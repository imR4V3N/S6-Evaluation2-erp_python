(()=>{var p=Object.defineProperty;var m=Object.getOwnPropertySymbols;var c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable;var f=(i,e,a)=>e in i?p(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a,_=(i,e)=>{for(var a in e||(e={}))c.call(e,a)&&f(i,a,e[a]);if(m)for(var a of m(e))u.call(e,a)&&f(i,a,e[a]);return i};var n=class{constructor({wrapper:e,page:a,frm:r,bom_configurator:t}){this.$wrapper=$(e),this.page=a,this.bom_configurator=t,this.frm=r,this.make(),this.prepare_layout(),this.bind_events()}add_boms(){this.frm.call({method:"add_boms",freeze:!0,doc:this.frm.doc})}make(){let e=_(_({},this.tree_options()),this.tree_methods());frappe.views.trees["BOM Configurator"]=new frappe.views.TreeView(e);let a=frappe.views.trees["BOM Configurator"].tree.root_node;frappe.views.trees["BOM Configurator"].tree.show_toolbar(a),frappe.views.trees["BOM Configurator"].tree.load_children(a,!0),this.tree_view=frappe.views.trees["BOM Configurator"]}bind_events(){frappe.views.trees["BOM Configurator"].events={frm:this.frm,add_item:this.add_item,add_sub_assembly:this.add_sub_assembly,get_sub_assembly_modal_fields:this.get_sub_assembly_modal_fields,convert_to_sub_assembly:this.convert_to_sub_assembly,delete_node:this.delete_node,edit_qty:this.edit_qty,load_tree:this.load_tree,set_default_qty:this.set_default_qty}}tree_options(){return{parent:this.$wrapper.get(0),body:this.$wrapper.get(0),doctype:"BOM Configurator",page:this.page,expandable:!0,title:__("Configure Product Assembly"),breadcrumb:"Manufacturing",get_tree_nodes:"erpnext.manufacturing.doctype.bom_creator.bom_creator.get_children",root_label:this.frm.doc.item_code,disable_add_node:!0,get_tree_root:!1,show_expand_all:!1,extend_toolbar:!1,do_not_make_page:!0,do_not_setup_menu:!0}}tree_methods(){var r;let e=this,a=frappe.views.trees["BOM Configurator"];return{onload:function(t){t.args.parent_id=e.frm.doc.name,t.args.parent=e.frm.doc.item_code,t.parent=e.$wrapper.get(0),t.body=e.$wrapper.get(0),t.make_tree()},onrender(t){let l=t.data.qty||e.frm.doc.qty,d=t.data.uom||e.frm.doc.uom,o=t.data.name||e.frm.doc.name,s=t.data.amount;t.data.value===e.frm.doc.item_code&&(s=e.frm.doc.raw_material_cost),s=frappe.format(s,{fieldtype:"Currency",currency:e.frm.doc.currency}),$(`
					<div class="pill small pull-right bom-qty-pill"
						style="background-color: var(--bg-white);
							color: var(--text-on-gray);
							font-weight:450;
							margin-right: 40px;
							display: inline-flex;
							min-width: 128px;
							border: 1px solid var(--bg-gray);
						">
							<div style="padding-right:5px" data-bom-qty-docname="${o}">${l} ${d}</div>
							<div class="fg-item-amt" style="padding-left:12px; border-left:1px solid var(--bg-gray)">
								${s}
							</div>
					</div>

				`).insertBefore(t.$ul)},toolbar:((r=this.frm)==null?void 0:r.doc.docstatus)===0?[{label:`${frappe.utils.icon("edit","sm")} ${__("Qty")}`,click:function(t){let l=frappe.views.trees["BOM Configurator"];l.events.edit_qty(t,l)},btnClass:"hidden-xs"},{label:`${frappe.utils.icon("add","sm")} ${__("Raw Material")}`,click:function(t){let l=frappe.views.trees["BOM Configurator"];l.events.add_item(t,l)},condition:function(t){return t.expandable},btnClass:"hidden-xs"},{label:`${frappe.utils.icon("add","sm")} ${__("Sub Assembly")}`,click:function(t){let l=frappe.views.trees["BOM Configurator"];l.events.add_sub_assembly(t,l)},condition:function(t){return t.expandable},btnClass:"hidden-xs"},{label:__("Collapse All"),click:function(t){let l=frappe.views.trees["BOM Configurator"];t.expanded?(t.$tree_link.trigger("click"),t.$toolbar.find(".expand-all-btn").html(__("Expand All"))):(l.tree.load_children(t,!0),$(t.parent[0]).find(".tree-children").show(),t.$toolbar.find(".expand-all-btn").html(__("Collapse All")))},condition:function(t){return t.expandable&&t.is_root},btnClass:"hidden-xs expand-all-btn"},{label:`${frappe.utils.icon("move","sm")} ${__("Sub Assembly")}`,click:function(t){let l=frappe.views.trees["BOM Configurator"];l.events.convert_to_sub_assembly(t,l)},condition:function(t){return!t.expandable},btnClass:"hidden-xs"},{label:`${frappe.utils.icon("delete","sm")} ${__("Item")}`,click:function(t){let l=frappe.views.trees["BOM Configurator"];l.events.delete_node(t,l)},condition:function(t){return!t.is_root},btnClass:"hidden-xs"}]:[{label:__("Expand All"),click:function(t){let l=frappe.views.trees["BOM Configurator"];t.expanded?(t.$tree_link.trigger("click"),t.$toolbar.find(".expand-all-btn").html(__("Expand All"))):(l.tree.load_children(t,!0),$(t.parent[0]).find(".tree-children").show(),t.$toolbar.find(".expand-all-btn").html(__("Collapse All")))},condition:function(t){return t.expandable&&t.is_root},btnClass:"hidden-xs expand-all-btn"}]}}add_item(e,a){frappe.prompt([{label:__("Item"),fieldname:"item_code",fieldtype:"Link",options:"Item",reqd:1},{label:__("Qty"),fieldname:"qty",default:1,fieldtype:"Float",reqd:1},{label:__("Allow Alternative Item"),fieldname:"allow_alternative_item",default:1,fieldtype:"Check",reqd:1}],r=>{e.data.parent_id||(e.data.parent_id=this.frm.doc.name),frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_item",args:{parent:e.data.parent_id,fg_item:e.data.value,item_code:r.item_code,fg_reference_id:e.data.name||this.frm.doc.name,qty:r.qty,allow_alternative_item:r.allow_alternative_item},callback:t=>{a.events.load_tree(t,e)}})},__("Add Item"),__("Add"))}add_sub_assembly(e,a){let r=new frappe.ui.Dialog({fields:a.events.get_sub_assembly_modal_fields(),title:__("Add Sub Assembly")});r.show(),a.events.set_default_qty(r),r.set_primary_action(__("Add"),()=>{var l;let t=r.get_values();(l=e.data)!=null&&l.parent_id||(e.data.parent_id=this.frm.doc.name),frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_sub_assembly",args:{parent:e.data.parent_id,fg_item:e.data.value,fg_reference_id:e.data.name||this.frm.doc.name,bom_item:t,allow_alternative_item:t.allow_alternative_item},callback:d=>{a.events.load_tree(d,e)}}),r.hide()})}get_sub_assembly_modal_fields(e=!1){return[{label:__("Sub Assembly Item"),fieldname:"item_code",fieldtype:"Link",options:"Item",reqd:1,read_only:e},{label:__("Allow Alternative Item"),fieldname:"allow_alternative_item",default:1,fieldtype:"Check",reqd:1,read_only:e},{fieldtype:"Column Break"},{label:__("Qty"),fieldname:"qty",default:1,fieldtype:"Float",reqd:1,read_only:e,change(){this.layout.fields_dict.items.grid.data.forEach(a=>{a.qty=flt(this.value)}),this.layout.fields_dict.items.grid.refresh()}},{fieldtype:"Section Break"},{label:__("Raw Materials"),fieldname:"items",fieldtype:"Table",reqd:1,fields:[{label:__("Item"),fieldname:"item_code",fieldtype:"Link",options:"Item",reqd:1,in_list_view:1},{label:__("Qty"),fieldname:"qty",default:1,fieldtype:"Float",reqd:1,in_list_view:1}]}]}convert_to_sub_assembly(e,a){let r=new frappe.ui.Dialog({fields:a.events.get_sub_assembly_modal_fields(!0),title:__("Add Sub Assembly")});r.set_values({item_code:e.data.value,qty:e.data.qty}),r.show(),a.events.set_default_qty(r),r.set_primary_action(__("Add"),()=>{let t=r.get_values();frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_sub_assembly",args:{parent:e.data.parent_id,fg_item:e.data.value,bom_item:t,fg_reference_id:e.data.name||this.frm.doc.name,convert_to_sub_assembly:!0},callback:l=>{e.expandable=!0,a.events.load_tree(l,e)}}),r.hide()})}set_default_qty(e){e.fields_dict.items.grid.fields_map.item_code.onchange=function(a){if(a){let r=$(a.currentTarget).closest(".grid-row").attr("data-name"),t=e.fields_dict.items.grid.grid_rows_by_docname[r].doc;t.qty=1,e.fields_dict.items.grid.refresh()}}}delete_node(e,a){frappe.confirm(__("Are you sure you want to delete this Item?"),()=>{frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.delete_node",args:{parent:e.data.parent_id,fg_item:e.data.value,doctype:e.data.doctype,docname:e.data.name},callback:r=>{a.events.load_tree(r,e.parent_node)}})})}edit_qty(e,a){let r=e.data.qty||this.frm.doc.qty;frappe.prompt([{label:__("Qty"),fieldname:"qty",default:r,fieldtype:"Float",reqd:1}],t=>{let l=e.data.doctype||this.frm.doc.doctype,d=e.data.name||this.frm.doc.name;frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.edit_qty",args:{doctype:l,docname:d,qty:t.qty,parent:e.data.parent_id},callback:o=>{e.data.qty=t.qty;let s=e.data.uom||this.frm.doc.uom;$(e.parent.get(0)).find(`[data-bom-qty-docname='${d}']`).html(t.qty+" "+s),a.events.load_tree(o,e)}})},__("Edit Qty"),__("Update"))}prepare_layout(){let e=$(this.page)[0];e.style.marginBottom="15px",$(e).find(".tree-children")[0].style.minHeight="370px",$(e).find(".tree-children")[0].style.maxHeight="370px",$(e).find(".tree-children")[0].style.overflowY="auto"}load_tree(e,a){let r="",t="",l=e.message.raw_material_cost;for(frappe.views.trees["BOM Configurator"].tree.load_children(a);a;)r=e.message.items.filter(d=>d.name===a.data.name),r!=null&&r.length?(a.data.amount=r[0].amount,l=a.data.amount):l=e.message.raw_material_cost,t=$(a.parent.get(0)),l=frappe.format(l,{fieldtype:"Currency",currency:this.frm.doc.currency}),$($(t).find(".fg-item-amt")[0]).html(l),a=a.parent_node}};frappe.ui.BOMConfigurator=n;})();
//# sourceMappingURL=bom_configurator.bundle.EPDHTEL3.js.map
