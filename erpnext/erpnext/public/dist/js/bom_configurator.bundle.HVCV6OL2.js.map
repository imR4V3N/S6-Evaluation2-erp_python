{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/erpnext/public/js/bom_configurator/bom_configurator.bundle.js"],
  "sourcesContent": ["class BOMConfigurator {\n\tconstructor({ wrapper, page, frm, bom_configurator }) {\n\t\tthis.$wrapper = $(wrapper);\n\t\tthis.page = page;\n\t\tthis.bom_configurator = bom_configurator;\n\t\tthis.frm = frm;\n\n\t\tthis.make();\n\t\tthis.prepare_layout();\n\t\tthis.bind_events();\n\t}\n\n\tadd_boms() {\n\t\tthis.frm.call({\n\t\t\tmethod: \"add_boms\",\n\t\t\tfreeze: true,\n\t\t\tdoc: this.frm.doc,\n\t\t});\n\t}\n\n\tmake() {\n\t\tlet options = {\n\t\t\t...this.tree_options(),\n\t\t\t...this.tree_methods(),\n\t\t};\n\n\t\tfrappe.views.trees[\"BOM Configurator\"] = new frappe.views.TreeView(options);\n\t\tlet node = frappe.views.trees[\"BOM Configurator\"].tree.root_node;\n\t\tfrappe.views.trees[\"BOM Configurator\"].tree.show_toolbar(node);\n\t\tfrappe.views.trees[\"BOM Configurator\"].tree.load_children(node, true);\n\t\tthis.tree_view = frappe.views.trees[\"BOM Configurator\"];\n\t}\n\n\tbind_events() {\n\t\tfrappe.views.trees[\"BOM Configurator\"].events = {\n\t\t\tfrm: this.frm,\n\t\t\tadd_item: this.add_item,\n\t\t\tadd_sub_assembly: this.add_sub_assembly,\n\t\t\tset_query_for_workstation: this.set_query_for_workstation,\n\t\t\tget_sub_assembly_modal_fields: this.get_sub_assembly_modal_fields,\n\t\t\tconvert_to_sub_assembly: this.convert_to_sub_assembly,\n\t\t\tdelete_node: this.delete_node,\n\t\t\tedit_bom: this.edit_bom,\n\t\t\tload_tree: this.load_tree,\n\t\t\tset_default_qty: this.set_default_qty,\n\t\t};\n\t}\n\n\ttree_options() {\n\t\treturn {\n\t\t\tparent: this.$wrapper.get(0),\n\t\t\tbody: this.$wrapper.get(0),\n\t\t\tdoctype: \"BOM Configurator\",\n\t\t\tpage: this.page,\n\t\t\texpandable: true,\n\t\t\ttitle: __(\"Configure Product Assembly\"),\n\t\t\tbreadcrumb: \"Manufacturing\",\n\t\t\tget_tree_nodes: \"erpnext.manufacturing.doctype.bom_creator.bom_creator.get_children\",\n\t\t\troot_label: this.frm.doc.item_code,\n\t\t\tdisable_add_node: true,\n\t\t\tget_tree_root: false,\n\t\t\tshow_expand_all: false,\n\t\t\textend_toolbar: false,\n\t\t\tdo_not_make_page: true,\n\t\t\tdo_not_setup_menu: true,\n\t\t};\n\t}\n\n\ttree_methods() {\n\t\tlet frm_obj = this;\n\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\n\t\treturn {\n\t\t\tonload: function (me) {\n\t\t\t\tme.args[\"parent_id\"] = frm_obj.frm.doc.name;\n\t\t\t\tme.args[\"parent\"] = frm_obj.frm.doc.item_code;\n\t\t\t\tme.parent = frm_obj.$wrapper.get(0);\n\t\t\t\tme.body = frm_obj.$wrapper.get(0);\n\t\t\t\tme.make_tree();\n\t\t\t},\n\t\t\tonrender(node) {\n\t\t\t\tconst qty = node.data.qty || frm_obj.frm.doc.qty;\n\t\t\t\tconst uom = node.data.uom || frm_obj.frm.doc.uom;\n\t\t\t\tconst docname = node.data.name || frm_obj.frm.doc.name;\n\t\t\t\tlet amount = node.data.amount;\n\t\t\t\tif (node.data.value === frm_obj.frm.doc.item_code) {\n\t\t\t\t\tamount = frm_obj.frm.doc.raw_material_cost;\n\t\t\t\t}\n\n\t\t\t\tamount = frappe.format(amount, { fieldtype: \"Currency\", currency: frm_obj.frm.doc.currency });\n\n\t\t\t\t$(`\n\t\t\t\t\t<div class=\"pill small pull-right bom-qty-pill\"\n\t\t\t\t\t\tstyle=\"background-color: var(--bg-white);\n\t\t\t\t\t\t\tcolor: var(--text-on-gray);\n\t\t\t\t\t\t\tfont-weight:450;\n\t\t\t\t\t\t\tmargin-right: 40px;\n\t\t\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\t\t\tmin-width: 128px;\n\t\t\t\t\t\t\tborder: 1px solid var(--bg-gray);\n\t\t\t\t\t\t\">\n\t\t\t\t\t\t\t<div style=\"padding-right:5px\" data-bom-qty-docname=\"${docname}\">${qty} ${uom}</div>\n\t\t\t\t\t\t\t<div class=\"fg-item-amt\" style=\"padding-left:12px; border-left:1px solid var(--bg-gray)\">\n\t\t\t\t\t\t\t\t${amount}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t`).insertBefore(node.$ul);\n\t\t\t},\n\t\t\ttoolbar:\n\t\t\t\tthis.frm?.doc.docstatus === 0\n\t\t\t\t\t? [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __(frappe.utils.icon(\"edit\", \"sm\") + \" BOM\"),\n\t\t\t\t\t\t\t\tclick: function (node) {\n\t\t\t\t\t\t\t\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\t\t\t\t\t\t\t\t\tview.events.edit_bom(node, view);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbtnClass: \"hidden-xs\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __(frappe.utils.icon(\"add\", \"sm\") + \" Raw Material\"),\n\t\t\t\t\t\t\t\tclick: function (node) {\n\t\t\t\t\t\t\t\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\t\t\t\t\t\t\t\t\tview.events.add_item(node, view);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcondition: function (node) {\n\t\t\t\t\t\t\t\t\treturn node.expandable;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbtnClass: \"hidden-xs\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __(frappe.utils.icon(\"add\", \"sm\") + \" Sub Assembly\"),\n\t\t\t\t\t\t\t\tclick: function (node) {\n\t\t\t\t\t\t\t\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\t\t\t\t\t\t\t\t\tview.events.add_sub_assembly(node, view);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcondition: function (node) {\n\t\t\t\t\t\t\t\t\treturn node.expandable;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbtnClass: \"hidden-xs\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __(\"Collapse All\"),\n\t\t\t\t\t\t\t\tclick: function (node) {\n\t\t\t\t\t\t\t\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\n\t\t\t\t\t\t\t\t\tif (!node.expanded) {\n\t\t\t\t\t\t\t\t\t\tview.tree.load_children(node, true);\n\t\t\t\t\t\t\t\t\t\t$(node.parent[0]).find(\".tree-children\").show();\n\t\t\t\t\t\t\t\t\t\tnode.$toolbar.find(\".expand-all-btn\").html(__(\"Collapse All\"));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tnode.$tree_link.trigger(\"click\");\n\t\t\t\t\t\t\t\t\t\tnode.$toolbar.find(\".expand-all-btn\").html(__(\"Expand All\"));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcondition: function (node) {\n\t\t\t\t\t\t\t\t\treturn node.expandable && node.is_root;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbtnClass: \"hidden-xs expand-all-btn\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __(frappe.utils.icon(\"move\", \"sm\") + \" Sub Assembly\"),\n\t\t\t\t\t\t\t\tclick: function (node) {\n\t\t\t\t\t\t\t\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\t\t\t\t\t\t\t\t\tview.events.convert_to_sub_assembly(node, view);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcondition: function (node) {\n\t\t\t\t\t\t\t\t\treturn !node.expandable;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbtnClass: \"hidden-xs\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __(frappe.utils.icon(\"delete\", \"sm\") + \" Item\"),\n\t\t\t\t\t\t\t\tclick: function (node) {\n\t\t\t\t\t\t\t\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\t\t\t\t\t\t\t\t\tview.events.delete_node(node, view);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcondition: function (node) {\n\t\t\t\t\t\t\t\t\treturn !node.is_root;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbtnClass: \"hidden-xs\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t  ]\n\t\t\t\t\t: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __(\"Expand All\"),\n\t\t\t\t\t\t\t\tclick: function (node) {\n\t\t\t\t\t\t\t\t\tlet view = frappe.views.trees[\"BOM Configurator\"];\n\n\t\t\t\t\t\t\t\t\tif (!node.expanded) {\n\t\t\t\t\t\t\t\t\t\tview.tree.load_children(node, true);\n\t\t\t\t\t\t\t\t\t\t$(node.parent[0]).find(\".tree-children\").show();\n\t\t\t\t\t\t\t\t\t\tnode.$toolbar.find(\".expand-all-btn\").html(__(\"Collapse All\"));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tnode.$tree_link.trigger(\"click\");\n\t\t\t\t\t\t\t\t\t\tnode.$toolbar.find(\".expand-all-btn\").html(__(\"Expand All\"));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcondition: function (node) {\n\t\t\t\t\t\t\t\t\treturn node.expandable && node.is_root;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbtnClass: \"hidden-xs expand-all-btn\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t  ],\n\t\t};\n\t}\n\n\tadd_item(node, view) {\n\t\tfrappe.prompt(\n\t\t\t[\n\t\t\t\t{ label: __(\"Item\"), fieldname: \"item_code\", fieldtype: \"Link\", options: \"Item\", reqd: 1 },\n\t\t\t\t{ label: __(\"Qty\"), fieldname: \"qty\", default: 1.0, fieldtype: \"Float\", reqd: 1 },\n\t\t\t],\n\t\t\t(data) => {\n\t\t\t\tif (!node.data.parent_id) {\n\t\t\t\t\tnode.data.parent_id = this.frm.doc.name;\n\t\t\t\t}\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_item\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tparent: node.data.parent_id,\n\t\t\t\t\t\tfg_item: node.data.value,\n\t\t\t\t\t\titem_code: data.item_code,\n\t\t\t\t\t\tfg_reference_id: node.data.name || this.frm.doc.name,\n\t\t\t\t\t\tqty: data.qty,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tview.events.load_tree(r, node);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t__(\"Add Item\"),\n\t\t\t__(\"Add\")\n\t\t);\n\t}\n\n\tset_query_for_workstation(dialog) {\n\t\tlet workstation = dialog.fields.filter((field) => field.fieldname === \"workstation\");\n\t\tif (workstation.length) {\n\t\t\tworkstation[0].get_query = function () {\n\t\t\t\tlet workstation_type = dialog.get_value(\"workstation_type\");\n\n\t\t\t\tif (workstation_type) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tworkstation_type: dialog.get_value(\"workstation_type\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tadd_sub_assembly(node, view) {\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\tfields: view.events.get_sub_assembly_modal_fields(view, node.is_root),\n\t\t\ttitle: __(\"Add Sub Assembly\"),\n\t\t});\n\t\tview.events.set_query_for_workstation(dialog);\n\n\t\tdialog.show();\n\t\tdialog.set_primary_action(__(\"Add\"), () => {\n\t\t\tlet bom_item = dialog.get_values();\n\n\t\t\tif (dialog.operation && !dialog.workstation_type && !dialog.workstation) {\n\t\t\t\tfrappe.throw(__(\"Either Workstation or Workstation Type is mandatory\"));\n\t\t\t}\n\n\t\t\tif (!node.data?.parent_id) {\n\t\t\t\tnode.data.parent_id = this.frm.doc.name;\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_sub_assembly\",\n\t\t\t\targs: {\n\t\t\t\t\tparent: node.data.parent_id,\n\t\t\t\t\tfg_item: node.data.value,\n\t\t\t\t\tfg_reference_id: node.data.name || this.frm.doc.name,\n\t\t\t\t\tbom_item: bom_item,\n\t\t\t\t\toperation: node.data.operation,\n\t\t\t\t\tworkstation_type: node.data.workstation_type,\n\t\t\t\t\toperation_time: node.data.operation_time,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tview.events.load_tree(r, node);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tdialog.hide();\n\t\t});\n\t}\n\n\tget_sub_assembly_modal_fields(view, is_root = false, read_only = false) {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tlabel: __(\"Sub Assembly Item\"),\n\t\t\t\tfieldname: \"item_code\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Item\",\n\t\t\t\treqd: 1,\n\t\t\t\tread_only: read_only,\n\t\t\t},\n\t\t\t{ fieldtype: \"Column Break\" },\n\t\t\t{\n\t\t\t\tlabel: __(\"Qty\"),\n\t\t\t\tfieldname: \"qty\",\n\t\t\t\tdefault: 1.0,\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\treqd: 1,\n\t\t\t\tread_only: read_only,\n\t\t\t\tchange() {\n\t\t\t\t\tthis.layout.fields_dict.items.grid.data.forEach((row) => {\n\t\t\t\t\t\trow.qty = flt(this.value);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.layout.fields_dict.items.grid.refresh();\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tif (is_root) {\n\t\t\tfields.push(\n\t\t\t\t...[\n\t\t\t\t\t{ fieldtype: \"Section Break\" },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: __(\"Operation\"),\n\t\t\t\t\t\tfieldname: \"operation\",\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\toptions: \"Operation\",\n\t\t\t\t\t\tget_query() {\n\t\t\t\t\t\t\tlet doc = view.events.frm.doc;\n\n\t\t\t\t\t\t\tif (doc.routing) {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tquery: \"erpnext.manufacturing.doctype.routing.routing.get_operations\",\n\t\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\t\trouting: doc.routing,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t]\n\t\t\t);\n\t\t}\n\n\t\tfields.push(\n\t\t\t...[\n\t\t\t\t{ fieldtype: \"Section Break\" },\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Raw Materials\"),\n\t\t\t\t\tfieldname: \"items\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Item\"),\n\t\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\t\toptions: \"Item\",\n\t\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\t\tchange() {\n\t\t\t\t\t\t\t\tlet doc = this.doc;\n\t\t\t\t\t\t\t\tdoc.qty = 1.0;\n\t\t\t\t\t\t\t\tthis.grid.set_value(\"qty\", 1.0, doc);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Qty\"),\n\t\t\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\t\t\tdefault: 1.0,\n\t\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t]\n\t\t);\n\n\t\treturn fields;\n\t}\n\n\tconvert_to_sub_assembly(node, view) {\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\tfields: view.events.get_sub_assembly_modal_fields(view, node.is_root, true),\n\t\t\ttitle: __(\"Add Sub Assembly\"),\n\t\t});\n\n\t\tdialog.set_values({\n\t\t\titem_code: node.data.value,\n\t\t\tqty: node.data.qty,\n\t\t});\n\n\t\tdialog.show();\n\t\tdialog.set_primary_action(__(\"Add\"), () => {\n\t\t\tlet bom_item = dialog.get_values();\n\n\t\t\tif (!bom_item.item_code) {\n\t\t\t\tfrappe.throw(__(\"Sub Assembly Item is mandatory\"));\n\t\t\t}\n\n\t\t\tbom_item.items.forEach((d) => {\n\t\t\t\tif (!d.item_code) {\n\t\t\t\t\tfrappe.throw(__(\"Item is mandatory in Raw Materials table.\"));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (dialog.operation && !dialog.workstation_type && !dialog.workstation) {\n\t\t\t\tfrappe.throw(__(\"Either Workstation or Workstation Type is mandatory\"));\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_sub_assembly\",\n\t\t\t\targs: {\n\t\t\t\t\tparent: node.data.parent_id,\n\t\t\t\t\tfg_item: node.data.value,\n\t\t\t\t\tbom_item: bom_item,\n\t\t\t\t\tfg_reference_id: node.data.name || this.frm.doc.name,\n\t\t\t\t\tconvert_to_sub_assembly: true,\n\t\t\t\t\toperation: node.data.operation,\n\t\t\t\t\tworkstation_type: node.data.workstation_type,\n\t\t\t\t\toperation_time: node.data.operation_time,\n\t\t\t\t\tworkstation: node.data.workstation,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tnode.expandable = true;\n\t\t\t\t\tview.events.load_tree(r, node.parent_node);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tdialog.hide();\n\t\t});\n\t}\n\n\tset_default_qty(dialog) {\n\t\tdialog.fields_dict.items.grid.fields_map.item_code.onchange = function (event) {\n\t\t\tif (event) {\n\t\t\t\tlet name = $(event.currentTarget).closest(\".grid-row\").attr(\"data-name\");\n\t\t\t\tlet item_row = dialog.fields_dict.items.grid.grid_rows_by_docname[name].doc;\n\t\t\t\titem_row.qty = 1;\n\t\t\t\tdialog.fields_dict.items.grid.refresh();\n\t\t\t}\n\t\t};\n\t}\n\n\tdelete_node(node, view) {\n\t\tfrappe.confirm(__(\"Are you sure you want to delete this Item?\"), () => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.manufacturing.doctype.bom_creator.bom_creator.delete_node\",\n\t\t\t\targs: {\n\t\t\t\t\tparent: node.data.parent_id,\n\t\t\t\t\tfg_item: node.data.value,\n\t\t\t\t\tdoctype: node.data.doctype,\n\t\t\t\t\tdocname: node.data.name,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tview.events.load_tree(r, node.parent_node);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tedit_bom(node, view) {\n\t\tlet me = this;\n\t\tlet qty = node.data.qty || this.frm.doc.qty;\n\t\tlet fields = [{ label: __(\"Qty\"), fieldname: \"qty\", default: qty, fieldtype: \"Float\", reqd: 1 }];\n\n\t\tthis.frm.edit_bom_dialog = frappe.prompt(\n\t\t\tfields,\n\t\t\t(data) => {\n\t\t\t\tlet doctype = node.data.doctype || this.frm.doc.doctype;\n\t\t\t\tlet docname = node.data.name || this.frm.doc.name;\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.manufacturing.doctype.bom_creator.bom_creator.edit_bom_creator\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: doctype,\n\t\t\t\t\t\tdocname: docname,\n\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\tparent: node.data.parent_id || this.frm.doc.name,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tfor (let key in data) {\n\t\t\t\t\t\t\tnode.data[key] = data[key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet uom = node.data.uom || this.frm.doc.uom;\n\t\t\t\t\t\t$(node.parent.get(0))\n\t\t\t\t\t\t\t.find(`[data-bom-qty-docname='${docname}']`)\n\t\t\t\t\t\t\t.html(data.qty + \" \" + uom);\n\t\t\t\t\t\tview.events.load_tree(r, node);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t__(\"Edit BOM\"),\n\t\t\t__(\"Update\")\n\t\t);\n\t}\n\n\tprepare_layout() {\n\t\tlet main_div = $(this.page)[0];\n\n\t\tmain_div.style.marginBottom = \"15px\";\n\t\t$(main_div).find(\".tree-children\")[0].style.minHeight = \"370px\";\n\t\t$(main_div).find(\".tree-children\")[0].style.maxHeight = \"370px\";\n\t\t$(main_div).find(\".tree-children\")[0].style.overflowY = \"auto\";\n\t}\n\n\tload_tree(response, node) {\n\t\tlet item_row = \"\";\n\t\tlet parent_dom = \"\";\n\t\tlet total_amount = response.message.raw_material_cost;\n\n\t\tfrappe.views.trees[\"BOM Configurator\"].tree.load_children(node);\n\n\t\twhile (node) {\n\t\t\titem_row = response.message.items.filter((item) => item.name === node.data.name);\n\n\t\t\tif (item_row?.length) {\n\t\t\t\tnode.data.amount = item_row[0].amount;\n\t\t\t\ttotal_amount = node.data.amount;\n\t\t\t} else {\n\t\t\t\ttotal_amount = response.message.raw_material_cost;\n\t\t\t}\n\n\t\t\tparent_dom = $(node.parent.get(0));\n\t\t\ttotal_amount = frappe.format(total_amount, {\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tcurrency: this.frm.doc.currency,\n\t\t\t});\n\n\t\t\t$($(parent_dom).find(\".fg-item-amt\")[0]).html(total_amount);\n\t\t\tnode = node.parent_node;\n\t\t}\n\t}\n}\n\nfrappe.ui.BOMConfigurator = BOMConfigurator;\n"],
  "mappings": "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",
  "names": ["BOMConfigurator", "wrapper", "page", "frm", "bom_configurator", "options", "__spreadValues", "node", "_a", "frm_obj", "view", "me", "qty", "uom", "docname", "amount", "data", "r", "dialog", "workstation", "field", "bom_item", "is_root", "read_only", "fields", "row", "doc", "d", "event", "name", "item_row", "doctype", "key", "main_div", "response", "parent_dom", "total_amount", "item"]
}
