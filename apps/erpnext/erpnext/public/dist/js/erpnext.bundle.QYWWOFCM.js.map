{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/erpnext/public/js/conf.js", "../../../../../apps/erpnext/erpnext/public/js/utils.js", "../../../../../apps/erpnext/erpnext/public/js/stock_reservation.js", "../../../../../apps/erpnext/erpnext/public/js/queries.js", "../../../../../apps/erpnext/erpnext/public/js/sms_manager.js", "../../../../../apps/erpnext/erpnext/public/js/utils/party.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js", "../../../../../apps/erpnext/erpnext/public/js/utils/serial_no_batch_selector.js", "../../../../../apps/erpnext/erpnext/public/js/payment/payments.js", "frappe-html:/home/raven/Workspace/Evaluation2/Evaluation2-erp_python/erp-local/apps/erpnext/erpnext/public/js/templates/visual_plant_floor_template.html", "../../../../../apps/erpnext/erpnext/public/js/plant_floor_visual/visual_plant.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/transaction.js", "frappe-html:/home/raven/Workspace/Evaluation2/Evaluation2-erp_python/erp-local/apps/erpnext/erpnext/public/js/templates/item_selector.html", "../../../../../apps/erpnext/erpnext/public/js/utils/item_selector.js", "../../../../../apps/erpnext/erpnext/public/js/help_links.js", "frappe-html:/home/raven/Workspace/Evaluation2/Evaluation2-erp_python/erp-local/apps/erpnext/erpnext/public/js/templates/item_quick_entry.html", "../../../../../apps/erpnext/erpnext/public/js/utils/contact_address_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/utils/supplier_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/call_popup/call_popup.js", "../../../../../apps/erpnext/erpnext/public/js/utils/dimension_tree_filter.js", "../../../../../apps/erpnext/erpnext/public/js/utils/ledger_preview.js", "../../../../../apps/erpnext/erpnext/public/js/utils/unreconcile.js", "../../../../../apps/erpnext/erpnext/public/js/utils/barcode_scanner.js", "../../../../../apps/erpnext/erpnext/public/js/telephony.js", "frappe-html:/home/raven/Workspace/Evaluation2/Evaluation2-erp_python/erp-local/apps/erpnext/erpnext/public/js/templates/call_link.html", "../../../../../apps/erpnext/erpnext/public/js/bulk_transaction_processing.js", "../../../../../apps/erpnext/erpnext/public/js/utils/crm_activities.js", "frappe-html:/home/raven/Workspace/Evaluation2/Evaluation2-erp_python/erp-local/apps/erpnext/erpnext/public/js/templates/crm_activities.html", "frappe-html:/home/raven/Workspace/Evaluation2/Evaluation2-erp_python/erp-local/apps/erpnext/erpnext/public/js/templates/crm_notes.html", "../../../../../apps/erpnext/erpnext/public/js/controllers/accounts.js", "../../../../../apps/erpnext/erpnext/public/js/utils/landed_taxes_and_charges_common.js", "../../../../../apps/erpnext/erpnext/public/js/utils/sales_common.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/buying.js", "../../../../../apps/erpnext/erpnext/public/js/utils/demo.js", "../../../../../apps/erpnext/erpnext/public/js/financial_statements.js", "../../../../../apps/erpnext/erpnext/public/js/sales_trends_filters.js", "../../../../../apps/erpnext/erpnext/public/js/purchase_trends_filters.js"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext\");\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\tTerritory: \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\tBrand: \"Stock\",\n\t\"Maintenance Schedule\": \"Support\",\n\t\"Maintenance Visit\": \"Support\",\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t\"ERPNext Integrations\": \"Integrations\",\n\tGeo: \"Settings\",\n\tPortal: \"Website\",\n\tUtilities: \"Settings\",\n\t\"E-commerce\": \"Website\",\n\tContacts: \"CRM\",\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\nfrappe.provide(\"erpnext.stock.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function (company) {\n\t\tif (!company && cur_frm) company = cur_frm.doc.company;\n\t\tif (company)\n\t\t\treturn frappe.get_doc(\":Company\", company)?.default_currency || frappe.boot.sysdefaults.currency;\n\t\telse return frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter((d) => d.doctype === \":Currency\").map((d) => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function () {\n\t\tif (\n\t\t\tcur_frm &&\n\t\t\tcur_frm.fields_dict.naming_series &&\n\t\t\tcur_frm.meta.naming_rule == 'By \"Naming Series\" field'\n\t\t) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal ? true : false);\n\t\t}\n\t},\n\n\thide_company: function (frm) {\n\t\tif (frm?.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif (companies.length === 1) {\n\t\t\t\tif (!frm.doc.company) frm.set_value(\"company\", companies[0]);\n\t\t\t\tfrm.toggle_display(\"company\", false);\n\t\t\t} else if (erpnext.last_selected_company) {\n\t\t\t\tif (!frm.doc.company) frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function (company) {\n\t\tif (company) {\n\t\t\tlet company_local = locals[\":Company\"] && locals[\":Company\"][company];\n\t\t\tif (company_local) {\n\t\t\t\treturn cint(company_local.enable_perpetual_inventory);\n\t\t\t}\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_or_batch_no: function () {\n\t\t// Deprecated in v15\n\t},\n\n\troute_to_adjustment_jv: (args) => {\n\t\tfrappe.model.with_doctype(\"Journal Entry\", () => {\n\t\t\t// route to adjustment Journal Entry to handle Account Balance and Stock Value mismatch\n\t\t\tlet journal_entry = frappe.model.get_new_doc(\"Journal Entry\");\n\n\t\t\targs.accounts.forEach((je_account) => {\n\t\t\t\tlet child_row = frappe.model.add_child(journal_entry, \"accounts\");\n\t\t\t\tchild_row.account = je_account.account;\n\t\t\t\tchild_row.debit_in_account_currency = je_account.debit_in_account_currency;\n\t\t\t\tchild_row.credit_in_account_currency = je_account.credit_in_account_currency;\n\t\t\t\tchild_row.party_type = \"\";\n\t\t\t});\n\t\t\tfrappe.set_route(\"Form\", \"Journal Entry\", journal_entry.name);\n\t\t});\n\t},\n\n\troute_to_pending_reposts: (args) => {\n\t\tfrappe.set_route(\"List\", \"Repost Item Valuation\", args);\n\t},\n});\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function (frm) {\n\t\tif (frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif (company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function (info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(\n\t\t\t\t\t__(\"Annual Billing: {0}\", [\n\t\t\t\t\t\tformat_currency(\n\t\t\t\t\t\t\tcompany_wise_info[0].billing_this_year,\n\t\t\t\t\t\t\tcompany_wise_info[0].currency\n\t\t\t\t\t\t),\n\t\t\t\t\t]),\n\t\t\t\t\t\"blue\"\n\t\t\t\t);\n\t\t\t\tfrm.dashboard.add_indicator(\n\t\t\t\t\t__(\"Total Unpaid: {0}\", [\n\t\t\t\t\t\tformat_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency),\n\t\t\t\t\t]),\n\t\t\t\t\tcompany_wise_info[0].total_unpaid ? \"orange\" : \"green\"\n\t\t\t\t);\n\n\t\t\t\tif (company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(\n\t\t\t\t\t\t__(\"Loyalty Points: {0}\", [company_wise_info[0].loyalty_points]),\n\t\t\t\t\t\t\"blue\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tview_serial_batch_nos: function (frm) {\n\t\tif (!frm.doc?.items) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet bundle_ids = frm.doc.items.filter((d) => d.serial_and_batch_bundle);\n\n\t\tif (bundle_ids?.length) {\n\t\t\tfrm.add_custom_button(\n\t\t\t\t__(\"Serial / Batch Nos\"),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\tvoucher_no: frm.doc.name,\n\t\t\t\t\t\tvoucher_type: frm.doc.doctype,\n\t\t\t\t\t\tfrom_date: frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\t\t\tto_date: frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t};\n\t\t\t\t\tfrappe.set_route(\"query-report\", \"Serial and Batch Summary\");\n\t\t\t\t},\n\t\t\t\t__(\"View\")\n\t\t\t);\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function (frm, info) {\n\t\tfrm.dashboard.stats_area.show();\n\t\tfrm.dashboard.stats_area_row.addClass(\"flex\");\n\t\tfrm.dashboard.stats_area_row.css(\"flex-wrap\", \"wrap\");\n\n\t\tvar color = info.total_unpaid ? \"orange\" : \"green\";\n\n\t\tvar indicator = $(\n\t\t\t'<div class=\"flex-column col-xs-6\">' +\n\t\t\t\t'<div style=\"margin-top:10px\"><h6>' +\n\t\t\t\tinfo.company +\n\t\t\t\t\"</h6></div>\" +\n\t\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">' +\n\t\t\t\t\"Annual Billing: \" +\n\t\t\t\tformat_currency(info.billing_this_year, info.currency) +\n\t\t\t\t\"</span></div>\" +\n\t\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">' +\n\t\t\t\t'<span class=\"indicator ' +\n\t\t\t\tcolor +\n\t\t\t\t'\">Total Unpaid: ' +\n\t\t\t\tformat_currency(info.total_unpaid, info.currency) +\n\t\t\t\t\"</span></div>\" +\n\t\t\t\t\"</div>\"\n\t\t).appendTo(frm.dashboard.stats_area_row);\n\n\t\tif (info.loyalty_points) {\n\t\t\t$(\n\t\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">' +\n\t\t\t\t\t\"Loyalty Points: \" +\n\t\t\t\t\tinfo.loyalty_points +\n\t\t\t\t\t\"</span></div>\"\n\t\t\t).appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function (party_type) {\n\t\tvar dict = {\n\t\t\tCustomer: \"customer_name\",\n\t\t\tSupplier: \"supplier_name\",\n\t\t\tEmployee: \"employee_name\",\n\t\t\tMember: \"member_name\",\n\t\t};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function (doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif (d[fieldname]) {\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor (var i = 0; i < cl.length; i++) {\n\t\t\t\tif (!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function (tc_name, doc, callback) {\n\t\tif (tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions\",\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function (doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname,\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function (r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t},\n\t\t});\n\t},\n\n\tadd_dimensions: function (report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\tcallback: function (r) {\n\t\t\t\tlet accounting_dimensions = r.message[0];\n\t\t\t\taccounting_dimensions.forEach((dimension) => {\n\t\t\t\t\tlet found = filters.some((el) => el.fieldname === dimension[\"fieldname\"]);\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\tfieldname: dimension[\"fieldname\"],\n\t\t\t\t\t\t\tlabel: __(dimension[\"label\"]),\n\t\t\t\t\t\t\tfieldtype: \"MultiSelectList\",\n\t\t\t\t\t\t\tget_data: function (txt) {\n\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"document_type\"], txt);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t},\n\n\tadd_inventory_dimensions: function (report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.stock.doctype.inventory_dimension.inventory_dimension.get_inventory_dimensions\",\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message && r.message.length) {\n\t\t\t\t\tr.message.forEach((dimension) => {\n\t\t\t\t\t\tlet existing_filter = filters.filter((el) => el.fieldname === dimension[\"fieldname\"]);\n\n\t\t\t\t\t\tif (!existing_filter.length) {\n\t\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\t\tfieldname: dimension[\"fieldname\"],\n\t\t\t\t\t\t\t\tlabel: __(dimension[\"doctype\"]),\n\t\t\t\t\t\t\t\tfieldtype: \"MultiSelectList\",\n\t\t\t\t\t\t\t\tdepends_on:\n\t\t\t\t\t\t\t\t\treport_name === \"Stock Balance\"\n\t\t\t\t\t\t\t\t\t\t? \"eval:doc.show_dimension_wise_stock === 1\"\n\t\t\t\t\t\t\t\t\t\t: \"\",\n\t\t\t\t\t\t\t\tget_data: function (txt) {\n\t\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"doctype\"], txt);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texisting_filter[0][\"fieldtype\"] = \"MultiSelectList\";\n\t\t\t\t\t\t\texisting_filter[0][\"get_data\"] = function (txt) {\n\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"doctype\"], txt);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n\n\tmake_subscription: function (doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t},\n\t\t});\n\t},\n\n\tmake_pricing_rule: function (doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t},\n\t\t});\n\t},\n\n\t/**\n\t * Checks if the first row of a given child table is empty\n\t * @param child_table - Child table Doctype\n\t * @return {Boolean}\n\t **/\n\tfirst_row_is_empty: function (child_table) {\n\t\tif ($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes the first row of a child table if it is empty\n\t * @param {_Frm} frm - The current form\n\t * @param {String} child_table_name - The child table field name\n\t * @return {Boolean}\n\t **/\n\tremove_empty_first_row: function (frm, child_table_name) {\n\t\tconst rows = frm[\"doc\"][child_table_name];\n\t\tif (this.first_row_is_empty(rows)) {\n\t\t\tfrm[\"doc\"][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function (option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif (user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map((perm) => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function (c) {\n\t\t\t\treturn c.name;\n\t\t\t}).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function (option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif (options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\toverrides_parent_value_in_all_rows: function (doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tif (doc[parent_fieldname]) {\n\t\t\tlet cl = doc[table_fieldname] || [];\n\t\t\tfor (let i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t\tfrappe.refresh_field(table_fieldname);\n\t\t}\n\t},\n\tcreate_new_doc: function (doctype, update_fields) {\n\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\t\t\tfor (let [key, value] of Object.entries(update_fields)) {\n\t\t\t\tnew_doc[key] = value;\n\t\t\t}\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t});\n\t},\n\n\t// check if payments app is installed on site, if not warn user.\n\tcheck_payments_app: () => {\n\t\tif (frappe.boot.versions && !frappe.boot.versions.payments) {\n\t\t\tconst marketplace_link =\n\t\t\t\t'<a href=\"https://frappecloud.com/marketplace/apps/payments\">Marketplace</a>';\n\t\t\tconst github_link = '<a href=\"https://github.com/frappe/payments/\">GitHub</a>';\n\t\t\tconst msg = __(\"payments app is not installed. Please install it from {0} or {1}\", [\n\t\t\t\tmarketplace_link,\n\t\t\t\tgithub_link,\n\t\t\t]);\n\t\t\tfrappe.msgprint(msg);\n\t\t}\n\t},\n\n\tpick_serial_and_batch_bundle(frm, cdt, cdn, type_of_transaction, warehouse_field) {\n\t\tlet item_row = frappe.get_doc(cdt, cdn);\n\t\titem_row.type_of_transaction = type_of_transaction;\n\n\t\tfrappe.db.get_value(\"Item\", item_row.item_code, [\"has_batch_no\", \"has_serial_no\"]).then((r) => {\n\t\t\titem_row.has_batch_no = r.message.has_batch_no;\n\t\t\titem_row.has_serial_no = r.message.has_serial_no;\n\n\t\t\tnew erpnext.SerialBatchPackageSelector(frm, item_row, (r) => {\n\t\t\t\tif (r) {\n\t\t\t\t\tlet update_values = {\n\t\t\t\t\t\tserial_and_batch_bundle: r.name,\n\t\t\t\t\t\tqty: Math.abs(r.total_qty),\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!warehouse_field) {\n\t\t\t\t\t\twarehouse_field = \"warehouse\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif (r.warehouse) {\n\t\t\t\t\t\tupdate_values[warehouse_field] = r.warehouse;\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(item_row.doctype, item_row.name, update_values);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tget_fiscal_year: function (date, with_dates = false, raise_on_missing = true) {\n\t\tif (!frappe.boot.setup_complete) {\n\t\t\treturn;\n\t\t}\n\t\tif (!date) {\n\t\t\tdate = frappe.datetime.get_today();\n\t\t}\n\n\t\tlet fiscal_year = \"\";\n\t\tif (\n\t\t\tfrappe.boot.current_fiscal_year &&\n\t\t\tdate >= frappe.boot.current_fiscal_year[1] &&\n\t\t\tdate <= frappe.boot.current_fiscal_year[2]\n\t\t) {\n\t\t\tif (with_dates) fiscal_year = frappe.boot.current_fiscal_year;\n\t\t\telse fiscal_year = frappe.boot.current_fiscal_year[0];\n\t\t} else {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.accounts.utils.get_fiscal_year\",\n\t\t\t\ttype: \"GET\", // make it cacheable\n\t\t\t\targs: {\n\t\t\t\t\tdate: date,\n\t\t\t\t\traise_on_missing: raise_on_missing,\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tif (with_dates) fiscal_year = r.message;\n\t\t\t\t\t\telse fiscal_year = r.message[0];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn fiscal_year;\n\t},\n});\n\nerpnext.utils.select_alternate_items = function (opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || \"warehouse\";\n\tconst item_field = opts.item_field || \"item_code\";\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{ fieldtype: \"Section Break\", label: __(\"Items\") },\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"docname\",\n\t\t\t\t\t\thidden: 1,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\toptions: \"Item\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tfieldname: \"alternate_item\",\n\t\t\t\t\t\toptions: \"Item\",\n\t\t\t\t\t\tdefault: \"\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __(\"Alternate Item\"),\n\t\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\t\twarehouse: warehouse,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict.actual_qty.set_value(\n\t\t\t\t\t\t\t\t\t\t\tr.message || 0\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\titem_code: e.item_code,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tfieldname: \"warehouse\",\n\t\t\t\t\t\toptions: \"Warehouse\",\n\t\t\t\t\t\tdefault: \"\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __(\"Warehouse\"),\n\t\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\t\twarehouse: warehouse,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict.actual_qty.set_value(\n\t\t\t\t\t\t\t\t\t\t\tr.message || 0\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"actual_qty\",\n\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __(\"Available Qty\"),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t\tprimary_action: function () {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter((d) => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach((d) => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === \"Work Order Item\") {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"qty\", qty);\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, opts.original_item_field, d.item_code);\n\t\t\t\tfrm.trigger(item_field, row.doctype, row.name);\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __(\"Update\"),\n\t});\n\n\tfrm.doc[opts.child_docname].forEach((d) => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\tdocname: d.name,\n\t\t\t\titem_code: d[item_field],\n\t\t\t\twarehouse: d[warehouse_field],\n\t\t\t\tactual_qty: d.actual_qty,\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n};\n\nerpnext.utils.update_child_items = function (opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = typeof opts.cannot_add_row === \"undefined\" ? true : opts.cannot_add_row;\n\tconst child_docname = typeof opts.cannot_add_row === \"undefined\" ? \"items\" : opts.child_docname;\n\tconst child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n\tconst has_reserved_stock = opts.has_reserved_stock ? true : false;\n\tconst get_precision = (fieldname) => child_meta.fields.find((f) => f.fieldname == fieldname).precision;\n\n\tthis.data = frm.doc[opts.child_docname].map((d) => {\n\t\treturn {\n\t\t\tdocname: d.name,\n\t\t\tname: d.name,\n\t\t\titem_code: d.item_code,\n\t\t\titem_name: d.item_name,\n\t\t\tdelivery_date: d.delivery_date,\n\t\t\tschedule_date: d.schedule_date,\n\t\t\tconversion_factor: d.conversion_factor,\n\t\t\tqty: d.qty,\n\t\t\trate: d.rate,\n\t\t\tuom: d.uom,\n\t\t\tfg_item: d.fg_item,\n\t\t\tfg_item_qty: d.fg_item_qty,\n\t\t};\n\t});\n\n\tconst fields = [\n\t\t{\n\t\t\tfieldtype: \"Data\",\n\t\t\tfieldname: \"docname\",\n\t\t\tread_only: 1,\n\t\t\thidden: 1,\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Link\",\n\t\t\tfieldname: \"item_code\",\n\t\t\toptions: \"Item\",\n\t\t\tin_list_view: 1,\n\t\t\tread_only: 0,\n\t\t\tdisabled: 0,\n\t\t\tlabel: __(\"Item Code\"),\n\t\t\tget_query: function () {\n\t\t\t\tlet filters;\n\t\t\t\tif (frm.doc.doctype == \"Sales Order\") {\n\t\t\t\t\tfilters = { is_sales_item: 1 };\n\t\t\t\t} else if (frm.doc.doctype == \"Purchase Order\") {\n\t\t\t\t\tif (frm.doc.is_subcontracted) {\n\t\t\t\t\t\tif (frm.doc.is_old_subcontracting_flow) {\n\t\t\t\t\t\t\tfilters = { is_sub_contracted_item: 1 };\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfilters = { is_stock_item: 0 };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilters = { is_purchase_item: 1 };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\t\tfilters: filters,\n\t\t\t\t};\n\t\t\t},\n\t\t\tonchange: function () {\n\t\t\t\tconst me = this;\n\n\t\t\t\tfrm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: frm.doc,\n\t\t\t\t\t\tctx: {\n\t\t\t\t\t\t\titem_code: this.value,\n\t\t\t\t\t\t\tset_warehouse: frm.doc.set_warehouse,\n\t\t\t\t\t\t\tcustomer: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\t\t\tquotation_to: frm.doc.quotation_to,\n\t\t\t\t\t\t\tsupplier: frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: frm.doc.currency,\n\t\t\t\t\t\t\tis_internal_supplier: frm.doc.is_internal_supplier,\n\t\t\t\t\t\t\tis_internal_customer: frm.doc.is_internal_customer,\n\t\t\t\t\t\t\tconversion_rate: frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: frm.doc.selling_price_list || frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\t\torder_type: frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(frm.doc.is_pos),\n\t\t\t\t\t\t\tis_return: cint(frm.doc.is_return),\n\t\t\t\t\t\t\tis_subcontracted: frm.doc.is_subcontracted,\n\t\t\t\t\t\t\tignore_pricing_rule: frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\t\t\tname: frm.doc.name,\n\t\t\t\t\t\t\tqty: me.doc.qty || 1,\n\t\t\t\t\t\t\tuom: me.doc.uom,\n\t\t\t\t\t\t\tpos_profile: cint(frm.doc.is_pos) ? frm.doc.pos_profile : \"\",\n\t\t\t\t\t\t\ttax_category: frm.doc.tax_category,\n\t\t\t\t\t\t\tchild_doctype: frm.doc.doctype + \" Item\",\n\t\t\t\t\t\t\tis_old_subcontracting_flow: frm.doc.is_old_subcontracting_flow,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\tqty,\n\t\t\t\t\t\t\t\tprice_list_rate: rate,\n\t\t\t\t\t\t\t\tuom,\n\t\t\t\t\t\t\t\tconversion_factor,\n\t\t\t\t\t\t\t\titem_name,\n\t\t\t\t\t\t\t\tbom_no,\n\t\t\t\t\t\t\t} = r.message;\n\n\t\t\t\t\t\t\tconst row = dialog.fields_dict.trans_items.df.data.find(\n\t\t\t\t\t\t\t\t(doc) => doc.idx == me.doc.idx\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\t\tObject.assign(row, {\n\t\t\t\t\t\t\t\t\tconversion_factor: me.doc.conversion_factor || conversion_factor,\n\t\t\t\t\t\t\t\t\tuom: me.doc.uom || uom,\n\t\t\t\t\t\t\t\t\tqty: me.doc.qty || qty,\n\t\t\t\t\t\t\t\t\trate: me.doc.rate || rate,\n\t\t\t\t\t\t\t\t\titem_name: item_name,\n\t\t\t\t\t\t\t\t\tbom_no: bom_no,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Data\",\n\t\t\tfieldname: \"item_name\",\n\t\t\tlabel: __(\"Item Name\"),\n\t\t\tread_only: 1,\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Link\",\n\t\t\tfieldname: \"uom\",\n\t\t\toptions: \"UOM\",\n\t\t\tread_only: 0,\n\t\t\tlabel: __(\"UOM\"),\n\t\t\treqd: 1,\n\t\t\tonchange: function () {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\t\targs: { item_code: this.doc.item_code, uom: this.value },\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\tif (this.doc.conversion_factor == r.message.conversion_factor) return;\n\n\t\t\t\t\t\t\tconst docname = this.doc.docname;\n\t\t\t\t\t\t\tdialog.fields_dict.trans_items.df.data.some((doc) => {\n\t\t\t\t\t\t\t\tif (doc.docname == docname) {\n\t\t\t\t\t\t\t\t\tdoc.conversion_factor = r.message.conversion_factor;\n\t\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Float\",\n\t\t\tfieldname: \"qty\",\n\t\t\tdefault: 0,\n\t\t\tread_only: 0,\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Qty\"),\n\t\t\tprecision: get_precision(\"qty\"),\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Currency\",\n\t\t\tfieldname: \"rate\",\n\t\t\toptions: \"currency\",\n\t\t\tdefault: 0,\n\t\t\tread_only: 0,\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Rate\"),\n\t\t\tprecision: get_precision(\"rate\"),\n\t\t},\n\t];\n\n\tif (frm.doc.doctype == \"Sales Order\" || frm.doc.doctype == \"Purchase Order\") {\n\t\tfields.splice(2, 0, {\n\t\t\tfieldtype: \"Date\",\n\t\t\tfieldname: frm.doc.doctype == \"Sales Order\" ? \"delivery_date\" : \"schedule_date\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: frm.doc.doctype == \"Sales Order\" ? __(\"Delivery Date\") : __(\"Reqd by date\"),\n\t\t\tdefault: frm.doc.doctype == \"Sales Order\" ? frm.doc.delivery_date : frm.doc.schedule_date,\n\t\t\treqd: 1,\n\t\t});\n\t\tfields.splice(3, 0, {\n\t\t\tfieldtype: \"Float\",\n\t\t\tfieldname: \"conversion_factor\",\n\t\t\tlabel: __(\"Conversion Factor\"),\n\t\t\tprecision: get_precision(\"conversion_factor\"),\n\t\t});\n\t}\n\n\tif (\n\t\tfrm.doc.doctype == \"Purchase Order\" &&\n\t\tfrm.doc.is_subcontracted &&\n\t\t!frm.doc.is_old_subcontracting_flow\n\t) {\n\t\tfields.push(\n\t\t\t{\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tfieldname: \"fg_item\",\n\t\t\t\toptions: \"Item\",\n\t\t\t\treqd: 1,\n\t\t\t\tin_list_view: 0,\n\t\t\t\tread_only: 0,\n\t\t\t\tdisabled: 0,\n\t\t\t\tlabel: __(\"Finished Good Item\"),\n\t\t\t\tget_query: () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tis_stock_item: 1,\n\t\t\t\t\t\t\tis_sub_contracted_item: 1,\n\t\t\t\t\t\t\tdefault_bom: [\"!=\", \"\"],\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tfieldname: \"fg_item_qty\",\n\t\t\t\treqd: 1,\n\t\t\t\tdefault: 0,\n\t\t\t\tread_only: 0,\n\t\t\t\tin_list_view: 0,\n\t\t\t\tlabel: __(\"Finished Good Item Qty\"),\n\t\t\t\tprecision: get_precision(\"fg_item_qty\"),\n\t\t\t}\n\t\t);\n\t}\n\n\tlet dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tsize: \"extra-large\",\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: false,\n\t\t\t\treqd: 1,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: fields,\n\t\t\t},\n\t\t],\n\t\tprimary_action: function () {\n\t\t\tif (frm.doctype == \"Sales Order\" && has_reserved_stock) {\n\t\t\t\tthis.hide();\n\t\t\t\tfrappe.confirm(\n\t\t\t\t\t__(\n\t\t\t\t\t\t\"The reserved stock will be released when you update items. Are you certain you wish to proceed?\"\n\t\t\t\t\t),\n\t\t\t\t\t() => this.update_items()\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.update_items();\n\t\t\t}\n\t\t},\n\t\tupdate_items: function () {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"].filter((item) => !!item.item_code);\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.update_child_qty_rate\",\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\tparent_doctype: frm.doc.doctype,\n\t\t\t\t\ttrans_items: trans_items,\n\t\t\t\t\tparent_doctype_name: frm.doc.name,\n\t\t\t\t\tchild_docname: child_docname,\n\t\t\t\t},\n\t\t\t\tcallback: function () {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __(\"Update\"),\n\t});\n\n\tdialog.show();\n};\n\nerpnext.utils.map_current_doc = function (opts) {\n\tfunction _map() {\n\t\tif ($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif (!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, \"items\").options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function (d) {\n\t\t\t\tif (d.options === opts.source_doctype) link_fieldname = d.fieldname;\n\t\t\t});\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function (i, d) {\n\t\t\t\topts.source_name.forEach(function (src) {\n\t\t\t\t\tif (d[link_fieldname] == src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code]) item_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse item_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (already_set) {\n\t\t\t\topts.source_name.forEach(function (src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function (r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function (i, row) {\n\t\t\t\t\t\t\tif (row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tif (already_set) {\n\t\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t\t__(\"You have already selected items from {0} {1}\", [opts.source_doctype, src])\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: \"frappe.model.mapper.map_docs\",\n\t\t\targs: {\n\t\t\t\tmethod: opts.method,\n\t\t\t\tsource_names: opts.source_name,\n\t\t\t\ttarget_doc: cur_frm.doc,\n\t\t\t\targs: opts.args,\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __(\"Mapping {0} ...\", [opts.source_doctype]),\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tlet query_args = {};\n\tif (opts.get_query_filters) {\n\t\tquery_args.filters = opts.get_query_filters;\n\t}\n\n\tif (opts.get_query_method) {\n\t\tquery_args.query = opts.get_query_method;\n\t}\n\n\tif (query_args.filters || query_args.query) {\n\t\topts.get_query = () => query_args;\n\t}\n\n\tif (opts.source_doctype) {\n\t\tlet data_fields = [];\n\t\tif ([\"Purchase Receipt\", \"Delivery Note\"].includes(opts.source_doctype)) {\n\t\t\tlet target_meta = frappe.get_meta(cur_frm.doc.doctype);\n\t\t\tif (target_meta.fields.find((f) => f.fieldname === \"taxes\")) {\n\t\t\t\tdata_fields.push({\n\t\t\t\t\tfieldname: \"merge_taxes\",\n\t\t\t\t\tfieldtype: \"Check\",\n\t\t\t\t\tlabel: __(\"Merge taxes from multiple documents\"),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tconst d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tread_only_setters: opts.read_only_setters,\n\t\t\tdata_fields: data_fields,\n\t\t\tget_query: opts.get_query,\n\t\t\tadd_filters_group: 1,\n\t\t\tallow_child_item_selection: opts.allow_child_item_selection,\n\t\t\tchild_fieldname: opts.child_fieldname,\n\t\t\tchild_columns: opts.child_columns,\n\t\t\tsize: opts.size,\n\t\t\taction: function (selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif (values.length === 0) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (values.constructor === Array) {\n\t\t\t\t\topts.source_name = [...new Set(values)];\n\t\t\t\t} else {\n\t\t\t\t\topts.source_name = values;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\topts.allow_child_item_selection ||\n\t\t\t\t\t[\"Purchase Receipt\", \"Delivery Note\"].includes(opts.source_doctype)\n\t\t\t\t) {\n\t\t\t\t\t// args contains filtered child docnames\n\t\t\t\t\topts.args = args;\n\t\t\t\t}\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\n\t\treturn d;\n\t}\n\n\tif (opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n};\n\nfrappe.form.link_formatters[\"Item\"] = function (value, doc, df) {\n\treturn add_link_title(value, doc, df, \"item_name\");\n};\n\nfrappe.form.link_formatters[\"Employee\"] = function (value, doc, df) {\n\treturn add_link_title(value, doc, df, \"employee_name\");\n};\n\nfrappe.form.link_formatters[\"Project\"] = function (value, doc, df) {\n\treturn add_link_title(value, doc, df, \"project_name\");\n};\n\n/**\n * Add a title to a link value based on the provided document and field information.\n *\n * @param {string} value - The value to add a link title to.\n * @param {Object} doc - The document object.\n * @param {Object} df - The field object.\n * @param {string} title_field - The field name for the title.\n * @returns {string} - The link value with the added title.\n */\nfunction add_link_title(value, doc, df, title_field) {\n\tif (doc && value && doc[title_field] && doc[title_field] !== value && doc[df.fieldname] === value) {\n\t\treturn value + \": \" + doc[title_field];\n\t} else if (!value && doc.doctype && doc[title_field]) {\n\t\treturn doc[title_field];\n\t} else {\n\t\treturn value;\n\t}\n}\n\n// add description on posting time\n$(document).on(\"app_ready\", function () {\n\tif (!frappe.datetime.is_timezone_same()) {\n\t\t$.each(\n\t\t\t[\n\t\t\t\t\"Stock Reconciliation\",\n\t\t\t\t\"Stock Entry\",\n\t\t\t\t\"Stock Ledger Entry\",\n\t\t\t\t\"Delivery Note\",\n\t\t\t\t\"Purchase Receipt\",\n\t\t\t\t\"Sales Invoice\",\n\t\t\t],\n\t\t\tfunction (i, d) {\n\t\t\t\tfrappe.ui.form.on(d, \"onload\", function (frm) {\n\t\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\", frappe.sys_defaults.time_zone);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n});\n\n// Show SLA dashboard\n$(document).on(\"app_ready\", function () {\n\t$.each(frappe.boot.service_level_agreement_doctypes, function (_i, d) {\n\t\tfrappe.ui.form.on(d, {\n\t\t\tonload: function (frm) {\n\t\t\t\tif (!frm.doc.service_level_agreement) return;\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.support.doctype.service_level_agreement.service_level_agreement.get_service_level_agreement_filters\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\t\tname: frm.doc.service_level_agreement,\n\t\t\t\t\t\tcustomer: frm.doc.customer,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r && r.message) {\n\t\t\t\t\t\t\tfrm.set_query(\"priority\", function () {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\t\tname: [\"in\", r.message.priority],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrm.set_query(\"service_level_agreement\", function () {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\t\tname: [\"in\", r.message.service_level_agreements],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\n\t\t\trefresh: function (frm) {\n\t\t\t\tif (\n\t\t\t\t\tfrm.doc.status !== \"Closed\" &&\n\t\t\t\t\tfrm.doc.service_level_agreement &&\n\t\t\t\t\t[\"First Response Due\", \"Resolution Due\"].includes(frm.doc.agreement_status)\n\t\t\t\t) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdoctype: \"Service Level Agreement\",\n\t\t\t\t\t\t\tname: frm.doc.service_level_agreement,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t\tlet statuses = data.message.pause_sla_on;\n\t\t\t\t\t\t\tconst hold_statuses = [];\n\t\t\t\t\t\t\t$.each(statuses, (_i, entry) => {\n\t\t\t\t\t\t\t\thold_statuses.push(entry.status);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (hold_statuses.includes(frm.doc.status)) {\n\t\t\t\t\t\t\t\tfrm.dashboard.clear_headline();\n\t\t\t\t\t\t\t\tlet message = {\n\t\t\t\t\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\t\t\t\t\tmsg: __(\"SLA is on hold since {0}\", [\n\t\t\t\t\t\t\t\t\t\tmoment(frm.doc.on_hold_since).fromNow(true),\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t\t\t\t'<div class=\"row\">' +\n\t\t\t\t\t\t\t\t\t\t'<div class=\"col-xs-12\">' +\n\t\t\t\t\t\t\t\t\t\t'<span class=\"indicator whitespace-nowrap ' +\n\t\t\t\t\t\t\t\t\t\tmessage.indicator +\n\t\t\t\t\t\t\t\t\t\t'\"><span>' +\n\t\t\t\t\t\t\t\t\t\tmessage.msg +\n\t\t\t\t\t\t\t\t\t\t\"</span></span> \" +\n\t\t\t\t\t\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\t\t\t\t\t\"</div>\"\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tset_time_to_resolve_and_response(frm, data.message.apply_sla_for_resolution);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t} else if (frm.doc.service_level_agreement) {\n\t\t\t\t\tfrm.dashboard.clear_headline();\n\n\t\t\t\t\tlet agreement_status =\n\t\t\t\t\t\tfrm.doc.agreement_status == \"Fulfilled\"\n\t\t\t\t\t\t\t? { indicator: \"green\", msg: \"Service Level Agreement has been fulfilled\" }\n\t\t\t\t\t\t\t: { indicator: \"red\", msg: \"Service Level Agreement Failed\" };\n\n\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t'<div class=\"row\">' +\n\t\t\t\t\t\t\t'<div class=\"col-xs-12\">' +\n\t\t\t\t\t\t\t'<span class=\"indicator whitespace-nowrap ' +\n\t\t\t\t\t\t\tagreement_status.indicator +\n\t\t\t\t\t\t\t'\"><span class=\"hidden-xs\">' +\n\t\t\t\t\t\t\tagreement_status.msg +\n\t\t\t\t\t\t\t\"</span></span> \" +\n\t\t\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\t\t\"</div>\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t});\n});\n\nfunction set_time_to_resolve_and_response(frm, apply_sla_for_resolution) {\n\tfrm.dashboard.clear_headline();\n\n\tlet time_to_respond;\n\tif (!frm.doc.first_responded_on) {\n\t\ttime_to_respond = get_time_left(frm.doc.response_by, frm.doc.agreement_status);\n\t} else {\n\t\ttime_to_respond = get_status(frm.doc.response_by, frm.doc.first_responded_on);\n\t}\n\n\tlet alert = `\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_respond.indicator}\">\n\t\t\t\t\t<span>Time to Respond: ${time_to_respond.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\n\tif (apply_sla_for_resolution) {\n\t\tlet time_to_resolve;\n\t\tif (!frm.doc.resolution_date) {\n\t\t\ttime_to_resolve = get_time_left(frm.doc.resolution_by, frm.doc.agreement_status);\n\t\t} else {\n\t\t\ttime_to_resolve = get_status(frm.doc.resolution_by, frm.doc.resolution_date);\n\t\t}\n\n\t\talert += `\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_resolve.indicator}\">\n\t\t\t\t\t<span>Time to Resolve: ${time_to_resolve.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\t}\n\n\talert += \"</div>\";\n\n\tfrm.dashboard.set_headline_alert(alert);\n}\n\nfunction get_time_left(timestamp, agreement_status) {\n\tconst diff = moment(timestamp).diff(frappe.datetime.system_datetime(true));\n\tconst diff_display = diff >= 44500 ? moment.duration(diff).humanize() : \"Failed\";\n\tlet indicator = diff_display == \"Failed\" && agreement_status != \"Fulfilled\" ? \"red\" : \"green\";\n\treturn { diff_display: diff_display, indicator: indicator };\n}\n\nfunction get_status(expected, actual) {\n\tconst time_left = moment(expected).diff(moment(actual));\n\tif (time_left >= 0) {\n\t\treturn { diff_display: \"Fulfilled\", indicator: \"green\" };\n\t} else {\n\t\treturn { diff_display: \"Failed\", indicator: \"red\" };\n\t}\n}\n\nfunction attach_selector_button(inner_text, append_loction, context, grid_row) {\n\tlet $btn_div = $(\"<div>\").css({ \"margin-bottom\": \"10px\", \"margin-top\": \"10px\" }).appendTo(append_loction);\n\tlet $btn = $(`<button class=\"btn btn-sm btn-default\">${inner_text}</button>`).appendTo($btn_div);\n\n\t$btn.on(\"click\", function () {\n\t\tcontext.show_serial_batch_selector(grid_row.frm, grid_row.doc, \"\", \"\", true);\n\t});\n}\n\n$.extend(erpnext.stock.utils, {\n\tset_item_details_using_barcode(frm, child_row, callback) {\n\t\tconst barcode_scanner = new erpnext.utils.BarcodeScanner({ frm: frm });\n\t\tbarcode_scanner.scan_api_call(child_row.barcode, callback);\n\t},\n\n\tget_serial_range(range_string, separator) {\n\t\t/* Return an array of serial numbers generated from a range string.\n\n\t\tExamples (using separator \"::\"):\n\t\t\t- \"1::5\" => [\"1\", \"2\", \"3\", \"4\", \"5\"]\n\t\t\t- \"SN0009::12\" => [\"SN0009\", \"SN0010\", \"SN0011\", \"SN0012\"]\n\t\t\t- \"ABC//05::8\" => [\"ABC//05\", \"ABC//06\", \"ABC//07\", \"ABC//08\"]\n\t\t*/\n\t\tif (!range_string) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [start_str, end_str] = range_string.trim().split(separator);\n\n\t\tif (!start_str || !end_str) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst end_int = parseInt(end_str);\n\t\tconst length_difference = start_str.length - end_str.length;\n\t\tconst start_int = parseInt(start_str.substring(length_difference));\n\n\t\tif (isNaN(start_int) || isNaN(end_int)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst serial_numbers = Array(end_int - start_int + 1)\n\t\t\t.fill(1)\n\t\t\t.map((x, y) => x + y)\n\t\t\t.map((x) => x + start_int - 1);\n\t\treturn serial_numbers.map((val) => {\n\t\t\treturn start_str.substring(0, length_difference) + val.toString().padStart(end_str.length, \"0\");\n\t\t});\n\t},\n});\n", "frappe.provide(\"erpnext.stock_reservation\");\n\n$.extend(erpnext.stock_reservation, {\n\tmake_entries(frm, table_name) {\n\t\terpnext.stock_reservation.setup(frm, table_name);\n\t},\n\n\tsetup(frm, table_name) {\n\t\tlet parms = erpnext.stock_reservation.get_parms(frm, table_name);\n\n\t\terpnext.stock_reservation.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Stock Reservation\"),\n\t\t\tsize: \"extra-large\",\n\t\t\tfields: erpnext.stock_reservation.get_dialog_fields(frm, parms),\n\t\t\tprimary_action_label: __(\"Reserve Stock\"),\n\t\t\tprimary_action: () => {\n\t\t\t\terpnext.stock_reservation.reserve_stock(frm, parms);\n\t\t\t},\n\t\t});\n\n\t\terpnext.stock_reservation.render_items(frm, parms);\n\t},\n\n\tget_parms(frm, table_name) {\n\t\tlet params = {\n\t\t\ttable_name: table_name || \"items\",\n\t\t\tchild_doctype: frm.doc.doctype + \" Item\",\n\t\t};\n\n\t\tparams[\"qty_field\"] = {\n\t\t\t\"Sales Order\": \"stock_qty\",\n\t\t\t\"Work Order\": \"required_qty\",\n\t\t}[frm.doc.doctype];\n\n\t\tparams[\"dispatch_qty_field\"] = {\n\t\t\t\"Sales Order\": \"delivered_qty\",\n\t\t\t\"Work Order\": \"transferred_qty\",\n\t\t}[frm.doc.doctype];\n\n\t\tparams[\"method\"] = {\n\t\t\t\"Sales Order\": \"delivered_qty\",\n\t\t\t\"Work Order\":\n\t\t\t\t\"erpnext.manufacturing.doctype.work_order.work_order.make_stock_reservation_entries\",\n\t\t}[frm.doc.doctype];\n\n\t\treturn params;\n\t},\n\n\tget_dialog_fields(frm, parms) {\n\t\tlet fields = erpnext.stock_reservation.fields || [];\n\t\tlet qty_field = parms.qty_field;\n\t\tlet dialog = erpnext.stock_reservation.dialog;\n\n\t\tlet table_fields = [\n\t\t\t{ fieldtype: \"Section Break\" },\n\t\t\t{\n\t\t\t\tfieldname: \"items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: __(\"Items to Reserve\"),\n\t\t\t\tallow_bulk_edit: false,\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tcannot_delete_rows: true,\n\t\t\t\tdata: [],\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: frappe.scrub(parms.child_doctype),\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tlabel: __(parms.child_doctype),\n\t\t\t\t\t\toptions: parms.child_doctype,\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tquery: \"erpnext.controllers.queries.get_filtered_child_rows\",\n\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\tparenttype: frm.doc.doctype,\n\t\t\t\t\t\t\t\t\tparent: frm.doc.name,\n\t\t\t\t\t\t\t\t\treserve_stock: 1,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonchange: (event) => {\n\t\t\t\t\t\t\tif (event) {\n\t\t\t\t\t\t\t\tlet name = $(event.currentTarget).closest(\".grid-row\").attr(\"data-name\");\n\t\t\t\t\t\t\t\tlet item_row = dialog.fields_dict.items.grid.grid_rows_by_docname[name].doc;\n\n\t\t\t\t\t\t\t\tfrm.doc.items.forEach((item) => {\n\t\t\t\t\t\t\t\t\tif (item.name === item_row.sales_order_item) {\n\t\t\t\t\t\t\t\t\t\titem_row.item_code = item.item_code;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tdialog.fields_dict.items.grid.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t\toptions: \"Item\",\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"warehouse\",\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tlabel: __(\"Warehouse\"),\n\t\t\t\t\t\toptions: \"Warehouse\",\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tfilters: [[\"Warehouse\", \"is_group\", \"!=\", 1]],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: qty_field,\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tlabel: __(\"Qty\"),\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t];\n\n\t\treturn fields.concat(table_fields);\n\t},\n\n\trender_items(frm, parms) {\n\t\tlet dialog = erpnext.stock_reservation.dialog;\n\t\tlet field = frappe.scrub(parms.child_doctype);\n\n\t\tlet qty_field = parms.qty_field;\n\t\tlet dispatch_qty_field = parms.dispatch_qty_field;\n\n\t\tif (frm.doc.doctype === \"Work Order\" && frm.doc.skip_transfer) {\n\t\t\tdispatch_qty_field = \"consumed_qty\";\n\t\t}\n\n\t\tfrm.doc[parms.table_name].forEach((item) => {\n\t\t\tif (frm.doc.reserve_stock) {\n\t\t\t\tlet unreserved_qty =\n\t\t\t\t\t(flt(item[qty_field]) -\n\t\t\t\t\t\t(item.stock_reserved_qty\n\t\t\t\t\t\t\t? flt(item.stock_reserved_qty)\n\t\t\t\t\t\t\t: flt(item[dispatch_qty_field]) * flt(item.conversion_factor || 1))) /\n\t\t\t\t\tflt(item.conversion_factor || 1);\n\n\t\t\t\tif (unreserved_qty > 0) {\n\t\t\t\t\tlet args = {\n\t\t\t\t\t\t__checked: 1,\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\twarehouse: item.warehouse || item.source_warehouse,\n\t\t\t\t\t};\n\n\t\t\t\t\targs[field] = item.name;\n\t\t\t\t\targs[qty_field] = unreserved_qty;\n\t\t\t\t\tdialog.fields_dict.items.df.data.push(args);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdialog.fields_dict.items.grid.refresh();\n\t\tdialog.show();\n\t},\n\n\treserve_stock(frm, parms) {\n\t\tlet dialog = erpnext.stock_reservation.dialog;\n\t\tvar data = { items: dialog.fields_dict.items.grid.get_selected_children() };\n\n\t\tif (data.items && data.items.length > 0) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: parms.method,\n\t\t\t\targs: {\n\t\t\t\t\tdoc: frm.doc,\n\t\t\t\t\titems: data.items,\n\t\t\t\t\tnotify: true,\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t\tfreeze_message: __(\"Reserving Stock...\"),\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tfrm.doc.__onload.has_unreserved_stock = false;\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tdialog.hide();\n\t\t} else {\n\t\t\tfrappe.msgprint(__(\"Please select items to reserve.\"));\n\t\t}\n\t},\n\n\tunreserve_stock(frm) {\n\t\terpnext.stock_reservation.get_stock_reservation_entries(frm.doctype, frm.docname).then((r) => {\n\t\t\tif (!r.exc && r.message) {\n\t\t\t\tif (r.message.length > 0) {\n\t\t\t\t\terpnext.stock_reservation.prepare_for_cancel_sre_entries(frm, r.message);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"No reserved stock to unreserve.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tprepare_for_cancel_sre_entries(frm, sre_entries) {\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Stock Unreservation\"),\n\t\t\tsize: \"extra-large\",\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"sr_entries\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: __(\"Reserved Stock\"),\n\t\t\t\t\tallow_bulk_edit: false,\n\t\t\t\t\tcannot_add_rows: true,\n\t\t\t\t\tcannot_delete_rows: true,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: erpnext.stock_reservation.get_fields_for_cancel(),\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Unreserve Stock\"),\n\t\t\tprimary_action: () => {\n\t\t\t\terpnext.stock_reservation.cancel_stock_reservation(dialog, frm);\n\t\t\t},\n\t\t});\n\n\t\tsre_entries.forEach((sre) => {\n\t\t\tdialog.fields_dict.sr_entries.df.data.push({\n\t\t\t\tsre: sre.name,\n\t\t\t\titem_code: sre.item_code,\n\t\t\t\twarehouse: sre.warehouse,\n\t\t\t\tqty: flt(sre.reserved_qty) - flt(sre.delivered_qty),\n\t\t\t});\n\t\t});\n\n\t\tdialog.fields_dict.sr_entries.grid.refresh();\n\t\tdialog.show();\n\t},\n\n\tcancel_stock_reservation(dialog, frm) {\n\t\tvar data = { sr_entries: dialog.fields_dict.sr_entries.grid.get_selected_children() };\n\n\t\tif (data.sr_entries?.length > 0) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.manufacturing.doctype.work_order.work_order.cancel_stock_reservation_entries\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: frm.doc,\n\t\t\t\t\tsre_list: data.sr_entries.map((item) => item.sre),\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t\tfreeze_message: __(\"Unreserving Stock...\"),\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tfrm.doc.__onload.has_reserved_stock = false;\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tdialog.hide();\n\t\t} else {\n\t\t\tfrappe.msgprint(__(\"Please select items to unreserve.\"));\n\t\t}\n\t},\n\n\tget_stock_reservation_entries(voucher_type, voucher_no) {\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.stock.doctype.stock_reservation_entry.stock_reservation_entry.get_stock_reservation_entries_for_voucher\",\n\t\t\targs: {\n\t\t\t\tvoucher_type: voucher_type,\n\t\t\t\tvoucher_no: voucher_no,\n\t\t\t},\n\t\t});\n\t},\n\n\tget_fields_for_cancel() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tfieldname: \"sre\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Stock Reservation Entry\"),\n\t\t\t\toptions: \"Stock Reservation Entry\",\n\t\t\t\treqd: 1,\n\t\t\t\tread_only: 1,\n\t\t\t\tin_list_view: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"item_code\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\toptions: \"Item\",\n\t\t\t\treqd: 1,\n\t\t\t\tread_only: 1,\n\t\t\t\tin_list_view: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"warehouse\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Warehouse\"),\n\t\t\t\toptions: \"Warehouse\",\n\t\t\t\treqd: 1,\n\t\t\t\tread_only: 1,\n\t\t\t\tin_list_view: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"qty\",\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tlabel: __(\"Qty\"),\n\t\t\t\treqd: 1,\n\t\t\t\tread_only: 1,\n\t\t\t\tin_list_view: 1,\n\t\t\t},\n\t\t];\n\t},\n\n\tshow_reserved_stock(frm, table_name) {\n\t\tif (!table_name) {\n\t\t\ttable_name = \"items\";\n\t\t}\n\n\t\t// Get the latest modified date from the items table.\n\t\tvar to_date = moment(\n\t\t\tnew Date(Math.max(...frm.doc[table_name].map((e) => new Date(e.modified))))\n\t\t).format(\"YYYY-MM-DD\");\n\n\t\tlet from_date = frm.doc.transaction_date || new Date(frm.doc.creation);\n\n\t\tfrappe.route_options = {\n\t\t\tcompany: frm.doc.company,\n\t\t\tfrom_date: from_date,\n\t\t\tto_date: to_date,\n\t\t\tvoucher_type: frm.doc.doctype,\n\t\t\tvoucher_no: frm.doc.name,\n\t\t};\n\t\tfrappe.set_route(\"query-report\", \"Reserved Stock\");\n\t},\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function () {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function () {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\titem: function (filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif (filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function () {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function () {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function (doc) {\n\t\tif (!doc.customer) {\n\t\t\tcur_frm.scroll_to_field(\"customer\");\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name)),\n\t\t\t\t]),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function (doc) {\n\t\tif (frappe.dynamic_link) {\n\t\t\tif (!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tcur_frm.scroll_to_field(frappe.dynamic_link.fieldname);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name)),\n\t\t\t\t\t]),\n\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: \"frappe.contacts.doctype.contact.contact.contact_query\",\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_contact_query: function (doc) {\n\t\tif (!doc.company) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"company\", doc.name))]));\n\t\t}\n\n\t\treturn {\n\t\t\tquery: \"frappe.contacts.doctype.contact.contact.contact_query\",\n\t\t\tfilters: { link_doctype: \"Company\", link_name: doc.company },\n\t\t};\n\t},\n\n\taddress_query: function (doc) {\n\t\tif (frappe.dynamic_link) {\n\t\t\tif (!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tcur_frm.scroll_to_field(frappe.dynamic_link.fieldname);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name)),\n\t\t\t\t\t]),\n\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function (doc) {\n\t\tif (!doc.company) {\n\t\t\tcur_frm.scroll_to_field(\"company\");\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, \"company\", doc.name)),\n\t\t\t\t]),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\tfilters: { link_doctype: \"Company\", link_name: doc.company },\n\t\t};\n\t},\n\n\tdispatch_address_query: function (doc) {\n\t\tvar filters = { link_doctype: \"Company\", link_name: doc.company || \"\" };\n\t\tvar is_drop_ship = doc.items.some((item) => item.delivered_by_supplier);\n\t\tif (is_drop_ship) filters = {};\n\t\treturn {\n\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\tfilters: filters,\n\t\t};\n\t},\n\n\tsupplier_filter: function (doc) {\n\t\tif (!doc.supplier) {\n\t\t\tcur_frm.scroll_to_field(\"supplier\");\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name)),\n\t\t\t\t]),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function (doc) {\n\t\tif (!doc.lead) {\n\t\t\tcur_frm.scroll_to_field(\"lead\");\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Please specify a {0} first.\", [\n\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name)),\n\t\t\t\t]),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function () {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function () {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" };\n\t},\n\n\twarehouse: function (doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\", 0],\n\t\t\t],\n\t\t};\n\t},\n\n\tget_filtered_dimensions: function (doc, child_fields, dimension, company) {\n\t\tlet account = \"\";\n\n\t\tchild_fields.forEach((field) => {\n\t\t\tif (!account) {\n\t\t\t\taccount = doc[field];\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tquery: \"erpnext.controllers.queries.get_filtered_dimensions\",\n\t\t\tfilters: {\n\t\t\t\tdimension: dimension,\n\t\t\t\taccount: account,\n\t\t\t\tcompany: company,\n\t\t\t},\n\t\t};\n\t},\n});\n\nerpnext.queries.setup_queries = function (frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function (doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name, {\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: options,\n\t\t});\n\t\t$.each(link_fields, function (i, df) {\n\t\t\tif (parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(\n\t\tfrappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, { fieldtype: \"Table\" }),\n\t\tfunction (i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t}\n\t);\n};\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function (frm) {\n\tfrm.set_query(\"warehouse\", \"items\", function (doc, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif (row.item_code) {\n\t\t\t$.extend(filters, { query: \"erpnext.controllers.queries.warehouse_query\" });\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters;\n\t});\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function () {\n\t\tvar default_msg = {\n\t\t\tLead: \"\",\n\t\t\tOpportunity: \"Your enquiry has been logged into the system. Ref No: \" + doc.name,\n\t\t\tQuotation: \"Quotation \" + doc.name + \" has been sent via email. Thanks!\",\n\t\t\t\"Sales Order\":\n\t\t\t\t\"Sales Order \" +\n\t\t\t\tdoc.name +\n\t\t\t\t\" has been created against \" +\n\t\t\t\t(doc.quotation_no ? \"Quote No:\" + doc.quotation_no : \"\") +\n\t\t\t\t(doc.po_no ? \" for your PO: \" + doc.po_no : \"\"),\n\t\t\t\"Delivery Note\":\n\t\t\t\t\"Items has been delivered against delivery note: \" +\n\t\t\t\tdoc.name +\n\t\t\t\t(doc.po_no ? \" for your PO: \" + doc.po_no : \"\"),\n\t\t\t\"Sales Invoice\":\n\t\t\t\t\"Invoice \" +\n\t\t\t\tdoc.name +\n\t\t\t\t\" has been sent via email \" +\n\t\t\t\t(doc.po_no ? \" for your PO: \" + doc.po_no : \"\"),\n\t\t\t\"Material Request\": \"Material Request \" + doc.name + \" has been raised in the system\",\n\t\t\t\"Purchase Order\": \"Purchase Order \" + doc.name + \" has been sent via email\",\n\t\t\t\"Purchase Receipt\": \"Items has been received against purchase receipt: \" + doc.name,\n\t\t};\n\n\t\tif ([\"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(doc.doctype))\n\t\t\tthis.show(doc.contact_person, \"Customer\", doc.customer, \"\", default_msg[doc.doctype]);\n\t\telse if (doc.doctype === \"Quotation\")\n\t\t\tthis.show(doc.contact_person, \"Customer\", doc.party_name, \"\", default_msg[doc.doctype]);\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\"].includes(doc.doctype))\n\t\t\tthis.show(doc.contact_person, \"Supplier\", doc.supplier, \"\", default_msg[doc.doctype]);\n\t\telse if (doc.doctype == \"Lead\") this.show(\"\", \"\", \"\", doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == \"Opportunity\")\n\t\t\tthis.show(\"\", \"\", \"\", doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == \"Material Request\") this.show(\"\", \"\", \"\", \"\", default_msg[doc.doctype]);\n\t};\n\n\tthis.get_contact_number = function (contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.exc) {\n\t\t\t\t\tfrappe.msgprint(r.exc);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t},\n\t\t});\n\t};\n\n\tthis.show = function (contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact) {\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name);\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t};\n\tthis.show_dialog = function () {\n\t\tif (!me.dialog) me.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\tmessage: me.message,\n\t\t\tnumber: me.number,\n\t\t});\n\t\tme.dialog.show();\n\t};\n\tthis.make_dialog = function () {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: \"Send SMS\",\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{ fieldname: \"number\", fieldtype: \"Data\", label: \"Mobile Number\", reqd: 1 },\n\t\t\t\t{ fieldname: \"message\", fieldtype: \"Text\", label: \"Message\", reqd: 1 },\n\t\t\t\t{ fieldname: \"send\", fieldtype: \"Button\", label: \"Send\" },\n\t\t\t],\n\t\t});\n\t\td.fields_dict.send.input.onclick = function () {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif (v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif (r.exc) {\n\t\t\t\t\t\t\tfrappe.msgprint(r.exc);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tthis.dialog = d;\n\t};\n\tthis.setup();\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nconst SALES_DOCTYPES = [\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"];\nconst PURCHASE_DOCTYPES = [\"Supplier Quotation\", \"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"];\n\nerpnext.utils.get_party_details = function (frm, method, args, callback) {\n\tif (!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\n\tif (!args) {\n\t\tif (\n\t\t\t(frm.doctype != \"Purchase Order\" && frm.doc.customer) ||\n\t\t\t(frm.doc.party_name && [\"Quotation\", \"Opportunity\"].includes(frm.doc.doctype))\n\t\t) {\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif (frm.doc.quotation_to && [\"Lead\", \"Prospect\", \"CRM Deal\"].includes(frm.doc.quotation_to)) {\n\t\t\t\tparty_type = frm.doc.quotation_to;\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list,\n\t\t\t};\n\t\t} else if (frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list,\n\t\t\t};\n\t\t}\n\n\t\tif (!args) {\n\t\t\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\tparty_type: \"Customer\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!args || !args.party) return;\n\n\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\targs.fetch_payment_terms_template = cint(!frm.doc.ignore_default_payment_terms_template);\n\t}\n\n\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.company_address) {\n\t\t\targs.company_address = frm.doc.company_address;\n\t\t}\n\t}\n\n\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.billing_address) {\n\t\t\targs.company_address = frm.doc.billing_address;\n\t\t}\n\n\t\tif (!args.shipping_address && frm.doc.shipping_address) {\n\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t}\n\n\t\tif (!args.dispatch_address && frm.doc.dispatch_address) {\n\t\t\targs.dispatch_address = frm.doc.dispatch_address;\n\t\t}\n\t}\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Posting / Transaction Date\",\n\t\t\t\targs.posting_date,\n\t\t\t\targs.party_type == \"Customer\" ? \"customer\" : \"supplier\"\n\t\t\t)\n\t\t)\n\t\t\treturn;\n\t}\n\n\tif (\n\t\t!erpnext.utils.validate_mandatory(\n\t\t\tfrm,\n\t\t\t\"Company\",\n\t\t\tfrm.doc.company,\n\t\t\targs.party_type == \"Customer\" ? \"customer\" : \"supplier\"\n\t\t)\n\t) {\n\t\treturn;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function (r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif (callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\t\t},\n\t});\n};\n\nerpnext.utils.add_item = function (frm) {\n\tif (frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif (prev_route[1] === \"Item\" && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child(\"items\");\n\t\t\tfrm.refresh_field(\"items\");\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, \"item_code\", prev_route[2]);\n\t\t}\n\t}\n};\n\nerpnext.utils.get_address_display = function (frm, address_field, display_field, is_your_company_address) {\n\tif (frm.updating_party_details) return;\n\n\tif (!address_field) {\n\t\tif (frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if (frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif (!display_field) display_field = \"address_display\";\n\tif (frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: { address_dict: frm.doc[address_field] },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrm.set_value(display_field, \"\");\n\t}\n};\n\nerpnext.utils.set_taxes_from_address = function (\n\tfrm,\n\ttriggered_from_field,\n\tbilling_address_field,\n\tshipping_address_field\n) {\n\tif (frm.updating_party_details) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Lead / Customer / Supplier\",\n\t\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Posting / Transaction Date\",\n\t\t\t\tfrm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\ttax_category: frm.doc.tax_category,\n\t\t\tbilling_address: frm.doc[billing_address_field],\n\t\t\tshipping_address: frm.doc[shipping_address_field],\n\t\t},\n\t\tcallback: function (r) {\n\t\t\tif (!r.exc) {\n\t\t\t\tif (frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\terpnext.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t});\n};\n\nerpnext.utils.set_taxes = function (frm, triggered_from_field) {\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Lead / Customer / Supplier\",\n\t\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Posting / Transaction Date\",\n\t\t\t\tfrm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = \"Lead\";\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = \"Customer\";\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = \"Supplier\";\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to) {\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tif (!frm.doc.company) {\n\t\tfrappe.throw(__(\"Kindly select the company first\"));\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\tparty: party,\n\t\t\tparty_type: party_type,\n\t\t\tposting_date: frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\tcompany: frm.doc.company,\n\t\t\tcustomer_group: frm.doc.customer_group,\n\t\t\tsupplier_group: frm.doc.supplier_group,\n\t\t\ttax_category: frm.doc.tax_category,\n\t\t\tbilling_address:\n\t\t\t\tfrm.doc.customer || frm.doc.lead ? frm.doc.customer_address : frm.doc.supplier_address,\n\t\t\tshipping_address: frm.doc.shipping_address_name,\n\t\t},\n\t\tcallback: function (r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message);\n\t\t\t}\n\t\t},\n\t});\n};\n\nerpnext.utils.get_contact_details = function (frm) {\n\tif (frm.updating_party_details) return;\n\n\tif (frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: { contact: frm.doc.contact_person },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) frm.set_value(r.message);\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrm.set_value({\n\t\t\tcontact_person: \"\",\n\t\t\tcontact_display: \"\",\n\t\t\tcontact_email: \"\",\n\t\t\tcontact_mobile: \"\",\n\t\t\tcontact_phone: \"\",\n\t\t\tcontact_designation: \"\",\n\t\t\tcontact_department: \"\",\n\t\t});\n\t}\n};\n\nerpnext.utils.validate_mandatory = function (frm, label, value, trigger_on) {\n\tif (!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.throw({ message: __(\"Please enter {0} first\", [label]), title: __(\"Mandatory\") });\n\t\treturn false;\n\t}\n\treturn true;\n};\n\nerpnext.utils.get_shipping_address = function (frm, callback) {\n\tif (frm.doc.company) {\n\t\tif (\n\t\t\tfrm.doc.inter_company_order_reference ||\n\t\t\tfrm.doc.internal_invoice_reference ||\n\t\t\tfrm.doc.internal_order_reference\n\t\t) {\n\t\t\tif (callback) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t}\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.custom.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]); //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]); //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif (callback) {\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = class StockController extends frappe.ui.form.Controller {\n\tonload() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t}\n\n\tbarcode(doc, cdt, cdn)  {\n\t\tlet row = locals[cdt][cdn];\n\t\tif (row.barcode) {\n\t\t\terpnext.stock.utils.set_item_details_using_barcode(this.frm, row, (r) => {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, {\n\t\t\t\t\t\"item_code\": r.message.item_code,\n\t\t\t\t\t\"qty\": 1,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_warehouse_query() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t}\n\n\tsetup_posting_date_time_check() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_stock_ledger() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2,\n\t\t\t\t\tignore_prepared_report: true\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t}\n\n\tshow_general_ledger() {\n\t\tlet me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\",\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2,\n\t\t\t\t\tignore_prepared_report: true\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n};\n", "erpnext.SerialBatchPackageSelector = class SerialNoBatchBundleUpdate {\n\tconstructor(frm, item, callback) {\n\t\tthis.frm = frm;\n\t\tthis.item = item;\n\t\tthis.qty = item.qty;\n\t\tthis.callback = callback;\n\t\tthis.bundle = this.item?.is_rejected\n\t\t\t? this.item.rejected_serial_and_batch_bundle\n\t\t\t: this.item.serial_and_batch_bundle;\n\n\t\tthis.make();\n\t\tthis.render_data();\n\t}\n\n\tmake() {\n\t\tlet label = this.item?.has_serial_no ? __(\"Serial Nos\") : __(\"Batch Nos\");\n\t\tlet primary_label = this.bundle ? __(\"Update\") : __(\"Add\");\n\n\t\tif (this.item?.has_serial_no && this.item?.has_batch_no) {\n\t\t\tlabel = __(\"Serial Nos / Batch Nos\");\n\t\t}\n\n\t\tprimary_label += \" \" + label;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: this.item?.title || primary_label,\n\t\t\tsize: \"large\",\n\t\t\tfields: this.get_dialog_fields(),\n\t\t\tprimary_action_label: primary_label,\n\t\t\tprimary_action: () => this.update_bundle_entries(),\n\t\t\tsecondary_action_label: __(\"Edit Full Form\"),\n\t\t\tsecondary_action: () => this.edit_full_form(),\n\t\t});\n\n\t\tthis.dialog.show();\n\t\tthis.$scan_btn = this.dialog.$wrapper.find(\".link-btn\");\n\t\tthis.$scan_btn.css(\"display\", \"inline\");\n\n\t\tlet qty = this.item.stock_qty || this.item.transfer_qty || this.item.qty;\n\n\t\tif (this.item?.is_rejected) {\n\t\t\tqty = this.item.rejected_qty;\n\t\t}\n\n\t\tqty = Math.abs(qty);\n\t\tif (qty > 0) {\n\t\t\tthis.dialog.set_value(\"qty\", qty).then(() => {\n\t\t\t\tif (this.item.serial_no && !this.item.serial_and_batch_bundle) {\n\t\t\t\t\tlet serial_nos = this.item.serial_no.split(\"\\n\");\n\t\t\t\t\tif (serial_nos.length > 1) {\n\t\t\t\t\t\tserial_nos.forEach((serial_no) => {\n\t\t\t\t\t\t\tthis.dialog.fields_dict.entries.df.data.push({\n\t\t\t\t\t\t\t\tserial_no: serial_no,\n\t\t\t\t\t\t\t\tbatch_no: this.item.batch_no,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.dialog.set_value(\"scan_serial_no\", this.item.serial_no);\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.model.set_value(this.item.doctype, this.item.name, \"serial_no\", \"\");\n\t\t\t\t} else if (this.item.batch_no && !this.item.serial_and_batch_bundle) {\n\t\t\t\t\tthis.dialog.set_value(\"scan_batch_no\", this.item.batch_no);\n\t\t\t\t\tfrappe.model.set_value(this.item.doctype, this.item.name, \"batch_no\", \"\");\n\t\t\t\t}\n\n\t\t\t\tthis.dialog.fields_dict.entries.grid.refresh();\n\t\t\t});\n\t\t}\n\t}\n\n\tget_serial_no_filters() {\n\t\tlet warehouse =\n\t\t\tthis.item?.type_of_transaction === \"Outward\" ? this.item.warehouse || this.item.s_warehouse : \"\";\n\n\t\tif (this.frm.doc.doctype === \"Stock Entry\") {\n\t\t\twarehouse = this.item.s_warehouse || this.item.t_warehouse;\n\t\t}\n\n\t\tif (!warehouse && this.frm.doc.doctype === \"Stock Reconciliation\") {\n\t\t\twarehouse = this.get_warehouse();\n\t\t}\n\n\t\treturn {\n\t\t\titem_code: this.item.item_code,\n\t\t\twarehouse: [\"=\", warehouse],\n\t\t};\n\t}\n\n\tget_dialog_fields() {\n\t\tlet fields = [];\n\n\t\tfields.push({\n\t\t\tfieldtype: \"Link\",\n\t\t\tfieldname: \"warehouse\",\n\t\t\tlabel: __(\"Warehouse\"),\n\t\t\toptions: \"Warehouse\",\n\t\t\tdefault: this.get_warehouse(),\n\t\t\tonchange: () => {\n\t\t\t\tif (this.item?.is_rejected) {\n\t\t\t\t\tthis.item.rejected_warehouse = this.dialog.get_value(\"warehouse\");\n\t\t\t\t} else {\n\t\t\t\t\tthis.item.warehouse = this.dialog.get_value(\"warehouse\");\n\t\t\t\t}\n\n\t\t\t\tthis.get_auto_data();\n\t\t\t},\n\t\t\tget_query: () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\tis_group: 0,\n\t\t\t\t\t\tcompany: this.frm.doc.company,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t},\n\t\t});\n\n\t\tif (this.frm.doc.doctype === \"Stock Entry\" && this.frm.doc.purpose === \"Manufacture\") {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t});\n\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tfieldname: \"work_order\",\n\t\t\t\tlabel: __(\"For Work Order\"),\n\t\t\t\toptions: \"Work Order\",\n\t\t\t\tread_only: 1,\n\t\t\t\tdefault: this.frm.doc.work_order,\n\t\t\t});\n\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t});\n\t\t}\n\n\t\tfields.push({\n\t\t\tfieldtype: \"Column Break\",\n\t\t});\n\n\t\tif (this.item.has_serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tfieldname: \"scan_serial_no\",\n\t\t\t\tlabel: __(\"Scan Serial No\"),\n\t\t\t\tget_query: () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: this.get_serial_no_filters(),\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tonchange: () => this.scan_barcode_data(),\n\t\t\t});\n\t\t}\n\n\t\tif (this.item.has_batch_no && !this.item.has_serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tfieldname: \"scan_batch_no\",\n\t\t\t\tlabel: __(\"Scan Batch No\"),\n\t\t\t\tonchange: () => this.scan_barcode_data(),\n\t\t\t});\n\t\t}\n\n\t\tif (this.item?.type_of_transaction === \"Outward\") {\n\t\t\tfields = [...this.get_filter_fields(), ...fields];\n\t\t} else {\n\t\t\tfields = [...fields, ...this.get_attach_field()];\n\t\t}\n\n\t\tfields.push({\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tdepends_on: \"eval:doc.enter_manually !== 1 || doc.entries?.length > 0\",\n\t\t});\n\n\t\tfields.push({\n\t\t\tfieldname: \"entries\",\n\t\t\tfieldtype: \"Table\",\n\t\t\tallow_bulk_edit: true,\n\t\t\tdepends_on: \"eval:doc.enter_manually !== 1 || doc.entries?.length > 0\",\n\t\t\tdata: [],\n\t\t\tfields: this.get_dialog_table_fields(),\n\t\t});\n\n\t\treturn fields;\n\t}\n\n\tget_attach_field() {\n\t\tlet me = this;\n\t\tlet label = this.item?.has_serial_no ? __(\"Serial Nos\") : __(\"Batch Nos\");\n\t\tlet primary_label = this.bundle ? __(\"Update\") : __(\"Add\");\n\n\t\tif (this.item?.has_serial_no && this.item?.has_batch_no) {\n\t\t\tlabel = __(\"Serial Nos / Batch Nos\");\n\t\t}\n\n\t\tlet fields = [];\n\t\tif (this.item.has_serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: __(\"Enter Manually\"),\n\t\t\t\tfieldname: \"enter_manually\",\n\t\t\t\tdefault: 1,\n\t\t\t\tdepends_on: \"eval:doc.import_using_csv_file !== 1\",\n\t\t\t\tchange() {\n\t\t\t\t\tif (me.dialog.get_value(\"enter_manually\")) {\n\t\t\t\t\t\tme.dialog.set_value(\"import_using_csv_file\", 0);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tfields = [\n\t\t\t...fields,\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: __(\"Import Using CSV file\"),\n\t\t\t\tfieldname: \"import_using_csv_file\",\n\t\t\t\tdepends_on: \"eval:doc.enter_manually !== 1\",\n\t\t\t\tdefault: !this.item.has_serial_no ? 1 : 0,\n\t\t\t\tchange() {\n\t\t\t\t\tif (me.dialog.get_value(\"import_using_csv_file\")) {\n\t\t\t\t\t\tme.dialog.set_value(\"enter_manually\", 0);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tdepends_on: \"eval:doc.import_using_csv_file === 1\",\n\t\t\t\tlabel: __(\"{0} {1} via CSV File\", [primary_label, label]),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Button\",\n\t\t\t\tfieldname: \"download_csv\",\n\t\t\t\tlabel: __(\"Download CSV Template\"),\n\t\t\t\tclick: () => this.download_csv_file(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Attach\",\n\t\t\t\tfieldname: \"attach_serial_batch_csv\",\n\t\t\t\tlabel: __(\"Attach CSV File\"),\n\t\t\t\tonchange: () => this.upload_csv_file(),\n\t\t\t},\n\t\t];\n\n\t\tif (this.item?.has_serial_no) {\n\t\t\tfields = [\n\t\t\t\t...fields,\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\t\tlabel: __(\"{0} {1} Manually\", [primary_label, label]),\n\t\t\t\t\tdepends_on: \"eval:doc.enter_manually === 1\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tlabel: __(\"Serial No Range\"),\n\t\t\t\t\tfieldname: \"serial_no_range\",\n\t\t\t\t\tdepends_on: \"eval:doc.enter_manually === 1 && !doc.serial_no_series\",\n\t\t\t\t\tdescription: __('\"SN-01::10\" for \"SN-01\" to \"SN-10\"'),\n\t\t\t\t\tonchange: () => {\n\t\t\t\t\t\tthis.set_serial_nos_from_range();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\n\t\tif (this.item?.has_serial_no) {\n\t\t\tfields = [\n\t\t\t\t...fields,\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\t\tdepends_on: \"eval:doc.enter_manually === 1\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\tlabel: __(\"Enter Serial Nos\"),\n\t\t\t\t\tfieldname: \"upload_serial_nos\",\n\t\t\t\t\tdepends_on: \"eval:doc.enter_manually === 1\",\n\t\t\t\t\tdescription: __(\"Enter each serial no in a new line\"),\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tset_serial_nos_from_range() {\n\t\tconst serial_no_range = this.dialog.get_value(\"serial_no_range\");\n\n\t\tif (!serial_no_range) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst serial_nos = erpnext.stock.utils.get_serial_range(serial_no_range, \"::\");\n\n\t\tif (serial_nos) {\n\t\t\tthis.dialog.set_value(\"upload_serial_nos\", serial_nos.join(\"\\n\"));\n\t\t}\n\t}\n\n\tcreate_serial_nos() {\n\t\tlet { upload_serial_nos } = this.dialog.get_values();\n\n\t\tif (!upload_serial_nos) {\n\t\t\tfrappe.throw(__(\"Please enter Serial Nos\"));\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.create_serial_nos\",\n\t\t\targs: {\n\t\t\t\titem_code: this.item.item_code,\n\t\t\t\tserial_nos: upload_serial_nos,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tthis.dialog.fields_dict.entries.df.data = [];\n\t\t\t\t\tthis.set_data(r.message);\n\t\t\t\t\tthis.update_bundle_entries();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tdownload_csv_file() {\n\t\tlet csvFileData = [\"Serial No\"];\n\n\t\tif (this.item.has_serial_no && this.item.has_batch_no) {\n\t\t\tcsvFileData = [\"Serial No\", \"Batch No\", \"Quantity\"];\n\t\t} else if (this.item.has_batch_no) {\n\t\t\tcsvFileData = [\"Batch No\", \"Quantity\"];\n\t\t}\n\n\t\tconst method = `/api/method/erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.download_blank_csv_template?content=${encodeURIComponent(\n\t\t\tJSON.stringify(csvFileData)\n\t\t)}`;\n\t\tconst w = window.open(frappe.urllib.get_full_url(method));\n\t\tif (!w) {\n\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\"));\n\t\t}\n\t}\n\n\tupload_csv_file() {\n\t\tconst file_path = this.dialog.get_value(\"attach_serial_batch_csv\");\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.upload_csv_file\",\n\t\t\targs: {\n\t\t\t\titem_code: this.item.item_code,\n\t\t\t\tfile_path: file_path,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (r.message.serial_nos && r.message.serial_nos.length) {\n\t\t\t\t\tthis.set_data(r.message.serial_nos);\n\t\t\t\t} else if (r.message.batch_nos && r.message.batch_nos.length) {\n\t\t\t\t\tthis.set_data(r.message.batch_nos);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tget_filter_fields() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Auto Fetch\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tfieldname: \"qty\",\n\t\t\t\tlabel: __(\"Qty to Fetch\"),\n\t\t\t\tonchange: () => this.get_auto_data(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: [\"FIFO\", \"LIFO\", \"Expiry\"],\n\t\t\t\tdefault: \"FIFO\",\n\t\t\t\tfieldname: \"based_on\",\n\t\t\t\tlabel: __(\"Fetch Based On\"),\n\t\t\t\tonchange: () => this.get_auto_data(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t];\n\t}\n\n\tget_batch_qty(batch_no, callback) {\n\t\tlet warehouse = this.item.s_warehouse || this.item.t_warehouse || this.item.warehouse;\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.stock.doctype.batch.batch.get_batch_qty\",\n\t\t\targs: {\n\t\t\t\tbatch_no: batch_no,\n\t\t\t\twarehouse: warehouse,\n\t\t\t\titem_code: this.item.item_code,\n\t\t\t\tposting_date: this.frm.doc.posting_date,\n\t\t\t\tposting_time: this.frm.doc.posting_time,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tcallback(flt(r.message));\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tget_dialog_table_fields() {\n\t\tlet fields = [];\n\t\tlet me = this;\n\n\t\tif (this.item.has_serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Serial No\",\n\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\tlabel: __(\"Serial No\"),\n\t\t\t\tin_list_view: 1,\n\t\t\t\tget_query: () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: this.get_serial_no_filters(),\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tlet batch_fields = [];\n\t\tif (this.item.has_batch_no) {\n\t\t\tbatch_fields = [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"Batch\",\n\t\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tget_route_options_for_new_doc: () => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\titem: this.item.item_code,\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\tchange() {\n\t\t\t\t\t\tlet doc = this.doc;\n\t\t\t\t\t\tif (!doc.qty && me.item.type_of_transaction === \"Outward\") {\n\t\t\t\t\t\t\tme.get_batch_qty(doc.batch_no, (qty) => {\n\t\t\t\t\t\t\t\tdoc.qty = qty;\n\t\t\t\t\t\t\t\tthis.grid.set_value(\"qty\", qty, doc);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\tlet is_inward = false;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t([\"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doc.doctype) &&\n\t\t\t\t\t\t\t\t!this.frm.doc.is_return) ||\n\t\t\t\t\t\t\t(this.frm.doc.doctype === \"Stock Entry\" &&\n\t\t\t\t\t\t\t\tthis.frm.doc.purpose === \"Material Receipt\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tis_inward = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet include_expired_batches = me.include_expired_batches();\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: this.item.item_code,\n\t\t\t\t\t\t\t\twarehouse:\n\t\t\t\t\t\t\t\t\tthis.item.s_warehouse || this.item.t_warehouse || this.item.warehouse,\n\t\t\t\t\t\t\t\tis_inward: is_inward,\n\t\t\t\t\t\t\t\tinclude_expired_batches: include_expired_batches,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tif (!this.item.has_serial_no) {\n\t\t\t\tbatch_fields.push({\n\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\tlabel: __(\"Quantity\"),\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfields = [...fields, ...batch_fields];\n\n\t\tfields.push({\n\t\t\tfieldtype: \"Data\",\n\t\t\tfieldname: \"name\",\n\t\t\tlabel: __(\"Name\"),\n\t\t\thidden: 1,\n\t\t});\n\n\t\treturn fields;\n\t}\n\n\tinclude_expired_batches() {\n\t\treturn (\n\t\t\tthis.frm.doc.doctype === \"Stock Reconciliation\" ||\n\t\t\t(this.frm.doc.doctype === \"Stock Entry\" &&\n\t\t\t\t[\"Material Receipt\", \"Material Transfer\", \"Material Issue\"].includes(this.frm.doc.purpose))\n\t\t);\n\t}\n\n\tget_auto_data() {\n\t\tlet { qty, based_on } = this.dialog.get_values();\n\n\t\tif (this.item.serial_and_batch_bundle || this.item.rejected_serial_and_batch_bundle) {\n\t\t\tif (this.qty && qty === Math.abs(this.qty)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.item.serial_no || this.item.batch_no) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!based_on) {\n\t\t\tbased_on = \"FIFO\";\n\t\t}\n\n\t\tlet warehouse = this.item.warehouse || this.item.s_warehouse;\n\t\tif (this.item?.is_rejected) {\n\t\t\twarehouse = this.item.rejected_warehouse;\n\t\t}\n\n\t\tif (qty) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.get_auto_data\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: this.item.item_code,\n\t\t\t\t\twarehouse: warehouse,\n\t\t\t\t\thas_serial_no: this.item.has_serial_no,\n\t\t\t\t\thas_batch_no: this.item.has_batch_no,\n\t\t\t\t\tqty: qty,\n\t\t\t\t\tbased_on: based_on,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date,\n\t\t\t\t\tposting_time: this.frm.doc.posting_time,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.dialog.fields_dict.entries.df.data = r.message;\n\t\t\t\t\t\tthis.dialog.fields_dict.entries.grid.refresh();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tscan_barcode_data() {\n\t\tconst { scan_serial_no, scan_batch_no } = this.dialog.get_values();\n\n\t\tthis.dialog.set_value(\"enter_manually\", 0);\n\n\t\tif (scan_serial_no || scan_batch_no) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.is_serial_batch_no_exists\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: this.item.item_code,\n\t\t\t\t\ttype_of_transaction: this.item.type_of_transaction,\n\t\t\t\t\tserial_no: scan_serial_no,\n\t\t\t\t\tbatch_no: scan_batch_no,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tthis.update_serial_batch_no();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tupdate_serial_batch_no() {\n\t\tconst { scan_serial_no, scan_batch_no } = this.dialog.get_values();\n\n\t\tif (scan_serial_no) {\n\t\t\tlet existing_row = this.dialog.fields_dict.entries.df.data.filter((d) => {\n\t\t\t\tif (d.serial_no === scan_serial_no) {\n\t\t\t\t\treturn d;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (existing_row?.length) {\n\t\t\t\tfrappe.throw(__(\"Serial No {0} already exists\", [scan_serial_no]));\n\t\t\t}\n\n\t\t\tif (!this.item.has_batch_no) {\n\t\t\t\tthis.dialog.fields_dict.entries.df.data.push({\n\t\t\t\t\tserial_no: scan_serial_no,\n\t\t\t\t});\n\n\t\t\t\tthis.dialog.fields_dict.scan_serial_no.set_value(\"\");\n\t\t\t} else {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.get_batch_no_from_serial_no\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tserial_no: scan_serial_no,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tthis.dialog.fields_dict.entries.df.data.push({\n\t\t\t\t\t\t\tserial_no: scan_serial_no,\n\t\t\t\t\t\t\tbatch_no: r.message,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.dialog.fields_dict.scan_serial_no.set_value(\"\");\n\t\t\t\t\t\tthis.dialog.fields_dict.entries.grid.refresh();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (scan_batch_no) {\n\t\t\tlet existing_row = this.dialog.fields_dict.entries.df.data.filter((d) => {\n\t\t\t\tif (d.batch_no === scan_batch_no) {\n\t\t\t\t\treturn d;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (existing_row?.length) {\n\t\t\t\texisting_row[0].qty += 1;\n\t\t\t} else {\n\t\t\t\tthis.dialog.fields_dict.entries.df.data.push({\n\t\t\t\t\tbatch_no: scan_batch_no,\n\t\t\t\t\tqty: 1,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.dialog.fields_dict.scan_batch_no.set_value(\"\");\n\t\t}\n\n\t\tthis.dialog.fields_dict.entries.grid.refresh();\n\t}\n\n\tupdate_bundle_entries() {\n\t\tlet entries = this.dialog.get_values().entries;\n\t\tlet warehouse = this.dialog.get_value(\"warehouse\");\n\t\tlet upload_serial_nos = this.dialog.get_value(\"upload_serial_nos\");\n\n\t\tif (!entries?.length && upload_serial_nos) {\n\t\t\tthis.create_serial_nos();\n\t\t\treturn;\n\t\t}\n\n\t\tif ((entries && !entries.length) || !entries) {\n\t\t\tfrappe.throw(__(\"Please add atleast one Serial No / Batch No\"));\n\t\t}\n\n\t\tif (!warehouse) {\n\t\t\tfrappe.throw(__(\"Please select a Warehouse\"));\n\t\t}\n\n\t\tif (this.item?.is_rejected && this.item.rejected_warehouse === this.item.warehouse) {\n\t\t\tfrappe.throw(__(\"Rejected Warehouse and Accepted Warehouse cannot be same.\"));\n\t\t}\n\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.add_serial_batch_ledgers\",\n\t\t\t\targs: {\n\t\t\t\t\tentries: entries,\n\t\t\t\t\tchild_row: this.item,\n\t\t\t\t\tdoc: this.frm.doc,\n\t\t\t\t\twarehouse: warehouse,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.callback && this.callback(r.message);\n\t\t\t\t\t},\n\t\t\t\t\t() => this.frm.save(),\n\t\t\t\t\t() => this.dialog.hide(),\n\t\t\t\t]);\n\t\t\t});\n\t}\n\n\tedit_full_form() {\n\t\tlet bundle_id = this.item.serial_and_batch_bundle;\n\t\tif (!bundle_id) {\n\t\t\tlet _new = frappe.model.get_new_doc(\"Serial and Batch Bundle\", null, null, true);\n\n\t\t\t_new.item_code = this.item.item_code;\n\t\t\t_new.warehouse = this.get_warehouse();\n\t\t\t_new.has_serial_no = this.item.has_serial_no;\n\t\t\t_new.has_batch_no = this.item.has_batch_no;\n\t\t\t_new.type_of_transaction = this.item.type_of_transaction;\n\t\t\t_new.company = this.frm.doc.company;\n\t\t\t_new.voucher_type = this.frm.doc.doctype;\n\t\t\tbundle_id = _new.name;\n\t\t}\n\n\t\tfrappe.set_route(\"Form\", \"Serial and Batch Bundle\", bundle_id);\n\t\tthis.dialog.hide();\n\t}\n\n\tget_warehouse() {\n\t\tif (this.item?.is_rejected) {\n\t\t\treturn this.item.rejected_warehouse;\n\t\t}\n\n\t\treturn this.item?.type_of_transaction === \"Outward\"\n\t\t\t? this.item.warehouse || this.item.s_warehouse\n\t\t\t: this.item.warehouse || this.item.t_warehouse;\n\t}\n\n\trender_data() {\n\t\tif (this.bundle || this.frm.doc.is_return) {\n\t\t\tfrappe\n\t\t\t\t.call({\n\t\t\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.get_serial_batch_ledgers\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\titem_code: this.item.item_code,\n\t\t\t\t\t\tname: this.bundle,\n\t\t\t\t\t\tvoucher_no: !this.frm.is_new() ? this.item.parent : \"\",\n\t\t\t\t\t\tchild_row: this.frm.doc.is_return ? this.item : \"\",\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.set_data(r.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t}\n\n\tset_data(data) {\n\t\tdata.forEach((d) => {\n\t\t\td.qty = Math.abs(d.qty);\n\t\t\td.name = d.child_row || d.name;\n\t\t\tthis.dialog.fields_dict.entries.df.data.push(d);\n\t\t});\n\n\t\tthis.dialog.fields_dict.entries.grid.refresh();\n\t\tif (this.dialog.fields_dict.entries.df.data?.length) {\n\t\t\tthis.dialog.set_value(\"enter_manually\", 0);\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = class payments extends erpnext.stock.StockController {\n\tmake_payment() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: \"Payment\",\n\t\t});\n\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text();\n\t}\n\n\tselect_text() {\n\t\t$(this.$body)\n\t\t\t.find(\".form-control\")\n\t\t\t.click(function () {\n\t\t\t\t$(this).select();\n\t\t\t});\n\t}\n\n\tset_payment_primary_action() {\n\t\tvar me = this;\n\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function () {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tmake_keyboard() {\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template(\"pos_payment\", this.frm.doc));\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event();\n\t\tthis.clear_amount();\n\t}\n\n\tmake_multimode_payment() {\n\t\tvar me = this;\n\n\t\tif (this.frm.doc.change_amount > 0) {\n\t\t\tme.payment_val = me.doc.outstanding_amount;\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, \"Multi Mode Payment\", \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t}\n\n\tshow_payment_details() {\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find(\".multimode-payments\").empty();\n\t\tif (this.frm.doc.payments.length) {\n\t\t\t$.each(this.frm.doc.payments, function (index, data) {\n\t\t\t\t$(\n\t\t\t\t\tfrappe.render_template(\"payment_details\", {\n\t\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\t\tamount: data.amount,\n\t\t\t\t\t\tidx: data.idx,\n\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\ttype: data.type,\n\t\t\t\t\t})\n\t\t\t\t).appendTo(multimode_payments);\n\n\t\t\t\tif (data.type == \"Cash\" && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\", { idx: me.idx }));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments);\n\t\t}\n\t}\n\n\tset_outstanding_amount() {\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\", { idx: this.idx }));\n\t\tthis.highlight_selected_row();\n\t\tthis.payment_val = 0.0;\n\t\tif (this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0) {\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(\n\t\t\t\tthis.frm.doc.outstanding_amount / this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"outstanding_amount\")\n\t\t\t);\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount();\n\t\t} else if (flt(this.selected_mode.val()) > 0) {\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select();\n\t\tthis.bind_amount_change_event();\n\t}\n\n\tbind_keyboard_event() {\n\t\tvar me = this;\n\t\tthis.payment_val = \"\";\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t}\n\n\tbind_form_control_event() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".pos-payment-row\")\n\t\t\t.click(function () {\n\t\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\t\tme.set_outstanding_amount();\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".form-control\")\n\t\t\t.click(function () {\n\t\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\t\tme.set_outstanding_amount();\n\t\t\t\tme.update_paid_amount(true);\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".write_off_amount\")\n\t\t\t.change(function () {\n\t\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".change_amount\")\n\t\t\t.change(function () {\n\t\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t\t});\n\t}\n\n\thighlight_selected_row() {\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\", { idx: this.idx }));\n\t\t$(this.$body).find(\".pos-payment-row\").removeClass(\"selected-payment-mode\");\n\t\tselected_row.addClass(\"selected-payment-mode\");\n\t\t$(this.$body).find(\".amount\").attr(\"disabled\", true);\n\t\tthis.selected_mode.attr(\"disabled\", false);\n\t}\n\n\tbind_numeric_keys_event() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".pos-keyboard-key\")\n\t\t\t.click(function () {\n\t\t\t\tme.payment_val += $(this).text();\n\t\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\t\tme.update_paid_amount();\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".delete-btn\")\n\t\t\t.click(function () {\n\t\t\t\tme.payment_val = cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\t\tme.update_paid_amount();\n\t\t\t});\n\t}\n\n\tbind_amount_change_event() {\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function () {\n\t\t\tme.payment_val = flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_payment_amount();\n\t\t});\n\t}\n\n\tclear_amount() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".clr\")\n\t\t\t.click(function (e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\", { idx: me.idx }));\n\t\t\t\tme.payment_val = 0.0;\n\t\t\t\tme.selected_mode.val(0.0);\n\t\t\t\tme.highlight_selected_row();\n\t\t\t\tme.update_payment_amount();\n\t\t\t});\n\t}\n\n\twrite_off_amount(write_off_amount) {\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(\n\t\t\tthis.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\")\n\t\t);\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tchange_amount(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount();\n\t\tthis.show_amounts();\n\t}\n\n\tupdate_paid_amount(update_write_off) {\n\t\tvar me = this;\n\t\tif ([\"change_amount\", \"write_off_amount\"].includes(this.idx)) {\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif (me.idx == \"change_amount\") {\n\t\t\t\tme.change_amount(value);\n\t\t\t} else {\n\t\t\t\tif (flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(\n\t\t\t\t\t\tme.frm.doc.outstanding_amount / me.frm.doc.conversion_rate,\n\t\t\t\t\t\tprecision(me.idx)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.update_payment_amount();\n\t\t}\n\t}\n\n\tupdate_payment_amount() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function (index, data) {\n\t\t\tif (cint(me.idx) == cint(data.idx)) {\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2);\n\t\t\t}\n\t\t});\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tshow_amounts() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".write_off_amount\")\n\t\t\t.val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body)\n\t\t\t.find(\".paid_amount\")\n\t\t\t.text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body)\n\t\t\t.find(\".change_amount\")\n\t\t\t.val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency));\n\t\t$(this.$body)\n\t\t\t.find(\".outstanding_amount\")\n\t\t\t.text(\n\t\t\t\tformat_currency(\n\t\t\t\t\tthis.frm.doc.outstanding_amount,\n\t\t\t\t\tfrappe.get_doc(\":Company\", this.frm.doc.company).default_currency\n\t\t\t\t)\n\t\t\t);\n\t\tthis.update_invoice();\n\t}\n};\n", "\n\tfrappe.templates['visual_plant_floor_template'] = `{% $.each(workstations, (idx, row) => { %}\n\t<div class=\"workstation-wrapper\" data-workstation=\"{{row.name}}\">\n\t\t<div class=\"workstation-status text-left\" style=\"\">\n\t\t\t<span class=\"indicator-pill no-indicator-dot whitespace-nowrap {{row.color}}\" style=\"margin: 8px 0px 0px 8px;\">\n\t\t\t\t<span class=\"workstation-status-title\" style=\"font-size:10px\">{{row.status}}</span>\n\t\t\t</span>\n\t\t</div>\n\t\t<div class=\"workstation-image {{row.workstation_off}}\" onclick=\"location.href='{{row.workstation_link}}'\">\n\t\t\t<div class=\"workstation-image-container flex items-center justify-center h-32 border-b-grey text-6xl text-grey-100\">\n\t\t\t\t{% if(row.status_image) { %}\n\t\t\t\t\t<img class=\"workstation-image-cls\" src=\"{{row.status_image}}\">\n\t\t\t\t{% } else { %}\n\t\t\t\t\t<div class=\"workstation-image-cls workstation-abbr\" style=\"margin:6px; height:82px\">{{frappe.get_abbr(row.name, 2)}}</div>\n\t\t\t\t{% } %}\n\t\t\t</div>\n\t\t\t<span class=\"ellipsis\" title=\"{{row.name}}\">\n\t\t\t\t<div style=\"font-size:11px; text-align:center;padding-bottom:8px\">{{row.workstation_name}}</div>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n{% }); %}`;\n", "class VisualPlantFloor {\n\tconstructor({ wrapper, skip_filters = false, plant_floor = null }, page = null) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.plant_floor = plant_floor;\n\t\tthis.skip_filters = skip_filters;\n\n\t\tthis.make();\n\t\tif (!this.skip_filters) {\n\t\t\tthis.page = page;\n\t\t\tthis.add_filter();\n\t\t\tthis.prepare_menu();\n\t\t}\n\t}\n\n\tmake() {\n\t\tthis.wrapper.append(`\n\t\t\t<div class=\"plant-floor\">\n\t\t\t\t<div class=\"plant-floor-filter\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"plant-floor-container col-sm-12\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tif (!this.skip_filters) {\n\t\t\tthis.filter_wrapper = this.wrapper.find(\".plant-floor-filter\");\n\t\t\tthis.visualization_wrapper = this.wrapper.find(\".plant-floor-visualization\");\n\t\t} else if (this.plant_floor) {\n\t\t\tthis.wrapper.find(\".plant-floor\").css(\"border\", \"none\");\n\t\t\tthis.prepare_data();\n\t\t}\n\t}\n\n\tprepare_data() {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.manufacturing.doctype.workstation.workstation.get_workstations\",\n\t\t\targs: {\n\t\t\t\tplant_floor: this.plant_floor,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tthis.workstations = r.message;\n\t\t\t\tthis.render_workstations();\n\t\t\t},\n\t\t});\n\t}\n\n\tadd_filter() {\n\t\tthis.plant_floor = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Plant Floor\",\n\t\t\t\tfieldname: \"plant_floor\",\n\t\t\t\tlabel: __(\"Plant Floor\"),\n\t\t\t\treqd: 1,\n\t\t\t\tonchange: () => {\n\t\t\t\t\tthis.render_plant_visualization();\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.filter_wrapper,\n\t\t\trender_input: true,\n\t\t});\n\n\t\tthis.plant_floor.$wrapper.addClass(\"form-column col-sm-2\");\n\n\t\tthis.workstation_type = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Workstation Type\",\n\t\t\t\tfieldname: \"workstation_type\",\n\t\t\t\tlabel: __(\"Machine Type\"),\n\t\t\t\tonchange: () => {\n\t\t\t\t\tthis.render_plant_visualization();\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.filter_wrapper,\n\t\t\trender_input: true,\n\t\t});\n\n\t\tthis.workstation_type.$wrapper.addClass(\"form-column col-sm-2\");\n\n\t\tthis.workstation = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Workstation\",\n\t\t\t\tfieldname: \"workstation\",\n\t\t\t\tlabel: __(\"Machine\"),\n\t\t\t\tonchange: () => {\n\t\t\t\t\tthis.render_plant_visualization();\n\t\t\t\t},\n\t\t\t\tget_query: () => {\n\t\t\t\t\tif (this.workstation_type.get_value()) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\tworkstation_type: this.workstation_type.get_value() || \"\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.filter_wrapper,\n\t\t\trender_input: true,\n\t\t});\n\n\t\tthis.workstation.$wrapper.addClass(\"form-column col-sm-2\");\n\n\t\tthis.workstation_status = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: \"\\nProduction\\nOff\\nIdle\\nProblem\\nMaintenance\\nSetup\",\n\t\t\t\tfieldname: \"workstation_status\",\n\t\t\t\tlabel: __(\"Status\"),\n\t\t\t\tonchange: () => {\n\t\t\t\t\tthis.render_plant_visualization();\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.filter_wrapper,\n\t\t\trender_input: true,\n\t\t});\n\t}\n\n\trender_plant_visualization() {\n\t\tlet plant_floor = this.plant_floor.get_value();\n\n\t\tif (plant_floor) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.manufacturing.doctype.workstation.workstation.get_workstations\",\n\t\t\t\targs: {\n\t\t\t\t\tplant_floor: plant_floor,\n\t\t\t\t\tworkstation_type: this.workstation_type.get_value(),\n\t\t\t\t\tworkstation: this.workstation.get_value(),\n\t\t\t\t\tworkstation_status: this.workstation_status.get_value(),\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tthis.workstations = r.message;\n\t\t\t\t\tthis.render_workstations();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\trender_workstations() {\n\t\tthis.wrapper.find(\".plant-floor-container\").empty();\n\t\tlet template = frappe.render_template(\"visual_plant_floor_template\", {\n\t\t\tworkstations: this.workstations,\n\t\t});\n\n\t\t$(template).appendTo(this.wrapper.find(\".plant-floor-container\"));\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.add_menu_item(__(\"Refresh\"), () => {\n\t\t\tthis.render_plant_visualization();\n\t\t});\n\t}\n\n\tupdate_status(data) {\n\t\tlet workstation_card$ = this.wrapper.find(`.workstation-wrapper[data-workstation=\"${data.name}\"]`);\n\t\tworkstation_card$.find(\".workstation-image-container\").empty();\n\t\tlet workstation_image = workstation_card$.find(\".workstation-image\");\n\t\tworkstation_image.removeClass(\"workstation-off\");\n\n\t\tif (data.status_image) {\n\t\t\tworkstation_card$\n\t\t\t\t.find(\".workstation-image-container\")\n\t\t\t\t.append(`<img class=\"workstation-image-cls\" src=\"${data.status_image}\" />`);\n\t\t} else {\n\t\t\tworkstation_card$\n\t\t\t\t.find(\".workstation-image-container\")\n\t\t\t\t.append(\n\t\t\t\t\t`<div class=\"workstation-image-cls workstation-abbr\" style=\"margin:6px; height:82px\">${frappe.get_abbr(\n\t\t\t\t\t\tdata.name,\n\t\t\t\t\t\t2\n\t\t\t\t\t)}</div>`\n\t\t\t\t);\n\t\t}\n\n\t\tif (data.status !== \"Production\") {\n\t\t\tworkstation_image.addClass(\"workstation-off\");\n\t\t}\n\n\t\tworkstation_card$.find(\".indicator-pill\").removeClass(data.old_color);\n\t\tworkstation_card$.find(\".indicator-pill\").addClass(data.color);\n\t\tworkstation_card$.find(\".workstation-status-title\").text(data.status);\n\t}\n}\n\nfrappe.ui.VisualPlantFloor = VisualPlantFloor;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = class TaxesAndTotals extends erpnext.payments {\n\tsetup() {\n\t\tthis.fetch_round_off_accounts();\n\t}\n\n\tapply_pricing_rule_on_item(item) {\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tlet item_rate = item.rate;\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(item.parenttype) && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif (item.margin_type == \"Percentage\") {\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem_rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif (item.discount_percentage && !item.discount_amount) {\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount > 0) {\n\t\t\titem_rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t\titem.discount_percentage = 100 * flt(item.discount_amount) / flt(item.rate_with_margin);\n\t\t}\n\n\t\tfrappe.model.set_value(item.doctype, item.name, \"rate\", item_rate);\n\t}\n\n\tasync calculate_taxes_and_totals(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// # Update grand total as per cash and non trade discount\n\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\tthis.frm.doc.grand_total -= this.frm.doc.discount_amount;\n\t\t\tthis.frm.doc.base_grand_total -= this.frm.doc.base_discount_amount;\n\t\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\t\tthis.frm.doc.base_rounding_adjustment = 0;\n\t\t\tthis.set_rounded_total();\n\t\t}\n\n\t\tawait this.calculate_shipping_charges();\n\n\t\t// Advance calculation applicable to Sales/Purchase Invoice\n\t\tif (\n\t\t\t[\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2\n\t\t\t&& !this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (\n\t\t\t[\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.is_pos\n\t\t\t&& this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.set_total_amount_to_default_mop();\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\t// Update paid amount on return/debit note creation\n\t\tif (\n\t\t\tthis.frm.doc.doctype === \"Purchase Invoice\"\n\t\t\t&& this.frm.doc.is_return\n\t\t\t&& (this.frm.doc.grand_total > this.frm.doc.paid_amount)\n\t\t) {\n\t\t\tthis.frm.doc.paid_amount = flt(this.frm.doc.grand_total, precision(\"grand_total\"));\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tcalculate_discount_amount() {\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t}\n\n\t_calculate_taxes_and_totals() {\n\t\tconst is_quotation = this.frm.doc.doctype == \"Quotation\";\n\t\tthis.frm._items = is_quotation ? this.filtered_items() : this.frm.doc.items;\n\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.adjust_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t}\n\n\tvalidate_conversion_rate() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tconst subs =  [conversion_rate_label, this.frm.doc.currency, company_currency];\n\t\t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', subs);\n\t\t\t\tfrappe.throw(err_message);\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_item_values() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\tfor (const item of this.frm.doc.items || []) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\t\t\t\titem.qty = item.qty === undefined ? (me.frm.doc.is_return ? -1 : 1) : item.qty;\n\n\t\t\t\tif (!(me.frm.doc.is_return || me.frm.doc.is_debit_note)) {\n\t\t\t\t\titem.net_amount = item.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// allow for '0' qty on Credit/Debit notes\n\t\t\t\t\tlet qty = flt(item.qty);\n\t\t\t\t\tif (!qty) {\n\t\t\t\t\t\tqty = (me.frm.doc.is_debit_note ? 1 : -1);\n\t\t\t\t\t\tif (me.frm.doc.doctype !== \"Purchase Receipt\" && me.frm.doc.is_return === 1) {\n\t\t\t\t\t\t\t// In case of Purchase Receipt, qty can be 0 if all items are rejected\n\t\t\t\t\t\t\tqty = flt(item.qty);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\titem.net_amount = item.amount = flt(item.rate * qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t}\n\t}\n\n\tset_in_company_currency(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t}\n\n\tinitialize_taxes() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\ttax.item_wise_tax_detail = {};\n\t\t\t}\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied) {\n\t\t\t\terpnext.accounts.taxes.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\terpnext.accounts.taxes.validate_inclusive_tax(tax, this.frm);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t}\n\n\tfetch_round_off_accounts() {\n\t\tlet me = this;\n\t\tfrappe.flags.round_off_applicable_accounts = [];\n\n\t\tif (me.frm.doc.company) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.controllers.taxes_and_totals.get_round_off_applicable_accounts\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\t\t\"account_list\": frappe.flags.round_off_applicable_accounts\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tfrappe.flags.round_off_applicable_accounts.push(...r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.controllers.taxes_and_totals.get_rounding_tax_settings\",\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.flags.round_off_settings = r.message;\n\t\t\t}\n\t\t});\n\t}\n\n\tdetermine_exclusive_rate() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(this.frm.doc.items || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction), precision(\"net_amount\", item));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t}\n\n\tget_current_tax_fraction(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t}\n\n\t_get_tax_rate(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t}\n\n\tcalculate_net_total() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm._items || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t});\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t}\n\n\tcalculate_shipping_charges() {\n\t\t// Do not apply shipping rule for POS\n\t\tif (this.frm.doc.is_pos) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"shipping_rule\", this.frm.doc.name)) {\n\t\t\treturn this.shipping_rule();\n\t\t}\n\t}\n\n\tadd_taxes_from_item_tax_template(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif (item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif (typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif (!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t\tchild.set_by_item_tax_template = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_taxes() {\n\t\tconst doc = this.frm.doc;\n\t\tif (!doc.taxes?.length) return;\n\n\t\tvar me = this;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(doc.taxes, function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm._items || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(doc.taxes, function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\t\t\t\tif (frappe.flags.round_row_wise_tax) {\n\t\t\t\t\tcurrent_tax_amount = flt(current_tax_amount, precision(\"tax_amount\", tax));\n\t\t\t\t}\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm._items.length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconst discount_amount_applied = this.discount_amount_applied;\n\t\tif (doc.apply_discount_on === \"Grand Total\" && (discount_amount_applied || doc.discount_amount || doc.additional_discount_percentage)) {\n\t\t\tconst tax_amount_precision = precision(\"tax_amount\", doc.taxes[0]);\n\n\t\t\tfor (const [i, tax] of doc.taxes.entries()) {\n\t\t\t\tif (discount_amount_applied)\n\t\t\t\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, tax_amount_precision);\n\n\t\t\t\tthis.set_cumulative_total(i, tax);\n\t\t\t}\n\n\t\t\tif (!this.discount_amount_applied) {\n\t\t\t\tthis.grand_total_for_distributing_discount = doc.taxes[doc.taxes.length - 1].total;\n\t\t\t} else {\n\t\t\t\tthis.grand_total_diff = flt(\n\t\t\t\t\tthis.grand_total_for_distributing_discount - doc.discount_amount - doc.taxes[doc.taxes.length - 1].total, precision(\"grand_total\"));\n\t\t\t}\n\t\t}\n\n\t\tfor (const [i, tax] of doc.taxes.entries()) {\n\t\t\tme.round_off_totals(tax);\n\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t[\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\tme.round_off_base_values(tax);\n\n\t\t\t// in tax.total, accumulate grand total for each tax\n\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\tme.set_in_company_currency(tax, [\"total\"]);\n\t\t}\n\t}\n\n\tset_cumulative_total(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t}\n\n\t_load_item_tax_rate(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t}\n\n\tget_current_tax_amount(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\t\tvar current_net_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\tcurrent_net_amount = item.net_amount\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tif (tax.account_head in item_tax_map) {\n\t\t\t\tcurrent_net_amount = item.net_amount\n\t\t\t};\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_net_amount = this.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_net_amount = this.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t// don't sum current net amount due to the field being a currency field\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\n\t\tif (!tax.dont_recompute_tax) {\n\t\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount, current_net_amount);\n\t\t}\n\n\t\treturn current_tax_amount;\n\t}\n\n\tset_item_wise_tax(item, tax, tax_rate, current_tax_amount, current_net_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tif(typeof (tax_detail) == \"string\") {\n\t\t\ttax.item_wise_tax_detail = JSON.parse(tax.item_wise_tax_detail);\n\t\t\ttax_detail = tax.item_wise_tax_detail;\n\t\t}\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tlet item_wise_net_amount = current_net_amount * this.frm.doc.conversion_rate;\n\t\tif (frappe.flags.round_row_wise_tax) {\n\t\t\titem_wise_tax_amount = flt(item_wise_tax_amount, precision(\"tax_amount\", tax));\n\t\t\titem_wise_net_amount = flt(item_wise_net_amount, precision(\"net_amount\", tax));\n\t\t\tif (tax_detail && tax_detail[key]) {\n\t\t\t\titem_wise_tax_amount += flt(tax_detail[key].tax_amount, precision(\"tax_amount\", tax));\n\t\t\t\titem_wise_net_amount += flt(tax_detail[key].net_amount, precision(\"net_amount\", tax));\n\t\t\t}\n\t\t} else if (tax_detail && tax_detail[key]) {\n\t\t\titem_wise_tax_amount += tax_detail[key].tax_amount;\n\t\t\titem_wise_net_amount += tax_detail[key].net_amount;\n\t\t}\n\n\t\ttax_detail[key] = {\n\t\t\ttax_rate: tax_rate,\n\t\t\ttax_amount: flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax)),\n\t\t\tnet_amount: flt(item_wise_net_amount, precision(\"base_net_amount\", tax)),\n\t\t};\n\t}\n\n\tround_off_totals(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.tax_amount= Math.round(tax.tax_amount);\n\t\t\ttax.tax_amount_after_discount_amount = Math.round(tax.tax_amount_after_discount_amount);\n\t\t}\n\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t}\n\n\tround_off_base_values(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.base_tax_amount= Math.round(tax.base_tax_amount);\n\t\t\ttax.base_tax_amount_after_discount_amount = Math.round(tax.base_tax_amount_after_discount_amount);\n\t\t}\n\t}\n\n\t/**\n\t* @deprecated Use adjust_grand_total_for_inclusive_tax instead.\n\t*/\n\tmanipulate_grand_total_for_inclusive_tax() {\n\t\t// for backward compatablility - if in case used by an external application\n\t\tthis.adjust_grand_total_for_inclusive_tax()\n\t}\n\n\tadjust_grand_total_for_inclusive_tax() {\n\t\tvar me = this;\n\n\t\t// if any inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\tlet tax_amount = d.category === \"Valuation\" ? 0 : d.tax_amount_after_discount_amount;\n\t\t\t\t\t\t\tif (d.add_deduct_tax === \"Deduct\") tax_amount *= -1;\n\t\t\t\t\t\t\treturn tax_amount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.grand_total_diff = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_totals() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tconst me = this;\n\t\tconst tax_count = this.frm.doc.taxes?.length;\n\t\tconst grand_total_diff = this.grand_total_diff || 0;\n\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + grand_total_diff\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif ([\"Valuation and Total\", \"Total\"].includes(tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- grand_total_diff, precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t}\n\n\tset_rounded_total() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment = flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t}\n\n\t_cleanup() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\t\tlet items = this.frm.doc.items;\n\n\t\tif(items && items.length) {\n\t\t\tif(!frappe.meta.get_docfield(items[0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(items || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tset_discount_amount() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t}\n\n\tapply_discount_amount() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tlet net_total = 0;\n\t\t\tlet expected_net_total = 0;\n\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm._items || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\n\t\t\t\t\tconst adjusted_net_amount = item.net_amount - distributed_amount;\n\t\t\t\t\texpected_net_total += adjusted_net_amount\n\t\t\t\t\titem.net_amount = flt(adjusted_net_amount, precision(\"net_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding adjustment\n\t\t\t\t\t// assignment to rounding_difference is intentional\n\t\t\t\t\tconst rounding_difference = flt(expected_net_total - net_total, precision(\"net_total\"));\n\t\t\t\t\tif (rounding_difference) {\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + rounding_difference, precision(\"net_amount\", item));\n\t\t\t\t\t\tnet_total += rounding_difference;\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t}\n\n\tget_total_for_discount_amount() {\n\t\tconst doc = this.frm.doc;\n\n\t\tif (doc.apply_discount_on == \"Net Total\" || !doc.taxes?.length)\n\t\t\treturn doc.net_total;\n\n\t\tlet total_actual_tax = 0.0;\n\t\tlet actual_taxes_dict = {};\n\n\t\tfunction update_actual_taxes_dict(tax, tax_amount) {\n\t\t\tif (tax.add_deduct_tax == \"Deduct\") tax_amount *= -1;\n\t\t\tif (tax.category != \"Valuation\") total_actual_tax += tax_amount;\n\n\t\t\tactual_taxes_dict[tax.idx] = {\n\t\t\t\ttax_amount: tax_amount,\n\t\t\t\tcumulative_total: total_actual_tax\n\t\t\t};\n\t\t}\n\n\t\tdoc.taxes.forEach(tax => {\n\t\t\tif ([\"Actual\", \"On Item Quantity\"].includes(tax.charge_type)) {\n\t\t\t\tupdate_actual_taxes_dict(tax, tax.tax_amount);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst base_row = actual_taxes_dict[tax.row_id];\n\t\t\tif (!base_row) return;\n\n\t\t\t// if charge type is 'On Previous Row Amount', calculate tax on previous row amount\n\t\t\t// else (On Previous Row Total) calculate tax on cumulative total\n\t\t\tconst base_tax_amount = tax.charge_type == \"On Previous Row Amount\" ? base_row[\"tax_amount\"]: base_row[\"cumulative_total\"];\n\t\t\tupdate_actual_taxes_dict(tax, base_tax_amount * tax.rate / 100);\n\t\t});\n\n\t\treturn (this.grand_total_for_distributing_discount || doc.grand_total) - total_actual_tax;\n\t}\n\n\tcalculate_total_advance(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = 0;\n\t\t}\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t\tthis.calculate_write_off_amount();\n\t}\n\n\tis_internal_invoice() {\n\t\tif (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tif (this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalculate_outstanding_amount(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif([\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif (this.frm.doc.is_return || (this.frm.doc.docstatus > 0) || this.is_internal_invoice()) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif([\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t}\n\n\tasync set_total_amount_to_default_mop() {\n\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\tif (this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\tgrand_total - this.frm.doc.total_advance - this.frm.doc.write_off_amount,\n\t\t\t\tprecision(\"grand_total\")\n\t\t\t);\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(\n\t\t\t\t\tflt(\n\t\t\t\t\t\tbase_grand_total,\n\t\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t\t)\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount\n\t\t\t\t),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\n\t\t/*\n\t\tDuring returns, if an user select mode of payment other than\n\t\tdefault mode of payment, it should retain the user selection\n\t\tinstead resetting it to default mode of payment.\n\t\t*/\n\n\t\tlet payment_amount = 0;\n\t\tthis.frm.doc.payments.forEach(payment => {\n\t\t\tpayment_amount += payment.amount\n\t\t});\n\n\t\tif (payment_amount == total_amount_to_pay) {\n\t\t\treturn;\n\t\t}\n\n\t\t/*\n\t\tFor partial return, if the payment was made using single mode of payment\n\t\tit should set the return to that mode of payment only.\n\t\t*/\n\n\t\tlet return_against_mop = await frappe.call({\n\t\t\tmethod: 'erpnext.controllers.sales_and_purchase_return.get_payment_data',\n\t\t\targs: {\n\t\t\t\tinvoice: this.frm.doc.return_against\n\t\t\t}\n\t\t});\n\n\t\tif (return_against_mop.message.length === 1) {\n\t\t\tthis.frm.doc.payments.forEach(payment => {\n\t\t\t\tif (payment.mode_of_payment == return_against_mop.message[0].mode_of_payment) {\n\t\t\t\t\tpayment.amount = total_amount_to_pay;\n\t\t\t\t} else {\n\t\t\t\t\tpayment.amount = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.frm.refresh_fields();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.doc.payments.find(payment => {\n\t\t\tif (payment.default) {\n\t\t\t\tpayment.amount = total_amount_to_pay;\n\t\t\t} else {\n\t\t\t\tpayment.amount = 0\n\t\t\t}\n\t\t});\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tasync set_default_payment(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\tlet r = await frappe.db.get_value(\"POS Profile\", this.frm.doc.pos_profile, \"disable_grand_total_to_default_mop\");\n\n\t\t\tif (r.message.disable_grand_total_to_default_mop) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount, amount;\n\n\t\t\t\t\tif (me.frm.doc.party_account_currency == me.frm.doc.currency) {\n\t\t\t\t\t\t// if customer/supplier currency is same as company currency\n\t\t\t\t\t\t// total_amount_to_pay is already in customer/supplier currency\n\t\t\t\t\t\t// so base_amount has to be calculated using total_amount_to_pay\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay, precision(\"amount\", data));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_paid_amount() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t}\n\n\tcalculate_change_amount(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif([\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total,\n\t\t\t\t\tprecision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total, precision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_write_off_amount() {\n\t\tif(this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.outstanding_amount, precision(\"write_off_amount\"));\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\n\t\t\tthis.calculate_outstanding_amount(false);\n\t\t}\n\n\t}\n\n\tfiltered_items() {\n\t\treturn this.frm.doc.items.filter(item => !item[\"is_alternative\"]);\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n\nerpnext.TransactionController = class TransactionController extends erpnext.taxes_and_totals {\n\tsetup() {\n\t\tsuper.setup();\n\t\tlet me = this;\n\n\t\tthis.set_fields_onload_for_line_item();\n\t\tthis.frm.ignore_doctypes_on_cancel_all = ['Serial and Batch Bundle'];\n\n\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate && !item.blanket_order_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.discount_amount = flt(item.price_list_rate) - flt(item.rate);\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\tcur_frm.cscript.calculate_stock_uom_rate(frm, cdt, cdn);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\n\t\t\titems_add: function(frm, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif (!item.warehouse && frm.doc.set_warehouse) {\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.target_warehouse && frm.doc.set_target_warehouse) {\n\t\t\t\t\titem.target_warehouse = frm.doc.set_target_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.from_warehouse && frm.doc.set_from_warehouse) {\n\t\t\t\t\titem.from_warehouse = frm.doc.set_from_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (item.docstatus === 0\n\t\t\t\t\t&& frappe.meta.has_field(item.doctype, \"use_serial_batch_fields\")\n\t\t\t\t\t&& cint(frappe.user_defaults?.use_serial_batch_fields) === 1\n\t\t\t\t) {\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, \"use_serial_batch_fields\", 1);\n\t\t\t\t}\n\n\t\t\t\terpnext.accounts.dimensions.copy_dimension_from_first_row(frm, cdt, cdn, 'items');\n\t\t\t}\n\t\t});\n\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('serial_and_batch_bundle')) {\n\t\t\tthis.frm.set_query(\"serial_and_batch_bundle\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\tlet item_row = locals[cdt][cdn];\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t'item_code': item_row.item_code,\n\t\t\t\t\t\t'voucher_type': doc.doctype,\n\t\t\t\t\t\t'voucher_no': [\"in\", [doc.name, \"\"]],\n\t\t\t\t\t\t'is_cancelled': 0,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict['items'].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query('batch_no', 'items', function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"uom\")) {\n\t\t\tthis.frm.set_query(\"uom\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\tlet row = locals[cdt][cdn];\n\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_item_uom_query\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"item_code\": row.item_code\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.process_item_removal;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"expense_account\")) {\n\t\t\tthis.frm.set_query(\"expense_account\", \"items\", function(doc) {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"report_type\": \"Profit and Loss\",\n\t\t\t\t\t\t\"is_group\": 0\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"pricing_rules\")) {\n\t\t\tthis.frm.set_indicator_formatter('pricing_rule', function(doc) {\n\t\t\t\treturn (doc.rule_applied) ? \"green\" : \"red\";\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field('blanket_order')) {\n\t\t\tthis.frm.set_query(\"blanket_order\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\tvar item = locals[cdt][cdn];\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_blanket_orders\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"blanket_order_type\": doc.doctype === \"Sales Order\" ? \"Selling\" : \"Purchasing\",\n\t\t\t\t\t\t\"item\": item.item_code\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict.taxes_and_charges) {\n\t\t\tthis.frm.set_query(\"taxes_and_charges\", function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['company', '=', me.frm.doc.company],\n\t\t\t\t\t\t['docstatus', '!=', 2]\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t}\n\n\tuse_serial_batch_fields(frm, cdt, cdn) {\n\t\tconst item = locals[cdt][cdn];\n\t\tif (!item.use_serial_batch_fields) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"serial_no\", \"\");\n\t\t\tfrappe.model.set_value(cdt, cdn, \"batch_no\", \"\");\n\t\t\tfrappe.model.set_value(cdt, cdn, \"rejected_serial_no\", \"\");\n\t\t}\n\t}\n\n\tset_fields_onload_for_line_item() {\n\t\tif (this.frm.is_new() && this.frm.doc?.items) {\n\t\t\tthis.frm.doc.items.forEach(item => {\n\t\t\t\tif (item.docstatus === 0\n\t\t\t\t\t&& frappe.meta.has_field(item.doctype, \"use_serial_batch_fields\")\n\t\t\t\t\t&& cint(frappe.user_defaults?.use_serial_batch_fields) === 1\n\t\t\t\t) {\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, \"use_serial_batch_fields\", 1);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\ttoggle_enable_for_stock_uom(field) {\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.doctype.stock_settings.stock_settings.get_enable_stock_uom_editing',\n\t\t\tcallback: (r) => {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tvar value = r.message[field];\n\t\t\t\t\tthis.frm.fields_dict[\"items\"].grid.toggle_enable(\"stock_qty\", value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonload() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.frm.trigger('set_default_internal_warehouse');\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 0),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t}\n\n\tis_return() {\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\n\t\t\tthis.frm.set_value('return_against', '');\n\t\t}\n\t}\n\n\tsetup_quality_inspection() {\n\t\tif(![\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\", \"Subcontracting Receipt\"].includes(this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet show_qc_button = true;\n\t\tif ([\"Sales Invoice\", \"Purchase Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\tshow_qc_button = this.frm.doc.update_stock;\n\t\t}\n\n\t\tconst me = this;\n\t\tif (!this.frm.is_new() && this.frm.doc.docstatus === 0 && frappe.model.can_create(\"Quality Inspection\") && show_qc_button) {\n\t\t\tthis.frm.add_custom_button(__(\"Quality Inspection(s)\"), () => {\n\t\t\t\tme.make_quality_inspection();\n\t\t\t}, __(\"Create\"));\n\t\t}\n\n\t\tconst inspection_type = [\"Purchase Receipt\", \"Purchase Invoice\", \"Subcontracting Receipt\"].includes(this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tlet quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return {};\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: [\"<\", 2],\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_payment_request() {\n\t\tlet me = this;\n\t\tconst payment_request_type = (['Sales Order', 'Sales Invoice'].includes(this.frm.doc.doctype))\n\t\t\t? \"Inward\" : \"Outward\";\n\n\t\tfrappe.call({\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\n\t\t\targs: {\n\t\t\t\tdt: me.frm.doc.doctype,\n\t\t\t\tdn: me.frm.doc.name,\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\n\t\t\t\tpayment_request_type: payment_request_type,\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer,\n\t\t\t\tparty_name:payment_request_type == 'Outward' ? me.frm.doc.supplier_name : me.frm.doc.customer_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc){\n\t\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tonload_post_render() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !this.frm.doc.__onload?.load_after_mapping) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t\tthis.frm.get_field(\"items\").grid.set_multiple_add(\"item_code\", \"qty\");\n\t\t}\n\t}\n\n\trefresh() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company(this.frm);\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t\tthis.setup_quality_inspection();\n\t\tthis.validate_has_items();\n\t\terpnext.utils.view_serial_batch_nos(this.frm);\n\t\tthis.set_route_options_for_new_doc();\n\t}\n\n\tset_route_options_for_new_doc() {\n\t\t// While creating the batch from the link field, copy item from line item to batch form\n\n\t\tif(this.frm.fields_dict['items'].grid.get_field('batch_no')) {\n\t\t\tlet batch_no_field = this.frm.get_docfield('items', 'batch_no');\n\t\t\tif (batch_no_field) {\n\t\t\t\tbatch_no_field.get_route_options_for_new_doc = function(row) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'item': row.doc.item_code\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// While creating the SABB from the link field, copy item, doctype from line item to SABB form\n\t\tif(this.frm.fields_dict['items'].grid.get_field('serial_and_batch_bundle')) {\n\t\t\tlet sbb_field = this.frm.get_docfield('items', 'serial_and_batch_bundle');\n\t\t\tif (sbb_field) {\n\t\t\t\tsbb_field.get_route_options_for_new_doc = (row) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\t\t\"voucher_type\": this.frm.doc.doctype,\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tscan_barcode() {\n\t\tfrappe.flags.dialog_set = false;\n\t\tconst barcode_scanner = new erpnext.utils.BarcodeScanner({frm:this.frm});\n\t\tbarcode_scanner.process_scan();\n\t}\n\n\tbarcode(doc, cdt, cdn)  {\n\t\tlet row = locals[cdt][cdn];\n\t\tif (row.barcode) {\n\t\t\terpnext.stock.utils.set_item_details_using_barcode(this.frm, row, (r) => {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, {\n\t\t\t\t\t\"item_code\": r.message.item_code,\n\t\t\t\t\t\"qty\": 1,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tvalidate_has_items () {\n\t\tlet table = this.frm.doc.items;\n\t\tthis.frm.has_items = (table && table.length\n\t\t\t&& table[0].qty && table[0].item_code);\n\t}\n\n\tapply_default_taxes() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges || \"\",\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tdebounce: 2000,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_sms() {\n\t\tvar me = this;\n\t\tlet blacklist = ['Purchase Invoice', 'BOM'];\n\t\tif(frappe.boot.sms_gateway_enabled && this.frm.doc.docstatus===1 && ![\"Lost\", \"Stopped\", \"Closed\"].includes(this.frm.doc.status)\n\t\t\t&& !blacklist.includes(this.frm.doctype)) {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t}\n\n\tsend_sms() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t}\n\n\titem_code(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\t// Experimental: This will be removed once stability is achieved.\n\t\tif (frappe.boot.sysdefaults.use_server_side_reactivity) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.call({\n\t\t\t\tdoc: doc,\n\t\t\t\tmethod: \"process_item_selection\",\n\t\t\t\targs: {\n\t\t\t\t\titem_idx: item.idx\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.frm.refresh_fields();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tme.process_item_selection(doc, cdt, cdn);\n\t\t}\n\t}\n\n\tprocess_item_selection(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar me = this;\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\n\t\titem.weight_per_unit = 0;\n\t\titem.weight_uom = '';\n\t\titem.conversion_factor = 0;\n\n\t\tif(['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt') ||\n\t\t\t  this.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\n\t\tif (show_batch_dialog && item.use_serial_batch_fields === 1) {\n\t\t\tshow_batch_dialog = 0;\n\t\t}\n\n\t\titem.barcode = null;\n\n\n\t\tif(item.item_code || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\titem.pricing_rules = ''\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\tctx: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\tbatch_no: item.batch_no,\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\t\t\t\tquotation_to: me.frm.doc.quotation_to,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tis_internal_supplier: me.frm.doc.is_internal_supplier,\n\t\t\t\t\t\t\tis_internal_customer: me.frm.doc.is_internal_customer,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_return: cint(me.frm.doc.is_return),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tnet_rate: item.rate,\n\t\t\t\t\t\t\tbase_net_rate: item.base_net_rate,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tuom: item.uom,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tmanufacturer: item.manufacturer,\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\n\t\t\t\t\t\t\tpos_profile: cint(me.frm.doc.is_pos) ? me.frm.doc.pos_profile : '',\n\t\t\t\t\t\t\tcost_center: item.cost_center,\n\t\t\t\t\t\t\ttax_category: me.frm.doc.tax_category,\n\t\t\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\t\t\tchild_doctype: item.doctype,\n\t\t\t\t\t\t\tchild_docname: item.name,\n\t\t\t\t\t\t\tis_old_subcontracting_flow: me.frm.doc.is_old_subcontracting_flow,\n\t\t\t\t\t\t\tuse_serial_batch_fields: item.use_serial_batch_fields,\n\t\t\t\t\t\t\tserial_and_batch_bundle: item.serial_and_batch_bundle,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (item.docstatus === 0\n\t\t\t\t\t\t\t\t\t    && frappe.meta.has_field(item.doctype, \"use_serial_batch_fields\")\n\t\t\t\t\t\t\t\t\t    && !item.use_serial_batch_fields\n\t\t\t\t\t\t\t\t\t    && cint(frappe.user_defaults?.use_serial_batch_fields) === 1\n\t\t\t\t\t\t\t\t\t   ) {\n\t\t\t\t\t\t\t\t\t\titem[\"use_serial_batch_fields\"] = 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(d.item_tax_rate);\n\t\t\t\t\t\t\t\t\tif (d.free_item_data && d.free_item_data.length > 0) {\n\t\t\t\t\t\t\t\t\t\tme.apply_product_discount(d);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// for internal customer instead of pricing rule directly apply valuation rate on item\n\t\t\t\t\t\t\t\t\tif ((me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) && me.frm.doc.represents_company === me.frm.doc.company) {\n\t\t\t\t\t\t\t\t\t\tme.get_incoming_rate(item, me.frm.posting_date, me.frm.posting_time,\n\t\t\t\t\t\t\t\t\t\t\t\t     me.frm.doc.doctype, me.frm.doc.company);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog && !frappe.flags.trigger_from_barcode_scanner)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t\t\t\tif (r.message &&\n\t\t\t\t\t\t\t\t\t\t\t    (r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tshow_batch_dialog = false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// check if batch serial selector is disabled or not\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog && !frappe.flags.hide_serial_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_single_value('Stock Settings', 'disable_serial_no_and_batch_selector')\n\t\t\t\t\t\t\t\t\t\t.then((value) => {\n\t\t\t\t\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog && !frappe.flags.dialog_set) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (d.has_batch_no && d.has_serial_no) {\n\t\t\t\t\t\t\t\t\t\t\td.batch_no = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tfrappe.flags.dialog_set = true;\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tif (!me.frm.doc.set_warehouse)\n\t\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('warehouse', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tme.apply_price_list(item, true);\n\t\t\t\t\t\t\t\t\t\t}, undefined, !frappe.flags.hide_serial_batch_dialog);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tfrappe.flags.dialog_set = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true),\n\t\t\t\t\t\t\t\t() => me.remove_pricing_rule(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (item.apply_rule_on_other_items) {\n\t\t\t\t\t\t\t\t\t\tlet key = item.name;\n\t\t\t\t\t\t\t\t\t\tme.apply_rule_on_other_items({key: item});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\t\t\t\t\t\tme.update_item_grid_labels(company_currency);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\n\tprice_list_rate(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tfrappe.model.round_floats_in(item, [\"price_list_rate\", \"discount_percentage\"]);\n\n\t\t// check if child doctype is Sales Order Item/Quotation Item and calculate the rate\n\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\", \"POS Invoice Item\", \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), cdt)\n\t\t\tthis.apply_pricing_rule_on_item(item);\n\t\telse\n\t\t\titem.rate = flt(item.price_list_rate * (1 - item.discount_percentage / 100.0),\n\t\t\t\tprecision(\"rate\", item));\n\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tmargin_rate_or_amount(doc, cdt, cdn) {\n\t\t// calculated the revised total margin and rate on margin rate changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tthis.apply_pricing_rule_on_item(item);\n\t\tthis.calculate_taxes_and_totals();\n\t\tcur_frm.refresh_fields();\n\t}\n\n\tmargin_type(doc, cdt, cdn) {\n\t\t// calculate the revised total margin and rate on margin type changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!item.margin_type) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"margin_rate_or_amount\", 0);\n\t\t} else {\n\t\t\tthis.apply_pricing_rule_on_item(item, doc, cdt, cdn);\n\t\t\tthis.calculate_taxes_and_totals();\n\t\t\tcur_frm.refresh_fields();\n\t\t}\n\t}\n\n\tget_incoming_rate(item, posting_date, posting_time, voucher_type, company) {\n\n\t\tlet item_args = {\n\t\t\t'item_code': item.item_code,\n\t\t\t'warehouse': in_list('Purchase Receipt', 'Purchase Invoice') ? item.from_warehouse : item.warehouse,\n\t\t\t'posting_date': posting_date,\n\t\t\t'posting_time': posting_time,\n\t\t\t'qty': item.qty * item.conversion_factor,\n\t\t\t'serial_no': item.serial_no,\n\t\t\t'batch_no': item.batch_no,\n\t\t\t'voucher_type': voucher_type,\n\t\t\t'company': company,\n\t\t\t'allow_zero_valuation_rate': item.allow_zero_valuation_rate\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.utils.get_incoming_rate',\n\t\t\targs: {\n\t\t\t\targs: item_args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.model.set_value(item.doctype, item.name, 'rate', r.message * item.conversion_factor);\n\t\t\t}\n\t\t});\n\t}\n\n\tserial_no(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item && item.doctype === 'Purchase Receipt Item Supplied') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (item.serial_no) {\n\t\t\titem.use_serial_batch_fields = 1\n\t\t}\n\n\t\tif (item && item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Replace all occurences of comma with line feed\n\t\t\t\titem.serial_no = item.serial_no.replace(/,/g, '\\n');\n\t\t\t\titem.conversion_factor = item.conversion_factor || 1;\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif (!doc.is_return) {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tme.update_qty(cdt, cdn);\n\t\t\t\t\t}, 3000);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\ton_submit() {\n\t\tif ([\"Purchase Invoice\", \"Sales Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t&& !this.frm.doc.update_stock) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.refresh_serial_batch_bundle_field();\n\t}\n\n\trefresh_serial_batch_bundle_field() {\n\t\tfrappe.route_hooks.after_submit = (frm_obj) => {\n\t\t\tfrm_obj.reload_doc();\n\t\t}\n\t}\n\n\tupdate_qty(cdt, cdn) {\n\t\tvar valid_serial_nos = [];\n\t\tvar serialnos = [];\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tserialnos = item.serial_no.split(\"\\n\");\n\t\tfor (var i = 0; i < serialnos.length; i++) {\n\t\t\tif (serialnos[i] != \"\") {\n\t\t\t\tvalid_serial_nos.push(serialnos[i]);\n\t\t\t}\n\t\t}\n\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t}\n\n\tvalidate() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t}\n\n\tupdate_stock() {\n\t\tthis.frm.trigger('set_default_internal_warehouse');\n\t}\n\n\tset_default_internal_warehouse() {\n\t\tlet me = this;\n\t\tif ((this.frm.doc.doctype === 'Sales Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Delivery Note') {\n\t\t\tif (this.frm.doc.is_internal_customer && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_target_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif ((this.frm.doc.doctype === 'Purchase Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Purchase Receipt') {\n\t\t\tif (this.frm.doc.is_internal_supplier && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_from_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tcompany() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => get_party_currency(),\n\t\t\t\t\t() => me.update_item_tax_map(),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule(),\n\t\t\t\t\t() => set_terms(),\n\t\t\t\t\t() => set_letter_head(),\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar get_party_currency = function() {\n\t\t\tif (me.is_a_mapped_document() || me.frm.doc.__onload?.load_after_mapping) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar party_type = frappe.meta.has_field(me.frm.doc.doctype, \"customer\") ? \"Customer\" : \"Supplier\";\n\t\t\tvar party_name = me.frm.doc[party_type.toLowerCase()];\n\t\t\tif (party_name) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: party_type,\n\t\t\t\t\t\tfilters: { name: party_name },\n\t\t\t\t\t\tfieldname: \"default_currency\",\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tset_currency(r.message.default_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tset_currency();\n\t\t\t}\n\t\t}\n\n\t\tvar set_currency = function(party_default_currency) {\n\t\t\tvar company_currency = me.get_company_currency();\n\t\t\tvar currency = party_default_currency || company_currency;\n\t\t\tif (me.frm.doc.currency != currency) {\n\t\t\t\tme.frm.set_value(\"currency\", currency);\n\t\t\t}\n\n\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t}\n\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t}\n\n\t\t\tme.frm.script_manager.trigger(\"currency\");\n\t\t}\n\n\t\tvar set_terms = function() {\n\t\t\tif (frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") && !me.frm.doc.tc_name) {\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\t\t\t\tvar selling_doctypes = [\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"];\n\t\t\t\tvar company_terms_fieldname = selling_doctypes.includes(me.frm.doc.doctype) ? \"default_selling_terms\" : \"default_buying_terms\";\n\t\t\t\tif (company_doc && company_doc[company_terms_fieldname]) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc[company_terms_fieldname]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar set_letter_head = function() {\n\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\t\t\t\tif (company_doc && company_doc.default_letter_head) {\n\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif ([\"Sales Invoice\", \"Purchase Invoice\"].includes(me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\t['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'].includes(this.frm.doctype)) {\n\t\t\t\tlet is_drop_ship = me.frm.doc.items.some(item => item.delivered_by_supplier);\n\n\t\t\t\tif (!is_drop_ship) {\n\t\t\t\t\terpnext.utils.get_shipping_address(this.frm, function() {\n\t\t\t\t\t\tset_party_account(set_pricing);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t}\n\n\ttransaction_date() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t}\n\n\tposting_date() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t}\n\n\tdue_date(doc, cdt) {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (doc.doctype !== cdt) {\n\t\t\t// triggered by change to the due_date field in payment schedule child table\n\t\t\t// do nothing to avoid infinite clearing loop\n\t\t\treturn;\n\t\t}\n\n\t\t// if there is only one row in payment schedule child table, set its due date as the due date\n\t\tif (doc.payment_schedule.length == 1){\n\t\t\tdoc.payment_schedule[0].due_date = doc.due_date;\n\t\t\tthis.frm.refresh_field(\"payment_schedule\");\n\t\t\treturn\n\t\t}\n\n\t\tif (\n\t\t\tdoc.due_date &&\n\t\t\t!this.frm.updating_party_details &&\n\t\t\t!doc.is_pos &&\n\t\t\t(\n\t\t\t\tdoc.payment_terms_template ||\n\t\t\t\tdoc.payment_schedule?.length\n\t\t\t)\n\t\t) {\n\t\t\tconst to_clear = [];\n\t\t\tif (doc.payment_terms_template) {\n\t\t\t\tto_clear.push(__(frappe.meta.get_label(cdt, \"payment_terms_template\")));\n\t\t\t}\n\n\t\t\tif (doc.payment_schedule?.length) {\n\t\t\t\tto_clear.push(__(frappe.meta.get_label(cdt, \"payment_schedule\")));\n\t\t\t}\n\n\t\t\tfrappe.confirm(\n\t\t\t\t__(\n\t\t\t\t\t\"For the new {0} to take effect, would you like to clear the current {1}?\",\n\t\t\t\t\t[\n\t\t\t\t\t\t__(frappe.meta.get_label(cdt, \"due_date\")),\n\t\t\t\t\t\tfrappe.utils.comma_and(to_clear)\n\t\t\t\t\t],\n\t\t\t\t\t\"Clear payment terms template and/or payment schedule when due date is changed\"\n\t\t\t\t),\n\t\t\t\t() => {\n\t\t\t\t\tthis.frm.set_value(\"payment_terms_template\", \"\");\n\t\t\t\t\tthis.frm.clear_table(\"payment_schedule\");\n\t\t\t\t\tthis.frm.refresh_field(\"payment_schedule\");\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tbill_date() {\n\t\tthis.posting_date();\n\t}\n\n\trecalculate_terms() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tget_company_currency() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t}\n\n\tcontact_person() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t}\n\n\tcurrency() {\n\t\t// The transaction date be either transaction_date (from orders) or posting_date (from invoices)\n\t\tlet transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\t\tlet inter_company_reference = this.frm.doc.inter_company_order_reference || this.frm.doc.inter_company_invoice_reference;\n\n\t\tlet me = this;\n\t\tthis.set_dynamic_labels();\n\t\tlet company_currency = this.get_company_currency();\n\t\t// Added `load_after_mapping` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& (!this.frm.doc.__onload?.load_after_mapping || inter_company_reference)) {\n\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tif(exchange_rate != me.frm.doc.conversion_rate) {\n\t\t\t\t\t\tme.set_margin_amount_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.set_actual_charges_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\t// company currency and doc currency is same\n\t\t\t// this will prevent unnecessary conversion rate triggers\n\t\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t} else {\n\t\t\t\tthis.conversion_rate();\n\t\t\t}\n\t\t}\n\t}\n\n\tconversion_rate() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.__onload?.load_after_mapping) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t}\n\n\tapply_discount_on_item(doc, cdt, cdn, field) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(item && !item.price_list_rate) {\n\t\t\titem[field] = 0.0;\n\t\t} else {\n\t\t\tthis.price_list_rate(doc, cdt, cdn);\n\t\t}\n\t\tthis.set_gross_profit(item);\n\t}\n\n\tshipping_rule() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme._calculate_taxes_and_totals();\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t}\n\n\tset_margin_amount_based_on_currency(exchange_rate) {\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"Purchase Invoice\", \"Purchase Order\", \"Purchase Receipt\"]), this.frm.doc.doctype) {\n\t\t\tvar me = this;\n\t\t\t$.each(this.frm.doc.items || [], function(i, d) {\n\t\t\t\tif(d.margin_type == \"Amount\") {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"margin_rate_or_amount\",\n\t\t\t\t\t\tflt(d.margin_rate_or_amount) / flt(exchange_rate));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tset_actual_charges_based_on_currency(exchange_rate) {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.base_tax_amount) / flt(exchange_rate));\n\t\t\t}\n\t\t});\n\t}\n\n\tget_exchange_rate(transaction_date, from_currency, to_currency, callback) {\n\t\tvar args;\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_selling\";\n\t\t}\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_buying\";\n\t\t}\n\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency,\n\t\t\t\targs: args\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __(\"Fetching exchange rates ...\"),\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t}\n\n\tprice_list_currency() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `load_after_mapping` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  &&\n\t\t\t\t!this.frm.doc.__onload?.load_after_mapping) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t}\n\n\tplc_conversion_rate() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t}\n\n\tuom(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\titem.pricing_rules = ''\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'conversion_factor', r.message.conversion_factor);\n\t\t\t\t\t\tme.apply_price_list(item, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.calculate_stock_uom_rate(doc, cdt, cdn);\n\t}\n\n\tconversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\n\t\t\tif(doc.doctype != \"Material Request\") {\n\t\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\t\tthis.calculate_net_weight();\n\t\t\t}\n\n\t\t\t// for handling customization not to fetch price list rate\n\t\t\tif(frappe.flags.dont_fetch_price_list_rate) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t\tthis.calculate_stock_uom_rate(doc, cdt, cdn);\n\t\t}\n\t}\n\n\tis_a_mapped_document(item) {\n\t\tconst mapped_item_field_map = {\n\t\t\t\"Delivery Note\": [\"si_detail\", \"so_detail\", \"dn_detail\"],\n\t\t\t\"Sales Invoice\": [\"dn_detail\", \"so_detail\", \"sales_invoice_item\"],\n\t\t\t\"Purchase Receipt\": [\"purchase_order_item\", \"purchase_invoice_item\", \"purchase_receipt_item\"],\n\t\t\t\"Purchase Invoice\": [\"purchase_order_item\", \"pr_detail\", \"po_detail\"],\n\t\t\t\"Sales Order\": [\"prevdoc_docname\", \"quotation_item\"],\n\t\t\t\"Purchase Order\": [\"supplier_quotation_item\"],\n\t\t};\n\t\tconst mappped_fields = mapped_item_field_map[this.frm.doc.doctype] || [];\n\n\t\tif (item) {\n\t\t\treturn mappped_fields\n\t\t\t\t.map((field) => item[field])\n\t\t\t\t.filter(Boolean).length > 0;\n\t\t} else if (this.frm.doc?.items) {\n\t\t\tlet first_row = this.frm.doc.items[0];\n\t\t\tif (!first_row) {\n\t\t\t\treturn false\n\t\t\t};\n\n\t\t\tlet mapped_rows = mappped_fields.filter(d => first_row[d])\n\n\t\t\treturn mapped_rows?.length > 0;\n\t\t}\n\t}\n\n\ttoggle_conversion_factor(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\t}\n\n\tqty(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!this.is_a_mapped_document(item)) {\n\t\t\t// item.pricing_rules = ''\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.remove_pricing_rule_for_item(item),\n\t\t\t\t() => this.conversion_factor(doc, cdt, cdn, true),\n\t\t\t\t() => this.apply_price_list(item, true), //reapply price list before applying pricing rule\n\t\t\t\t() => this.calculate_stock_uom_rate(doc, cdt, cdn),\n\t\t\t\t() => this.apply_pricing_rule(item, true)\n\t\t\t]);\n\t\t} else {\n\t\t\tthis.conversion_factor(doc, cdt, cdn, true)\n\t\t}\n\t}\n\n\tstock_qty(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\titem.conversion_factor = 1.0;\n\t\tif (item.stock_qty) {\n\t\t\titem.conversion_factor = flt(item.stock_qty) / flt(item.qty);\n\t\t}\n\n\t\trefresh_field(\"conversion_factor\", item.name, item.parentfield);\n\t}\n\n\tcalculate_stock_uom_rate(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item?.rate) {\n\t\t\titem.stock_uom_rate = flt(item.rate) / flt(item.conversion_factor);\n\t\t\trefresh_field(\"stock_uom_rate\", item.name, item.parentfield);\n\t\t}\n\t}\n\tservice_stop_date(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_stop_date) {\n\t\t\tlet start_date = Date.parse(child.service_start_date);\n\t\t\tlet end_date = Date.parse(child.service_end_date);\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\n\n\t\t\tif(stop_date < start_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\n\t\t\t} else if (stop_date > end_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\n\t\t\t}\n\t\t}\n\t}\n\n\tservice_start_date(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_start_date) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\n\t\t\t\targs: {ctx: child},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tprocess_item_removal() {\n\t\tthis.frm.trigger(\"calculate_taxes_and_totals\");\n\t\tthis.frm.trigger(\"calculate_net_weight\");\n\t}\n\n\tcalculate_net_weight(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t}\n\n\tset_dynamic_labels() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tvar company_currency = this.get_company_currency();\n\t\tthis.change_form_labels(company_currency);\n\t\tthis.change_grid_labels(company_currency);\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tchange_form_labels(company_currency) {\n\t\tlet me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\"tax_withholding_net_total\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tthis.frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\", \"base_tax_withholding_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tlet show = cint(this.frm.doc.discount_amount) ||\n\t\t\t\t((this.frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(this.frm.doc.doctype && frappe.meta.get_docfield(this.frm.doc.doctype, \"net_total\")) {\n\t\t\tthis.frm.toggle_display(\"net_total\", show);\n\t\t}\n\n\t\tif(this.frm.doc.doctype && frappe.meta.get_docfield(this.frm.doc.doctype, \"base_net_total\")) {\n\t\t\tthis.frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\t\t}\n\t}\n\n\tchange_grid_labels(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.update_item_grid_labels(company_currency);\n\n\t\tthis.toggle_item_grid_columns(company_currency);\n\n\t\tif (this.frm.doc.operations && this.frm.doc.operations.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.scrap_items && this.frm.doc.scrap_items.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif (this.frm.doc.advances && this.frm.doc.advances.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\tthis.update_payment_schedule_grid_labels(company_currency);\n\t}\n\n\tupdate_item_grid_labels(company_currency) {\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"base_rate\", \"base_net_rate\", \"base_price_list_rate\",\n\t\t\t\"base_amount\", \"base_net_amount\", \"base_rate_with_margin\"\n\t\t], company_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"rate\", \"net_rate\", \"price_list_rate\", \"amount\",\n\t\t\t\"net_amount\", \"stock_uom_rate\", \"rate_with_margin\"\n\t\t], this.frm.doc.currency, \"items\");\n\t}\n\n\tupdate_payment_schedule_grid_labels(company_currency) {\n\t\tconst me = this;\n\t\tif (this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"],\n\t\t\t\tcompany_currency, \"payment_schedule\");\n\t\t\tthis.frm.set_currency_labels([\"payment_amount\", \"outstanding\", \"paid_amount\"],\n\t\t\t\tthis.frm.doc.currency, \"payment_schedule\");\n\n\t\t\tvar schedule_grid = this.frm.fields_dict[\"payment_schedule\"].grid;\n\t\t\t$.each([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"], function(i, fname) {\n\t\t\t\tif (frappe.meta.get_docfield(schedule_grid.doctype, fname))\n\t\t\t\t\tschedule_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\t}\n\n\tbatch_no(frm, cdt, cdn) {\n\t\tlet row = locals[cdt][cdn];\n\n\t\tif (row.batch_no) {\n\t\t\trow.use_serial_batch_fields = 1\n\t\t}\n\n\t\tif (row.batch_no) {\n\t\t\tvar params = this._get_args(row);\n\t\t\tparams.batch_no = row.batch_no;\n\t\t\tparams.uom = row.uom;\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_batch_based_item_price\",\n\t\t\t\targs: {\n\t\t\t\t\tpctx: params,\n\t\t\t\t\titem_code: row.item_code,\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\trow.price_list_rate = r.message;\n\t\t\t\t\t\trow.rate = r.message;\n\t\t\t\t\t\trefresh_field(\"rate\", row.name, row.parentfield);\n\t\t\t\t\t\trefresh_field(\"price_list_rate\", row.name, row.parentfield);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\ttoggle_item_grid_columns(company_currency) {\n\t\tconst me = this;\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\", \"base_rate_with_margin\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(this.frm.doc.discount_amount)) ||\n\t\t\t((this.frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\t}\n\n\trecalculate() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\trecalculate_values() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tcalculate_charges() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tignore_pricing_rule() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tlet me = this;\n\t\t\tlet item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code) {\n\t\t\t\t\tif (d.is_free_item) {\n\t\t\t\t\t\t// Simply remove free items\n\t\t\t\t\t\tme.frm.get_field(\"items\").grid.grid_rows[i].remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\t\t\"price_list_rate\": d.price_list_rate\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tr.message.forEach(row_item => {\n\t\t\t\t\t\t\tme.remove_pricing_rule(row_item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t}\n\n\tremove_pricing_rule_for_item(item) {\n\t\t// capture pricing rule before removing it to delete free items\n\t\tlet removed_pricing_rule = item.pricing_rules;\n\t\tif (item.pricing_rules){\n\t\t\tlet me = this;\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rule_for_item\",\n\t\t\t\targs: {\n\t\t\t\t\tpricing_rules: item.pricing_rules,\n\t\t\t\t\titem_details: {\n\t\t\t\t\t\t\"doctype\": item.doctype,\n\t\t\t\t\t\t\"name\": item.name,\n\t\t\t\t\t\t\"item_code\": item.item_code,\n\t\t\t\t\t\t\"pricing_rules\": item.pricing_rules,\n\t\t\t\t\t\t\"parenttype\": item.parenttype,\n\t\t\t\t\t\t\"parent\": item.parent,\n\t\t\t\t\t\t\"price_list_rate\": item.price_list_rate\n\t\t\t\t\t},\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\trate: item.price_list_rate,\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tme.remove_pricing_rule(r.message, removed_pricing_rule, item.name);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tapply_pricing_rule(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\t// Target doc created from a mapped doc\n\t\tif (this.frm.doc.__onload?.load_after_mapping) {\n\t\t\t// Calculate totals even though pricing rule is not applied.\n\t\t\t// `apply_pricing_rule` is triggered due to change in data which most likely contributes to Total.\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif (me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t_get_args(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\"quotation_to\": me.frm.doc.quotation_to,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": ['Sales Invoice', 'Purchase Invoice'].includes(me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\"coupon_code\": me.frm.doc.coupon_code,\n\t\t\t\"is_internal_supplier\": me.frm.doc.is_internal_supplier,\n\t\t\t\"is_internal_customer\": me.frm.doc.is_internal_customer,\n\t\t};\n\t}\n\n\t_get_item_list(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"child_docname\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"stock_qty\": d.stock_qty,\n\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\"stock_uom\": d.stock_uom,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\"is_free_item\": d.is_free_item,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"batch_no\": d.batch_no,\n\t\t\t\t\t\"price_list_rate\": d.price_list_rate,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0,\n\t\t\t\t\t\"discount_percentage\" : d.discount_percentage,\n\t\t\t\t\t\"discount_amount\" : d.discount_amount,\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\",  \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), d.doctype) {\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t}\n\n\t_set_values_for_item_list(children) {\n\t\tconst items_rule_dict = {};\n\n\t\tfor (const child of children) {\n\t\t\tconst existing_pricing_rule = frappe.model.get_value(child.doctype, child.name, \"pricing_rules\");\n\n\t\t\tfor (const [key, value] of Object.entries(child)) {\n\t\t\t\tif (![\"doctype\", \"name\"].includes(key)) {\n\t\t\t\t\tif (key === \"price_list_rate\") {\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, \"rate\", value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === \"pricing_rules\") {\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, key, value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key !== \"free_item_data\") {\n\t\t\t\t\t\tif (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n\t\t\t\t\t\t\tif (!in_list(JSON.parse(child.apply_rule_on_other_items), child.item_code)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(\n\t\t\t\tfrappe.get_doc(child.doctype, child.name),\n\t\t\t\t[\"price_list_rate\", \"discount_percentage\"],\n\t\t\t);\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif (!this.frm.doc.ignore_pricing_rule && existing_pricing_rule && !child.pricing_rules) {\n\t\t\t\tthis.apply_price_list(frappe.get_doc(child.doctype, child.name));\n\t\t\t} else if (!child.pricing_rules) {\n\t\t\t\tthis.remove_pricing_rule(frappe.get_doc(child.doctype, child.name));\n\t\t\t}\n\n\t\t\tif (child.free_item_data && child.free_item_data.length > 0) {\n\t\t\t\tthis.apply_product_discount(child);\n\t\t\t}\n\n\t\t\tif (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n\t\t\t\titems_rule_dict[child.name] = child;\n\t\t\t}\n\t\t}\n\n\t\tthis.apply_rule_on_other_items(items_rule_dict);\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tapply_rule_on_other_items(args) {\n\t\tconst me = this;\n\t\tconst fields = [\"pricing_rules\"];\n\n\t\tfor(var k in args) {\n\t\t\tlet data = args[k];\n\n\t\t\tif (data && data.apply_rule_on_other_items && JSON.parse(data.apply_rule_on_other_items)) {\n\t\t\t\tfields.push(frappe.scrub(data.pricing_rule_for))\n\t\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\t\tif (JSON.parse(data.apply_rule_on_other_items).includes(d[data.apply_rule_on])) {\n\t\t\t\t\t\tfor(var k in data) {\n\n\t\t\t\t\t\t\tif (in_list(fields, k) && data[k] && (data.price_or_product_discount === 'Price' || k === 'pricing_rules')) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, data[k]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tapply_product_discount(args) {\n\t\tconst items = this.frm.doc.items.filter(d => (d.is_free_item)) || [];\n\n\t\tconst exist_items = items.map(row => { return {item_code: row.item_code, pricing_rules: row.pricing_rules};});\n\n\t\targs.free_item_data.forEach(async pr_row => {\n\t\t\tlet row_to_modify = {};\n\n\t\t\t// If there are no free items, or if the current free item doesn't exist in the table, add it\n\t\t\tif (!items || !exist_items.filter(e_row => {\n\t\t\t\treturn e_row.item_code == pr_row.item_code && e_row.pricing_rules == pr_row.pricing_rules;\n\t\t\t}).length) {\n\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc,\n\t\t\t\t\tthis.frm.doc.doctype + ' Item', 'items');\n\n\t\t\t} else if(items) {\n\t\t\t\trow_to_modify = items.filter(d => (d.item_code === pr_row.item_code\n\t\t\t\t\t&& d.pricing_rules === pr_row.pricing_rules))[0];\n\t\t\t}\n\n\t\t\tfor (let key in pr_row) {\n\t\t\t\trow_to_modify[key] = pr_row[key];\n\t\t\t}\n\n\t\t\tif (this.frm.doc.hasOwnProperty(\"is_pos\") && this.frm.doc.is_pos) {\n\t\t\t\tlet r = await frappe.db.get_value(\"POS Profile\", this.frm.doc.pos_profile, \"cost_center\");\n\t\t\t\tif (r.message.cost_center) {\n\t\t\t\t\trow_to_modify[\"cost_center\"] = r.message.cost_center;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.frm.script_manager.copy_from_first_row(\"items\", row_to_modify, [\"expense_account\", \"income_account\"]);\n\t\t});\n\n\t\t// free_item_data is a temporary variable\n\t\targs.free_item_data = '';\n\t\trefresh_field('items');\n\t}\n\n\tapply_price_list(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\n\n\t\tif (this.frm.doc.doctype === \"Material Request\") {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tlet me = this;\n\t\tlet args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\tctx: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (r.message.parent.price_list_currency)\n\t\t\t\t\t\t\t\tme.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (r.message.parent.plc_conversion_rate)\n\t\t\t\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t\t$.each(r.message.children || [], function(i, d) {\n\t\t\t\t\t\t\t\t\tme.apply_discount_on_item(d, d.doctype, d.name, 'discount_percentage');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tme.in_apply_price_list = false;\n\t\t});\n\t}\n\n\tremove_pricing_rule(item, removed_pricing_rule, row_name) {\n\t\tlet me = this;\n\t\tconst fields = [\"discount_percentage\",\n\t\t\t\"discount_amount\", \"margin_rate_or_amount\", \"rate_with_margin\"];\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(item.remove_free_item) {\n\t\t\tlet items = [];\n\n\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\t// if same item was added as free item through a different pricing rule, keep it\n\t\t\t\tif(d.item_code != item.remove_free_item || !d.is_free_item || !removed_pricing_rule?.includes(d.pricing_rules)) {\n\t\t\t\t\titems.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.frm.doc.items = items;\n\t\t\trefresh_field('items');\n\t\t} else if(item.applied_on_items && item.apply_on) {\n\t\t\tconst applied_on_items = item.applied_on_items.split(',');\n\t\t\tme.frm.doc.items.forEach(row => {\n\t\t\t\tif(applied_on_items.includes(row[item.apply_on])) {\n\t\t\t\t\tfields.forEach(f => {\n\t\t\t\t\t\trow[f] = 0;\n\t\t\t\t\t});\n\n\t\t\t\t\t[\"pricing_rules\", \"margin_type\"].forEach(field => {\n\t\t\t\t\t\tif (row[field]) {\n\t\t\t\t\t\t\trow[field] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.trigger_price_list_rate();\n\t\t}\n\t\telse if(!item.is_free_item && row_name){\n\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\tif (d.name != row_name) return;\n\n\t\t\t\tObject.assign(d, item);\n\t\t\t});\n\t\t}\n\t}\n\n\ttrigger_price_list_rate() {\n\t\tvar me  = this;\n\n\t\tthis.frm.doc.items.forEach(child_row => {\n\t\t\tme.frm.script_manager.trigger(\"price_list_rate\",\n\t\t\t\tchild_row.doctype, child_row.name);\n\t\t})\n\t}\n\n\tvalidate_company_and_party() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\tif (frappe.flags.ignore_company_party_validation) {\n\t\t\treturn valid;\n\t\t}\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) &&  ![\"Purchase Order\",\"Purchase Invoice\"].includes(me.frm.doc.doctype)) {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\t__(frappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name)) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t}\n\n\tget_terms() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t}\n\n\ttaxes_and_charges() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n\t\t\t\t\t\t\tfor (let tax of r.message) {\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\ttax_category() {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tfrappe.run_serially([\n\t\t\t() => this.update_item_tax_map(),\n\t\t\t() => erpnext.utils.set_taxes(this.frm, \"tax_category\"),\n\t\t]);\n\t}\n\n\tupdate_item_tax_map() {\n\t\tlet me = this;\n\t\tlet item_codes = [];\n\t\tlet item_rates = {};\n\t\tlet item_tax_templates = {};\n\n\t\tif (me.frm.doc.is_return && me.frm.doc.return_against) return;\n\n\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\tif (item.item_code) {\n\t\t\t\t// Use combination of name and item code in case same item is added multiple times\n\t\t\t\titem_codes.push([item.item_code, item.name]);\n\t\t\t\titem_rates[item.name] = item.base_net_rate;\n\t\t\t\titem_tax_templates[item.name] = item.item_tax_template;\n\t\t\t}\n\t\t});\n\n\t\tif (item_codes.length) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_info\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\ttax_category: cstr(me.frm.doc.tax_category),\n\t\t\t\t\titem_codes: item_codes,\n\t\t\t\t\titem_rates: item_rates,\n\t\t\t\t\titem_tax_templates: item_tax_templates\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t$.each(me.frm.doc.items || [], function(i, item) {\n\t\t\t\t\t\t\tif (item.name && r.message.hasOwnProperty(item.name) && r.message[item.name].item_tax_template) {\n\t\t\t\t\t\t\t\titem.item_tax_template = r.message[item.name].item_tax_template;\n\t\t\t\t\t\t\t\titem.item_tax_rate = r.message[item.name].item_tax_rate;\n\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\titem_tax_template(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(item.item_tax_template) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\ttax_template: item.item_tax_template,\n\t\t\t\t\tas_json: true\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\titem.item_tax_rate = r.message;\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titem.item_tax_rate = \"{}\";\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t}\n\n\n\tis_recurring() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t}\n\n\tfrom_date() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t}\n\n\tset_gross_profit(item) {\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(this.frm.doc.doctype) && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t}\n\n\tsetup_item_selector() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t}\n\n\tget_advances() {\n\t\tif(!this.frm.is_return) {\n\t\t\tvar me = this;\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t\tme.frm.dirty();\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tmake_payment_entry() {\n\t\tlet via_journal_entry = this.frm.doc.__onload && this.frm.doc.__onload.make_payment_via_journal_entry;\n\t\tif(this.has_discount_in_schedule() && !via_journal_entry) {\n\t\t\t// If early payment discount is applied, ask user for reference date\n\t\t\tthis.prompt_user_for_reference_date();\n\t\t} else {\n\t\t\tthis.make_mapped_payment_entry();\n\t\t}\n\t}\n\n\tmake_mapped_payment_entry(args) {\n\t\tvar me = this;\n\t\targs = args || { \"dt\": this.frm.doc.doctype, \"dn\": this.frm.doc.name };\n\t\treturn frappe.call({\n\t\t\tmethod: me.get_method_for_payment(),\n\t\t\targs: args,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t});\n\t}\n\n\tprompt_user_for_reference_date(){\n\t\tlet me = this;\n\t\tfrappe.prompt({\n\t\t\tlabel: __(\"Cheque/Reference Date\"),\n\t\t\tfieldname: \"reference_date\",\n\t\t\tfieldtype: \"Date\",\n\t\t\treqd: 1,\n\t\t}, (values) => {\n\t\t\tlet args = {\n\t\t\t\t\"dt\": me.frm.doc.doctype,\n\t\t\t\t\"dn\": me.frm.doc.name,\n\t\t\t\t\"reference_date\": values.reference_date\n\t\t\t}\n\t\t\tme.make_mapped_payment_entry(args);\n\t\t},\n\t\t__(\"Reference Date for Early Payment Discount\"),\n\t\t__(\"Continue\")\n\t\t);\n\t}\n\n\thas_discount_in_schedule() {\n\t\tlet is_eligible = in_list(\n\t\t\t[\"Sales Order\", \"Sales Invoice\", \"Purchase Order\", \"Purchase Invoice\"],\n\t\t\tthis.frm.doctype\n\t\t);\n\t\tlet has_payment_schedule = this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length;\n\t\tif(!is_eligible || !has_payment_schedule) return false;\n\n\t\tlet has_discount = this.frm.doc.payment_schedule.some(row => row.discount);\n\t\treturn has_discount;\n\t}\n\n\tmake_quality_inspection() {\n\t\tlet data = [];\n\t\tconst fields = [\n\t\t\t{\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tfieldname: \"items\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"docname\",\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_name\",\n\t\t\t\t\t\tlabel: __(\"Item Name\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\t\tlabel: __(\"Accepted Quantity\"),\n\t\t\t\t\t\tin_list_view: true,\n\t\t\t\t\t\tread_only: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"sample_size\",\n\t\t\t\t\t\tlabel: __(\"Sample Size\"),\n\t\t\t\t\t\treqd: true,\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"description\",\n\t\t\t\t\t\tlabel: __(\"Description\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\t\t\tlabel: __(\"Serial No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"child_row_reference\",\n\t\t\t\t\t\tlabel: __(\"Child Row Reference\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t];\n\n\t\tconst me = this;\n\t\tconst inspection_type = [\"Purchase Receipt\", \"Purchase Invoice\", \"Subcontracting Receipt\"].includes(this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Select Items for Quality Inspection\"),\n\t\t\tsize: \"extra-large\",\n\t\t\tfields: fields,\n\t\t\tprimary_action: function () {\n\t\t\t\tconst data = dialog.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.controllers.stock_controller.make_quality_inspections\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\tdocname: me.frm.doc.name,\n\t\t\t\t\t\titems: data.items,\n\t\t\t\t\t\tinspection_type: inspection_type\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message.length > 0) {\n\t\t\t\t\t\t\tif (r.message.length === 1) {\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Quality Inspection\", r.message[0]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\t\t\t\t\t\"reference_name\": me.frm.doc.name\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tfrappe.set_route(\"List\", \"Quality Inspection\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Create\")\n\t\t});\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.controllers.stock_controller.check_item_quality_inspection\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doc.doctype,\n\t\t\t\titems: this.frm.doc.items\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function (r) {\n\t\t\t\tr.message.forEach(item => {\n\t\t\t\t\tif (me.has_inspection_required(item)) {\n\t\t\t\t\t\tlet dialog_items = dialog.fields_dict.items;\n\t\t\t\t\t\tdialog_items.df.data.push({\n\t\t\t\t\t\t\t\"item_code\": item.item_code,\n\t\t\t\t\t\t\t\"item_name\": item.item_name,\n\t\t\t\t\t\t\t\"qty\": item.qty,\n\t\t\t\t\t\t\t\"description\": item.description,\n\t\t\t\t\t\t\t\"serial_no\": item.serial_no,\n\t\t\t\t\t\t\t\"batch_no\": item.batch_no,\n\t\t\t\t\t\t\t\"sample_size\": item.sample_quantity,\n\t\t\t\t\t\t\t\"child_row_reference\": item.name,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdialog_items.grid.refresh();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdata = dialog.fields_dict.items.df.data;\n\t\t\t\tif (!data.length) {\n\t\t\t\t\tfrappe.msgprint(__(\"All items in this document already have a linked Quality Inspection.\"));\n\t\t\t\t} else {\n\t\t\t\t\tdialog.show();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thas_inspection_required(item) {\n\t\tif (this.frm.doc.doctype === \"Stock Entry\" && this.frm.doc.purpose == \"Manufacture\" ) {\n\t\t\tif (item.is_finished_item && !item.quality_inspection) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (!item.quality_inspection) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tget_method_for_payment() {\n\t\tlet method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(this.frm.doc.__onload && this.frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(['Sales Invoice', 'Purchase Invoice'].includes( this.frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t}\n\n\tset_query_for_batch(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\n\t\t\tif (doc.is_return) {\n\t\t\t\tfilters[\"is_return\"] = 1;\n\t\t\t\tif ([\"Sales Invoice\", \"Delivery Note\"].includes(doc.doctype)) {\n\t\t\t\t\tfilters[\"is_inward\"] = 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t}\n\n\tset_query_for_item_tax_template(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(!item.item_code) {\n\t\t\treturn doc.company ? {filters: {company: doc.company}} : {};\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'valid_from': [\"<=\", doc.transaction_date || doc.bill_date || doc.posting_date],\n\t\t\t\t'item_group': item.item_group,\n\t\t\t\t\"base_net_rate\": item.base_net_rate,\n\t\t\t}\n\n\t\t\tif (doc.tax_category)\n\t\t\t\tfilters['tax_category'] = doc.tax_category;\n\t\t\tif (doc.company)\n\t\t\t\tfilters['company'] = doc.company;\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.get_tax_template\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t}\n\n\tpayment_terms_template() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note' && !doc.is_return) {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbase_grand_total: doc.base_rounded_total || doc.base_grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tpayment_term(doc, cdt, cdn) {\n\t\tconst me = this;\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total,\n\t\t\t\t\tbase_grand_total: this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tagainst_blanket_order(doc, cdt, cdn) {\n\t\tvar item = locals[cdt][cdn];\n\t\tif(!item.against_blanket_order) {\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order\", null);\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order_rate\", 0.00);\n\t\t}\n\t}\n\n\tblanket_order(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = locals[cdt][cdn];\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\n\t\t\t\targs: {\n\t\t\t\t\tctx:{\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\tsupplier: doc.supplier,\n\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\n\t\t\t\t\t\tblanket_order: item.blanket_order\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tset_reserve_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.supplied_items, \"reserve_warehouse\", this.frm.doc.set_reserve_warehouse);\n\t}\n\n\tset_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"warehouse\", this.frm.doc.set_warehouse);\n\t}\n\n\tset_target_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"target_warehouse\", this.frm.doc.set_target_warehouse);\n\t}\n\n\tset_from_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"from_warehouse\", this.frm.doc.set_from_warehouse);\n\t}\n\n\tautofill_warehouse(child_table, warehouse_field, warehouse) {\n\t\tif (warehouse && child_table && child_table.length) {\n\t\t\tlet doctype = child_table[0].doctype;\n\t\t\t$.each(child_table || [], function(i, item) {\n\t\t\t\tfrappe.model.set_value(doctype, item.name, warehouse_field, warehouse);\n\t\t\t});\n\t\t}\n\t}\n\n\tcoupon_code() {\n\t\tif (this.frm.doc.coupon_code || this.frm._last_coupon_code) {\n\t\t\t// reset pricing rules if coupon code is set or is unset\n\t\t\tconst _ignore_pricing_rule = this.frm.doc.ignore_pricing_rule;\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=1,\n\t\t\t\t() => this.frm.trigger('ignore_pricing_rule'),\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=_ignore_pricing_rule,\n\t\t\t\t() => this.frm.trigger('apply_pricing_rule'),\n\t\t\t\t() => this.frm._last_coupon_code = this.frm.doc.coupon_code\n\t\t\t]);\n\t\t}\n\t}\n};\n\nerpnext.show_serial_batch_selector = function (frm, item_row, callback, on_close, show_dialog) {\n\tlet warehouse, receiving_stock, existing_stock;\n\n\tlet warehouse_field = \"warehouse\";\n\tif (frm.doc.is_return) {\n\t\tif ([\"Purchase Receipt\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = item_row.warehouse;\n\t\t} else if ([\"Delivery Note\", \"Sales Invoice\"].includes(frm.doc.doctype)) {\n\t\t\treceiving_stock = true;\n\t\t}\n\t} else {\n\t\tif (frm.doc.doctype == \"Stock Entry\") {\n\t\t\tif (frm.doc.purpose == \"Material Receipt\") {\n\t\t\t\treceiving_stock = true;\n\t\t\t} else {\n\t\t\t\texisting_stock = true;\n\t\t\t\twarehouse = item_row.s_warehouse;\n\t\t\t}\n\n\t\t\tif (in_list([\n\t\t\t\t\t\"Material Transfer\",\n\t\t\t\t\t\"Send to Subcontractor\",\n\t\t\t\t\t\"Material Issue\",\n\t\t\t\t\t\"Material Consumption for Manufacture\",\n\t\t\t\t\t\"Material Transfer for Manufacture\"\n\t\t\t\t], frm.doc.purpose)\n\t\t\t) {\n\t\t\t\twarehouse_field = \"s_warehouse\";\n\t\t\t} else {\n\t\t\t\twarehouse_field = \"t_warehouse\";\n\t\t\t}\n\t\t} else {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = item_row.warehouse;\n\t\t}\n\t}\n\n\tif (!warehouse) {\n\t\tif (receiving_stock) {\n\t\t\twarehouse = [\"like\", \"\"];\n\t\t} else if (existing_stock) {\n\t\t\twarehouse = [\"!=\", \"\"];\n\t\t}\n\t}\n\n\tif ([\"Sales Invoice\", \"Delivery Note\"].includes(frm.doc.doctype)) {\n\t\titem_row.type_of_transaction = frm.doc.is_return ? \"Inward\" : \"Outward\";\n\t} else {\n\t\titem_row.type_of_transaction = frm.doc.is_return ? \"Outward\" : \"Inward\";\n\t}\n\n\tnew erpnext.SerialBatchPackageSelector(frm, item_row, (r) => {\n\t\tif (r) {\n\t\t\tlet update_values = {\n\t\t\t\t\"serial_and_batch_bundle\": r.name,\n\t\t\t\t\"qty\": Math.abs(r.total_qty)\n\t\t\t}\n\n\t\t\tif (r.warehouse) {\n\t\t\t\tupdate_values[warehouse_field] = r.warehouse;\n\t\t\t}\n\n\t\t\tfrappe.model.set_value(item_row.doctype, item_row.name, update_values);\n\t\t}\n\t});\n}\n\nerpnext.apply_putaway_rule = (frm, purpose=null) => {\n\tif (!frm.doc.company) {\n\t\tfrappe.throw({message: __(\"Please select a Company first.\"), title: __(\"Mandatory\")});\n\t}\n\tif (!frm.doc.items.length) return;\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.stock.doctype.putaway_rule.putaway_rule.apply_putaway_rule\",\n\t\targs: {\n\t\t\tdoctype: frm.doctype,\n\t\t\titems: frm.doc.items,\n\t\t\tcompany: frm.doc.company,\n\t\t\tsync: true,\n\t\t\tpurpose: purpose\n\t\t},\n\t\tcallback: (result) => {\n\t\t\tif (!result.exc && result.message) {\n\t\t\t\tfrm.clear_table(\"items\");\n\n\t\t\t\tlet items =  result.message;\n\t\t\t\titems.forEach((row) => {\n\t\t\t\t\tdelete row[\"name\"]; // dont overwrite name from server side\n\t\t\t\t\tlet child = frm.add_child(\"items\");\n\t\t\t\t\tObject.assign(child, row);\n\t\t\t\t\tfrm.script_manager.trigger(\"qty\", child.doctype, child.name);\n\t\t\t\t});\n\t\t\t\tfrm.get_field(\"items\").grid.refresh();\n\t\t\t}\n\t\t}\n\t});\n};\n", "\n\tfrappe.templates['item_selector'] = `<div class=\"app-listing item-list image-view-container item-selector\">\n{% for (var i=0; i < data.length; i++) { var item = data[i]; %}\n\t{% if (i % 4 === 0) { %}<div class=\"image-view-row\">{% } %}\n\t<div class=\"image-view-item\" data-name=\"{{ item.name }}\">\n\t\t<div class=\"image-view-header doclist-row\">\n\t\t\t<div class=\"list-value\">\n\t\t\t\t<a class=\"grey list-id\" data-name=\"{{item.name}}\"\n\t\t\t\t\ttitle=\"{{ item.item_name || item.name}}\">\n\t\t\t\t\t{{item.item_name || item.name}}</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"image-view-body\">\n\t\t\t<a  data-item-code=\"{{ item.name }}\"\n\t\t\t\ttitle=\"{{ item.item_name || item.name }}\"\n\t\t\t>\n\t\t\t\t<div class=\"image-field\"\n\t\t\t\t\tstyle=\"\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t\tbackground-color: #fafbfc;\n\t\t\t\t\t{% } %}\n\t\t\t\t\tborder: 0px;\"\n\t\t\t\t>\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t<span class=\"placeholder-text\">\n\t\t\t\t\t\t{%= frappe.get_abbr(item.item_name || item.name) %}\n\t\t\t\t\t</span>\n\t\t\t\t\t{% } %}\n\t\t\t\t\t{% if (item.image) { %}\n\t\t\t\t\t<img src=\"{{ item.image }}\" alt=\"{{item.item_name || item.name}}\">\n\t\t\t\t\t{% } %}\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t{% if ((i % 4 === 3) || (i===data.length - 1)) { %}</div>{% } %}\n{% endfor %}\n</div>\n`;\n", "erpnext.ItemSelector = class ItemSelector {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = \"item_code\";\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tvar me = this;\n\t\tif (!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__(\"Add Items\"), function () {\n\t\t\t\tif (!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tme.dialog.input.focus();\n\t\t\t\t}, 1000);\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add Items\"),\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html(\n\t\t\t'<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>'\n\t\t);\n\n\t\tthis.dialog.input = body.find(\".form-control\");\n\t\tthis.dialog.results = body.find(\".results\");\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on(\"click\", \".image-view-item\", function () {\n\t\t\tme.add_item($(this).attr(\"data-name\"));\n\t\t});\n\n\t\tthis.dialog.input.on(\"keyup\", function () {\n\t\t\tif (me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function () {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t}\n\n\tadd_item(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif (d[this.item_field] === item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"qty\", d.qty + 1);\n\t\t\t\tfrappe.show_alert({ message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: \"green\" });\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif (!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => {\n\t\t\t\t\td = this.grid.add_new_row();\n\t\t\t\t},\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"qty\", 1);\n\t\t\t\t\tfrappe.show_alert({ message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: \"green\" });\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\trender_items() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {},\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function (results) {\n\t\t\t$.each(results, function (i, d) {\n\t\t\t\tif (!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template(\"item_selector\", { data: results }));\n\t\t});\n\t}\n};\n", "frappe.provide(\"frappe.help.help_links\");\n\nconst docsUrl = \"https://erpnext.com/docs/\";\n\nfrappe.help.help_links[\"Form/Rename Tool\"] = [\n\t{\n\t\tlabel: \"Bulk Rename\",\n\t\turl: docsUrl + \"user/manual/en/transactions-bulk-rename\",\n\t},\n];\n\n//Setup\n\nfrappe.help.help_links[\"List/User\"] = [\n\t{\n\t\tlabel: \"New User\",\n\t\turl: docsUrl + \"user/manual/en/adding-users\",\n\t},\n\t{\n\t\tlabel: \"Rename User\",\n\t\turl: docsUrl + \"user/manual/en/renaming-documents\",\n\t},\n];\n\nfrappe.help.help_links[\"permission-manager\"] = [\n\t{\n\t\tlabel: \"Role Based Permissions\",\n\t\turl: docsUrl + \"user/manual/en/role-based-permissions\",\n\t},\n\t{\n\t\tlabel: \"Managing Perm Level in Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/managing-perm-level\",\n\t},\n\t{\n\t\tlabel: \"User Permissions\",\n\t\turl: docsUrl + \"user/manual/en/user-permissions\",\n\t},\n\t{\n\t\tlabel: \"Sharing\",\n\t\turl: docsUrl + \"user/manual/en/sharing\",\n\t},\n\t{\n\t\tlabel: \"Password\",\n\t\turl: docsUrl + \"user/manual/en/change-password\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/System Settings\"] = [\n\t{\n\t\tlabel: \"System Settings\",\n\t\turl: docsUrl + \"user/manual/en/system-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/data-import\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/data-import\",\n\t},\n];\n\nfrappe.help.help_links[\"module_setup\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/role-based-permissions\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Document Naming Settings\"] = [\n\t{\n\t\tlabel: \"Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/document-naming-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Global Defaults\"] = [\n\t{\n\t\tlabel: \"Global Settings\",\n\t\turl: docsUrl + \"user/manual/en/global-defaults\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Letter Head\"] = [\n\t{\n\t\tlabel: \"Letter Head\",\n\t\turl: docsUrl + \"user/manual/en/letter-head\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Address Template\"] = [\n\t{\n\t\tlabel: \"Address Template\",\n\t\turl: docsUrl + \"user/manual/en/address-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Terms and Conditions\"] = [\n\t{\n\t\tlabel: \"Terms and Conditions\",\n\t\turl: docsUrl + \"user/manual/en/terms-and-conditions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Cheque Print Template\"] = [\n\t{\n\t\tlabel: \"Cheque Print Template\",\n\t\turl: docsUrl + \"user/manual/en/cheque-print-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Email Account\"] = [\n\t{\n\t\tlabel: \"Email Account\",\n\t\turl: docsUrl + \"user/manual/en/email-account\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Auto Email Report\"] = [\n\t{\n\t\tlabel: \"Auto Email Reports\",\n\t\turl: docsUrl + \"user/manual/en/auto-email-reports\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Settings\"] = [\n\t{\n\t\tlabel: \"Print Settings\",\n\t\turl: docsUrl + \"user/manual/en/print-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"print-format-builder\"] = [\n\t{\n\t\tlabel: \"Print Format Builder\",\n\t\turl: docsUrl + \"user/manual/en/print-format-builder\",\n\t},\n];\n\n//setup-integrations\n\nfrappe.help.help_links[\"Form/PayPal Settings\"] = [\n\t{\n\t\tlabel: \"PayPal Settings\",\n\t\turl: docsUrl + \"user/manual/en/paypal-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Razorpay Settings\"] = [\n\t{\n\t\tlabel: \"Razorpay Settings\",\n\t\turl: docsUrl + \"user/manual/en/razorpay-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Dropbox Settings\"] = [\n\t{\n\t\tlabel: \"Dropbox Settings\",\n\t\turl: docsUrl + \"user/manual/en/dropbox-backup\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/LDAP Settings\"] = [\n\t{\n\t\tlabel: \"LDAP Settings\",\n\t\turl: docsUrl + \"user/manual/en/ldap-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stripe Settings\"] = [\n\t{\n\t\tlabel: \"Stripe Settings\",\n\t\turl: docsUrl + \"user/manual/en/stripe-integration\",\n\t},\n];\n\n//Sales\n\nfrappe.help.help_links[\"Form/Quotation\"] = [\n\t{ label: \"Quotation\", url: docsUrl + \"user/manual/en/quotation\" },\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/applying-discount\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Drop Shipping\",\n\t\turl: docsUrl + \"user/manual/en/drop-shipping\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Close Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/close-sales-order\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Product Bundle\"] = [\n\t{\n\t\tlabel: \"Product Bundle\",\n\t\turl: docsUrl + \"user/manual/en/product-bundle\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Selling Settings\"] = [\n\t{\n\t\tlabel: \"Selling Settings\",\n\t\turl: docsUrl + \"user/manual/en/selling-settings\",\n\t},\n];\n\n//Buying\n\nfrappe.help.help_links[\"List/Supplier\"] = [{ label: \"Supplier\", url: docsUrl + \"user/manual/en/supplier\" }];\n\nfrappe.help.help_links[\"Form/Supplier\"] = [{ label: \"Supplier\", url: docsUrl + \"user/manual/en/supplier\" }];\n\nfrappe.help.help_links[\"Form/Request for Quotation\"] = [\n\t{\n\t\tlabel: \"Request for Quotation\",\n\t\turl: docsUrl + \"user/manual/en/request-for-quotation\",\n\t},\n\t{\n\t\tlabel: \"RFQ Video\",\n\t\turl: docsUrl + \"user/videos/learn/request-for-quotation.html\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Supplier Quotation\"] = [\n\t{\n\t\tlabel: \"Supplier Quotation\",\n\t\turl: docsUrl + \"user/manual/en/supplier-quotation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Buying Settings\"] = [\n\t{\n\t\tlabel: \"Buying Settings\",\n\t\turl: docsUrl + \"user/manual/en/buying-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Item UoM\",\n\t\turl: docsUrl + \"user/manual/en/purchasing-in-different-unit\",\n\t},\n\t{\n\t\tlabel: \"Supplier Item Code\",\n\t\turl: docsUrl + \"user/manual/en/maintaining-suppliers-part-no-in-item\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Price List\"] = [\n\t{\n\t\tlabel: \"Price List\",\n\t\turl: docsUrl + \"user/manual/en/price-lists\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Authorization Rule\"] = [\n\t{\n\t\tlabel: \"Authorization Rule\",\n\t\turl: docsUrl + \"user/manual/en/authorization-rule\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/SMS Settings\"] = [\n\t{\n\t\tlabel: \"SMS Settings\",\n\t\turl: docsUrl + \"user/manual/en/sms-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Stock Reconciliation\",\n\t\turl: docsUrl + \"user/manual/en/stock-reconciliation\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Territory\"] = [\n\t{\n\t\tlabel: \"Territory\",\n\t\turl: docsUrl + \"user/manual/en/territory\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Workflow\"] = [{ label: \"Workflow\", url: docsUrl + \"user/manual/en/workflows\" }];\n\nfrappe.help.help_links[\"List/Company\"] = [\n\t{\n\t\tlabel: \"Company\",\n\t\turl: docsUrl + \"user/manual/en/company-setup\",\n\t},\n\t{\n\t\tlabel: \"Delete All Related Transactions for a Company\",\n\t\turl: docsUrl + \"user/manual/en/delete_company_transactions\",\n\t},\n];\n\n//Accounts\n\nfrappe.help.help_links[\"Tree/Account\"] = [\n\t{\n\t\tlabel: \"Chart of Accounts\",\n\t\turl: docsUrl + \"user/manual/en/chart-of-accounts\",\n\t},\n\t{\n\t\tlabel: \"Managing Tree Mastes\",\n\t\turl: docsUrl + \"user/manual/en/managing-tree-structure-masters\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"point-of-sale\"] = [\n\t{\n\t\tlabel: \"Point of Sale Invoice\",\n\t\turl: docsUrl + \"user/manual/en/point-of-sales\",\n\t},\n];\n\nfrappe.help.help_links[\"List/POS Profile\"] = [\n\t{\n\t\tlabel: \"Point of Sale Profile\",\n\t\turl: docsUrl + \"user/manual/en/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/POS Profile\"] = [\n\t{\n\t\tlabel: \"POS Profile\",\n\t\turl: docsUrl + \"user/manual/en/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Invoice\"] = [\n\t{\n\t\tlabel: \"Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/purchase-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Journal Entry\"] = [\n\t{\n\t\tlabel: \"Journal Entry\",\n\t\turl: docsUrl + \"user/manual/en/journal-entry\",\n\t},\n\t{\n\t\tlabel: \"Advance Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/advance-payment-entry\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Entry\"] = [\n\t{\n\t\tlabel: \"Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/payment-entry\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Request\"] = [\n\t{\n\t\tlabel: \"Payment Request\",\n\t\turl: docsUrl + \"user/manual/en/payment-request\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset\"] = [\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset Category\"] = [\n\t{\n\t\tlabel: \"Asset Category\",\n\t\turl: docsUrl + \"user/manual/en/asset-category\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Cost Center\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/budgeting\" },\n];\n\n//Stock\n\nfrappe.help.help_links[\"List/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl: docsUrl + \"user/manual/en/calculation-of-valuation-rate-in-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl: docsUrl + \"user/manual/en/item-valuation-transactions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Receipt\"] = [\n\t{\n\t\tlabel: \"Purchase Receipt\",\n\t\turl: docsUrl + \"user/manual/en/purchase-receipt\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Installation Note\"] = [\n\t{\n\t\tlabel: \"Installation Note\",\n\t\turl: docsUrl + \"user/manual/en/installation-note\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Budget\"] = [{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/budgeting\" }];\n\nfrappe.help.help_links[\"List/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl: docsUrl + \"user/manual/en/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl: docsUrl + \"user/manual/en/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock-entry\" },\n\t{\n\t\tlabel: \"Stock Entry Types\",\n\t\turl: docsUrl + \"user/manual/en/stock-entry-purpose\",\n\t},\n\t{\n\t\tlabel: \"Repack Entry\",\n\t\turl: docsUrl + \"user/manual/en/repack-entry\",\n\t},\n\t{\n\t\tlabel: \"Opening Stock\",\n\t\turl: docsUrl + \"user/manual/en/opening-stock\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock-entry\" },\n];\n\nfrappe.help.help_links[\"Tree/Warehouse\"] = [\n\t{ label: \"Warehouse\", url: docsUrl + \"user/manual/en/warehouse\" },\n];\n\nfrappe.help.help_links[\"List/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/serial-no\" },\n];\n\nfrappe.help.help_links[\"Form/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/serial-no\" },\n];\n\nfrappe.help.help_links[\"List/Batch\"] = [{ label: \"Batch\", url: docsUrl + \"user/manual/en/batch\" }];\n\nfrappe.help.help_links[\"Form/Batch\"] = [{ label: \"Batch\", url: docsUrl + \"user/manual/en/batch\" }];\n\nfrappe.help.help_links[\"Form/Packing Slip\"] = [\n\t{\n\t\tlabel: \"Packing Slip\",\n\t\turl: docsUrl + \"user/manual/en/packing-slip\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Quality Inspection\"] = [\n\t{\n\t\tlabel: \"Quality Inspection\",\n\t\turl: docsUrl + \"user/manual/en/quality-inspection\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Landed Cost Voucher\"] = [\n\t{\n\t\tlabel: \"Landed Cost Voucher\",\n\t\turl: docsUrl + \"user/manual/en/landed-cost-voucher\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Item Group\"] = [\n\t{\n\t\tlabel: \"Item Group\",\n\t\turl: docsUrl + \"user/manual/en/item-group\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item Attribute\"] = [\n\t{\n\t\tlabel: \"Item Attribute\",\n\t\turl: docsUrl + \"user/manual/en/item-attribute\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/UOM\"] = [\n\t{\n\t\tlabel: \"Fractions in UOM\",\n\t\turl: docsUrl + \"user/manual/en/managing-fractions-in-uom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Opening Stock Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock-reconciliation\",\n\t},\n];\n\n//CRM\n\nfrappe.help.help_links[\"Form/Lead\"] = [{ label: \"Lead\", url: docsUrl + \"user/manual/en/lead\" }];\n\nfrappe.help.help_links[\"Form/Opportunity\"] = [\n\t{ label: \"Opportunity\", url: docsUrl + \"user/manual/en/opportunity\" },\n];\n\nfrappe.help.help_links[\"Form/Address\"] = [{ label: \"Address\", url: docsUrl + \"user/manual/en/address\" }];\n\nfrappe.help.help_links[\"Form/Contact\"] = [{ label: \"Contact\", url: docsUrl + \"user/manual/en/contact\" }];\n\nfrappe.help.help_links[\"Form/Newsletter\"] = [\n\t{ label: \"Newsletter\", url: docsUrl + \"user/manual/en/newsletter\" },\n];\n\nfrappe.help.help_links[\"Form/Campaign\"] = [{ label: \"Campaign\", url: docsUrl + \"user/manual/en/campaign\" }];\n\nfrappe.help.help_links[\"Tree/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/sales-person\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person Target\",\n\t\turl: docsUrl + \"user/manual/en/sales-person-target-allocation\",\n\t},\n\t{\n\t\tlabel: \"Sales Person in Transactions\",\n\t\turl: docsUrl + \"user/manual/en/sales-persons-in-the-sales-transactions\",\n\t},\n];\n\n//Manufacturing\n\nfrappe.help.help_links[\"Form/BOM\"] = [\n\t{\n\t\tlabel: \"Bill of Material\",\n\t\turl: docsUrl + \"user/manual/en/bill-of-materials\",\n\t},\n\t{\n\t\tlabel: \"Nested BOM Structure\",\n\t\turl: docsUrl + \"user/manual/en/managing-multi-level-bom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Work Order\"] = [\n\t{\n\t\tlabel: \"Work Order\",\n\t\turl: docsUrl + \"user/manual/en/work-order\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Workstation\"] = [\n\t{\n\t\tlabel: \"Workstation\",\n\t\turl: docsUrl + \"user/manual/en/workstation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Operation\"] = [\n\t{\n\t\tlabel: \"Operation\",\n\t\turl: docsUrl + \"user/manual/en/operation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/BOM Update Tool\"] = [\n\t{\n\t\tlabel: \"BOM Update Tool\",\n\t\turl: docsUrl + \"user/manual/en/bom-update-tool\",\n\t},\n];\n\n//Customize\n\nfrappe.help.help_links[\"Form/Customize Form\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/custom-field\",\n\t},\n\t{\n\t\tlabel: \"Customize Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-form\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/custom-field\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/custom-field\",\n\t},\n];\n", "\n\tfrappe.templates['item_quick_entry'] = `<div class=\"h6 uppercase\" style=\"margin-top: 30px;\">{{ __(\"Variant Attributes\") }}</div>\n<div class=\"attributes hide-control\">\n</div>\n`;\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.ContactAddressQuickEntryForm = class ContactAddressQuickEntryForm extends (\n\tfrappe.ui.form.QuickEntryForm\n) {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tsuper(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tsuper.render_dialog();\n\t}\n\n\tinsert() {\n\t\t/**\n\t\t * Using alias fieldnames because the doctype definition define \"email_id\" and \"mobile_no\" as readonly fields.\n\t\t * This results in the fields being \"hidden\".\n\t\t */\n\t\tconst map_field_names = {\n\t\t\temail_address: \"email_id\",\n\t\t\tmobile_number: \"mobile_no\",\n\t\t\tmap_to_first_name: \"first_name\",\n\t\t\tmap_to_last_name: \"last_name\",\n\t\t};\n\n\t\tObject.entries(map_field_names).forEach(([fieldname, new_fieldname]) => {\n\t\t\tthis.dialog.doc[new_fieldname] = this.dialog.doc[fieldname];\n\t\t\tdelete this.dialog.doc[fieldname];\n\t\t});\n\n\t\treturn super.insert();\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\t\tcollapsible: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"First Name\"),\n\t\t\t\tfieldname: \"map_to_first_name\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tdepends_on: \"eval:doc.customer_type=='Company'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Last Name\"),\n\t\t\t\tfieldname: \"map_to_last_name\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tdepends_on: \"eval:doc.customer_type=='Company'\",\n\t\t\t},\n\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Email Id\"),\n\t\t\t\tfieldname: \"email_address\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\toptions: \"Email\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\t\tfieldname: \"mobile_number\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\t\tcollapsible: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\t\tfieldname: \"address_line1\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\t\tfieldname: \"address_line2\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\t\tfieldname: \"pincode\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"City\"),\n\t\t\t\tfieldname: \"city\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"State\"),\n\t\t\t\tfieldname: \"state\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Country\"),\n\t\t\t\tfieldname: \"country\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Country\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\t\tfieldname: \"customer_pos_id\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\thidden: 1,\n\t\t\t},\n\t\t];\n\n\t\treturn variant_fields;\n\t}\n};\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.ContactAddressQuickEntryForm;\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.SupplierQuickEntryForm = frappe.ui.form.ContactAddressQuickEntryForm;\n", "class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tfrappe.utils.play_sound(\"incoming-call\");\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\tstatic: true,\n\t\t\tminimizable: true,\n\t\t});\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.setup_dialog();\n\t\tthis.set_call_status();\n\t\tfrappe.utils.bind_actions_with_object(this.dialog.$body, this);\n\t\tthis.dialog.$wrapper.addClass(\"call-popup\");\n\t\tthis.dialog.get_close_btn().unbind(\"click\").click(this.close_modal.bind(this));\n\t\tthis.dialog.show();\n\t}\n\n\tsetup_dialog() {\n\t\tthis.setup_call_details();\n\t\tthis.dialog.$body.empty().append(this.caller_info);\n\t}\n\n\tset_indicator(color, blink = false) {\n\t\tlet classes = `indicator ${color} ${blink ? \"blink\" : \"\"}`;\n\t\tthis.dialog.header.find(\".indicator\").attr(\"class\", classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = \"\";\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif ([\"Ringing\"].includes(call_status) || !call_status) {\n\t\t\ttitle = __(\"Incoming call from {0}\", [this.get_caller_name() || this.caller_number]);\n\t\t\tthis.set_indicator(\"blue\", true);\n\t\t} else if (call_status === \"In Progress\") {\n\t\t\ttitle = __(\"Call Connected\");\n\t\t\tthis.set_indicator(\"green\");\n\t\t} else if ([\"No Answer\", \"Missed\"].includes(call_status)) {\n\t\t\tthis.set_indicator(\"yellow\");\n\t\t\ttitle = __(\"Call Missed\");\n\t\t} else if ([\"Completed\", \"Busy\", \"Failed\"].includes(call_status)) {\n\t\t\tthis.set_indicator(\"red\");\n\t\t\ttitle = __(\"Call Ended\");\n\t\t} else {\n\t\t\tthis.set_indicator(\"blue\");\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log, missed) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status(missed ? \"Missed\" : null);\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete erpnext.call_popup;\n\t}\n\n\tcall_ended(call_log, missed) {\n\t\tfrappe.utils.play_sound(\"call-disconnect\");\n\t\tthis.update_call_log(call_log, missed);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value(\"call_summary\")) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 60000);\n\t\tthis.clear_listeners();\n\t}\n\n\tget_caller_name() {\n\t\tconst contact_link = this.get_contact_link();\n\t\treturn contact_link.link_title || contact_link.link_name;\n\t}\n\n\tget_contact_link() {\n\t\tlet log = this.call_log;\n\t\tlet contact_link = log.links.find((d) => d.link_doctype === \"Contact\");\n\t\treturn contact_link || {};\n\t}\n\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_ended`, (call_log) => {\n\t\t\tthis.call_ended(call_log);\n\t\t});\n\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_missed`, (call_log) => {\n\t\t\tthis.call_ended(call_log, true);\n\t\t});\n\t}\n\n\tclear_listeners() {\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_ended`);\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_missed`);\n\t}\n\n\tsetup_call_details() {\n\t\tthis.caller_info = $(`<div></div>`);\n\t\tthis.call_details = new frappe.ui.FieldGroup({\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"name\",\n\t\t\t\t\tlabel: \"Name\",\n\t\t\t\t\tdefault: this.get_caller_name() || __(\"Unknown Caller\"),\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Open Contact\"),\n\t\t\t\t\tclick: () => frappe.set_route(\"Form\", \"Contact\", this.get_contact_link().link_name),\n\t\t\t\t\tdepends_on: () => this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Create New Contact\"),\n\t\t\t\t\tclick: this.create_new_contact.bind(this),\n\t\t\t\t\tdepends_on: () => !this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Create New Customer\"),\n\t\t\t\t\tclick: this.create_new_customer.bind(this),\n\t\t\t\t\tdepends_on: () => !this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Create New Lead\"),\n\t\t\t\t\tclick: () => frappe.new_doc(\"Lead\", { mobile_no: this.caller_number }),\n\t\t\t\t\tdepends_on: () => !this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"number\",\n\t\t\t\t\tlabel: \"Phone Number\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tdefault: this.caller_number,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\t\thide_border: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"call_type\",\n\t\t\t\t\tlabel: \"Call Type\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"Telephony Call Type\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\t\thide_border: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\tlabel: __(\"Call Summary\"),\n\t\t\t\t\tfieldname: \"call_summary\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Save\"),\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tconst call_summary = this.call_details.get_value(\"call_summary\");\n\t\t\t\t\t\tconst call_type = this.call_details.get_value(\"call_type\");\n\t\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\t\tfrappe\n\t\t\t\t\t\t\t.xcall(\n\t\t\t\t\t\t\t\t\"erpnext.telephony.doctype.call_log.call_log.add_call_summary_and_call_type\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcall_log: this.call_log.name,\n\t\t\t\t\t\t\t\t\tsummary: call_summary,\n\t\t\t\t\t\t\t\t\tcall_type: call_type,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: `\n\t\t\t\t\t\t\t\t${__(\"Call Summary Saved\")}\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass=\"text-small text-muted\"\n\t\t\t\t\t\t\t\t\thref=\"/app/call-log/${this.call_log.name}\">\n\t\t\t\t\t\t\t\t\t${__(\"View call log\")}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tbody: this.caller_info,\n\t\t});\n\t\tthis.call_details.make();\n\t}\n\n\tis_known_caller() {\n\t\treturn Boolean(this.get_caller_name());\n\t}\n\n\tcreate_new_customer() {\n\t\t// to avoid quick entry form\n\t\tconst new_customer = frappe.model.get_new_doc(\"Customer\");\n\t\tnew_customer.mobile_no = this.caller_number;\n\t\tfrappe.set_route(\"Form\", new_customer.doctype, new_customer.name);\n\t}\n\n\tcreate_new_contact() {\n\t\t// TODO: fix new_doc, it should accept child table values\n\t\tconst new_contact = frappe.model.get_new_doc(\"Contact\");\n\t\tconst phone_no = frappe.model.add_child(new_contact, \"Contact Phone\", \"phone_nos\");\n\t\tphone_no.phone = this.caller_number;\n\t\tphone_no.is_primary_mobile_no = 1;\n\t\tfrappe.set_route(\"Form\", new_contact.doctype, new_contact.name);\n\t}\n}\n\n$(document).on(\"app_ready\", function () {\n\tfrappe.realtime.on(\"show_call_popup\", (call_log) => {\n\t\tlet call_popup = erpnext.call_popup;\n\t\tif (call_popup && call_log.name === call_popup.call_log.name) {\n\t\t\tcall_popup.update_call_log(call_log);\n\t\t\tcall_popup.dialog.show();\n\t\t} else {\n\t\t\terpnext.call_popup = new CallPopup(call_log);\n\t\t}\n\t});\n});\n\nwindow.CallPopup = CallPopup;\n", "frappe.provide(\"erpnext.accounts\");\n\nerpnext.accounts.dimensions = {\n\tsetup_dimension_filters(frm, doctype) {\n\t\tthis.accounting_dimensions = [];\n\t\tthis.default_dimensions = {};\n\t\tthis.fetch_custom_dimensions(frm, doctype);\n\t},\n\n\tfetch_custom_dimensions(frm, doctype) {\n\t\tlet me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\targs: {\n\t\t\t\twith_cost_center_and_project: true,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tme.accounting_dimensions = r.message[0];\n\t\t\t\t// Ignoring \"Project\" as it is already handled specifically in Sales Order and Delivery Note\n\t\t\t\tme.accounting_dimensions = me.accounting_dimensions.filter((x) => {\n\t\t\t\t\treturn x.document_type != \"Project\";\n\t\t\t\t});\n\t\t\t\tme.default_dimensions = r.message[1];\n\t\t\t\tme.setup_filters(frm, doctype);\n\t\t\t\tme.update_dimension(frm, doctype);\n\t\t\t},\n\t\t});\n\t},\n\n\tsetup_filters(frm, doctype) {\n\t\tif (doctype == \"Payment Entry\" && this.accounting_dimensions) {\n\t\t\tfrm.dimension_filters = this.accounting_dimensions;\n\t\t}\n\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tfrappe.model.with_doctype(dimension[\"document_type\"], () => {\n\t\t\t\t\tlet parent_fields = [];\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\t\tif (df.fieldtype === \"Link\" && df.options === \"Account\") {\n\t\t\t\t\t\t\tparent_fields.push(df.fieldname);\n\t\t\t\t\t\t} else if (df.fieldtype === \"Table\") {\n\t\t\t\t\t\t\tthis.setup_child_filters(frm, df.options, df.fieldname, dimension[\"fieldname\"]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension[\"fieldname\"])) {\n\t\t\t\t\t\t\tthis.setup_account_filters(frm, dimension[\"fieldname\"], parent_fields);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_child_filters(frm, doctype, parentfield, dimension) {\n\t\tlet fields = [];\n\n\t\tif (frappe.meta.has_field(doctype, dimension)) {\n\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\tif (df.fieldtype === \"Link\" && df.options === \"Account\") {\n\t\t\t\t\t\tfields.push(df.fieldname);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrm.set_query(dimension, parentfield, function (doc, cdt, cdn) {\n\t\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\t\treturn erpnext.queries.get_filtered_dimensions(row, fields, dimension, doc.company);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_account_filters(frm, dimension, fields) {\n\t\tfrm.set_query(dimension, function (doc) {\n\t\t\treturn erpnext.queries.get_filtered_dimensions(doc, fields, dimension, doc.company);\n\t\t});\n\t},\n\n\tupdate_dimension(frm, doctype) {\n\t\tif (\n\t\t\t!this.accounting_dimensions ||\n\t\t\t!frm.is_new() ||\n\t\t\t!frm.doc.company ||\n\t\t\t!this.default_dimensions?.[frm.doc.company]\n\t\t)\n\t\t\treturn;\n\n\t\t// don't set default dimensions if any of the dimension is already set due to mapping\n\t\tif (frm.doc.__onload?.load_after_mapping) {\n\t\t\tfor (const dimension of this.accounting_dimensions) {\n\t\t\t\tif (frm.doc[dimension[\"fieldname\"]]) return;\n\t\t\t}\n\t\t}\n\n\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\tconst default_dimension = this.default_dimensions[frm.doc.company][dimension[\"fieldname\"]];\n\n\t\t\tif (!default_dimension) return;\n\n\t\t\tif (frappe.meta.has_field(doctype, dimension[\"fieldname\"])) {\n\t\t\t\tfrm.set_value(dimension[\"fieldname\"], default_dimension);\n\t\t\t}\n\n\t\t\t(frm.doc.items || frm.doc.accounts || []).forEach((row) => {\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, dimension[\"fieldname\"], default_dimension);\n\t\t\t});\n\t\t});\n\t},\n\n\tcopy_dimension_from_first_row(frm, cdt, cdn, fieldname) {\n\t\tif (frappe.meta.has_field(frm.doctype, fieldname) && this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tlet row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(fieldname, row, [dimension[\"fieldname\"]]);\n\t\t\t});\n\t\t}\n\t},\n};\n", "frappe.provide(\"erpnext.accounts\");\n\nerpnext.accounts.ledger_preview = {\n\tshow_accounting_ledger_preview(frm) {\n\t\tlet me = this;\n\t\tif (!frm.is_new() && frm.doc.docstatus == 0) {\n\t\t\tfrm.add_custom_button(\n\t\t\t\t__(\"Accounting Ledger\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\t\tmethod: \"erpnext.controllers.stock_controller.show_accounting_ledger_preview\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\t\t\tdocname: frm.doc.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (response) {\n\t\t\t\t\t\t\tme.make_dialog(\n\t\t\t\t\t\t\t\t\"Accounting Ledger Preview\",\n\t\t\t\t\t\t\t\t\"accounting_ledger_preview_html\",\n\t\t\t\t\t\t\t\tresponse.message.gl_columns,\n\t\t\t\t\t\t\t\tresponse.message.gl_data\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t__(\"Preview\")\n\t\t\t);\n\t\t}\n\t},\n\n\tshow_stock_ledger_preview(frm) {\n\t\tlet me = this;\n\t\tif (!frm.is_new() && frm.doc.docstatus == 0) {\n\t\t\tfrm.add_custom_button(\n\t\t\t\t__(\"Stock Ledger\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\t\tmethod: \"erpnext.controllers.stock_controller.show_stock_ledger_preview\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\t\t\tdocname: frm.doc.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (response) {\n\t\t\t\t\t\t\tme.make_dialog(\n\t\t\t\t\t\t\t\t\"Stock Ledger Preview\",\n\t\t\t\t\t\t\t\t\"stock_ledger_preview_html\",\n\t\t\t\t\t\t\t\tresponse.message.sl_columns,\n\t\t\t\t\t\t\t\tresponse.message.sl_data\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t__(\"Preview\")\n\t\t\t);\n\t\t}\n\t},\n\n\tmake_dialog(label, fieldname, columns, data) {\n\t\tlet me = this;\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\tsize: \"extra-large\",\n\t\t\ttitle: __(label),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\tfieldname: fieldname,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tsetTimeout(function () {\n\t\t\tme.get_datatable(columns, data, dialog.get_field(fieldname).wrapper);\n\t\t}, 200);\n\n\t\tdialog.show();\n\t},\n\n\tget_datatable(columns, data, wrapper) {\n\t\tconst datatable_options = {\n\t\t\tcolumns: columns,\n\t\t\tdata: data,\n\t\t\tdynamicRowHeight: true,\n\t\t\tcheckboxColumn: false,\n\t\t\tinlineFilters: true,\n\t\t};\n\n\t\tnew frappe.DataTable(wrapper, datatable_options);\n\t},\n};\n", "frappe.provide(\"erpnext.accounts\");\n\nerpnext.accounts.unreconcile_payment = {\n\tadd_unreconcile_btn(frm) {\n\t\tif (frm.doc.docstatus == 1) {\n\t\t\tif (\n\t\t\t\t(frm.doc.doctype == \"Journal Entry\" &&\n\t\t\t\t\t![\"Journal Entry\", \"Bank Entry\", \"Cash Entry\"].includes(frm.doc.voucher_type)) ||\n\t\t\t\t![\"Purchase Invoice\", \"Sales Invoice\", \"Journal Entry\", \"Payment Entry\"].includes(\n\t\t\t\t\tfrm.doc.doctype\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.unreconcile_payment.unreconcile_payment.doc_has_references\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\tdocname: frm.doc.name,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tfrm.add_custom_button(\n\t\t\t\t\t\t\t__(\"UnReconcile\"),\n\t\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\t\terpnext.accounts.unreconcile_payment.build_unreconcile_dialog(frm);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t__(\"Actions\")\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\n\tbuild_selection_map(frm, selections) {\n\t\t// assuming each row is an individual voucher\n\t\t// pass this to server side method that creates unreconcile doc for each row\n\t\tlet selection_map = [];\n\t\tif ([\"Sales Invoice\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\n\t\t\tselection_map = selections.map(function (elem) {\n\t\t\t\treturn {\n\t\t\t\t\tcompany: elem.company,\n\t\t\t\t\tvoucher_type: elem.voucher_type,\n\t\t\t\t\tvoucher_no: elem.voucher_no,\n\t\t\t\t\tagainst_voucher_type: frm.doc.doctype,\n\t\t\t\t\tagainst_voucher_no: frm.doc.name,\n\t\t\t\t};\n\t\t\t});\n\t\t} else if ([\"Payment Entry\", \"Journal Entry\"].includes(frm.doc.doctype)) {\n\t\t\tselection_map = selections.map(function (elem) {\n\t\t\t\treturn {\n\t\t\t\t\tcompany: elem.company,\n\t\t\t\t\tvoucher_type: frm.doc.doctype,\n\t\t\t\t\tvoucher_no: frm.doc.name,\n\t\t\t\t\tagainst_voucher_type: elem.voucher_type,\n\t\t\t\t\tagainst_voucher_no: elem.voucher_no,\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t\treturn selection_map;\n\t},\n\n\tbuild_unreconcile_dialog(frm) {\n\t\tif (\n\t\t\t[\"Sales Invoice\", \"Purchase Invoice\", \"Payment Entry\", \"Journal Entry\"].includes(frm.doc.doctype)\n\t\t) {\n\t\t\tlet child_table_fields = [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Voucher Type\"),\n\t\t\t\t\tfieldname: \"voucher_type\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"DocType\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Voucher No\"),\n\t\t\t\t\tfieldname: \"voucher_no\",\n\t\t\t\t\tfieldtype: \"Dynamic Link\",\n\t\t\t\t\toptions: \"voucher_type\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Allocated Amount\"),\n\t\t\t\t\tfieldname: \"allocated_amount\",\n\t\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\toptions: \"account_currency\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Currency\"),\n\t\t\t\t\tfieldname: \"account_currency\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"Currency\",\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t];\n\t\t\tlet unreconcile_dialog_fields = [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Allocations\"),\n\t\t\t\t\tfieldname: \"allocations\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tfields: child_table_fields,\n\t\t\t\t\tcannot_add_rows: true,\n\t\t\t\t},\n\t\t\t];\n\n\t\t\t// get linked payments\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.unreconcile_payment.unreconcile_payment.get_linked_payments_for_doc\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\tdocname: frm.doc.name,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t// populate child table with allocations\n\t\t\t\t\t\tunreconcile_dialog_fields[0].data = r.message;\n\t\t\t\t\t\tunreconcile_dialog_fields[0].get_data = function () {\n\t\t\t\t\t\t\treturn r.message;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\t\t\ttitle: __(\"UnReconcile Allocations\"),\n\t\t\t\t\t\t\tfields: unreconcile_dialog_fields,\n\t\t\t\t\t\t\tsize: \"large\",\n\t\t\t\t\t\t\tprimary_action_label: __(\"UnReconcile\"),\n\t\t\t\t\t\t\tprimary_action(values) {\n\t\t\t\t\t\t\t\tlet selected_allocations = values.allocations.filter((x) => x.__checked);\n\t\t\t\t\t\t\t\tif (selected_allocations.length > 0) {\n\t\t\t\t\t\t\t\t\tlet selection_map =\n\t\t\t\t\t\t\t\t\t\terpnext.accounts.unreconcile_payment.build_selection_map(\n\t\t\t\t\t\t\t\t\t\t\tfrm,\n\t\t\t\t\t\t\t\t\t\t\tselected_allocations\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\terpnext.accounts.unreconcile_payment.create_unreconcile_docs(\n\t\t\t\t\t\t\t\t\t\tselection_map\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfrappe.msgprint(__(\"No Selection\"));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\td.show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\n\tcreate_unreconcile_docs(selection_map) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.unreconcile_payment.unreconcile_payment.create_unreconcile_doc_for_selection\",\n\t\t\targs: {\n\t\t\t\tselections: selection_map,\n\t\t\t},\n\t\t});\n\t},\n};\n", "erpnext.utils.BarcodeScanner = class BarcodeScanner {\n\tconstructor(opts) {\n\t\tthis.frm = opts.frm;\n\t\t// frappe.flags.trigger_from_barcode_scanner is used for custom scripts\n\n\t\t// field from which to capture input of scanned data\n\t\tthis.scan_field_name = opts.scan_field_name || \"scan_barcode\";\n\t\tthis.scan_barcode_field = this.frm.fields_dict[this.scan_field_name];\n\n\t\tthis.barcode_field = opts.barcode_field || \"barcode\";\n\t\tthis.serial_no_field = opts.serial_no_field || \"serial_no\";\n\t\tthis.batch_no_field = opts.batch_no_field || \"batch_no\";\n\t\tthis.uom_field = opts.uom_field || \"uom\";\n\t\tthis.qty_field = opts.qty_field || \"qty\";\n\t\t// field name on row which defines max quantity to be scanned e.g. picklist\n\t\tthis.max_qty_field = opts.max_qty_field;\n\t\t// scanner won't add a new row if this flag is set.\n\t\tthis.dont_allow_new_row = opts.dont_allow_new_row;\n\t\t// scanner will ask user to type the quantity instead of incrementing by 1\n\t\tthis.prompt_qty = opts.prompt_qty;\n\n\t\tthis.items_table_name = opts.items_table_name || \"items\";\n\t\tthis.items_table = this.frm.doc[this.items_table_name];\n\n\t\t// optional sound name to play when scan either fails or passes.\n\t\t// see https://frappeframework.com/docs/v14/user/en/python-api/hooks#sounds\n\t\tthis.success_sound = opts.play_success_sound;\n\t\tthis.fail_sound = opts.play_fail_sound;\n\n\t\t// any API that takes `search_value` as input and returns dictionary as follows\n\t\t// {\n\t\t//     item_code: \"HORSESHOE\", // present if any item was found\n\t\t//     bar_code: \"123456\", // present if barcode was scanned\n\t\t//     batch_no: \"LOT12\", // present if batch was scanned\n\t\t//     serial_no: \"987XYZ\", // present if serial no was scanned\n\t\t//     uom: \"Kg\", // present if barcode UOM is different from default\n\t\t// }\n\t\tthis.scan_api = opts.scan_api || \"erpnext.stock.utils.scan_barcode\";\n\t}\n\n\tprocess_scan() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet me = this;\n\n\t\t\tconst input = this.scan_barcode_field.value;\n\t\t\tthis.scan_barcode_field.set_value(\"\");\n\t\t\tif (!input) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.scan_api_call(input, (r) => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\tthis.show_alert(__(\"Cannot find Item with this Barcode\"), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.update_table(data)\n\t\t\t\t\t.then((row) => {\n\t\t\t\t\t\tthis.play_success_sound();\n\t\t\t\t\t\tresolve(row);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tscan_api_call(input, callback) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: this.scan_api,\n\t\t\t\targs: {\n\t\t\t\t\tsearch_value: input,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tcallback(r);\n\t\t\t});\n\t}\n\n\tupdate_table(data) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\t\t\tfrappe.flags.trigger_from_barcode_scanner = true;\n\n\t\t\tconst { item_code, barcode, batch_no, serial_no, uom } = data;\n\n\t\t\tlet row = this.get_row_to_modify_on_scan(item_code, batch_no, uom, barcode);\n\n\t\t\tthis.is_new_row = false;\n\t\t\tif (!row) {\n\t\t\t\tif (this.dont_allow_new_row) {\n\t\t\t\t\tthis.show_alert(__(\"Maximum quantity scanned for item {0}.\", [item_code]), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.is_new_row = true;\n\n\t\t\t\t// add new row if new item/batch is scanned\n\t\t\t\trow = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\t\t\t\t// trigger any row add triggers defined on child table.\n\t\t\t\tthis.frm.script_manager.trigger(`${this.items_table_name}_add`, row.doctype, row.name);\n\t\t\t\tthis.frm.has_items = false;\n\t\t\t}\n\n\t\t\tif (this.is_duplicate_serial_no(row, serial_no)) {\n\t\t\t\tthis.clean_up();\n\t\t\t\treject();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.set_selector_trigger_flag(data),\n\t\t\t\t() =>\n\t\t\t\t\tthis.set_item(row, item_code, barcode, batch_no, serial_no).then((qty) => {\n\t\t\t\t\t\tthis.show_scan_message(row.idx, row.item_code, qty);\n\t\t\t\t\t}),\n\t\t\t\t() => this.set_barcode_uom(row, uom),\n\t\t\t\t() => this.set_serial_no(row, serial_no),\n\t\t\t\t() => this.set_batch_no(row, batch_no),\n\t\t\t\t() => this.set_barcode(row, barcode),\n\t\t\t\t() => this.clean_up(),\n\t\t\t\t() => this.revert_selector_flag(),\n\t\t\t\t() => resolve(row),\n\t\t\t]);\n\t\t});\n\t}\n\n\t// batch and serial selector is reduandant when all info can be added by scan\n\t// this flag on item row is used by transaction.js to avoid triggering selector\n\tset_selector_trigger_flag(data) {\n\t\tconst { batch_no, serial_no, has_batch_no, has_serial_no } = data;\n\n\t\tconst require_selecting_batch = has_batch_no && !batch_no;\n\t\tconst require_selecting_serial = has_serial_no && !serial_no;\n\n\t\tif (!(require_selecting_batch || require_selecting_serial)) {\n\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\t}\n\t}\n\n\trevert_selector_flag() {\n\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\tfrappe.flags.trigger_from_barcode_scanner = false;\n\t}\n\n\tset_item(row, item_code, barcode, batch_no, serial_no) {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst increment = async (value = 1) => {\n\t\t\t\tconst item_data = { item_code: item_code, use_serial_batch_fields: 1.0 };\n\t\t\t\tfrappe.flags.trigger_from_barcode_scanner = true;\n\t\t\t\titem_data[this.qty_field] = Number(row[this.qty_field] || 0) + Number(value);\n\t\t\t\tawait frappe.model.set_value(row.doctype, row.name, item_data);\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t\tif (this.prompt_qty) {\n\t\t\t\tfrappe.prompt(__(\"Please enter quantity for item {0}\", [item_code]), ({ value }) => {\n\t\t\t\t\tincrement(value).then((value) => resolve(value));\n\t\t\t\t});\n\t\t\t} else if (this.frm.has_items) {\n\t\t\t\tthis.prepare_item_for_scan(row, item_code, barcode, batch_no, serial_no);\n\t\t\t} else {\n\t\t\t\tincrement().then((value) => resolve(value));\n\t\t\t}\n\t\t});\n\t}\n\n\tprepare_item_for_scan(row, item_code, barcode, batch_no, serial_no) {\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Scan barcode for item {0}\", [item_code]),\n\t\t\tfields: me.get_fields_for_dialog(row, item_code, barcode, batch_no, serial_no),\n\t\t});\n\n\t\tthis.dialog.set_primary_action(__(\"Update\"), () => {\n\t\t\tconst item_data = { item_code: item_code };\n\t\t\titem_data[this.qty_field] = this.dialog.get_value(\"scanned_qty\");\n\t\t\titem_data[\"has_item_scanned\"] = 1;\n\n\t\t\tthis.remaining_qty =\n\t\t\t\tflt(this.dialog.get_value(\"qty\")) - flt(this.dialog.get_value(\"scanned_qty\"));\n\t\t\tfrappe.model.set_value(row.doctype, row.name, item_data);\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.set_batch_no(row, this.dialog.get_value(\"batch_no\")),\n\t\t\t\t() => this.set_barcode(row, this.dialog.get_value(\"barcode\")),\n\t\t\t\t() => this.set_serial_no(row, this.dialog.get_value(\"serial_no\")),\n\t\t\t\t() => this.add_child_for_remaining_qty(row),\n\t\t\t\t() => this.clean_up(),\n\t\t\t]);\n\n\t\t\tthis.dialog.hide();\n\t\t});\n\n\t\tthis.dialog.show();\n\n\t\tthis.$scan_btn = this.dialog.$wrapper.find(\".link-btn\");\n\t\tthis.$scan_btn.css(\"display\", \"inline\");\n\t}\n\n\tget_fields_for_dialog(row, item_code, barcode, batch_no, serial_no) {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode_scanner\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Scan Barcode\"),\n\t\t\t\tonchange: (e) => {\n\t\t\t\t\tif (!e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.target.value) {\n\t\t\t\t\t\tthis.scan_api_call(e.target.value, (r) => {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tthis.update_dialog_values(item_code, r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tfieldname: \"qty\",\n\t\t\t\tlabel: __(\"Quantity to Scan\"),\n\t\t\t\tdefault: row[this.qty_field] || 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\tfieldname: \"column_break_1\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tread_only: 1,\n\t\t\t\tfieldname: \"scanned_qty\",\n\t\t\t\tlabel: __(\"Scanned Quantity\"),\n\t\t\t\tdefault: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t];\n\n\t\tif (batch_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\toptions: \"Batch No\",\n\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\tdefault: batch_no,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1,\n\t\t\t});\n\t\t}\n\n\t\tif (serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\tlabel: __(\"Serial Nos\"),\n\t\t\t\tdefault: serial_no,\n\t\t\t\tread_only: 1,\n\t\t\t});\n\t\t}\n\n\t\tif (barcode) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Barcode\"),\n\t\t\t\tdefault: barcode,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1,\n\t\t\t});\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tupdate_dialog_values(scanned_item, r) {\n\t\tconst { item_code, barcode, batch_no, serial_no } = r.message;\n\n\t\tthis.dialog.set_value(\"barcode_scanner\", \"\");\n\t\tif (\n\t\t\titem_code === scanned_item &&\n\t\t\t(this.dialog.get_value(\"barcode\") === barcode || batch_no || serial_no)\n\t\t) {\n\t\t\tif (batch_no) {\n\t\t\t\tthis.dialog.set_value(\"batch_no\", batch_no);\n\t\t\t}\n\n\t\t\tif (serial_no) {\n\t\t\t\tthis.validate_duplicate_serial_no(serial_no);\n\t\t\t\tlet serial_nos = this.dialog.get_value(\"serial_no\") + \"\\n\" + serial_no;\n\t\t\t\tthis.dialog.set_value(\"serial_no\", serial_nos);\n\t\t\t}\n\n\t\t\tlet qty = flt(this.dialog.get_value(\"scanned_qty\")) + 1.0;\n\t\t\tthis.dialog.set_value(\"scanned_qty\", qty);\n\t\t}\n\t}\n\n\tvalidate_duplicate_serial_no(serial_no) {\n\t\tlet serial_nos = this.dialog.get_value(\"serial_no\")\n\t\t\t? this.dialog.get_value(\"serial_no\").split(\"\\n\")\n\t\t\t: [];\n\n\t\tif (in_list(serial_nos, serial_no)) {\n\t\t\tfrappe.throw(__(\"Serial No {0} already scanned\", [serial_no]));\n\t\t}\n\t}\n\n\tadd_child_for_remaining_qty(prev_row) {\n\t\tif (this.remaining_qty && this.remaining_qty > 0) {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\t\t\tlet row = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\n\t\t\tlet ignore_fields = [\n\t\t\t\t\"name\",\n\t\t\t\t\"idx\",\n\t\t\t\t\"batch_no\",\n\t\t\t\t\"barcode\",\n\t\t\t\t\"received_qty\",\n\t\t\t\t\"serial_no\",\n\t\t\t\t\"has_item_scanned\",\n\t\t\t];\n\n\t\t\tfor (let key in prev_row) {\n\t\t\t\tif (in_list(ignore_fields, key)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\trow[key] = prev_row[key];\n\t\t\t}\n\n\t\t\trow[this.qty_field] = this.remaining_qty;\n\t\t\tif (this.qty_field == \"qty\" && frappe.meta.has_field(row.doctype, \"stock_qty\")) {\n\t\t\t\trow[\"stock_qty\"] = this.remaining_qty * row.conversion_factor;\n\t\t\t}\n\n\t\t\tthis.frm.script_manager.trigger(\"item_code\", row.doctype, row.name);\n\t\t}\n\t}\n\n\tasync set_serial_no(row, serial_no) {\n\t\tif (serial_no && frappe.meta.has_field(row.doctype, this.serial_no_field)) {\n\t\t\tconst existing_serial_nos = row[this.serial_no_field];\n\t\t\tlet new_serial_nos = \"\";\n\n\t\t\tif (!!existing_serial_nos) {\n\t\t\t\tnew_serial_nos = existing_serial_nos + \"\\n\" + serial_no;\n\t\t\t} else {\n\t\t\t\tnew_serial_nos = serial_no;\n\t\t\t}\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.serial_no_field, new_serial_nos);\n\t\t}\n\t}\n\n\tasync set_barcode_uom(row, uom) {\n\t\tif (uom && frappe.meta.has_field(row.doctype, this.uom_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.uom_field, uom);\n\t\t}\n\t}\n\n\tasync set_batch_no(row, batch_no) {\n\t\tif (batch_no && frappe.meta.has_field(row.doctype, this.batch_no_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.batch_no_field, batch_no);\n\t\t}\n\t}\n\n\tasync set_barcode(row, barcode) {\n\t\tif (barcode && frappe.meta.has_field(row.doctype, this.barcode_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.barcode_field, barcode);\n\t\t}\n\t}\n\n\tshow_scan_message(idx, exist = null, qty = 1) {\n\t\t// show new row or qty increase toast\n\t\tif (exist) {\n\t\t\tthis.show_alert(__(\"Row #{0}: Qty increased by {1}\", [idx, qty]), \"green\");\n\t\t} else {\n\t\t\tthis.show_alert(__(\"Row #{0}: Item added\", [idx]), \"green\");\n\t\t}\n\t}\n\n\tis_duplicate_serial_no(row, serial_no) {\n\t\tconst is_duplicate = row[this.serial_no_field]?.includes(serial_no);\n\n\t\tif (is_duplicate) {\n\t\t\tthis.show_alert(__(\"Serial No {0} is already added\", [serial_no]), \"orange\");\n\t\t}\n\t\treturn is_duplicate;\n\t}\n\n\tget_row_to_modify_on_scan(item_code, batch_no, uom, barcode) {\n\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\n\t\t// Check if batch is scanned and table has batch no field\n\t\tlet is_batch_no_scan = batch_no && frappe.meta.has_field(cur_grid.doctype, this.batch_no_field);\n\t\tlet check_max_qty = this.max_qty_field && frappe.meta.has_field(cur_grid.doctype, this.max_qty_field);\n\n\t\tconst matching_row = (row) => {\n\t\t\tconst item_match = row.item_code == item_code;\n\t\t\tconst batch_match = !row[this.batch_no_field] || row[this.batch_no_field] == batch_no;\n\t\t\tconst uom_match = !uom || row[this.uom_field] == uom;\n\t\t\tconst qty_in_limit = flt(row[this.qty_field]) < flt(row[this.max_qty_field]);\n\t\t\tconst item_scanned = row.has_item_scanned;\n\n\t\t\treturn (\n\t\t\t\titem_match &&\n\t\t\t\tuom_match &&\n\t\t\t\t!item_scanned &&\n\t\t\t\t(!is_batch_no_scan || batch_match) &&\n\t\t\t\t(!check_max_qty || qty_in_limit)\n\t\t\t);\n\t\t};\n\n\t\treturn this.items_table.find(matching_row) || this.get_existing_blank_row();\n\t}\n\n\tget_existing_blank_row() {\n\t\treturn this.items_table.find((d) => !d.item_code);\n\t}\n\n\tplay_success_sound() {\n\t\tthis.success_sound && frappe.utils.play_sound(this.success_sound);\n\t}\n\n\tplay_fail_sound() {\n\t\tthis.fail_sound && frappe.utils.play_sound(this.fail_sound);\n\t}\n\n\tclean_up() {\n\t\tthis.scan_barcode_field.set_value(\"\");\n\t\trefresh_field(this.items_table_name);\n\t}\n\tshow_alert(msg, indicator, duration = 3) {\n\t\tfrappe.show_alert({ message: msg, indicator: indicator }, duration);\n\t}\n};\n", "frappe.ui.form.ControlData = class ControlData extends frappe.ui.form.ControlData {\n\tmake_input() {\n\t\tsuper.make_input();\n\t\tif (this.df.options == \"Phone\") {\n\t\t\tthis.setup_phone();\n\t\t}\n\t\tif (this.frm && this.frm.fields_dict) {\n\t\t\tObject.values(this.frm.fields_dict).forEach(function (field) {\n\t\t\t\tif (\n\t\t\t\t\tfield.df.read_only === 1 &&\n\t\t\t\t\tfield.df.options === \"Phone\" &&\n\t\t\t\t\tfield.disp_area.style[0] != \"display\" &&\n\t\t\t\t\t!field.has_icon\n\t\t\t\t) {\n\t\t\t\t\tfield.setup_phone && field.setup_phone();\n\t\t\t\t\tfield.has_icon = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tsetup_phone() {\n\t\tif (frappe.phone_call.handler) {\n\t\t\tlet control = this.df.read_only ? \".control-value\" : \".control-input\";\n\t\t\tthis.$wrapper\n\t\t\t\t.find(control)\n\t\t\t\t.append(\n\t\t\t\t\t`\n\t\t\t\t\t<span class=\"phone-btn\">\n\t\t\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Make a call\")}\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"call\")}\n\t\t\t\t\t</span>\n\t\t\t\t`\n\t\t\t\t)\n\t\t\t\t.find(\".phone-btn\")\n\t\t\t\t.click(() => {\n\t\t\t\t\tfrappe.phone_call.handler(this.get_value(), this.frm);\n\t\t\t\t});\n\t\t}\n\t}\n};\n", "\n\tfrappe.templates['call_link'] = `<div class=\"call-detail-wrapper\">\n\t<div class=\"head flex justify-between\">\n\t\t<div>\n\t\t\t<span class=\"bold\"> {{ type }} Call</span>\n\t\t\t{% if (duration) %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ frappe.format(duration, { fieldtype: \"Duration\" }) }}</span>\n\t\t\t{% endif %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ comment_when(creation) }}</span>\n\t\t</div>\n\t\t<span>\n\t\t\t<a class=\"action-btn\" href=\"/app/call-log/{{ name }}\" title=\"{{ __(\"Open Call Log\") }}\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-link-url\" class=\"like-icon\"></use>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t</span>\n\t</div>\n\n\n\t<div class=\"body pt-3\">\n\t\t{% if (type === \"Incoming\") { %}\n\t\t\t<span> Incoming call from {{ from }}, received by {{ to }}</span>\n\t\t{% } else { %}\n\t\t\t<span> Outgoing Call made by {{ from }} to {{ to }}</span>\n\t\t{% } %}\n\t\t<div class=\"summary pt-3\">\n\t\t{% if (summary) { %}\n\t\t\t<i>{{ summary }}</i>\n\t\t{% } else { %}\n\t\t\t<i class=\"text-muted\">{{ __(\"No Summary\") }}</i>\n\t\t{% } %}\n\t\t</div>\n\t\t{% if (recording_url) { %}\n\t\t<div class=\"margin-top\">\n\t\t\t\t<audio\n\t\t\t\t\tcontrols\n\t\t\t\t\tsrc=\"{{ recording_url }}\">\n\t\t\t\t</audio>\n\t\t</div>\n\t\t{% } %}\n\t</div>\n</div>\n`;\n", "frappe.provide(\"erpnext.bulk_transaction_processing\");\n\n$.extend(erpnext.bulk_transaction_processing, {\n\tcreate: function (listview, from_doctype, to_doctype, args) {\n\t\tlet checked_items = listview.get_checked_items();\n\t\tconst doc_name = [];\n\t\tchecked_items.forEach((Item) => {\n\t\t\tif (Item.docstatus == 0) {\n\t\t\t\tdoc_name.push(Item.name);\n\t\t\t}\n\t\t});\n\n\t\tlet count_of_rows = checked_items.length;\n\t\tfrappe.confirm(__(\"Create {0} {1} ?\", [count_of_rows, __(to_doctype)]), () => {\n\t\t\tif (doc_name.length == 0) {\n\t\t\t\tfrappe\n\t\t\t\t\t.call({\n\t\t\t\t\t\tmethod: \"erpnext.utilities.bulk_transaction.transaction_processing\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdata: checked_items,\n\t\t\t\t\t\t\tfrom_doctype: from_doctype,\n\t\t\t\t\t\t\tto_doctype: to_doctype,\n\t\t\t\t\t\t\targs: args,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {});\n\t\t\t\tif (count_of_rows > 10) {\n\t\t\t\t\tfrappe.show_alert(\"Starting a background job to create {0} {1}\", [\n\t\t\t\t\t\tcount_of_rows,\n\t\t\t\t\t\t__(to_doctype),\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__(\"Selected document must be in submitted state\"));\n\t\t\t}\n\t\t});\n\t},\n});\n", "erpnext.utils.CRMActivities = class CRMActivities {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\t$(this.open_activities_wrapper).empty();\n\t\tlet cur_form_footer = this.form_wrapper.find(\".form-footer\");\n\n\t\t// all activities\n\t\tif (!$(this.all_activities_wrapper).find(\".form-footer\").length) {\n\t\t\tthis.all_activities_wrapper.empty();\n\t\t\t$(cur_form_footer).appendTo(this.all_activities_wrapper);\n\n\t\t\t// remove frappe-control class to avoid absolute position for action-btn\n\t\t\t$(this.all_activities_wrapper).removeClass(\"frappe-control\");\n\t\t\t// hide new event button\n\t\t\t$(\".timeline-actions\").find(\".btn-default\").hide();\n\t\t\t// hide new comment box\n\t\t\t$(\".comment-box\").hide();\n\t\t\t// show only communications by default\n\t\t\t$($(\".timeline-content\").find(\".nav-link\")[0]).tab(\"show\");\n\t\t}\n\n\t\t// open activities\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.crm.utils.get_open_activities\",\n\t\t\targs: {\n\t\t\t\tref_doctype: this.frm.doc.doctype,\n\t\t\t\tref_docname: this.frm.doc.name,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tvar activities_html = frappe.render_template(\"crm_activities\", {\n\t\t\t\t\t\ttasks: r.message.tasks,\n\t\t\t\t\t\tevents: r.message.events,\n\t\t\t\t\t\ttasks_history: r.message.tasks_history,\n\t\t\t\t\t\tevents_history: r.message.events_history,\n\t\t\t\t\t});\n\n\t\t\t\t\t$(activities_html).appendTo(me.open_activities_wrapper);\n\n\t\t\t\t\t$(\".open-tasks\")\n\t\t\t\t\t\t.find(\".completion-checkbox\")\n\t\t\t\t\t\t.on(\"click\", function () {\n\t\t\t\t\t\t\tme.update_status(this, \"ToDo\");\n\t\t\t\t\t\t});\n\n\t\t\t\t\t$(\".open-events\")\n\t\t\t\t\t\t.find(\".completion-checkbox\")\n\t\t\t\t\t\t.on(\"click\", function () {\n\t\t\t\t\t\t\tme.update_status(this, \"Event\");\n\t\t\t\t\t\t});\n\n\t\t\t\t\tme.create_task();\n\t\t\t\t\tme.create_event();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tcreate_task() {\n\t\tlet me = this;\n\t\tlet _create_task = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Task\"),\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field(\"interaction_type\").set_value(\"ToDo\");\n\t\t\t// hide column having interaction type field\n\t\t\t$(composer.dialog.get_field(\"interaction_type\").wrapper).closest(\".form-column\").hide();\n\t\t\t// hide summary field\n\t\t\t$(composer.dialog.get_field(\"summary\").wrapper).closest(\".form-section\").hide();\n\t\t};\n\t\t$(\".new-task-btn\").click(_create_task);\n\t}\n\n\tcreate_event() {\n\t\tlet me = this;\n\t\tlet _create_event = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Event\"),\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field(\"interaction_type\").set_value(\"Event\");\n\t\t\t$(composer.dialog.get_field(\"interaction_type\").wrapper).hide();\n\t\t};\n\t\t$(\".new-event-btn\").click(_create_event);\n\t}\n\n\tasync update_status(input_field, doctype) {\n\t\tlet completed = $(input_field).prop(\"checked\") ? 1 : 0;\n\t\tlet docname = $(input_field).attr(\"name\");\n\t\tif (completed) {\n\t\t\tawait frappe.db.set_value(doctype, docname, \"status\", \"Closed\");\n\t\t\tthis.refresh();\n\t\t}\n\t}\n};\n\nerpnext.utils.CRMNotes = class CRMNotes {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\tthis.notes_wrapper.find(\".notes-section\").remove();\n\n\t\tlet notes = this.frm.doc.notes || [];\n\t\tnotes.sort(function (a, b) {\n\t\t\treturn new Date(b.added_on) - new Date(a.added_on);\n\t\t});\n\n\t\tlet notes_html = frappe.render_template(\"crm_notes\", {\n\t\t\tnotes: notes,\n\t\t});\n\t\t$(notes_html).appendTo(this.notes_wrapper);\n\n\t\tthis.add_note();\n\n\t\t$(\".notes-section\")\n\t\t\t.find(\".edit-note-btn\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tme.edit_note(this);\n\t\t\t});\n\n\t\t$(\".notes-section\")\n\t\t\t.find(\".delete-note-btn\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tme.delete_note(this);\n\t\t\t});\n\t}\n\n\tadd_note() {\n\t\tlet me = this;\n\t\tlet _add_note = () => {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Add a Note\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"Note\",\n\t\t\t\t\t\tfieldname: \"note\",\n\t\t\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\tenable_mentions: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action: function () {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"add_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __(\"Add\"),\n\t\t\t});\n\t\t\td.show();\n\t\t};\n\t\t$(\".new-note-btn\").click(_add_note);\n\t}\n\n\tedit_note(edit_btn) {\n\t\tvar me = this;\n\t\tlet row = $(edit_btn).closest(\".comment-content\");\n\t\tlet row_id = row.attr(\"name\");\n\t\tlet row_content = $(row).find(\".content\").html();\n\t\tif (row_content) {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Edit Note\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"Note\",\n\t\t\t\t\t\tfieldname: \"note\",\n\t\t\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\t\t\tdefault: row_content,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action: function () {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"edit_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note,\n\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __(\"Done\"),\n\t\t\t});\n\t\t\td.show();\n\t\t}\n\t}\n\n\tdelete_note(delete_btn) {\n\t\tvar me = this;\n\t\tlet row_id = $(delete_btn).closest(\".comment-content\").attr(\"name\");\n\t\tfrappe.call({\n\t\t\tmethod: \"delete_note\",\n\t\t\tdoc: me.frm.doc,\n\t\t\targs: {\n\t\t\t\trow_id: row_id,\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n};\n", "\n\tfrappe.templates['crm_activities'] = `<div class=\"open-activities\">\n\t<div class=\"new-btn pb-3\">\n\t\t<span>\n\t\t\t<button class=\"btn btn-sm small new-task-btn mr-1\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Task\") }}\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-sm small new-event-btn\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-calendar\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Event\") }}\n\t\t\t</button>\n\t\t</span>\n\t</div>\n\t<div class=\"section-body\">\n\t\t<div class=\"open-tasks pr-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Tasks\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (tasks.length) { %}\n\t\t\t\t{% for(var i=0, l=tasks.length; i<l; i++) { %}\n\t\t\t\t\t<div class=\"single-activity\">\n\t\t\t\t\t\t<div class=\"flex justify-between mb-2\">\n\t\t\t\t\t\t\t<div class=\"row label-area font-md ml-1\">\n\t\t\t\t\t\t\t\t<span class=\"mr-2\">\n\t\t\t\t\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<a href=\"/app/todo/{{ tasks[i].name }}\" title=\"{{ __('Open Task') }}\">\n\t\t\t\t\t\t\t\t\t{%= tasks[i].description %}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"checkbox\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"completion-checkbox\"\n\t\t\t\t\t\t\t\t\tname=\"{{tasks[i].name}}\" title=\"{{ __('Mark As Closed') }}\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% if(tasks[i].date) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted ml-1\">\n\t\t\t\t\t\t\t\t{%= frappe.datetime.global_date_format(tasks[i].date) %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t{% if(tasks[i].allocated_to) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted  ml-1\">\n\t\t\t\t\t\t\t\t{{ __(\"Allocated To:\") }}\n\t\t\t\t\t\t\t\t{%= tasks[i].allocated_to %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t</div>\n\t\t\t    {% } %}\n            {% } else { %}\n                <div class=\"single-activity no-activity text-muted\">\n                    {{ __(\"No open task\") }}\n                </div>\n\t\t    {% } %}\n\n\t\t{% if (typeof tasks_history == \"object\" && tasks_history?.length) { %}\n\t\t<div class=\"mt-4\" style=\"opacity: 0.8;\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span>{{ __(\"Completed Tasks\") }}</span>\n\t\t\t</div>\n\t\t\t{% for (const t of tasks_history) { %}\n\t\t\t<div class=\"single-activity\">\n\t\t\t\t{% if(t.date || t.allocated_to) { %}\n\t\t\t\t<div class=\"text-muted small flex align-items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{% if(t.allocated_to) { %}\n\t\t\t\t\t\t{%= frappe.avatar(t.allocated_to) %}\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ml-2\">\n\t\t\t\t\t\t<div class=\"indicator-pill no-indicator-dot whitespace-nowrap red\">\n\t\t\t\t\t\t\t{{ __(\"Done\") }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{% if (t.date) { %}\n\t\t\t\t\t<div class=\"ml-auto\">\n\t\t\t\t\t\t{%= frappe.datetime.global_date_format(t.date) %}\n\t\t\t\t\t</div>\n\t\t\t\t\t{% } %}\n\t\t\t\t\t<div class=\"checkbox {% if(!t.date) { %}ml-auto{% } else { %}ml-2{% } %}\">\n\t\t\t\t\t\t<input type=\"checkbox\" class=\"completion-checkbox\" checked disabled>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{% } %}\n\t\t\t\t<div class=\"pl-2 mb-2 mt-2\">\n\t\t\t\t\t<div class=\"label-area font-md\">\n\t\t\t\t\t\t<a href=\"/app/todo/{{ t.name }}\" title=\"{{ __('Open Task') }}\">\n\t\t\t\t\t\t\t{%= t.description %}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{% } %}\n\t\t</div>\n\t\t{% } %}\n\t\t</div>\n\t\t<div class=\"open-events pl-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Events\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (events.length) { %}\n                {% let icon_set = {\"Sent/Received Email\": \"mail\", \"Call\": \"call\", \"Meeting\": \"share-people\"}; %}\n                {% for(var i=0, l=events.length; i<l; i++) { %}\n                    <div class=\"single-activity\">\n                        <div class=\"flex justify-between mb-2\">\n                            <div class=\"row label-area font-md ml-1 title\">\n                                <span class=\"mr-2\">\n                                    <svg class=\"icon icon-sm\">\n                                        <use href=\"#icon-{{ icon_set[events[i].event_category] || 'calendar' }}\"></use>\n                                    </svg>\n                                </span>\n                                <a href=\"/app/event/{{ events[i].name }}\" title=\"{{ __('Open Event') }}\">\n                                    {%= events[i].subject %}\n                                </a>\n                            </div>\n                            <div class=\"checkbox\">\n                                <input type=\"checkbox\" class=\"completion-checkbox\"\n                                    name=\"{{ events[i].name }}\" title=\"{{ __('Mark As Closed') }}\">\n                            </div>\n                        </div>\n                        <div class=\"text-muted ml-1\">\n                            {%= frappe.datetime.global_date_format(events[i].starts_on) %}\n\n                            {% if (events[i].ends_on) { %}\n                                {% if (frappe.datetime.obj_to_user(events[i].starts_on) != frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    -\n                                    {%= frappe.datetime.global_date_format(frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } else if (events[i].ends_on) { %}\n                                    -\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } %}\n                            {% } %}\n\n                        </div>\n                    </div>\n                {% } %}\n            {% } else { %}\n            <div class=\"single-activity no-activity text-muted\">\n                {{ __(\"No open event\") }}\n            </div>\n\t\t    {% } %}\n\n\t\t{% if (typeof events_history == \"object\" && events_history?.length) { %}\n\t\t<div class=\"mt-4\" style=\"opacity: 0.8;\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span>{{ __(\"Past Events\") }}</span>\n\t\t\t</div>\n\t\t\t{% let icon_set = {\"Sent/Received Email\": \"mail\", \"Call\": \"call\", \"Meeting\": \"share-people\"}; %}\n\t\t\t{% for(const event of events_history) { %}\n\t\t\t<div class=\"single-activity\">\n\t\t\t\t<div class=\"flex justify-between mb-2\">\n\t\t\t\t\t<div class=\"row label-area font-md ml-1 title\">\n\t\t\t\t\t\t<span class=\"mr-2\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t\t\t<use href=\"#icon-{{ icon_set[event.event_category] || 'calendar' }}\"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<a href=\"/app/event/{{ event.name }}\" title=\"{{ __('Open Event') }}\">\n\t\t\t\t\t\t\t{%= event.subject %}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"checkbox\">\n\t\t\t\t\t\t<input type=\"checkbox\" class=\"completion-checkbox\" checked disabled>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"text-muted ml-1\">\n\t\t\t\t\t{%= frappe.datetime.global_date_format(event.starts_on) %}\n\n\t\t\t\t\t{% if (event.ends_on) { %}\n\t\t\t\t\t{% if (frappe.datetime.obj_to_user(event.starts_on) != frappe.datetime.obj_to_user(event.ends_on)) %}\n\t\t\t\t\t-\n\t\t\t\t\t{%= frappe.datetime.global_date_format(frappe.datetime.obj_to_user(event.ends_on)) %}\n\t\t\t\t\t{%= frappe.datetime.get_time(event.ends_on) %}\n\t\t\t\t\t{% } else if (event.ends_on) { %}\n\t\t\t\t\t-\n\t\t\t\t\t{%= frappe.datetime.get_time(event.ends_on) %}\n\t\t\t\t\t{% } %}\n\t\t\t\t\t{% } %}\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{% } %}\n\t\t</div>\n\t\t{% } %}\n\t\t</div>\n\t</div>\n</div>\n\n\n<style>\n.open-activities {\n\tmin-height: 50px;\n\tpadding-left: 0px;\n\tpadding-bottom: 15px !important;\n}\n\n.open-activities .new-btn {\n\ttext-align: right;\n}\n\n.single-activity {\n\tmin-height: 90px;\n\tborder: 1px solid var(--border-color);\n\tpadding: 10px;\n\tborder-bottom: 0;\n\tpadding-right: 0;\n}\n\n.single-activity:last-child {\n\tborder-bottom: 1px solid var(--border-color);\n}\n\n.single-activity:hover .completion-checkbox{\n\tdisplay: block;\n}\n\n.completion-checkbox {\n\tvertical-align: middle;\n\tdisplay: none;\n}\n\n.checkbox {\n\tmin-width: 22px;\n}\n\n.open-tasks {\n\twidth: 50%;\n}\n\n.open-tasks:first-child {\n\tborder-right: 0;\n}\n\n.open-events {\n\twidth: 50%;\n}\n\n.open-section-head {\n\tbackground-color: var(--bg-color);\n\tmin-height: 30px;\n\tborder-bottom: 1px solid var(--border-color);\n\tpadding: 10px;\n\tfont-weight: bold;\n}\n\n.no-activity {\n    text-align: center;\n    padding-top: 30px;\n}\n\n.form-footer {\n\tbackground-color: var(--bg-color);\n}\n</style>`;\n", "\n\tfrappe.templates['crm_notes'] = `<div class=\"notes-section col-xs-12\">\n\t<div class=\"new-btn pb-3\">\n\t\t<button class=\"btn btn-sm small new-note-btn mr-1\">\n\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t<use href=\"#icon-add\"></use>\n\t\t\t</svg>\n\t\t\t{{ __(\"New Note\") }}\n\t\t</button>\n\t</div>\n\t<div class=\"all-notes\">\n\t\t{% if (notes.length) { %}\n\t\t\t{% for(var i=0, l=notes.length; i<l; i++) { %}\n\t\t\t\t<div class=\"comment-content p-3 row\" name=\"{{ notes[i].name }}\">\n\t\t\t\t\t<div class=\"mb-2 head col-xs-3\">\n\t\t\t\t\t\t{% if (notes[i].added_by && notes[i].added_on) %}\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t<div class=\"col-xs-2\">\n\t\t\t\t\t\t\t\t{{ frappe.avatar(notes[i].added_by) }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"col-xs-10\">\n\t\t\t\t\t\t\t\t<div class=\"mr-2 title font-weight-bold ellipsis\" title=\"{{ strip_html(notes[i].added_by) }}\">\n\t\t\t\t\t\t\t\t\t{{ strip_html(notes[i].added_by) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"time small text-muted\">\n\t\t\t\t\t\t\t\t\t{{ frappe.datetime.global_date_format(notes[i].added_on) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"content col-xs-8\">\n\t\t\t\t\t\t{{ notes[i].note }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"col-xs-1 text-right\">\n\t\t\t\t\t\t<span class=\"edit-note-btn btn btn-link\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-sm\"><use xlink:href=\"#icon-edit\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"delete-note-btn  btn btn-link pl-2\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-xs\"><use xlink:href=\"#icon-delete\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{% } %}\n\t\t{% } else { %}\n            <div class=\"no-activity text-muted pt-6\">\n                {{ __(\"No Notes\") }}\n            </div>\n\t\t    {% } %}\n\t</div>\n</div>\n\n<style>\n\n.comment-content {\n    border: 1px solid var(--border-color);\n\tborder-bottom: none;\n}\n\n.comment-content:last-child {\n    border-bottom: 1px solid var(--border-color);\n}\n\n.new-btn {\n\ttext-align: right;\n}\n\n.notes-section .no-activity {\n\tmin-height: 100px;\n\ttext-align: center;\n}\n\n.notes-section .btn {\n\tpadding: 0.2rem 0.2rem;\n}\n\n</style>`;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// get tax rate\nfrappe.provide(\"erpnext.taxes\");\n\nerpnext.accounts.taxes = {\n\tsetup_tax_validations: function(doctype) {\n\t\tlet me = this;\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\tsetup: function(frm) {\n\t\t\t\t// set conditional display for rate column in taxes\n\t\t\t\t$(frm.wrapper).on('grid-row-render', function(e, grid_row) {\n\t\t\t\t\tif(['Sales Taxes and Charges', 'Purchase Taxes and Charges'].includes(grid_row.doc.doctype)) {\n\t\t\t\t\t\tme.set_conditional_mandatory_rate_or_amount(grid_row);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tonload: function(frm) {\n\t\t\t\tif(frm.get_field(\"taxes\")) {\n\t\t\t\t\tfrm.set_query(\"account_head\", \"taxes\", function(doc) {\n\t\t\t\t\t\tif(frm.cscript.tax_table == \"Sales Taxes and Charges\") {\n\t\t\t\t\t\t\tvar account_type = [\"Tax\", \"Chargeable\", \"Expense Account\"];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar account_type = [\"Tax\", \"Chargeable\", \"Income Account\", \"Expenses Included In Valuation\"];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.controllers.queries.tax_account_query\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\"account_type\": account_type,\n\t\t\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tfrm.set_query(\"cost_center\", \"taxes\", function(doc) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\t\t\"is_group\": 0\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tvalidate: function(frm) {\n\t\t\t\t// neither is absolutely mandatory\n\t\t\t\tif(frm.get_docfield(\"taxes\")) {\n\t\t\t\t\tfrm.get_docfield(\"taxes\", \"rate\").reqd = 0;\n\t\t\t\t\tfrm.get_docfield(\"taxes\", \"tax_amount\").reqd = 0;\n\t\t\t\t}\n\n\t\t\t},\n\t\t\ttaxes_on_form_rendered: function(frm) {\n\t\t\t\tme.set_conditional_mandatory_rate_or_amount(frm.open_grid_row());\n\t\t\t},\n\t\t});\n\t},\n\n\tset_conditional_mandatory_rate_or_amount: function(grid_row) {\n\t\tif(grid_row) {\n\t\t\tif(grid_row.doc.charge_type===\"Actual\") {\n\t\t\t\tgrid_row.toggle_editable(\"tax_amount\", true);\n\t\t\t\tgrid_row.toggle_reqd(\"tax_amount\", true);\n\t\t\t\tgrid_row.toggle_editable(\"rate\", false);\n\t\t\t\tgrid_row.toggle_reqd(\"rate\", false);\n\t\t\t} else {\n\t\t\t\tgrid_row.toggle_editable(\"rate\", true);\n\t\t\t\tgrid_row.toggle_reqd(\"rate\", true);\n\t\t\t\tgrid_row.toggle_editable(\"tax_amount\", false);\n\t\t\t\tgrid_row.toggle_reqd(\"tax_amount\", false);\n\t\t\t}\n\t\t}\n\t},\n\n\tvalidate_taxes_and_charges: function(cdt, cdn) {\n\t\tlet d = locals[cdt][cdn];\n\t\tlet msg = \"\";\n\n\t\tif (d.account_head && !d.description) {\n\t\t\t// set description from account head\n\t\t\td.description = d.account_head.split(' - ').slice(0, -1).join(' - ');\n\t\t}\n\n\t\tif (!d.charge_type && (d.row_id || d.rate || d.tax_amount)) {\n\t\t\tmsg = __(\"Please select Charge Type first\");\n\t\t\td.row_id = \"\";\n\t\t\td.rate = d.tax_amount = 0.0;\n\t\t} else if ((d.charge_type == 'Actual' || d.charge_type == 'On Net Total' || d.charge_type == 'On Paid Amount') && d.row_id) {\n\t\t\tmsg = __(\"Can refer row only if the charge type is 'On Previous Row Amount' or 'Previous Row Total'\");\n\t\t\td.row_id = \"\";\n\t\t} else if ((d.charge_type == 'On Previous Row Amount' || d.charge_type == 'On Previous Row Total') && d.row_id) {\n\t\t\tif (d.idx == 1) {\n\t\t\t\tmsg = __(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\");\n\t\t\t\td.charge_type = '';\n\t\t\t} else if (!d.row_id) {\n\t\t\t\tmsg = __(\"Please specify a valid Row ID for row {0} in table {1}\", [d.idx, __(d.doctype)]);\n\t\t\t\td.row_id = \"\";\n\t\t\t} else if (d.row_id && d.row_id >= d.idx) {\n\t\t\t\tmsg = __(\"Cannot refer row number greater than or equal to current row number for this Charge type\");\n\t\t\t\td.row_id = \"\";\n\t\t\t}\n\t\t}\n\t\tif (msg) {\n\t\t\tfrappe.validated = false;\n\t\t\trefresh_field(\"taxes\");\n\t\t\tfrappe.throw(msg);\n\t\t}\n\n\t},\n\n\tsetup_tax_filters: function(doctype) {\n\t\tlet me = this;\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\taccount_head: function(frm, cdt, cdn) {\n\t\t\t\tlet d = locals[cdt][cdn];\n\n\t\t\t\tif (d.docstatus == 1) {\n\t\t\t\t\t// Should not trigger any changes on change post submit\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif(!d.charge_type && d.account_head){\n\t\t\t\t\tfrappe.msgprint(__(\"Please select Charge Type first\"));\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"account_head\", \"\");\n\t\t\t\t} else if (d.account_head) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\ttype:\"GET\",\n\t\t\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_tax_rate\",\n\t\t\t\t\t\targs: {\"account_head\":d.account_head},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (d.charge_type!==\"Actual\") {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"rate\", r.message.tax_rate || 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"description\", r.message.account_name);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\trow_id: function(frm, cdt, cdn) {\n\t\t\t\tme.validate_taxes_and_charges(cdt, cdn);\n\t\t\t},\n\t\t\trate: function(frm, cdt, cdn) {\n\t\t\t\tme.validate_taxes_and_charges(cdt, cdn);\n\t\t\t},\n\t\t\ttax_amount: function(frm, cdt, cdn) {\n\t\t\t\tme.validate_taxes_and_charges(cdt, cdn);\n\t\t\t},\n\t\t\tcharge_type: function(frm, cdt, cdn) {\n\t\t\t\tme.validate_taxes_and_charges(cdt, cdn);\n\t\t\t\tlet open_form = frm.open_grid_row();\n\t\t\t\tif(open_form) {\n\t\t\t\t\tme.set_conditional_mandatory_rate_or_amount(open_form);\n\t\t\t\t} else {\n\t\t\t\t\t// apply in current row\n\t\t\t\t\tme.set_conditional_mandatory_rate_or_amount(frm.get_field('taxes').grid.get_row(cdn));\n\t\t\t\t}\n\t\t\t},\n\t\t\tincluded_in_print_rate: function(frm, cdt, cdn) {\n\t\t\t\tlet tax = frappe.get_doc(cdt, cdn);\n\t\t\t\ttry {\n\t\t\t\t\tme.validate_taxes_and_charges(cdt, cdn);\n\t\t\t\t\tme.validate_inclusive_tax(tax, frm);\n\t\t\t\t} catch(e) {\n\t\t\t\t\ttax.included_in_print_rate = 0;\n\t\t\t\t\trefresh_field(\"included_in_print_rate\", tax.name, tax.parentfield);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tvalidate_inclusive_tax: function(tax, frm) {\n\t\tthis.frm = this.frm || frm;\n\t\tlet actual_type_error = function() {\n\t\t\tvar msg = __(\"Actual type tax cannot be included in Item rate in row {0}\", [tax.idx])\n\t\t\tfrappe.throw(msg);\n\t\t};\n\n\t\tlet on_previous_row_error = function(row_range) {\n\t\t\tvar msg = __(\"For row {0} in {1}. To include {2} in Item rate, rows {3} must also be included\",\n\t\t\t\t[tax.idx, __(tax.doctype), tax.charge_type, row_range])\n\t\t\tfrappe.throw(msg);\n\t\t};\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t\t// inclusive tax cannot be of type Actual\n\t\t\t\tactual_type_error();\n\t\t\t} else if (tax.charge_type == \"On Previous Row Amount\" && this.frm &&\n\t\t\t\t!cint(this.frm.doc[\"taxes\"][tax.row_id - 1].included_in_print_rate)\n\t\t\t) {\n\t\t\t\t// referred row should also be an inclusive tax\n\t\t\t\ton_previous_row_error(tax.row_id);\n\t\t\t} else if (tax.charge_type == \"On Previous Row Total\" && this.frm) {\n\t\t\t\tvar taxes_not_included = $.map(this.frm.doc[\"taxes\"].slice(0, tax.row_id),\n\t\t\t\t\tfunction(t) { return cint(t.included_in_print_rate) ? null : t; });\n\t\t\t\tif(taxes_not_included.length > 0) {\n\t\t\t\t\t// all rows above this tax should be inclusive\n\t\t\t\t\ton_previous_row_error(tax.row_id == 1 ? \"1\" : \"1 - \" + tax.row_id);\n\t\t\t\t}\n\t\t\t} else if(tax.category == \"Valuation\") {\n\t\t\t\tfrappe.throw(__(\"Valuation type charges can not marked as Inclusive\"));\n\t\t\t}\n\t\t}\n\t}\n}\n\nerpnext.accounts.payment_triggers = {\n\tsetup: function(doctype) {\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\tallocate_advances_automatically(frm) {\n\t\t\t\tfrm.trigger('fetch_advances');\n\t\t\t},\n\n\t\t\tonly_include_allocated_payments(frm) {\n\t\t\t\tfrm.trigger('fetch_advances');\n\t\t\t},\n\n\t\t\tfetch_advances(frm) {\n\t\t\t\tif(frm.doc.allocate_advances_automatically) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tdoc: frm.doc,\n\t\t\t\t\t\tmethod: \"set_advances\",\n\t\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n}\n\nerpnext.accounts.pos = {\n\tsetup: function(doctype) {\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\tmode_of_payment: function(frm, cdt, cdn) {\n\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\tget_payment_mode_account(frm, d.mode_of_payment, function(account){\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'account', account)\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\t},\n\n\tget_payment_mode_account: function(frm, mode_of_payment, callback) {\n\t\tif(!frm.doc.company) {\n\t\t\tfrappe.throw({message:__(\"Please select a Company first.\"), title: __(\"Mandatory\")});\n\t\t}\n\n\t\tif(!mode_of_payment) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn  frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.sales_invoice.sales_invoice.get_bank_cash_account\",\n\t\t\targs: {\n\t\t\t\t\"mode_of_payment\": mode_of_payment,\n\t\t\t\t\"company\": frm.doc.company\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tcallback(r.message.account)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n", "erpnext.landed_cost_taxes_and_charges = {\n\tsetup_triggers: function (doctype) {\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\trefresh: function (frm) {\n\t\t\t\tlet tax_field = frm.doc.doctype == \"Landed Cost Voucher\" ? \"taxes\" : \"additional_costs\";\n\t\t\t\tfrm.set_query(\"expense_account\", tax_field, function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\taccount_type: [\n\t\t\t\t\t\t\t\t\"in\",\n\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\"Tax\",\n\t\t\t\t\t\t\t\t\t\"Chargeable\",\n\t\t\t\t\t\t\t\t\t\"Income Account\",\n\t\t\t\t\t\t\t\t\t\"Expenses Included In Valuation\",\n\t\t\t\t\t\t\t\t\t\"Expenses Included In Asset Valuation\",\n\t\t\t\t\t\t\t\t\t\"Expense Account\",\n\t\t\t\t\t\t\t\t\t\"Direct Expense\",\n\t\t\t\t\t\t\t\t\t\"Indirect Expense\",\n\t\t\t\t\t\t\t\t\t\"Stock Received But Not Billed\",\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tset_account_currency: function (frm, cdt, cdn) {\n\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\tif (row.expense_account) {\n\t\t\t\t\tfrappe.db.get_value(\"Account\", row.expense_account, \"account_currency\", function (value) {\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"account_currency\", value.account_currency);\n\t\t\t\t\t\tfrm.events.set_exchange_rate(frm, cdt, cdn);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tset_exchange_rate: function (frm, cdt, cdn) {\n\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\tlet company_currency = frappe.get_doc(\":Company\", frm.doc.company).default_currency;\n\n\t\t\t\tif (row.account_currency == company_currency) {\n\t\t\t\t\trow.exchange_rate = 1;\n\t\t\t\t\tfrm.set_df_property(\"taxes\", \"hidden\", 1, row.name, \"exchange_rate\");\n\t\t\t\t} else if (!row.exchange_rate || row.exchange_rate == 1) {\n\t\t\t\t\tfrm.set_df_property(\"taxes\", \"hidden\", 0, row.name, \"exchange_rate\");\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.doctype.journal_entry.journal_entry.get_exchange_rate\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tposting_date: frm.doc.posting_date,\n\t\t\t\t\t\t\taccount: row.expense_account,\n\t\t\t\t\t\t\taccount_currency: row.account_currency,\n\t\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"exchange_rate\", r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfrm.refresh_field(\"taxes\");\n\t\t\t},\n\n\t\t\tset_base_amount: function (frm, cdt, cdn) {\n\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\tcdt,\n\t\t\t\t\tcdn,\n\t\t\t\t\t\"base_amount\",\n\t\t\t\t\tflt(flt(row.amount) * row.exchange_rate, precision(\"base_amount\", row))\n\t\t\t\t);\n\t\t\t},\n\t\t});\n\t},\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.selling\");\n\nerpnext.sales_common = {\n\tsetup_selling_controller: function () {\n\t\terpnext.selling.SellingController = class SellingController extends erpnext.TransactionController {\n\t\t\tsetup() {\n\t\t\t\tsuper.setup();\n\t\t\t\tthis.toggle_enable_for_stock_uom(\"allow_to_edit_stock_uom_qty_for_sales\");\n\t\t\t\tthis.frm.email_field = \"contact_email\";\n\t\t\t}\n\n\t\t\tonload() {\n\t\t\t\tsuper.onload();\n\t\t\t\tthis.setup_queries();\n\t\t\t\tthis.frm.set_query(\"shipping_rule\", function (doc) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tshipping_rule_type: \"Selling\",\n\t\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tthis.frm.set_query(\"project\", function (doc) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: \"erpnext.controllers.queries.get_project_name\",\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsetup_queries() {\n\t\t\t\tvar me = this;\n\n\t\t\t\t$.each(\n\t\t\t\t\t[\n\t\t\t\t\t\t[\"customer\", \"customer\"],\n\t\t\t\t\t\t[\"lead\", \"lead\"],\n\t\t\t\t\t],\n\t\t\t\t\tfunction (i, opts) {\n\t\t\t\t\t\tif (me.frm.fields_dict[opts[0]]) me.frm.set_query(opts[0], erpnext.queries[opts[1]]);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tme.frm.set_query(\"contact_person\", erpnext.queries.contact_query);\n\t\t\t\tme.frm.set_query(\"company_contact_person\", erpnext.queries.company_contact_query);\n\t\t\t\tme.frm.set_query(\"customer_address\", erpnext.queries.address_query);\n\t\t\t\tme.frm.set_query(\"shipping_address_name\", erpnext.queries.address_query);\n\t\t\t\tme.frm.set_query(\"dispatch_address_name\", erpnext.queries.dispatch_address_query);\n\t\t\t\tme.frm.set_query(\"company_address\", erpnext.queries.company_address_query);\n\n\t\t\t\terpnext.accounts.dimensions.setup_dimension_filters(me.frm, me.frm.doctype);\n\n\t\t\t\tif (this.frm.fields_dict.selling_price_list) {\n\t\t\t\t\tthis.frm.set_query(\"selling_price_list\", function () {\n\t\t\t\t\t\treturn { filters: { selling: 1 } };\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.frm.fields_dict.tc_name) {\n\t\t\t\t\tthis.frm.set_query(\"tc_name\", function () {\n\t\t\t\t\t\treturn { filters: { selling: 1 } };\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!this.frm.fields_dict[\"items\"]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"item_code\")) {\n\t\t\t\t\tthis.frm.set_query(\"item_code\", \"items\", function () {\n\t\t\t\t\t\tlet customer = me.frm.doc.customer;\n\t\t\t\t\t\tif (me.frm.doc.doctype == \"Quotation\" && me.frm.doc.quotation_to == \"Customer\") {\n\t\t\t\t\t\t\tcustomer = me.frm.doc.party_name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\t\t\t\tfilters: { is_sales_item: 1, customer: customer, has_variants: 0 },\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.frm.fields_dict[\"packed_items\"] &&\n\t\t\t\t\tthis.frm.fields_dict[\"packed_items\"].grid.get_field(\"batch_no\")\n\t\t\t\t) {\n\t\t\t\t\tthis.frm.set_query(\"batch_no\", \"packed_items\", function (doc, cdt, cdn) {\n\t\t\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"item_code\")) {\n\t\t\t\t\tthis.frm.set_query(\"item_tax_template\", \"items\", function (doc, cdt, cdn) {\n\t\t\t\t\t\treturn me.set_query_for_item_tax_template(doc, cdt, cdn);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trefresh() {\n\t\t\t\tsuper.refresh();\n\n\t\t\t\tfrappe.dynamic_link = { doc: this.frm.doc, fieldname: \"customer\", doctype: \"Customer\" };\n\n\t\t\t\tthis.frm.toggle_display(\n\t\t\t\t\t\"customer_name\",\n\t\t\t\t\tthis.frm.doc.customer_name && this.frm.doc.customer_name !== this.frm.doc.customer\n\t\t\t\t);\n\n\t\t\t\tthis.toggle_editable_price_list_rate();\n\t\t\t}\n\n\t\t\tcompany() {\n\t\t\t\tsuper.company();\n\t\t\t\tthis.set_default_company_address();\n\t\t\t}\n\n\t\t\tset_default_company_address() {\n\t\t\t\tif (!frappe.meta.has_field(this.frm.doc.doctype, \"company_address\")) return;\n\t\t\t\tvar me = this;\n\t\t\t\tif (this.frm.doc.company) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.setup.doctype.company.company.get_default_company_address\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tname: this.frm.doc.company,\n\t\t\t\t\t\t\texisting_address: this.frm.doc.company_address || \"\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdebounce: 2000,\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(\"company_address\", r.message);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.frm.set_value(\"company_address\", \"\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcustomer() {\n\t\t\t\tvar me = this;\n\t\t\t\terpnext.utils.get_party_details(this.frm, null, null, function () {\n\t\t\t\t\tme.apply_price_list();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcustomer_address() {\n\t\t\t\terpnext.utils.get_address_display(this.frm, \"customer_address\");\n\t\t\t\terpnext.utils.set_taxes_from_address(\n\t\t\t\t\tthis.frm,\n\t\t\t\t\t\"customer_address\",\n\t\t\t\t\t\"customer_address\",\n\t\t\t\t\t\"shipping_address_name\"\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tshipping_address_name() {\n\t\t\t\terpnext.utils.get_address_display(this.frm, \"shipping_address_name\", \"shipping_address\");\n\t\t\t\terpnext.utils.set_taxes_from_address(\n\t\t\t\t\tthis.frm,\n\t\t\t\t\t\"shipping_address_name\",\n\t\t\t\t\t\"customer_address\",\n\t\t\t\t\t\"shipping_address_name\"\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tdispatch_address_name() {\n\t\t\t\terpnext.utils.get_address_display(this.frm, \"dispatch_address_name\", \"dispatch_address\");\n\t\t\t}\n\n\t\t\tsales_partner() {\n\t\t\t\tthis.apply_pricing_rule();\n\t\t\t}\n\n\t\t\tcampaign() {\n\t\t\t\tthis.apply_pricing_rule();\n\t\t\t}\n\n\t\t\tselling_price_list() {\n\t\t\t\tthis.apply_price_list();\n\t\t\t\tthis.set_dynamic_labels();\n\t\t\t}\n\n\t\t\tdiscount_percentage(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_amount = 0.0;\n\t\t\t\tthis.apply_discount_on_item(doc, cdt, cdn, \"discount_percentage\");\n\t\t\t}\n\n\t\t\tdiscount_amount(doc, cdt, cdn) {\n\t\t\t\tif (doc.name === cdn) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\tthis.apply_discount_on_item(doc, cdt, cdn, \"discount_amount\");\n\t\t\t}\n\n\t\t\tcommission_rate() {\n\t\t\t\tthis.calculate_commission();\n\t\t\t}\n\n\t\t\ttotal_commission() {\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\n\t\t\t\t\t\"amount_eligible_for_commission\",\n\t\t\t\t\t\"total_commission\",\n\t\t\t\t]);\n\n\t\t\t\tconst { amount_eligible_for_commission } = this.frm.doc;\n\t\t\t\tif (!amount_eligible_for_commission) return;\n\n\t\t\t\tthis.frm.set_value(\n\t\t\t\t\t\"commission_rate\",\n\t\t\t\t\tflt((this.frm.doc.total_commission * 100.0) / amount_eligible_for_commission)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tallocated_percentage(doc, cdt, cdn) {\n\t\t\t\tvar sales_person = frappe.get_doc(cdt, cdn);\n\t\t\t\tif (sales_person.allocated_percentage) {\n\t\t\t\t\tsales_person.allocated_percentage = flt(\n\t\t\t\t\t\tsales_person.allocated_percentage,\n\t\t\t\t\t\tprecision(\"allocated_percentage\", sales_person)\n\t\t\t\t\t);\n\n\t\t\t\t\tsales_person.allocated_amount = flt(\n\t\t\t\t\t\t(this.frm.doc.amount_eligible_for_commission * sales_person.allocated_percentage) /\n\t\t\t\t\t\t\t100.0,\n\t\t\t\t\t\tprecision(\"allocated_amount\", sales_person)\n\t\t\t\t\t);\n\t\t\t\t\trefresh_field([\"allocated_amount\"], sales_person);\n\n\t\t\t\t\tthis.calculate_incentive(sales_person);\n\t\t\t\t\trefresh_field(\n\t\t\t\t\t\t[\"allocated_percentage\", \"allocated_amount\", \"commission_rate\", \"incentives\"],\n\t\t\t\t\t\tsales_person.name,\n\t\t\t\t\t\tsales_person.parentfield\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsales_person(doc, cdt, cdn) {\n\t\t\t\tvar row = frappe.get_doc(cdt, cdn);\n\t\t\t\tthis.calculate_incentive(row);\n\t\t\t\trefresh_field(\"incentives\", row.name, row.parentfield);\n\t\t\t}\n\n\t\t\twarehouse(doc, cdt, cdn) {\n\t\t\t\tif (doc.docstatus === 0 && doc.is_return && !doc.return_against) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"incoming_rate\", 0.0);\n\t\t\t\t}\n\n\t\t\t\tthis.set_actual_qty(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tset_actual_qty(doc, cdt, cdn) {\n\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\tlet sales_doctypes = [\"Sales Invoice\", \"Delivery Note\", \"Sales Order\"];\n\n\t\t\t\tif (row.item_code && row.warehouse && sales_doctypes.includes(doc.doctype)) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_bin_details\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: row.item_code,\n\t\t\t\t\t\t\twarehouse: row.warehouse,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback(r) {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"actual_qty\", r.message.actual_qty);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttoggle_editable_price_list_rate() {\n\t\t\t\tvar df = frappe.meta.get_docfield(\n\t\t\t\t\tthis.frm.doc.doctype + \" Item\",\n\t\t\t\t\t\"price_list_rate\",\n\t\t\t\t\tthis.frm.doc.name\n\t\t\t\t);\n\t\t\t\tvar editable_price_list_rate = cint(frappe.defaults.get_default(\"editable_price_list_rate\"));\n\n\t\t\t\tif (df && editable_price_list_rate) {\n\t\t\t\t\tconst parent_field = frappe.meta.get_parentfield(\n\t\t\t\t\t\tthis.frm.doc.doctype,\n\t\t\t\t\t\tthis.frm.doc.doctype + \" Item\"\n\t\t\t\t\t);\n\t\t\t\t\tif (!this.frm.fields_dict[parent_field]) return;\n\n\t\t\t\t\tthis.frm.fields_dict[parent_field].grid.update_docfield_property(\n\t\t\t\t\t\t\"price_list_rate\",\n\t\t\t\t\t\t\"read_only\",\n\t\t\t\t\t\t0\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalculate_commission() {\n\t\t\t\tif (!this.frm.fields_dict.commission_rate || this.frm.doc.docstatus === 1) return;\n\n\t\t\t\tif (this.frm.doc.commission_rate > 100) {\n\t\t\t\t\tthis.frm.set_value(\"commission_rate\", 100);\n\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t`${__(\n\t\t\t\t\t\t\tfrappe.meta.get_label(this.frm.doc.doctype, \"commission_rate\", this.frm.doc.name)\n\t\t\t\t\t\t)} ${__(\"cannot be greater than 100\")}`\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.frm.doc.amount_eligible_for_commission = this.frm.doc.items.reduce(\n\t\t\t\t\t(sum, item) => (item.grant_commission ? sum + item.base_net_amount : sum),\n\t\t\t\t\t0\n\t\t\t\t);\n\n\t\t\t\tthis.frm.doc.total_commission = flt(\n\t\t\t\t\t(this.frm.doc.amount_eligible_for_commission * this.frm.doc.commission_rate) / 100.0,\n\t\t\t\t\tprecision(\"total_commission\")\n\t\t\t\t);\n\n\t\t\t\trefresh_field([\"amount_eligible_for_commission\", \"total_commission\"]);\n\t\t\t}\n\n\t\t\tcalculate_contribution() {\n\t\t\t\tvar me = this;\n\t\t\t\t$.each(this.frm.doc.doctype.sales_team || [], function (i, sales_person) {\n\t\t\t\t\tfrappe.model.round_floats_in(sales_person);\n\t\t\t\t\tif (!sales_person.allocated_percentage) return;\n\n\t\t\t\t\tsales_person.allocated_amount = flt(\n\t\t\t\t\t\t(me.frm.doc.amount_eligible_for_commission * sales_person.allocated_percentage) /\n\t\t\t\t\t\t\t100.0,\n\t\t\t\t\t\tprecision(\"allocated_amount\", sales_person)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcalculate_incentive(row) {\n\t\t\t\tif (row.allocated_amount) {\n\t\t\t\t\trow.incentives = flt(\n\t\t\t\t\t\t(row.allocated_amount * row.commission_rate) / 100.0,\n\t\t\t\t\t\tprecision(\"incentives\", row)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tset_dynamic_labels() {\n\t\t\t\tsuper.set_dynamic_labels();\n\t\t\t\tthis.set_product_bundle_help(this.frm.doc);\n\t\t\t}\n\n\t\t\tset_product_bundle_help(doc) {\n\t\t\t\tif (!this.frm.fields_dict.packing_list) return;\n\t\t\t\tif ((doc.packed_items || []).length) {\n\t\t\t\t\t$(this.frm.fields_dict.packing_list.row.wrapper).toggle(true);\n\n\t\t\t\t\tif ([\"Delivery Note\", \"Sales Invoice\"].includes(doc.doctype)) {\n\t\t\t\t\t\tvar help_msg =\n\t\t\t\t\t\t\t\"<div class='alert alert-warning'>\" +\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\"For 'Product Bundle' items, Warehouse, Serial No and Batch No will be considered from the 'Packing List' table. If Warehouse and Batch No are same for all packing items for any 'Product Bundle' item, those values can be entered in the main Item table, values will be copied to 'Packing List' table.\"\n\t\t\t\t\t\t\t) +\n\t\t\t\t\t\t\t\"</div>\";\n\t\t\t\t\t\tfrappe.meta.get_docfield(doc.doctype, \"product_bundle_help\", doc.name).options =\n\t\t\t\t\t\t\thelp_msg;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$(this.frm.fields_dict.packing_list.row.wrapper).toggle(false);\n\t\t\t\t\tif ([\"Delivery Note\", \"Sales Invoice\"].includes(doc.doctype)) {\n\t\t\t\t\t\tfrappe.meta.get_docfield(doc.doctype, \"product_bundle_help\", doc.name).options = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trefresh_field(\"product_bundle_help\");\n\t\t\t}\n\n\t\t\tcompany_address() {\n\t\t\t\tvar me = this;\n\t\t\t\tif (this.frm.doc.company_address) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\t\t\t\targs: { address_dict: this.frm.doc.company_address },\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(\"company_address_display\", r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.frm.set_value(\"company_address_display\", \"\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\t\t\tsuper.conversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate);\n\t\t\t}\n\n\t\t\tqty(doc, cdt, cdn) {\n\t\t\t\tsuper.qty(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tpick_serial_and_batch(doc, cdt, cdn) {\n\t\t\t\tlet item = locals[cdt][cdn];\n\t\t\t\tlet me = this;\n\n\t\t\t\tfrappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"]).then((r) => {\n\t\t\t\t\tif (r.message && (r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\titem.has_serial_no = r.message.has_serial_no;\n\t\t\t\t\t\titem.has_batch_no = r.message.has_batch_no;\n\t\t\t\t\t\titem.type_of_transaction = item.qty > 0 ? \"Outward\" : \"Inward\";\n\n\t\t\t\t\t\titem.title = item.has_serial_no ? __(\"Select Serial No\") : __(\"Select Batch No\");\n\n\t\t\t\t\t\tif (item.has_serial_no && item.has_batch_no) {\n\t\t\t\t\t\t\titem.title = __(\"Select Serial and Batch\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnew erpnext.SerialBatchPackageSelector(me.frm, item, (r) => {\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tlet qty = Math.abs(r.total_qty);\n\t\t\t\t\t\t\t\tif (doc.is_return) {\n\t\t\t\t\t\t\t\t\tqty = qty * -1;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, {\n\t\t\t\t\t\t\t\t\tserial_and_batch_bundle: r.name,\n\t\t\t\t\t\t\t\t\tuse_serial_batch_fields: 0,\n\t\t\t\t\t\t\t\t\tincoming_rate: r.avg_rate,\n\t\t\t\t\t\t\t\t\tqty:\n\t\t\t\t\t\t\t\t\t\tqty /\n\t\t\t\t\t\t\t\t\t\tflt(\n\t\t\t\t\t\t\t\t\t\t\titem.conversion_factor || 1,\n\t\t\t\t\t\t\t\t\t\t\tprecision(\"conversion_factor\", item)\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tupdate_auto_repeat_reference(doc) {\n\t\t\t\tif (doc.auto_repeat) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.update_reference\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdocname: doc.auto_repeat,\n\t\t\t\t\t\t\treference: doc.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (r.message == \"success\") {\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __(\"Auto repeat document updated\"),\n\t\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __(\"An error occurred during the update process\"),\n\t\t\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tproject() {\n\t\t\t\tlet me = this;\n\t\t\t\tif ([\"Delivery Note\", \"Sales Invoice\", \"Sales Order\"].includes(this.frm.doc.doctype)) {\n\t\t\t\t\tif (this.frm.doc.project) {\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"erpnext.projects.doctype.project.project.get_cost_center_name\",\n\t\t\t\t\t\t\targs: { project: this.frm.doc.project },\n\t\t\t\t\t\t\tcallback: function (r, rt) {\n\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\t\t\t$.each(me.frm.doc[\"items\"] || [], function (i, row) {\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\t\t\t\t\t\trow.doctype,\n\t\t\t\t\t\t\t\t\t\t\t\trow.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\"cost_center\",\n\t\t\t\t\t\t\t\t\t\t\t\tr.message\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t\t\t\t\t\t__(\"Cost Center for Item rows has been updated to {0}\", [\n\t\t\t\t\t\t\t\t\t\t\t\tr.message,\n\t\t\t\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcoupon_code() {\n\t\t\t\tthis.frm.set_value(\"discount_amount\", 0);\n\t\t\t\tthis.frm.set_value(\"additional_discount_percentage\", 0);\n\t\t\t}\n\t\t};\n\t},\n};\n\nerpnext.pre_sales = {\n\tset_as_lost: function (doctype) {\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\tset_as_lost_dialog: function (frm) {\n\t\t\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __(\"Set as Lost\"),\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldtype: \"Table MultiSelect\",\n\t\t\t\t\t\t\tlabel: __(\"Lost Reasons\"),\n\t\t\t\t\t\t\tfieldname: \"lost_reason\",\n\t\t\t\t\t\t\toptions:\n\t\t\t\t\t\t\t\tfrm.doctype === \"Opportunity\"\n\t\t\t\t\t\t\t\t\t? \"Opportunity Lost Reason Detail\"\n\t\t\t\t\t\t\t\t\t: \"Quotation Lost Reason Detail\",\n\t\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldtype: \"Table MultiSelect\",\n\t\t\t\t\t\t\tlabel: __(\"Competitors\"),\n\t\t\t\t\t\t\tfieldname: \"competitors\",\n\t\t\t\t\t\t\toptions: \"Competitor Detail\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\t\t\tlabel: __(\"Detailed Reason\"),\n\t\t\t\t\t\t\tfieldname: \"detailed_reason\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tprimary_action: function () {\n\t\t\t\t\t\tlet values = dialog.get_values();\n\n\t\t\t\t\t\tfrm.call({\n\t\t\t\t\t\t\tdoc: frm.doc,\n\t\t\t\t\t\t\tmethod: \"declare_enquiry_lost\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\tlost_reasons_list: values.lost_reason,\n\t\t\t\t\t\t\t\tcompetitors: values.competitors ? values.competitors : [],\n\t\t\t\t\t\t\t\tdetailed_reason: values.detailed_reason,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tprimary_action_label: __(\"Declare Lost\"),\n\t\t\t\t});\n\n\t\t\t\tdialog.show();\n\t\t\t},\n\t\t});\n\t},\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.buying\");\n// cur_frm.add_fetch('project', 'cost_center', 'cost_center');\n\nerpnext.buying = {\n\tsetup_buying_controller: function() {\n\t\terpnext.buying.BuyingController = class BuyingController extends erpnext.TransactionController {\n\t\t\tsetup() {\n\t\t\t\tsuper.setup();\n\t\t\t\tthis.toggle_enable_for_stock_uom(\"allow_to_edit_stock_uom_qty_for_purchase\");\n\t\t\t\tthis.frm.email_field = \"contact_email\";\n\t\t\t}\n\n\t\t\tonload(doc, cdt, cdn) {\n\t\t\t\tthis.setup_queries(doc, cdt, cdn);\n\t\t\t\tsuper.onload();\n\n\t\t\t\tthis.frm.set_query('shipping_rule', function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\"shipping_rule_type\": \"Buying\"\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tthis.frm.set_query(\"project\", function (doc) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tif (this.frm.doc.__islocal\n\t\t\t\t\t&& frappe.meta.has_field(this.frm.doc.doctype, \"disable_rounded_total\")) {\n\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\");\n\t\t\t\t\t\tvar disable = cint(df.default) || cint(frappe.sys_defaults.disable_rounded_total);\n\t\t\t\t\t\tthis.frm.set_value(\"disable_rounded_total\", disable);\n\t\t\t\t}\n\n\n\t\t\t\t// no idea where me is coming from\n\t\t\t\tif(this.frm.get_field('shipping_address')) {\n\t\t\t\t\tthis.frm.set_query(\"shipping_address\", () => {\n\t\t\t\t\t\tif(this.frm.doc.customer) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\t\t\t\t\tfilters: { link_doctype: 'Customer', link_name: this.frm.doc.customer }\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\treturn erpnext.queries.company_address_query(this.frm.doc)\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(this.frm.get_field('dispatch_address')) {\n\t\t\t\t\tthis.frm.set_query(\"dispatch_address\", () => {\n\t\t\t\t\t\treturn erpnext.queries.address_query(this.frm.doc);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetup_queries(doc, cdt, cdn) {\n\t\t\t\tvar me = this;\n\n\t\t\t\tif(this.frm.fields_dict.buying_price_list) {\n\t\t\t\t\tthis.frm.set_query(\"buying_price_list\", function() {\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tfilters: { 'buying': 1 }\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(this.frm.fields_dict.tc_name) {\n\t\t\t\t\tthis.frm.set_query(\"tc_name\", function() {\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tfilters: { 'buying': 1 }\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tme.frm.set_query('supplier', erpnext.queries.supplier);\n\t\t\t\tme.frm.set_query('contact_person', erpnext.queries.contact_query);\n\t\t\t\tme.frm.set_query('supplier_address', erpnext.queries.address_query);\n\n\t\t\t\tme.frm.set_query('billing_address', erpnext.queries.company_address_query);\n\t\t\t\terpnext.accounts.dimensions.setup_dimension_filters(me.frm, me.frm.doctype);\n\n\t\t\t\tthis.frm.set_query(\"item_code\", \"items\", function() {\n\t\t\t\t\tif (me.frm.doc.is_subcontracted) {\n\t\t\t\t\t\tvar filters = {'supplier': me.frm.doc.supplier};\n\t\t\t\t\t\tif (me.frm.doc.is_old_subcontracting_flow) {\n\t\t\t\t\t\t\tfilters[\"is_sub_contracted_item\"] = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfilters[\"is_stock_item\"] = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\t\t\t\tfilters: filters\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\t\t\t\tfilters: { 'supplier': me.frm.doc.supplier, 'is_purchase_item': 1, 'has_variants': 0}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\n\t\t\t\tthis.frm.set_query(\"manufacturer\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\t\tconst row = locals[cdt][cdn];\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: \"erpnext.controllers.queries.item_manufacturer_query\",\n\t\t\t\t\t\tfilters:{ 'item_code': row.item_code }\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('item_code')) {\n\t\t\t\t\tthis.frm.set_query(\"item_tax_template\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\t\t\treturn me.set_query_for_item_tax_template(doc, cdt, cdn)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trefresh(doc) {\n\t\t\t\tfrappe.dynamic_link = {doc: this.frm.doc, fieldname: 'supplier', doctype: 'Supplier'};\n\n\t\t\t\tthis.frm.toggle_display(\"supplier_name\",\n\t\t\t\t\t(this.frm.doc.supplier_name && this.frm.doc.supplier_name!==this.frm.doc.supplier));\n\n\t\t\t\tif(this.frm.doc.docstatus==0 &&\n\t\t\t\t\t(this.frm.doctype===\"Purchase Order\" || this.frm.doctype===\"Material Request\")) {\n\t\t\t\t\tthis.set_from_product_bundle();\n\t\t\t\t}\n\n\t\t\t\tthis.toggle_subcontracting_fields();\n\t\t\t\tsuper.refresh();\n\t\t\t}\n\n\t\t\ttoggle_subcontracting_fields() {\n\t\t\t\tif (['Purchase Receipt', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\t\t\tthis.frm.fields_dict.supplied_items.grid.update_docfield_property('consumed_qty',\n\t\t\t\t\t\t'read_only', this.frm.doc.__onload && this.frm.doc.__onload.backflush_based_on === 'BOM');\n\n\t\t\t\t\tthis.frm.set_df_property('supplied_items', 'cannot_add_rows', 1);\n\t\t\t\t\tthis.frm.set_df_property('supplied_items', 'cannot_delete_rows', 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsupplier() {\n\t\t\t\tvar me = this;\n\t\t\t\terpnext.utils.get_party_details(this.frm, null, null, function(){\n\t\t\t\t\tme.apply_price_list();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcompany(){\n\t\t\t\tif(!frappe.meta.has_field(this.frm.doc.doctype, \"billing_address\")) return;\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.setup.doctype.company.company.get_billing_shipping_address\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tname: this.frm.doc.company,\n\t\t\t\t\t\tbilling_address:this.frm.doc.billing_address,\n\t\t\t\t\t\tshipping_address: this.frm.doc.shipping_address\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tthis.frm.set_value(\"billing_address\", r.message.primary_address || \"\");\n\n\t\t\t\t\t\tif(!frappe.meta.has_field(this.frm.doc.doctype, \"shipping_address\")) return;\n\t\t\t\t\t\tthis.frm.set_value(\"shipping_address\", r.message.shipping_address || \"\");\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsupplier_address() {\n\t\t\t\terpnext.utils.get_address_display(this.frm);\n\t\t\t\terpnext.utils.set_taxes_from_address(this.frm, \"supplier_address\", \"supplier_address\", \"supplier_address\");\n\t\t\t}\n\n\t\t\tbuying_price_list() {\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t\tdiscount_percentage(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_amount = 0.0;\n\t\t\t\tthis.price_list_rate(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tdiscount_amount(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\tthis.price_list_rate(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tqty(doc, cdt, cdn) {\n\t\t\t\tif ((doc.doctype == \"Purchase Receipt\") || (doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\t\t\t\t\tthis.calculate_received_qty(doc, cdt, cdn)\n\t\t\t\t}\n\t\t\t\tsuper.qty(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\trejected_qty(doc, cdt, cdn) {\n\t\t\t\tthis.calculate_received_qty(doc, cdt, cdn)\n\t\t\t}\n\n\t\t\tcalculate_received_qty(doc, cdt, cdn){\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"rejected_qty\"]);\n\n\t\t\t\tif(!doc.is_return && this.validate_negative_quantity(cdt, cdn, item, [\"qty\", \"rejected_qty\"])){ return }\n\n\t\t\t\tlet received_qty = flt(item.qty + item.rejected_qty, precision(\"received_qty\", item));\n\t\t\t\tlet received_stock_qty = flt(item.conversion_factor, precision(\"conversion_factor\", item)) * flt(received_qty);\n\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"received_qty\", received_qty);\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"received_stock_qty\", received_stock_qty);\n\t\t\t}\n\n\t\t\tbatch_no(doc, cdt, cdn) {\n\t\t\t\tsuper.batch_no(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tvalidate_negative_quantity(cdt, cdn, item, fieldnames){\n\t\t\t\tif(!item || !fieldnames) { return }\n\n\t\t\t\tvar is_negative_qty = false;\n\t\t\t\tfor(var i = 0; i<fieldnames.length; i++) {\n\t\t\t\t\tif(item[fieldnames[i]] < 0){\n\t\t\t\t\t\tfrappe.msgprint(__(\"Row #{0}: {1} can not be negative for item {2}\", [item.idx,__(frappe.meta.get_label(cdt, fieldnames[i], cdn)), item.item_code]));\n\t\t\t\t\t\tis_negative_qty = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn is_negative_qty\n\t\t\t}\n\n\t\t\twarehouse(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(item.item_code && item.warehouse) {\n\t\t\t\t\treturn this.frm.call({\n\t\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_bin_details\",\n\t\t\t\t\t\tchild: item,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\t\tinclude_child_warehouses: true\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tproject(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(item.project) {\n\t\t\t\t\t$.each(this.frm.doc[\"items\"] || [],\n\t\t\t\t\t\tfunction(i, other_item) {\n\t\t\t\t\t\t\tif(!other_item.project) {\n\t\t\t\t\t\t\t\tother_item.project = item.project;\n\t\t\t\t\t\t\t\trefresh_field(\"project\", other_item.name, other_item.parentfield);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trejected_warehouse(doc, cdt) {\n\t\t\t\t// trigger autofill_warehouse only if parent rejected_warehouse field is triggered\n\t\t\t\tif ([\"Purchase Invoice\", \"Purchase Receipt\"].includes(cdt)) {\n\t\t\t\t\tthis.autofill_warehouse(doc.items, \"rejected_warehouse\", doc.rejected_warehouse);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcategory(doc, cdt, cdn) {\n\t\t\t\t// should be the category field of tax table\n\t\t\t\tif(cdt != doc.doctype) {\n\t\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t\t}\n\t\t\t}\n\t\t\tadd_deduct_tax(doc, cdt, cdn) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tset_from_product_bundle() {\n\t\t\t\tvar me = this;\n\t\t\t\tthis.frm.add_custom_button(__(\"Product Bundle\"), function() {\n\t\t\t\t\terpnext.buying.get_items_from_product_bundle(me.frm);\n\t\t\t\t}, __(\"Get Items From\"));\n\t\t\t}\n\n\t\t\tshipping_address(){\n\t\t\t\tvar me = this;\n\t\t\t\terpnext.utils.get_address_display(this.frm, \"shipping_address\",\n\t\t\t\t\t\"shipping_address_display\", true);\n\t\t\t}\n\n\t\t\tdispatch_address(){\n\t\t\t\tvar me = this;\n\t\t\t\terpnext.utils.get_address_display(this.frm, \"dispatch_address\",\n\t\t\t\t\t\"dispatch_address_display\", true);\n\t\t\t}\n\n\t\t\tbilling_address() {\n\t\t\t\terpnext.utils.get_address_display(this.frm, \"billing_address\",\n\t\t\t\t\t\"billing_address_display\", true);\n\t\t\t}\n\n\t\t\ttc_name() {\n\t\t\t\tthis.get_terms();\n\t\t\t}\n\n\t\t\tupdate_auto_repeat_reference(doc) {\n\t\t\t\tif (doc.auto_repeat) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"frappe.automation.doctype.auto_repeat.auto_repeat.update_reference\",\n\t\t\t\t\t\targs:{\n\t\t\t\t\t\t\tdocname: doc.auto_repeat,\n\t\t\t\t\t\t\treference:doc.name\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r){\n\t\t\t\t\t\t\tif (r.message==\"success\") {\n\t\t\t\t\t\t\t\tfrappe.show_alert({message:__(\"Auto repeat document updated\"), indicator:'green'});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.show_alert({message:__(\"An error occurred during the update process\"), indicator:'red'});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmanufacturer(doc, cdt, cdn) {\n\t\t\t\tconst row = locals[cdt][cdn];\n\n\t\t\t\tif(row.manufacturer) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.stock.doctype.item_manufacturer.item_manufacturer.get_item_manufacturer_part_no\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t'item_code': row.item_code,\n\t\t\t\t\t\t\t'manufacturer': row.manufacturer\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'manufacturer_part_no', r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmanufacturer_part_no(doc, cdt, cdn) {\n\t\t\t\tconst row = locals[cdt][cdn];\n\n\t\t\t\tif (row.manufacturer_part_no) {\n\t\t\t\t\tfrappe.model.get_value('Item Manufacturer',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'item_code': row.item_code,\n\t\t\t\t\t\t\t'manufacturer': row.manufacturer,\n\t\t\t\t\t\t\t'manufacturer_part_no': row.manufacturer_part_no\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'name',\n\t\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\t\tif (!data) {\n\t\t\t\t\t\t\t\tlet msg = {\n\t\t\t\t\t\t\t\t\tmessage: __(\"Manufacturer Part Number <b>{0}</b> is invalid\", [row.manufacturer_part_no]),\n\t\t\t\t\t\t\t\t\ttitle: __(\"Invalid Part Number\")\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrappe.throw(msg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tadd_serial_batch_bundle(doc, cdt, cdn) {\n\t\t\t\tlet item = locals[cdt][cdn];\n\t\t\t\tlet me = this;\n\t\t\t\tlet fields = [\"has_batch_no\", \"has_serial_no\"];\n\n\t\t\t\tfrappe.db.get_value(\"Item\", item.item_code, fields)\n\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\tif (r.message && (r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\tfields.forEach((field) => {\n\t\t\t\t\t\t\t\titem[field] = r.message[field];\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\titem.type_of_transaction = item.qty > 0 ? \"Inward\" : \"Outward\";\n\t\t\t\t\t\t\titem.is_rejected = false;\n\n\t\t\t\t\t\t\tnew erpnext.SerialBatchPackageSelector(\n\t\t\t\t\t\t\t\tme.frm, item, (r) => {\n\t\t\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\t\t\tlet qty = Math.abs(r.total_qty);\n\t\t\t\t\t\t\t\t\t\tif (doc.is_return) {\n\t\t\t\t\t\t\t\t\t\t\tqty = qty * -1;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tlet update_values = {\n\t\t\t\t\t\t\t\t\t\t\t\"serial_and_batch_bundle\": r.name,\n\t\t\t\t\t\t\t\t\t\t\t\"use_serial_batch_fields\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\"qty\": qty / flt(item.conversion_factor || 1, precision(\"conversion_factor\", item))\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (r.warehouse) {\n\t\t\t\t\t\t\t\t\t\t\tupdate_values[\"warehouse\"] = r.warehouse;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, update_values);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tadd_serial_batch_for_rejected_qty(doc, cdt, cdn) {\n\t\t\t\tlet item = locals[cdt][cdn];\n\t\t\t\tlet me = this;\n\t\t\t\tlet fields = [\"has_batch_no\", \"has_serial_no\"];\n\n\t\t\t\tfrappe.db.get_value(\"Item\", item.item_code, fields)\n\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\tif (r.message && (r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\tfields.forEach((field) => {\n\t\t\t\t\t\t\t\titem[field] = r.message[field];\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\titem.type_of_transaction = !doc.is_return > 0 ? \"Inward\" : \"Outward\";\n\t\t\t\t\t\t\titem.is_rejected = true;\n\n\t\t\t\t\t\t\tnew erpnext.SerialBatchPackageSelector(\n\t\t\t\t\t\t\t\tme.frm, item, (r) => {\n\t\t\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\t\t\tlet qty = Math.abs(r.total_qty);\n\t\t\t\t\t\t\t\t\t\tif (doc.is_return) {\n\t\t\t\t\t\t\t\t\t\t\tqty = qty * -1;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tlet update_values = {\n\t\t\t\t\t\t\t\t\t\t\t\"rejected_serial_and_batch_bundle\": r.name,\n\t\t\t\t\t\t\t\t\t\t\t\"use_serial_batch_fields\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\"rejected_qty\": qty / flt(item.conversion_factor || 1, precision(\"conversion_factor\", item))\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (r.warehouse) {\n\t\t\t\t\t\t\t\t\t\t\tupdate_values[\"rejected_warehouse\"] = r.warehouse;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, update_values);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n}\n\nerpnext.buying.link_to_mrs = function(frm) {\n\tfrappe.call({\n\t\tmethod: \"erpnext.buying.utils.get_linked_material_requests\",\n\t\targs:{\n\t\t\titems: frm.doc.items.map((item) => item.item_code)\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.message || r.message.length == 0) {\n\t\t\t\tfrappe.throw({\n\t\t\t\t\tmessage: __(\"No pending Material Requests found to link for the given items.\"),\n\t\t\t\t\ttitle: __(\"Note\")\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar item_length = frm.doc.items.length;\n\t\t\tfor (let item of frm.doc.items) {\n\t\t\t\tvar qty = item.qty;\n\t\t\t\t(r.message[0] || []).forEach(function(d) {\n\t\t\t\t\tif (d.qty > 0 && qty > 0 && item.item_code == d.item_code && !item.material_request_item)\n\t\t\t\t\t{\n\t\t\t\t\t\titem.material_request = d.mr_name;\n\t\t\t\t\t\titem.material_request_item = d.mr_item;\n\t\t\t\t\t\tvar my_qty = Math.min(qty, d.qty);\n\t\t\t\t\t\tqty = qty - my_qty;\n\t\t\t\t\t\td.qty = d.qty - my_qty;\n\t\t\t\t\t\titem.stock_qty = my_qty*item.conversion_factor;\n\t\t\t\t\t\titem.qty = my_qty;\n\n\t\t\t\t\t\tfrappe.msgprint(\"Assigning \" + d.mr_name + \" to \" + d.item_code + \" (row \" + item.idx + \")\");\n\t\t\t\t\t\tif (qty > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfrappe.msgprint(\"Splitting \" + qty + \" units of \" + d.item_code);\n\t\t\t\t\t\t\tvar newrow = frappe.model.add_child(frm.doc, item.doctype, \"items\");\n\t\t\t\t\t\t\titem_length++;\n\n\t\t\t\t\t\t\tfor (var key in item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnewrow[key] = item[key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnewrow.idx = item_length;\n\t\t\t\t\t\t\tnewrow[\"stock_qty\"] = newrow.conversion_factor*qty;\n\t\t\t\t\t\t\tnewrow[\"qty\"] = qty;\n\n\t\t\t\t\t\t\tnewrow[\"material_request\"] = \"\";\n\t\t\t\t\t\t\tnewrow[\"material_request_item\"] = \"\";\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\trefresh_field(\"items\");\n\t\t}\n\t});\n}\n\nerpnext.buying.get_default_bom = function(frm) {\n\t$.each(frm.doc[\"items\"] || [], function(i, d) {\n\t\tif (d.item_code && d.bom === \"\") {\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"GET\",\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_default_bom\",\n\t\t\t\targs: {\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r) {\n\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"bom\", r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t});\n}\n\nerpnext.buying.get_items_from_product_bundle = function(frm) {\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Get Items from Product Bundle\"),\n\t\tfields: [\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\"label\": __(\"Product Bundle\"),\n\t\t\t\t\"fieldname\": \"product_bundle\",\n\t\t\t\t\"options\":\"Product Bundle\",\n\t\t\t\t\"reqd\": 1\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Currency\",\n\t\t\t\t\"label\": __(\"Quantity\"),\n\t\t\t\t\"fieldname\": \"quantity\",\n\t\t\t\t\"reqd\": 1,\n\t\t\t\t\"default\": 1\n\t\t\t}\n\t\t],\n\t\tprimary_action_label: 'Get Items',\n\t\tprimary_action(args){\n\t\t\tif(!args) return;\n\t\t\tdialog.hide();\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"GET\",\n\t\t\t\tmethod: \"erpnext.stock.doctype.packed_item.packed_item.get_items_from_product_bundle\",\n\t\t\t\targs: {\n\t\t\t\t\trow: {\n\t\t\t\t\t\titem_code: args.product_bundle,\n\t\t\t\t\t\tquantity: args.quantity,\n\t\t\t\t\t\tparenttype: frm.doc.doctype,\n\t\t\t\t\t\tparent: frm.doc.name,\n\t\t\t\t\t\tsupplier: frm.doc.supplier,\n\t\t\t\t\t\tcurrency: frm.doc.currency,\n\t\t\t\t\t\tconversion_rate: frm.doc.conversion_rate,\n\t\t\t\t\t\tprice_list: frm.doc.buying_price_list,\n\t\t\t\t\t\tprice_list_currency: frm.doc.price_list_currency,\n\t\t\t\t\t\tplc_conversion_rate: frm.doc.plc_conversion_rate,\n\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\tis_subcontracted: frm.doc.is_subcontracted,\n\t\t\t\t\t\ttransaction_date: frm.doc.transaction_date || frm.doc.posting_date,\n\t\t\t\t\t\tignore_pricing_rule: frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\tdoctype: frm.doc.doctype\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tconst first_row_is_empty = function(child_table){\n\t\t\t\t\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\t\t\t\t\treturn !child_table[0].item_code;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\n\t\t\t\t\tconst remove_empty_first_row = function(frm){\n\t\t\t\t\tif (first_row_is_empty(frm.doc.items)){\n\t\t\t\t\t\tfrm.doc.items = frm.doc.items.splice(1);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tremove_empty_first_row(frm);\n\t\t\t\t\t\tfor (var i=0; i< r.message.length; i++) {\n\t\t\t\t\t\t\tvar d = frm.add_child(\"items\");\n\t\t\t\t\t\t\tvar item = r.message[i];\n\t\t\t\t\t\t\tfor (var key in  item) {\n\t\t\t\t\t\t\t\tif (!is_null(item[key]) && key !== \"doctype\") {\n\t\t\t\t\t\t\t\t\td[key] = item[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(frappe.meta.get_docfield(d.doctype, \"price_list_rate\", d.name)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(\"price_list_rate\", d.doctype, d.name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrm.refresh_field(\"items\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t});\n\n\tdialog.show();\n}\n", "frappe.provide(\"erpnext.demo\");\n\n$(document).on(\"toolbar_setup\", function () {\n\tif (frappe.boot.sysdefaults.demo_company) {\n\t\trender_clear_demo_action();\n\t}\n});\n\nfunction render_clear_demo_action() {\n\tlet demo_action = $(\n\t\t`<a class=\"dropdown-item\" onclick=\"return erpnext.demo.clear_demo()\">\n\t\t\t${__(\"Clear Demo Data\")}\n\t\t</a>`\n\t);\n\n\tdemo_action.appendTo($(\"#toolbar-user\"));\n}\n\nerpnext.demo.clear_demo = function () {\n\tfrappe.confirm(__(\"Are you sure you want to clear all demo data?\"), () => {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.setup.demo.clear_demo_data\",\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __(\"Clearing Demo Data...\"),\n\t\t\tcallback: function (r) {\n\t\t\t\tfrappe.ui.toolbar.clear_cache();\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Demo data cleared\"),\n\t\t\t\t\tindicator: \"green\",\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t});\n};\n", "frappe.provide(\"erpnext.financial_statements\");\n\nerpnext.financial_statements = {\n\tfilters: get_filters(),\n\tbaseData: null,\n\tformatter: function (value, row, column, data, default_formatter, filter) {\n\t\tif (\n\t\t\tfrappe.query_report.get_filter_value(\"selected_view\") == \"Growth\" &&\n\t\t\tdata &&\n\t\t\tcolumn.colIndex >= 3\n\t\t) {\n\t\t\tconst growthPercent = data[column.fieldname];\n\n\t\t\tif (growthPercent == undefined) return \"NA\"; //making this not applicable for undefined/null values\n\n\t\t\tif (column.fieldname === \"total\") {\n\t\t\t\tvalue = $(`<span>${growthPercent}</span>`);\n\t\t\t} else {\n\t\t\t\tvalue = $(`<span>${(growthPercent >= 0 ? \"+\" : \"\") + growthPercent + \"%\"}</span>`);\n\n\t\t\t\tif (growthPercent < 0) {\n\t\t\t\t\tvalue = $(value).addClass(\"text-danger\");\n\t\t\t\t} else {\n\t\t\t\t\tvalue = $(value).addClass(\"text-success\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tvalue = $(value).wrap(\"<p></p>\").parent().html();\n\n\t\t\treturn value;\n\t\t} else if (frappe.query_report.get_filter_value(\"selected_view\") == \"Margin\" && data) {\n\t\t\tif (column.colIndex >= 2) {\n\t\t\t\tconst marginPercent = data[column.fieldname];\n\n\t\t\t\tif (marginPercent == undefined) return \"NA\"; //making this not applicable for undefined/null values\n\n\t\t\t\tvalue = $(`<span>${marginPercent + \"%\"}</span>`);\n\t\t\t\tif (marginPercent < 0) value = $(value).addClass(\"text-danger\");\n\t\t\t\telse value = $(value).addClass(\"text-success\");\n\t\t\t\tvalue = $(value).wrap(\"<p></p>\").parent().html();\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\tif (data && column.fieldname == \"account\") {\n\t\t\t// first column\n\t\t\tvalue = data.section_name || data.account_name || value;\n\n\t\t\tif (filter && filter?.text && filter?.type == \"contains\") {\n\t\t\t\tif (!value.toLowerCase().includes(filter.text)) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (data.account || data.accounts) {\n\t\t\t\tcolumn.link_onclick =\n\t\t\t\t\t\"erpnext.financial_statements.open_general_ledger(\" + JSON.stringify(data) + \")\";\n\t\t\t}\n\t\t\tcolumn.is_tree = true;\n\t\t}\n\n\t\tvalue = default_formatter(value, row, column, data);\n\n\t\tif (data && !data.parent_account && !data.parent_section) {\n\t\t\tvalue = $(`<span>${value}</span>`);\n\n\t\t\tvar $value = $(value).css(\"font-weight\", \"bold\");\n\t\t\tif (data.warn_if_negative && data[column.fieldname] < 0) {\n\t\t\t\t$value.addClass(\"text-danger\");\n\t\t\t}\n\n\t\t\tvalue = $value.wrap(\"<p></p>\").parent().html();\n\t\t}\n\n\t\treturn value;\n\t},\n\topen_general_ledger: function (data) {\n\t\tif (!data.account && !data.accounts) return;\n\t\tlet project = $.grep(frappe.query_report.filters, function (e) {\n\t\t\treturn e.df.fieldname == \"project\";\n\t\t});\n\n\t\tfrappe.route_options = {\n\t\t\taccount: data.account || data.accounts,\n\t\t\tcompany: frappe.query_report.get_filter_value(\"company\"),\n\t\t\tfrom_date: data.from_date || data.year_start_date,\n\t\t\tto_date: data.to_date || data.year_end_date,\n\t\t\tproject: project && project.length > 0 ? project[0].$input.val() : \"\",\n\t\t};\n\n\t\tlet report = \"General Ledger\";\n\n\t\tif ([\"Payable\", \"Receivable\"].includes(data.account_type)) {\n\t\t\treport = data.account_type == \"Payable\" ? \"Accounts Payable\" : \"Accounts Receivable\";\n\t\t\tfrappe.route_options[\"party_account\"] = data.account;\n\t\t\tfrappe.route_options[\"report_date\"] = data.year_end_date;\n\t\t}\n\n\t\tfrappe.set_route(\"query-report\", report);\n\t},\n\ttree: true,\n\tname_field: \"account\",\n\tparent_field: \"parent_account\",\n\tinitial_depth: 3,\n\tonload: function (report) {\n\t\t// dropdown for links to other financial statements\n\t\terpnext.financial_statements.filters = get_filters();\n\n\t\tlet fiscal_year = erpnext.utils.get_fiscal_year(frappe.datetime.get_today());\n\t\tvar filters = report.get_values();\n\n\t\tif (!filters.period_start_date || !filters.period_end_date) {\n\t\t\tfrappe.model.with_doc(\"Fiscal Year\", fiscal_year, function (r) {\n\t\t\t\tvar fy = frappe.model.get_doc(\"Fiscal Year\", fiscal_year);\n\t\t\t\tfrappe.query_report.set_filter_value({\n\t\t\t\t\tperiod_start_date: fy.year_start_date,\n\t\t\t\t\tperiod_end_date: fy.year_end_date,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (report.page) {\n\t\t\tconst views_menu = report.page.add_custom_button_group(__(\"Financial Statements\"));\n\n\t\t\treport.page.add_custom_menu_item(views_menu, __(\"Balance Sheet\"), function () {\n\t\t\t\tvar filters = report.get_values();\n\t\t\t\tfrappe.set_route(\"query-report\", \"Balance Sheet\", { company: filters.company });\n\t\t\t});\n\n\t\t\treport.page.add_custom_menu_item(views_menu, __(\"Profit and Loss\"), function () {\n\t\t\t\tvar filters = report.get_values();\n\t\t\t\tfrappe.set_route(\"query-report\", \"Profit and Loss Statement\", { company: filters.company });\n\t\t\t});\n\n\t\t\treport.page.add_custom_menu_item(views_menu, __(\"Cash Flow Statement\"), function () {\n\t\t\t\tvar filters = report.get_values();\n\t\t\t\tfrappe.set_route(\"query-report\", \"Cash Flow\", { company: filters.company });\n\t\t\t});\n\t\t}\n\t},\n};\n\nfunction get_filters() {\n\tlet filters = [\n\t\t{\n\t\t\tfieldname: \"company\",\n\t\t\tlabel: __(\"Company\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Company\",\n\t\t\tdefault: frappe.defaults.get_user_default(\"Company\"),\n\t\t\treqd: 1,\n\t\t},\n\t\t{\n\t\t\tfieldname: \"finance_book\",\n\t\t\tlabel: __(\"Finance Book\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Finance Book\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"filter_based_on\",\n\t\t\tlabel: __(\"Filter Based On\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\"Fiscal Year\", \"Date Range\"],\n\t\t\tdefault: [\"Fiscal Year\"],\n\t\t\treqd: 1,\n\t\t\ton_change: function () {\n\t\t\t\tlet filter_based_on = frappe.query_report.get_filter_value(\"filter_based_on\");\n\t\t\t\tfrappe.query_report.toggle_filter_display(\n\t\t\t\t\t\"from_fiscal_year\",\n\t\t\t\t\tfilter_based_on === \"Date Range\"\n\t\t\t\t);\n\t\t\t\tfrappe.query_report.toggle_filter_display(\"to_fiscal_year\", filter_based_on === \"Date Range\");\n\t\t\t\tfrappe.query_report.toggle_filter_display(\n\t\t\t\t\t\"period_start_date\",\n\t\t\t\t\tfilter_based_on === \"Fiscal Year\"\n\t\t\t\t);\n\t\t\t\tfrappe.query_report.toggle_filter_display(\n\t\t\t\t\t\"period_end_date\",\n\t\t\t\t\tfilter_based_on === \"Fiscal Year\"\n\t\t\t\t);\n\n\t\t\t\tfrappe.query_report.refresh();\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tfieldname: \"period_start_date\",\n\t\t\tlabel: __(\"Start Date\"),\n\t\t\tfieldtype: \"Date\",\n\t\t\tdepends_on: \"eval:doc.filter_based_on == 'Date Range'\",\n\t\t\tmandatory_depends_on: \"eval:doc.filter_based_on == 'Date Range'\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"period_end_date\",\n\t\t\tlabel: __(\"End Date\"),\n\t\t\tfieldtype: \"Date\",\n\t\t\tdepends_on: \"eval:doc.filter_based_on == 'Date Range'\",\n\t\t\tmandatory_depends_on: \"eval:doc.filter_based_on == 'Date Range'\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"from_fiscal_year\",\n\t\t\tlabel: __(\"Start Year\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Fiscal Year\",\n\t\t\treqd: 1,\n\t\t\tdepends_on: \"eval:doc.filter_based_on == 'Fiscal Year'\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"to_fiscal_year\",\n\t\t\tlabel: __(\"End Year\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Fiscal Year\",\n\t\t\treqd: 1,\n\t\t\tdepends_on: \"eval:doc.filter_based_on == 'Fiscal Year'\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"periodicity\",\n\t\t\tlabel: __(\"Periodicity\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\n\t\t\t\t{ value: \"Monthly\", label: __(\"Monthly\") },\n\t\t\t\t{ value: \"Quarterly\", label: __(\"Quarterly\") },\n\t\t\t\t{ value: \"Half-Yearly\", label: __(\"Half-Yearly\") },\n\t\t\t\t{ value: \"Yearly\", label: __(\"Yearly\") },\n\t\t\t],\n\t\t\tdefault: \"Yearly\",\n\t\t\treqd: 1,\n\t\t},\n\t\t// Note:\n\t\t// If you are modifying this array such that the presentation_currency object\n\t\t// is no longer the last object, please make adjustments in cash_flow.js\n\t\t// accordingly.\n\t\t{\n\t\t\tfieldname: \"presentation_currency\",\n\t\t\tlabel: __(\"Currency\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: erpnext.get_presentation_currency_list(),\n\t\t},\n\t\t{\n\t\t\tfieldname: \"cost_center\",\n\t\t\tlabel: __(\"Cost Center\"),\n\t\t\tfieldtype: \"MultiSelectList\",\n\t\t\tget_data: function (txt) {\n\t\t\t\treturn frappe.db.get_link_options(\"Cost Center\", txt, {\n\t\t\t\t\tcompany: frappe.query_report.get_filter_value(\"company\"),\n\t\t\t\t});\n\t\t\t},\n\t\t\toptions: \"Cost Center\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"project\",\n\t\t\tlabel: __(\"Project\"),\n\t\t\tfieldtype: \"MultiSelectList\",\n\t\t\tget_data: function (txt) {\n\t\t\t\treturn frappe.db.get_link_options(\"Project\", txt, {\n\t\t\t\t\tcompany: frappe.query_report.get_filter_value(\"company\"),\n\t\t\t\t});\n\t\t\t},\n\t\t\toptions: \"Project\",\n\t\t},\n\t];\n\n\t// Dynamically set 'default' values for fiscal year filters\n\tlet fy_filters = filters.filter((x) => {\n\t\treturn [\"from_fiscal_year\", \"to_fiscal_year\"].includes(x.fieldname);\n\t});\n\tlet fiscal_year = erpnext.utils.get_fiscal_year(frappe.datetime.get_today(), false, false);\n\tif (fiscal_year) {\n\t\tfy_filters.forEach((x) => {\n\t\t\tx.default = fiscal_year;\n\t\t});\n\t}\n\n\treturn filters;\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.sales_trends_filters = {\n\tfilters: [\n\t\t{\n\t\t\tfieldname: \"period\",\n\t\t\tlabel: __(\"Period\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\n\t\t\t\t{ value: \"Monthly\", label: __(\"Monthly\") },\n\t\t\t\t{ value: \"Quarterly\", label: __(\"Quarterly\") },\n\t\t\t\t{ value: \"Half-Yearly\", label: __(\"Half-Yearly\") },\n\t\t\t\t{ value: \"Yearly\", label: __(\"Yearly\") },\n\t\t\t],\n\t\t\tdefault: \"Monthly\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"based_on\",\n\t\t\tlabel: __(\"Based On\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\n\t\t\t\t{ value: \"Item\", label: __(\"Item\") },\n\t\t\t\t{ value: \"Item Group\", label: __(\"Item Group\") },\n\t\t\t\t{ value: \"Customer\", label: __(\"Customer\") },\n\t\t\t\t{ value: \"Customer Group\", label: __(\"Customer Group\") },\n\t\t\t\t{ value: \"Territory\", label: __(\"Territory\") },\n\t\t\t\t{ value: \"Project\", label: __(\"Project\") },\n\t\t\t],\n\t\t\tdefault: \"Item\",\n\t\t\tdashboard_config: {\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tfieldname: \"group_by\",\n\t\t\tlabel: __(\"Group By\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\"\", { value: \"Item\", label: __(\"Item\") }, { value: \"Customer\", label: __(\"Customer\") }],\n\t\t\tdefault: \"\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"fiscal_year\",\n\t\t\tlabel: __(\"Fiscal Year\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Fiscal Year\",\n\t\t\tdefault: erpnext.utils.get_fiscal_year(frappe.datetime.get_today()),\n\t\t},\n\t\t{\n\t\t\tfieldname: \"company\",\n\t\t\tlabel: __(\"Company\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Company\",\n\t\t\tdefault: frappe.defaults.get_user_default(\"Company\"),\n\t\t},\n\t],\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.purchase_trends_filters = {\n\tfilters: [\n\t\t{\n\t\t\tfieldname: \"company\",\n\t\t\tlabel: __(\"Company\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Company\",\n\t\t\treqd: 1,\n\t\t\tdefault: frappe.defaults.get_user_default(\"Company\"),\n\t\t},\n\t\t{\n\t\t\tfieldname: \"period\",\n\t\t\tlabel: __(\"Period\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\n\t\t\t\t{ value: \"Monthly\", label: __(\"Monthly\") },\n\t\t\t\t{ value: \"Quarterly\", label: __(\"Quarterly\") },\n\t\t\t\t{ value: \"Half-Yearly\", label: __(\"Half-Yearly\") },\n\t\t\t\t{ value: \"Yearly\", label: __(\"Yearly\") },\n\t\t\t],\n\t\t\tdefault: \"Monthly\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"fiscal_year\",\n\t\t\tlabel: __(\"Fiscal Year\"),\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Fiscal Year\",\n\t\t\tdefault: erpnext.utils.get_fiscal_year(frappe.datetime.get_today()),\n\t\t},\n\t\t{\n\t\t\tfieldname: \"period_based_on\",\n\t\t\tlabel: __(\"Period based On\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\n\t\t\t\t{ value: \"posting_date\", label: __(\"Posting Date\") },\n\t\t\t\t{ value: \"bill_date\", label: __(\"Billing Date\") },\n\t\t\t],\n\t\t\tdefault: \"posting_date\",\n\t\t},\n\t\t{\n\t\t\tfieldname: \"based_on\",\n\t\t\tlabel: __(\"Based On\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\n\t\t\t\t{ value: \"Item\", label: __(\"Item\") },\n\t\t\t\t{ value: \"Item Group\", label: __(\"Item Group\") },\n\t\t\t\t{ value: \"Supplier\", label: __(\"Supplier\") },\n\t\t\t\t{ value: \"Supplier Group\", label: __(\"Supplier Group\") },\n\t\t\t\t{ value: \"Project\", label: __(\"Project\") },\n\t\t\t],\n\t\t\tdefault: \"Item\",\n\t\t\tdashboard_config: {\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tfieldname: \"group_by\",\n\t\t\tlabel: __(\"Group By\"),\n\t\t\tfieldtype: \"Select\",\n\t\t\toptions: [\"\", { value: \"Item\", label: __(\"Item\") }, { value: \"Supplier\", label: __(\"Supplier\") }],\n\t\t\tdefault: \"\",\n\t\t},\n\t],\n};\n"],
  "mappings": "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",
  "names": ["company", "_a", "currency_list", "d", "frm", "companies", "company_local", "args", "journal_entry", "je_account", "child_row", "company_wise_info", "info", "bundle_ids", "color", "indicator", "party_type", "dict", "doc", "dt", "dn", "table_fieldname", "fieldname", "cl", "i", "tc_name", "callback", "r", "doctype", "docname", "doclist", "report_name", "index", "filters", "dimension", "el", "txt", "existing_filter", "child_table", "child_table_name", "rows", "option", "unscrub_option", "user_permission", "options", "perm", "c", "value", "self", "parent_fieldname", "update_fields", "new_doc", "key", "marketplace_link", "github_link", "msg", "cdt", "cdn", "type_of_transaction", "warehouse_field", "item_row", "update_values", "date", "with_dates", "raise_on_missing", "fiscal_year", "opts", "item_field", "dialog", "item_code", "warehouse", "e", "row", "qty", "cannot_add_row", "child_docname", "child_meta", "has_reserved_stock", "get_precision", "f", "fields", "me", "rate", "uom", "conversion_factor", "item_name", "bom_no", "trans_items", "item", "_map", "items_doctype", "link_fieldname", "already_set", "item_qty_map", "src", "source_doc", "query_args", "data_fields", "selections", "values", "df", "add_link_title", "title_field", "_i", "data", "statuses", "hold_statuses", "entry", "message", "set_time_to_resolve_and_response", "agreement_status", "apply_sla_for_resolution", "time_to_respond", "get_status", "get_time_left", "alert", "time_to_resolve", "timestamp", "diff", "diff_display", "expected", "actual", "frm", "child_row", "callback", "range_string", "separator", "start_str", "end_str", "end_int", "length_difference", "start_int", "x", "y", "val", "frm", "table_name", "parms", "params", "fields", "qty_field", "dialog", "table_fields", "event", "name", "item_row", "item", "field", "dispatch_qty_field", "unreserved_qty", "args", "data", "r", "sre_entries", "sre", "_a", "voucher_type", "voucher_no", "to_date", "e", "from_date", "filters", "args", "doc", "is_drop_ship", "item", "child_fields", "dimension", "company", "account", "field", "frm", "options", "query_fn", "me", "set_query", "doctype", "parentfield", "link_fields", "i", "df", "cdt", "cdn", "row", "doc", "me", "default_msg", "contact", "ref_doctype", "ref_name", "r", "mobile_nos", "message", "d", "btn", "v", "SALES_DOCTYPES", "PURCHASE_DOCTYPES", "frm", "method", "args", "callback", "party_type", "r", "prev_route", "item", "address_field", "display_field", "is_your_company_address", "triggered_from_field", "billing_address_field", "shipping_address_field", "party", "label", "value", "trigger_on", "doc", "cdt", "cdn", "row", "r", "me", "frm", "frm", "item", "callback", "_a", "_b", "_c", "_d", "_e", "label", "primary_label", "qty", "serial_nos", "serial_no", "warehouse", "fields", "me", "serial_no_range", "upload_serial_nos", "r", "csvFileData", "method", "file_path", "batch_no", "batch_fields", "doc", "is_inward", "include_expired_batches", "based_on", "scan_serial_no", "scan_batch_no", "existing_row", "d", "entries", "bundle_id", "_new", "data", "me", "index", "data", "multimode_payments", "selected_row", "e", "write_off_amount", "change_amount", "update_write_off", "value", "VisualPlantFloor", "wrapper", "skip_filters", "plant_floor", "page", "r", "template", "data", "workstation_card$", "workstation_image", "item", "effective_item_rate", "item_rate", "update_paid_amount", "is_quotation", "conversion_rate_label", "company_currency", "subs", "err_message", "me", "qty", "doc", "fields", "f", "i", "tax", "tax_fields", "fieldname", "r", "has_inclusive_tax", "row", "n", "item_tax_map", "cumulated_tax_fraction", "total_inclusive_tax_amount_per_qty", "current_tax_fraction", "inclusive_tax_amount_per_qty", "amount", "tax_rate", "rate", "d", "child", "_a", "actual_tax_dict", "current_tax_amount", "discount_amount_applied", "tax_amount_precision", "row_idx", "tax_amount", "item_tax_rate", "current_net_amount", "actual", "tax_detail", "key", "item_wise_tax_amount", "item_wise_net_amount", "any_inclusive_tax", "last_tax", "non_inclusive_tax_amount", "diff", "tax_count", "grand_total_diff", "disable_rounded_total", "items", "temporary_fields", "distributed_amount", "total_for_discount_amount", "net_total", "expected_net_total", "adjusted_net_amount", "rounding_difference", "total_actual_tax", "actual_taxes_dict", "update_actual_taxes_dict", "base_row", "base_tax_amount", "total_allocated_amount", "adv", "grand_total", "base_grand_total", "total_amount_to_pay", "total_amount_for_payment", "paid_amount", "payment_amount", "payment", "return_against_mop", "payment_status", "index", "data", "base_amount", "base_paid_amount", "payment_types", "me", "frm", "cdt", "cdn", "item", "has_margin_field", "total", "discount_amount", "_a", "doc", "row", "filters", "field", "r", "value", "currency", "set_value", "fieldname", "show_qc_button", "inspection_type", "quality_inspection_field", "d", "payment_request_type", "batch_no_field", "sbb_field", "table", "taxes_and_charges_field", "blacklist", "sms_man", "update_stock", "show_batch_dialog", "k", "v", "key", "company_currency", "posting_date", "posting_time", "voucher_type", "company", "item_args", "frm_obj", "valid_serial_nos", "serialnos", "i", "set_pricing", "get_party_currency", "set_terms", "set_letter_head", "party_type", "party_name", "set_currency", "party_default_currency", "company_doc", "selling_doctypes", "company_terms_fieldname", "set_party_account", "party_account_field", "party", "rt", "_b", "to_clear", "term", "transaction_date", "inter_company_reference", "exchange_rate", "from_currency", "to_currency", "callback", "args", "dont_fetch_price_list_rate", "mappped_fields", "first_row", "mapped_rows", "child", "start_date", "end_date", "stop_date", "show", "item_grid", "fname", "schedule_grid", "params", "item_list", "row_item", "removed_pricing_rule", "calculate_taxes_and_totals", "append_item", "children", "items_rule_dict", "existing_pricing_rule", "fields", "data", "items", "exist_items", "pr_row", "row_to_modify", "e_row", "reset_plc_conversion", "row_name", "applied_on_items", "f", "child_row", "valid", "tax", "item_codes", "item_rates", "item_tax_templates", "owner_email", "recurring_type_map", "months", "to_date", "rate", "via_journal_entry", "doclist", "values", "is_eligible", "has_payment_schedule", "dialog", "dialog_items", "method", "child_table", "warehouse_field", "warehouse", "doctype", "_ignore_pricing_rule", "item_row", "on_close", "show_dialog", "receiving_stock", "existing_stock", "update_values", "purpose", "result", "opts", "me", "body", "item_code", "added", "d", "args", "results", "docsUrl", "doctype", "after_insert", "init_callback", "doc", "force", "fieldname", "new_fieldname", "variant_fields", "CallPopup", "call_log", "color", "blink", "classes", "call_status", "title", "missed", "contact_link", "d", "call_summary", "call_type", "new_customer", "new_contact", "phone_no", "call_popup", "frm", "doctype", "me", "r", "x", "dimension", "parent_fields", "df", "parentfield", "fields", "doc", "cdt", "cdn", "row", "_a", "_b", "default_dimension", "fieldname", "frm", "me", "response", "label", "fieldname", "columns", "data", "dialog", "wrapper", "datatable_options", "frm", "r", "selections", "selection_map", "elem", "child_table_fields", "unreconcile_dialog_fields", "d", "values", "selected_allocations", "x", "opts", "resolve", "reject", "me", "input", "r", "data", "row", "callback", "cur_grid", "item_code", "barcode", "batch_no", "serial_no", "uom", "qty", "has_batch_no", "has_serial_no", "increment", "value", "item_data", "fields", "e", "scanned_item", "serial_nos", "prev_row", "ignore_fields", "key", "existing_serial_nos", "new_serial_nos", "idx", "exist", "_a", "is_duplicate", "is_batch_no_scan", "check_max_qty", "matching_row", "item_match", "batch_match", "uom_match", "qty_in_limit", "item_scanned", "d", "msg", "indicator", "duration", "field", "control", "listview", "from_doctype", "to_doctype", "args", "checked_items", "doc_name", "Item", "count_of_rows", "opts", "me", "cur_form_footer", "r", "activities_html", "_create_task", "args", "composer", "_create_event", "input_field", "doctype", "completed", "docname", "notes", "a", "b", "notes_html", "_add_note", "d", "data", "edit_btn", "row", "row_id", "row_content", "delete_btn", "doctype", "me", "frm", "e", "grid_row", "doc", "account_type", "cdt", "cdn", "d", "msg", "r", "open_form", "tax", "actual_type_error", "on_previous_row_error", "row_range", "taxes_not_included", "t", "rt", "account", "mode_of_payment", "callback", "doctype", "frm", "tax_field", "cdt", "cdn", "row", "value", "company_currency", "r", "doc", "me", "i", "opts", "customer", "cdt", "cdn", "r", "item", "amount_eligible_for_commission", "sales_person", "row", "sales_doctypes", "df", "editable_price_list_rate", "parent_field", "sum", "help_msg", "dont_fetch_price_list_rate", "qty", "rt", "doctype", "frm", "dialog", "values", "doc", "cdt", "cdn", "df", "disable", "me", "filters", "row", "r", "item", "received_qty", "received_stock_qty", "fieldnames", "is_negative_qty", "i", "other_item", "data", "msg", "fields", "field", "qty", "update_values", "frm", "item_length", "d", "my_qty", "newrow", "key", "dialog", "args", "first_row_is_empty", "child_table", "remove_empty_first_row", "render_clear_demo_action", "get_filters", "value", "row", "column", "data", "default_formatter", "filter", "growthPercent", "marginPercent", "$value", "project", "e", "report", "fiscal_year", "filters", "r", "fy", "views_menu", "filter_based_on", "txt", "fy_filters", "x"]
}
