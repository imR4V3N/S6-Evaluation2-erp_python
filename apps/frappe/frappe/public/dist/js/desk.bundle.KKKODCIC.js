(()=>{var L_=Object.create;var cn=Object.defineProperty,B_=Object.defineProperties,I_=Object.getOwnPropertyDescriptor,M_=Object.getOwnPropertyDescriptors,N_=Object.getOwnPropertyNames,ln=Object.getOwnPropertySymbols,R_=Object.getPrototypeOf,mo=Object.prototype.hasOwnProperty,Vl=Object.prototype.propertyIsEnumerable;var Wl=(i,e,t)=>e in i?cn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ee=(i,e)=>{for(var t in e||(e={}))mo.call(e,t)&&Wl(i,t,e[t]);if(ln)for(var t of ln(e))Vl.call(e,t)&&Wl(i,t,e[t]);return i},rt=(i,e)=>B_(i,M_(e));var Nr=(i=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(i,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):i)(function(i){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+i+'" is not supported')});var Yl=(i,e)=>{var t={};for(var r in i)mo.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&ln)for(var r of ln(i))e.indexOf(r)<0&&Vl.call(i,r)&&(t[r]=i[r]);return t};var te=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),D_=(i,e)=>{for(var t in e)cn(i,t,{get:e[t],enumerable:!0})},P_=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of N_(e))!mo.call(i,s)&&s!==t&&cn(i,s,{get:()=>e[s],enumerable:!(r=I_(e,s))||r.enumerable});return i};var Ut=(i,e,t)=>(t=i!=null?L_(R_(i)):{},P_(e||!i||!i.__esModule?cn(t,"default",{value:i,enumerable:!0}):t,i));var Ic=te((u$,Bc)=>{"use strict";var Ac=Array.isArray,Lc=Object.keys,cm=Object.prototype.hasOwnProperty;Bc.exports=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Ac(e),s=Ac(t),n,o,a;if(r&&s){if(o=e.length,o!=t.length)return!1;for(n=o;n--!==0;)if(!i(e[n],t[n]))return!1;return!0}if(r!=s)return!1;var l=e instanceof Date,c=t instanceof Date;if(l!=c)return!1;if(l&&c)return e.getTime()==t.getTime();var u=e instanceof RegExp,p=t instanceof RegExp;if(u!=p)return!1;if(u&&p)return e.toString()==t.toString();var m=Lc(e);if(o=m.length,o!==Lc(t).length)return!1;for(n=o;n--!==0;)if(!cm.call(t,m[n]))return!1;for(n=o;n--!==0;)if(a=m[n],!i(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var Nc=te((h$,Mc)=>{function dm(){this.__data__=[],this.size=0}Mc.exports=dm});var Bo=te((f$,Rc)=>{function um(i,e){return i===e||i!==i&&e!==e}Rc.exports=um});var Kr=te((_$,Dc)=>{var pm=Bo();function hm(i,e){for(var t=i.length;t--;)if(pm(i[t][0],e))return t;return-1}Dc.exports=hm});var jc=te((m$,Pc)=>{var fm=Kr(),_m=Array.prototype,mm=_m.splice;function gm(i){var e=this.__data__,t=fm(e,i);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():mm.call(e,t,1),--this.size,!0}Pc.exports=gm});var Fc=te((g$,zc)=>{var bm=Kr();function vm(i){var e=this.__data__,t=bm(e,i);return t<0?void 0:e[t][1]}zc.exports=vm});var qc=te((b$,Hc)=>{var ym=Kr();function wm(i){return ym(this.__data__,i)>-1}Hc.exports=wm});var Wc=te((v$,Uc)=>{var km=Kr();function xm(i,e){var t=this.__data__,r=km(t,i);return r<0?(++this.size,t.push([i,e])):t[r][1]=e,this}Uc.exports=xm});var Xr=te((y$,Vc)=>{var Cm=Nc(),Sm=jc(),Tm=Fc(),Em=qc(),$m=Wc();function Ji(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}Ji.prototype.clear=Cm;Ji.prototype.delete=Sm;Ji.prototype.get=Tm;Ji.prototype.has=Em;Ji.prototype.set=$m;Vc.exports=Ji});var Gc=te((w$,Yc)=>{var Om=Xr();function Am(){this.__data__=new Om,this.size=0}Yc.exports=Am});var Xc=te((k$,Kc)=>{function Lm(i){var e=this.__data__,t=e.delete(i);return this.size=e.size,t}Kc.exports=Lm});var Zc=te((x$,Jc)=>{function Bm(i){return this.__data__.get(i)}Jc.exports=Bm});var ed=te((C$,Qc)=>{function Im(i){return this.__data__.has(i)}Qc.exports=Im});var Io=te((S$,td)=>{var Mm=typeof global=="object"&&global&&global.Object===Object&&global;td.exports=Mm});var It=te((T$,id)=>{var Nm=Io(),Rm=typeof self=="object"&&self&&self.Object===Object&&self,Dm=Nm||Rm||Function("return this")();id.exports=Dm});var kn=te((E$,rd)=>{var Pm=It(),jm=Pm.Symbol;rd.exports=jm});var ad=te(($$,od)=>{var sd=kn(),nd=Object.prototype,zm=nd.hasOwnProperty,Fm=nd.toString,Jr=sd?sd.toStringTag:void 0;function Hm(i){var e=zm.call(i,Jr),t=i[Jr];try{i[Jr]=void 0;var r=!0}catch(n){}var s=Fm.call(i);return r&&(e?i[Jr]=t:delete i[Jr]),s}od.exports=Hm});var cd=te((O$,ld)=>{var qm=Object.prototype,Um=qm.toString;function Wm(i){return Um.call(i)}ld.exports=Wm});var Zr=te((A$,pd)=>{var dd=kn(),Vm=ad(),Ym=cd(),Gm="[object Null]",Km="[object Undefined]",ud=dd?dd.toStringTag:void 0;function Xm(i){return i==null?i===void 0?Km:Gm:ud&&ud in Object(i)?Vm(i):Ym(i)}pd.exports=Xm});var Zi=te((L$,hd)=>{function Jm(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}hd.exports=Jm});var Mo=te((B$,fd)=>{var Zm=Zr(),Qm=Zi(),eg="[object AsyncFunction]",tg="[object Function]",ig="[object GeneratorFunction]",rg="[object Proxy]";function sg(i){if(!Qm(i))return!1;var e=Zm(i);return e==tg||e==ig||e==eg||e==rg}fd.exports=sg});var md=te((I$,_d)=>{var ng=It(),og=ng["__core-js_shared__"];_d.exports=og});var vd=te((M$,bd)=>{var No=md(),gd=function(){var i=/[^.]+$/.exec(No&&No.keys&&No.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function ag(i){return!!gd&&gd in i}bd.exports=ag});var Ro=te((N$,yd)=>{var lg=Function.prototype,cg=lg.toString;function dg(i){if(i!=null){try{return cg.call(i)}catch(e){}try{return i+""}catch(e){}}return""}yd.exports=dg});var kd=te((R$,wd)=>{var ug=Mo(),pg=vd(),hg=Zi(),fg=Ro(),_g=/[\\^$.*+?()[\]{}|]/g,mg=/^\[object .+?Constructor\]$/,gg=Function.prototype,bg=Object.prototype,vg=gg.toString,yg=bg.hasOwnProperty,wg=RegExp("^"+vg.call(yg).replace(_g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function kg(i){if(!hg(i)||pg(i))return!1;var e=ug(i)?wg:mg;return e.test(fg(i))}wd.exports=kg});var Cd=te((D$,xd)=>{function xg(i,e){return i==null?void 0:i[e]}xd.exports=xg});var gi=te((P$,Sd)=>{var Cg=kd(),Sg=Cd();function Tg(i,e){var t=Sg(i,e);return Cg(t)?t:void 0}Sd.exports=Tg});var xn=te((j$,Td)=>{var Eg=gi(),$g=It(),Og=Eg($g,"Map");Td.exports=Og});var Qr=te((z$,Ed)=>{var Ag=gi(),Lg=Ag(Object,"create");Ed.exports=Lg});var Ad=te((F$,Od)=>{var $d=Qr();function Bg(){this.__data__=$d?$d(null):{},this.size=0}Od.exports=Bg});var Bd=te((H$,Ld)=>{function Ig(i){var e=this.has(i)&&delete this.__data__[i];return this.size-=e?1:0,e}Ld.exports=Ig});var Md=te((q$,Id)=>{var Mg=Qr(),Ng="__lodash_hash_undefined__",Rg=Object.prototype,Dg=Rg.hasOwnProperty;function Pg(i){var e=this.__data__;if(Mg){var t=e[i];return t===Ng?void 0:t}return Dg.call(e,i)?e[i]:void 0}Id.exports=Pg});var Rd=te((U$,Nd)=>{var jg=Qr(),zg=Object.prototype,Fg=zg.hasOwnProperty;function Hg(i){var e=this.__data__;return jg?e[i]!==void 0:Fg.call(e,i)}Nd.exports=Hg});var Pd=te((W$,Dd)=>{var qg=Qr(),Ug="__lodash_hash_undefined__";function Wg(i,e){var t=this.__data__;return this.size+=this.has(i)?0:1,t[i]=qg&&e===void 0?Ug:e,this}Dd.exports=Wg});var zd=te((V$,jd)=>{var Vg=Ad(),Yg=Bd(),Gg=Md(),Kg=Rd(),Xg=Pd();function Qi(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}Qi.prototype.clear=Vg;Qi.prototype.delete=Yg;Qi.prototype.get=Gg;Qi.prototype.has=Kg;Qi.prototype.set=Xg;jd.exports=Qi});var qd=te((Y$,Hd)=>{var Fd=zd(),Jg=Xr(),Zg=xn();function Qg(){this.size=0,this.__data__={hash:new Fd,map:new(Zg||Jg),string:new Fd}}Hd.exports=Qg});var Wd=te((G$,Ud)=>{function eb(i){var e=typeof i;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?i!=="__proto__":i===null}Ud.exports=eb});var es=te((K$,Vd)=>{var tb=Wd();function ib(i,e){var t=i.__data__;return tb(e)?t[typeof e=="string"?"string":"hash"]:t.map}Vd.exports=ib});var Gd=te((X$,Yd)=>{var rb=es();function sb(i){var e=rb(this,i).delete(i);return this.size-=e?1:0,e}Yd.exports=sb});var Xd=te((J$,Kd)=>{var nb=es();function ob(i){return nb(this,i).get(i)}Kd.exports=ob});var Zd=te((Z$,Jd)=>{var ab=es();function lb(i){return ab(this,i).has(i)}Jd.exports=lb});var eu=te((Q$,Qd)=>{var cb=es();function db(i,e){var t=cb(this,i),r=t.size;return t.set(i,e),this.size+=t.size==r?0:1,this}Qd.exports=db});var iu=te((e8,tu)=>{var ub=qd(),pb=Gd(),hb=Xd(),fb=Zd(),_b=eu();function er(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}er.prototype.clear=ub;er.prototype.delete=pb;er.prototype.get=hb;er.prototype.has=fb;er.prototype.set=_b;tu.exports=er});var su=te((t8,ru)=>{var mb=Xr(),gb=xn(),bb=iu(),vb=200;function yb(i,e){var t=this.__data__;if(t instanceof mb){var r=t.__data__;if(!gb||r.length<vb-1)return r.push([i,e]),this.size=++t.size,this;t=this.__data__=new bb(r)}return t.set(i,e),this.size=t.size,this}ru.exports=yb});var ou=te((i8,nu)=>{var wb=Xr(),kb=Gc(),xb=Xc(),Cb=Zc(),Sb=ed(),Tb=su();function tr(i){var e=this.__data__=new wb(i);this.size=e.size}tr.prototype.clear=kb;tr.prototype.delete=xb;tr.prototype.get=Cb;tr.prototype.has=Sb;tr.prototype.set=Tb;nu.exports=tr});var lu=te((r8,au)=>{function Eb(i,e){for(var t=-1,r=i==null?0:i.length;++t<r&&e(i[t],t,i)!==!1;);return i}au.exports=Eb});var du=te((s8,cu)=>{var $b=gi(),Ob=function(){try{var i=$b(Object,"defineProperty");return i({},"",{}),i}catch(e){}}();cu.exports=Ob});var Do=te((n8,pu)=>{var uu=du();function Ab(i,e,t){e=="__proto__"&&uu?uu(i,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):i[e]=t}pu.exports=Ab});var Po=te((o8,hu)=>{var Lb=Do(),Bb=Bo(),Ib=Object.prototype,Mb=Ib.hasOwnProperty;function Nb(i,e,t){var r=i[e];(!(Mb.call(i,e)&&Bb(r,t))||t===void 0&&!(e in i))&&Lb(i,e,t)}hu.exports=Nb});var ts=te((a8,fu)=>{var Rb=Po(),Db=Do();function Pb(i,e,t,r){var s=!t;t||(t={});for(var n=-1,o=e.length;++n<o;){var a=e[n],l=r?r(t[a],i[a],a,t,i):void 0;l===void 0&&(l=i[a]),s?Db(t,a,l):Rb(t,a,l)}return t}fu.exports=Pb});var mu=te((l8,_u)=>{function jb(i,e){for(var t=-1,r=Array(i);++t<i;)r[t]=e(t);return r}_u.exports=jb});var ir=te((c8,gu)=>{function zb(i){return i!=null&&typeof i=="object"}gu.exports=zb});var vu=te((d8,bu)=>{var Fb=Zr(),Hb=ir(),qb="[object Arguments]";function Ub(i){return Hb(i)&&Fb(i)==qb}bu.exports=Ub});var xu=te((u8,ku)=>{var yu=vu(),Wb=ir(),wu=Object.prototype,Vb=wu.hasOwnProperty,Yb=wu.propertyIsEnumerable,Gb=yu(function(){return arguments}())?yu:function(i){return Wb(i)&&Vb.call(i,"callee")&&!Yb.call(i,"callee")};ku.exports=Gb});var Cn=te((p8,Cu)=>{var Kb=Array.isArray;Cu.exports=Kb});var Tu=te((h8,Su)=>{function Xb(){return!1}Su.exports=Xb});var jo=te((is,rr)=>{var Jb=It(),Zb=Tu(),Ou=typeof is=="object"&&is&&!is.nodeType&&is,Eu=Ou&&typeof rr=="object"&&rr&&!rr.nodeType&&rr,Qb=Eu&&Eu.exports===Ou,$u=Qb?Jb.Buffer:void 0,ev=$u?$u.isBuffer:void 0,tv=ev||Zb;rr.exports=tv});var Lu=te((f8,Au)=>{var iv=9007199254740991,rv=/^(?:0|[1-9]\d*)$/;function sv(i,e){var t=typeof i;return e=e==null?iv:e,!!e&&(t=="number"||t!="symbol"&&rv.test(i))&&i>-1&&i%1==0&&i<e}Au.exports=sv});var zo=te((_8,Bu)=>{var nv=9007199254740991;function ov(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=nv}Bu.exports=ov});var Mu=te((m8,Iu)=>{var av=Zr(),lv=zo(),cv=ir(),dv="[object Arguments]",uv="[object Array]",pv="[object Boolean]",hv="[object Date]",fv="[object Error]",_v="[object Function]",mv="[object Map]",gv="[object Number]",bv="[object Object]",vv="[object RegExp]",yv="[object Set]",wv="[object String]",kv="[object WeakMap]",xv="[object ArrayBuffer]",Cv="[object DataView]",Sv="[object Float32Array]",Tv="[object Float64Array]",Ev="[object Int8Array]",$v="[object Int16Array]",Ov="[object Int32Array]",Av="[object Uint8Array]",Lv="[object Uint8ClampedArray]",Bv="[object Uint16Array]",Iv="[object Uint32Array]",He={};He[Sv]=He[Tv]=He[Ev]=He[$v]=He[Ov]=He[Av]=He[Lv]=He[Bv]=He[Iv]=!0;He[dv]=He[uv]=He[xv]=He[pv]=He[Cv]=He[hv]=He[fv]=He[_v]=He[mv]=He[gv]=He[bv]=He[vv]=He[yv]=He[wv]=He[kv]=!1;function Mv(i){return cv(i)&&lv(i.length)&&!!He[av(i)]}Iu.exports=Mv});var Sn=te((g8,Nu)=>{function Nv(i){return function(e){return i(e)}}Nu.exports=Nv});var Tn=te((rs,sr)=>{var Rv=Io(),Ru=typeof rs=="object"&&rs&&!rs.nodeType&&rs,ss=Ru&&typeof sr=="object"&&sr&&!sr.nodeType&&sr,Dv=ss&&ss.exports===Ru,Fo=Dv&&Rv.process,Pv=function(){try{var i=ss&&ss.require&&ss.require("util").types;return i||Fo&&Fo.binding&&Fo.binding("util")}catch(e){}}();sr.exports=Pv});var zu=te((b8,ju)=>{var jv=Mu(),zv=Sn(),Du=Tn(),Pu=Du&&Du.isTypedArray,Fv=Pu?zv(Pu):jv;ju.exports=Fv});var Ho=te((v8,Fu)=>{var Hv=mu(),qv=xu(),Uv=Cn(),Wv=jo(),Vv=Lu(),Yv=zu(),Gv=Object.prototype,Kv=Gv.hasOwnProperty;function Xv(i,e){var t=Uv(i),r=!t&&qv(i),s=!t&&!r&&Wv(i),n=!t&&!r&&!s&&Yv(i),o=t||r||s||n,a=o?Hv(i.length,String):[],l=a.length;for(var c in i)(e||Kv.call(i,c))&&!(o&&(c=="length"||s&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Vv(c,l)))&&a.push(c);return a}Fu.exports=Xv});var En=te((y8,Hu)=>{var Jv=Object.prototype;function Zv(i){var e=i&&i.constructor,t=typeof e=="function"&&e.prototype||Jv;return i===t}Hu.exports=Zv});var qo=te((w8,qu)=>{function Qv(i,e){return function(t){return i(e(t))}}qu.exports=Qv});var Wu=te((k8,Uu)=>{var ey=qo(),ty=ey(Object.keys,Object);Uu.exports=ty});var Yu=te((x8,Vu)=>{var iy=En(),ry=Wu(),sy=Object.prototype,ny=sy.hasOwnProperty;function oy(i){if(!iy(i))return ry(i);var e=[];for(var t in Object(i))ny.call(i,t)&&t!="constructor"&&e.push(t);return e}Vu.exports=oy});var Uo=te((C8,Gu)=>{var ay=Mo(),ly=zo();function cy(i){return i!=null&&ly(i.length)&&!ay(i)}Gu.exports=cy});var $n=te((S8,Ku)=>{var dy=Ho(),uy=Yu(),py=Uo();function hy(i){return py(i)?dy(i):uy(i)}Ku.exports=hy});var Ju=te((T8,Xu)=>{var fy=ts(),_y=$n();function my(i,e){return i&&fy(e,_y(e),i)}Xu.exports=my});var Qu=te((E8,Zu)=>{function gy(i){var e=[];if(i!=null)for(var t in Object(i))e.push(t);return e}Zu.exports=gy});var tp=te(($8,ep)=>{var by=Zi(),vy=En(),yy=Qu(),wy=Object.prototype,ky=wy.hasOwnProperty;function xy(i){if(!by(i))return yy(i);var e=vy(i),t=[];for(var r in i)r=="constructor"&&(e||!ky.call(i,r))||t.push(r);return t}ep.exports=xy});var On=te((O8,ip)=>{var Cy=Ho(),Sy=tp(),Ty=Uo();function Ey(i){return Ty(i)?Cy(i,!0):Sy(i)}ip.exports=Ey});var sp=te((A8,rp)=>{var $y=ts(),Oy=On();function Ay(i,e){return i&&$y(e,Oy(e),i)}rp.exports=Ay});var cp=te((ns,nr)=>{var Ly=It(),lp=typeof ns=="object"&&ns&&!ns.nodeType&&ns,np=lp&&typeof nr=="object"&&nr&&!nr.nodeType&&nr,By=np&&np.exports===lp,op=By?Ly.Buffer:void 0,ap=op?op.allocUnsafe:void 0;function Iy(i,e){if(e)return i.slice();var t=i.length,r=ap?ap(t):new i.constructor(t);return i.copy(r),r}nr.exports=Iy});var up=te((L8,dp)=>{function My(i,e){var t=-1,r=i.length;for(e||(e=Array(r));++t<r;)e[t]=i[t];return e}dp.exports=My});var hp=te((B8,pp)=>{function Ny(i,e){for(var t=-1,r=i==null?0:i.length,s=0,n=[];++t<r;){var o=i[t];e(o,t,i)&&(n[s++]=o)}return n}pp.exports=Ny});var Wo=te((I8,fp)=>{function Ry(){return[]}fp.exports=Ry});var An=te((M8,mp)=>{var Dy=hp(),Py=Wo(),jy=Object.prototype,zy=jy.propertyIsEnumerable,_p=Object.getOwnPropertySymbols,Fy=_p?function(i){return i==null?[]:(i=Object(i),Dy(_p(i),function(e){return zy.call(i,e)}))}:Py;mp.exports=Fy});var bp=te((N8,gp)=>{var Hy=ts(),qy=An();function Uy(i,e){return Hy(i,qy(i),e)}gp.exports=Uy});var Vo=te((R8,vp)=>{function Wy(i,e){for(var t=-1,r=e.length,s=i.length;++t<r;)i[s+t]=e[t];return i}vp.exports=Wy});var Yo=te((D8,yp)=>{var Vy=qo(),Yy=Vy(Object.getPrototypeOf,Object);yp.exports=Yy});var Go=te((P8,wp)=>{var Gy=Vo(),Ky=Yo(),Xy=An(),Jy=Wo(),Zy=Object.getOwnPropertySymbols,Qy=Zy?function(i){for(var e=[];i;)Gy(e,Xy(i)),i=Ky(i);return e}:Jy;wp.exports=Qy});var xp=te((j8,kp)=>{var ew=ts(),tw=Go();function iw(i,e){return ew(i,tw(i),e)}kp.exports=iw});var Ko=te((z8,Cp)=>{var rw=Vo(),sw=Cn();function nw(i,e,t){var r=e(i);return sw(i)?r:rw(r,t(i))}Cp.exports=nw});var Tp=te((F8,Sp)=>{var ow=Ko(),aw=An(),lw=$n();function cw(i){return ow(i,lw,aw)}Sp.exports=cw});var $p=te((H8,Ep)=>{var dw=Ko(),uw=Go(),pw=On();function hw(i){return dw(i,pw,uw)}Ep.exports=hw});var Ap=te((q8,Op)=>{var fw=gi(),_w=It(),mw=fw(_w,"DataView");Op.exports=mw});var Bp=te((U8,Lp)=>{var gw=gi(),bw=It(),vw=gw(bw,"Promise");Lp.exports=vw});var Mp=te((W8,Ip)=>{var yw=gi(),ww=It(),kw=yw(ww,"Set");Ip.exports=kw});var Rp=te((V8,Np)=>{var xw=gi(),Cw=It(),Sw=xw(Cw,"WeakMap");Np.exports=Sw});var Ln=te((Y8,qp)=>{var Xo=Ap(),Jo=xn(),Zo=Bp(),Qo=Mp(),ea=Rp(),Hp=Zr(),or=Ro(),Dp="[object Map]",Tw="[object Object]",Pp="[object Promise]",jp="[object Set]",zp="[object WeakMap]",Fp="[object DataView]",Ew=or(Xo),$w=or(Jo),Ow=or(Zo),Aw=or(Qo),Lw=or(ea),Oi=Hp;(Xo&&Oi(new Xo(new ArrayBuffer(1)))!=Fp||Jo&&Oi(new Jo)!=Dp||Zo&&Oi(Zo.resolve())!=Pp||Qo&&Oi(new Qo)!=jp||ea&&Oi(new ea)!=zp)&&(Oi=function(i){var e=Hp(i),t=e==Tw?i.constructor:void 0,r=t?or(t):"";if(r)switch(r){case Ew:return Fp;case $w:return Dp;case Ow:return Pp;case Aw:return jp;case Lw:return zp}return e});qp.exports=Oi});var Wp=te((G8,Up)=>{var Bw=Object.prototype,Iw=Bw.hasOwnProperty;function Mw(i){var e=i.length,t=new i.constructor(e);return e&&typeof i[0]=="string"&&Iw.call(i,"index")&&(t.index=i.index,t.input=i.input),t}Up.exports=Mw});var Yp=te((K8,Vp)=>{var Nw=It(),Rw=Nw.Uint8Array;Vp.exports=Rw});var Bn=te((X8,Kp)=>{var Gp=Yp();function Dw(i){var e=new i.constructor(i.byteLength);return new Gp(e).set(new Gp(i)),e}Kp.exports=Dw});var Jp=te((J8,Xp)=>{var Pw=Bn();function jw(i,e){var t=e?Pw(i.buffer):i.buffer;return new i.constructor(t,i.byteOffset,i.byteLength)}Xp.exports=jw});var Qp=te((Z8,Zp)=>{var zw=/\w*$/;function Fw(i){var e=new i.constructor(i.source,zw.exec(i));return e.lastIndex=i.lastIndex,e}Zp.exports=Fw});var sh=te((Q8,rh)=>{var eh=kn(),th=eh?eh.prototype:void 0,ih=th?th.valueOf:void 0;function Hw(i){return ih?Object(ih.call(i)):{}}rh.exports=Hw});var oh=te((e2,nh)=>{var qw=Bn();function Uw(i,e){var t=e?qw(i.buffer):i.buffer;return new i.constructor(t,i.byteOffset,i.length)}nh.exports=Uw});var lh=te((t2,ah)=>{var Ww=Bn(),Vw=Jp(),Yw=Qp(),Gw=sh(),Kw=oh(),Xw="[object Boolean]",Jw="[object Date]",Zw="[object Map]",Qw="[object Number]",ek="[object RegExp]",tk="[object Set]",ik="[object String]",rk="[object Symbol]",sk="[object ArrayBuffer]",nk="[object DataView]",ok="[object Float32Array]",ak="[object Float64Array]",lk="[object Int8Array]",ck="[object Int16Array]",dk="[object Int32Array]",uk="[object Uint8Array]",pk="[object Uint8ClampedArray]",hk="[object Uint16Array]",fk="[object Uint32Array]";function _k(i,e,t){var r=i.constructor;switch(e){case sk:return Ww(i);case Xw:case Jw:return new r(+i);case nk:return Vw(i,t);case ok:case ak:case lk:case ck:case dk:case uk:case pk:case hk:case fk:return Kw(i,t);case Zw:return new r;case Qw:case ik:return new r(i);case ek:return Yw(i);case tk:return new r;case rk:return Gw(i)}}ah.exports=_k});var uh=te((i2,dh)=>{var mk=Zi(),ch=Object.create,gk=function(){function i(){}return function(e){if(!mk(e))return{};if(ch)return ch(e);i.prototype=e;var t=new i;return i.prototype=void 0,t}}();dh.exports=gk});var hh=te((r2,ph)=>{var bk=uh(),vk=Yo(),yk=En();function wk(i){return typeof i.constructor=="function"&&!yk(i)?bk(vk(i)):{}}ph.exports=wk});var _h=te((s2,fh)=>{var kk=Ln(),xk=ir(),Ck="[object Map]";function Sk(i){return xk(i)&&kk(i)==Ck}fh.exports=Sk});var vh=te((n2,bh)=>{var Tk=_h(),Ek=Sn(),mh=Tn(),gh=mh&&mh.isMap,$k=gh?Ek(gh):Tk;bh.exports=$k});var wh=te((o2,yh)=>{var Ok=Ln(),Ak=ir(),Lk="[object Set]";function Bk(i){return Ak(i)&&Ok(i)==Lk}yh.exports=Bk});var Sh=te((a2,Ch)=>{var Ik=wh(),Mk=Sn(),kh=Tn(),xh=kh&&kh.isSet,Nk=xh?Mk(xh):Ik;Ch.exports=Nk});var Ah=te((l2,Oh)=>{var Rk=ou(),Dk=lu(),Pk=Po(),jk=Ju(),zk=sp(),Fk=cp(),Hk=up(),qk=bp(),Uk=xp(),Wk=Tp(),Vk=$p(),Yk=Ln(),Gk=Wp(),Kk=lh(),Xk=hh(),Jk=Cn(),Zk=jo(),Qk=vh(),e0=Zi(),t0=Sh(),i0=$n(),r0=On(),s0=1,n0=2,o0=4,Th="[object Arguments]",a0="[object Array]",l0="[object Boolean]",c0="[object Date]",d0="[object Error]",Eh="[object Function]",u0="[object GeneratorFunction]",p0="[object Map]",h0="[object Number]",$h="[object Object]",f0="[object RegExp]",_0="[object Set]",m0="[object String]",g0="[object Symbol]",b0="[object WeakMap]",v0="[object ArrayBuffer]",y0="[object DataView]",w0="[object Float32Array]",k0="[object Float64Array]",x0="[object Int8Array]",C0="[object Int16Array]",S0="[object Int32Array]",T0="[object Uint8Array]",E0="[object Uint8ClampedArray]",$0="[object Uint16Array]",O0="[object Uint32Array]",Fe={};Fe[Th]=Fe[a0]=Fe[v0]=Fe[y0]=Fe[l0]=Fe[c0]=Fe[w0]=Fe[k0]=Fe[x0]=Fe[C0]=Fe[S0]=Fe[p0]=Fe[h0]=Fe[$h]=Fe[f0]=Fe[_0]=Fe[m0]=Fe[g0]=Fe[T0]=Fe[E0]=Fe[$0]=Fe[O0]=!0;Fe[d0]=Fe[Eh]=Fe[b0]=!1;function In(i,e,t,r,s,n){var o,a=e&s0,l=e&n0,c=e&o0;if(t&&(o=s?t(i,r,s,n):t(i)),o!==void 0)return o;if(!e0(i))return i;var u=Jk(i);if(u){if(o=Gk(i),!a)return Hk(i,o)}else{var p=Yk(i),m=p==Eh||p==u0;if(Zk(i))return Fk(i,a);if(p==$h||p==Th||m&&!s){if(o=l||m?{}:Xk(i),!a)return l?Uk(i,zk(o,i)):qk(i,jk(o,i))}else{if(!Fe[p])return s?i:{};o=Kk(i,p,a)}}n||(n=new Rk);var w=n.get(i);if(w)return w;n.set(i,o),t0(i)?i.forEach(function(D){o.add(In(D,e,t,D,i,n))}):Qk(i)&&i.forEach(function(D,j){o.set(j,In(D,e,t,j,i,n))});var x=c?l?Vk:Wk:l?r0:i0,A=u?void 0:x(i);return Dk(A||i,function(D,j){A&&(j=D,D=i[j]),Pk(o,j,In(D,e,t,j,i,n))}),o}Oh.exports=In});var Bh=te((c2,Lh)=>{var A0=Ah(),L0=1,B0=4;function I0(i,e){return e=typeof e=="function"?e:void 0,A0(i,L0|B0,e)}Lh.exports=I0});var Rh=te((k2,Nh)=>{(function(){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,r){return t<<r|t>>>32-r},rotr:function(t,r){return t<<32-r|t>>>r},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var r=0;r<t.length;r++)t[r]=e.endian(t[r]);return t},randomBytes:function(t){for(var r=[];t>0;t--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(t){for(var r=[],s=0,n=0;s<t.length;s++,n+=8)r[n>>>5]|=t[s]<<24-n%32;return r},wordsToBytes:function(t){for(var r=[],s=0;s<t.length*32;s+=8)r.push(t[s>>>5]>>>24-s%32&255);return r},bytesToHex:function(t){for(var r=[],s=0;s<t.length;s++)r.push((t[s]>>>4).toString(16)),r.push((t[s]&15).toString(16));return r.join("")},hexToBytes:function(t){for(var r=[],s=0;s<t.length;s+=2)r.push(parseInt(t.substr(s,2),16));return r},bytesToBase64:function(t){for(var r=[],s=0;s<t.length;s+=3)for(var n=t[s]<<16|t[s+1]<<8|t[s+2],o=0;o<4;o++)s*8+o*6<=t.length*8?r.push(i.charAt(n>>>6*(3-o)&63)):r.push("=");return r.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],s=0,n=0;s<t.length;n=++s%4)n!=0&&r.push((i.indexOf(t.charAt(s-1))&Math.pow(2,-2*n+8)-1)<<n*2|i.indexOf(t.charAt(s))>>>6-n*2);return r}};Nh.exports=e})()});var ia=te((x2,Dh)=>{var ta={utf8:{stringToBytes:function(i){return ta.bin.stringToBytes(unescape(encodeURIComponent(i)))},bytesToString:function(i){return decodeURIComponent(escape(ta.bin.bytesToString(i)))}},bin:{stringToBytes:function(i){for(var e=[],t=0;t<i.length;t++)e.push(i.charCodeAt(t)&255);return e},bytesToString:function(i){for(var e=[],t=0;t<i.length;t++)e.push(String.fromCharCode(i[t]));return e.join("")}}};Dh.exports=ta});var zh=te((C2,jh)=>{jh.exports=function(i){return i!=null&&(Ph(i)||z0(i)||!!i._isBuffer)};function Ph(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function z0(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&Ph(i.slice(0,0))}});var Hh=te((S2,Fh)=>{(function(){var i=Rh(),e=ia().utf8,t=zh(),r=ia().bin,s=function(n,o){n.constructor==String?o&&o.encoding==="binary"?n=r.stringToBytes(n):n=e.stringToBytes(n):t(n)?n=Array.prototype.slice.call(n,0):!Array.isArray(n)&&n.constructor!==Uint8Array&&(n=n.toString());for(var a=i.bytesToWords(n),l=n.length*8,c=1732584193,u=-271733879,p=-1732584194,m=271733878,w=0;w<a.length;w++)a[w]=(a[w]<<8|a[w]>>>24)&16711935|(a[w]<<24|a[w]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var x=s._ff,A=s._gg,D=s._hh,j=s._ii,w=0;w<a.length;w+=16){var ee=c,d=u,g=p,_=m;c=x(c,u,p,m,a[w+0],7,-680876936),m=x(m,c,u,p,a[w+1],12,-389564586),p=x(p,m,c,u,a[w+2],17,606105819),u=x(u,p,m,c,a[w+3],22,-1044525330),c=x(c,u,p,m,a[w+4],7,-176418897),m=x(m,c,u,p,a[w+5],12,1200080426),p=x(p,m,c,u,a[w+6],17,-1473231341),u=x(u,p,m,c,a[w+7],22,-45705983),c=x(c,u,p,m,a[w+8],7,1770035416),m=x(m,c,u,p,a[w+9],12,-1958414417),p=x(p,m,c,u,a[w+10],17,-42063),u=x(u,p,m,c,a[w+11],22,-1990404162),c=x(c,u,p,m,a[w+12],7,1804603682),m=x(m,c,u,p,a[w+13],12,-40341101),p=x(p,m,c,u,a[w+14],17,-1502002290),u=x(u,p,m,c,a[w+15],22,1236535329),c=A(c,u,p,m,a[w+1],5,-165796510),m=A(m,c,u,p,a[w+6],9,-1069501632),p=A(p,m,c,u,a[w+11],14,643717713),u=A(u,p,m,c,a[w+0],20,-373897302),c=A(c,u,p,m,a[w+5],5,-701558691),m=A(m,c,u,p,a[w+10],9,38016083),p=A(p,m,c,u,a[w+15],14,-660478335),u=A(u,p,m,c,a[w+4],20,-405537848),c=A(c,u,p,m,a[w+9],5,568446438),m=A(m,c,u,p,a[w+14],9,-1019803690),p=A(p,m,c,u,a[w+3],14,-187363961),u=A(u,p,m,c,a[w+8],20,1163531501),c=A(c,u,p,m,a[w+13],5,-1444681467),m=A(m,c,u,p,a[w+2],9,-51403784),p=A(p,m,c,u,a[w+7],14,1735328473),u=A(u,p,m,c,a[w+12],20,-1926607734),c=D(c,u,p,m,a[w+5],4,-378558),m=D(m,c,u,p,a[w+8],11,-2022574463),p=D(p,m,c,u,a[w+11],16,1839030562),u=D(u,p,m,c,a[w+14],23,-35309556),c=D(c,u,p,m,a[w+1],4,-1530992060),m=D(m,c,u,p,a[w+4],11,1272893353),p=D(p,m,c,u,a[w+7],16,-155497632),u=D(u,p,m,c,a[w+10],23,-1094730640),c=D(c,u,p,m,a[w+13],4,681279174),m=D(m,c,u,p,a[w+0],11,-358537222),p=D(p,m,c,u,a[w+3],16,-722521979),u=D(u,p,m,c,a[w+6],23,76029189),c=D(c,u,p,m,a[w+9],4,-640364487),m=D(m,c,u,p,a[w+12],11,-421815835),p=D(p,m,c,u,a[w+15],16,530742520),u=D(u,p,m,c,a[w+2],23,-995338651),c=j(c,u,p,m,a[w+0],6,-198630844),m=j(m,c,u,p,a[w+7],10,1126891415),p=j(p,m,c,u,a[w+14],15,-1416354905),u=j(u,p,m,c,a[w+5],21,-57434055),c=j(c,u,p,m,a[w+12],6,1700485571),m=j(m,c,u,p,a[w+3],10,-1894986606),p=j(p,m,c,u,a[w+10],15,-1051523),u=j(u,p,m,c,a[w+1],21,-2054922799),c=j(c,u,p,m,a[w+8],6,1873313359),m=j(m,c,u,p,a[w+15],10,-30611744),p=j(p,m,c,u,a[w+6],15,-1560198380),u=j(u,p,m,c,a[w+13],21,1309151649),c=j(c,u,p,m,a[w+4],6,-145523070),m=j(m,c,u,p,a[w+11],10,-1120210379),p=j(p,m,c,u,a[w+2],15,718787259),u=j(u,p,m,c,a[w+9],21,-343485551),c=c+ee>>>0,u=u+d>>>0,p=p+g>>>0,m=m+_>>>0}return i.endian([c,u,p,m])};s._ff=function(n,o,a,l,c,u,p){var m=n+(o&a|~o&l)+(c>>>0)+p;return(m<<u|m>>>32-u)+o},s._gg=function(n,o,a,l,c,u,p){var m=n+(o&l|a&~l)+(c>>>0)+p;return(m<<u|m>>>32-u)+o},s._hh=function(n,o,a,l,c,u,p){var m=n+(o^a^l)+(c>>>0)+p;return(m<<u|m>>>32-u)+o},s._ii=function(n,o,a,l,c,u,p){var m=n+(a^(o|~l))+(c>>>0)+p;return(m<<u|m>>>32-u)+o},s._blocksize=16,s._digestsize=16,Fh.exports=function(n,o){if(n==null)throw new Error("Illegal argument "+n);var a=i.wordsToBytes(s(n,o));return o&&o.asBytes?a:o&&o.asString?r.bytesToString(a):i.bytesToHex(a)}})()});var Uh=te((qh,Mn)=>{(function(){function i(d){"use strict";var g={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `\xAB\xAB\xAB` and `\xBB\xBB\xBB` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(d===!1)return JSON.parse(JSON.stringify(g));var _={};for(var y in g)g.hasOwnProperty(y)&&(_[y]=g[y].defaultValue);return _}function e(){"use strict";var d=i(!0),g={};for(var _ in d)d.hasOwnProperty(_)&&(g[_]=!0);return g}var t={},r={},s={},n=i(!0),o="vanilla",a={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:i(!0),allOn:e()};t.helper={},t.extensions={},t.setOption=function(d,g){"use strict";return n[d]=g,this},t.getOption=function(d){"use strict";return n[d]},t.getOptions=function(){"use strict";return n},t.resetOptions=function(){"use strict";n=i(!0)},t.setFlavor=function(d){"use strict";if(!a.hasOwnProperty(d))throw Error(d+" flavor was not found");t.resetOptions();var g=a[d];o=d;for(var _ in g)g.hasOwnProperty(_)&&(n[_]=g[_])},t.getFlavor=function(){"use strict";return o},t.getFlavorOptions=function(d){"use strict";if(a.hasOwnProperty(d))return a[d]},t.getDefaultOptions=function(d){"use strict";return i(d)},t.subParser=function(d,g){"use strict";if(t.helper.isString(d))if(typeof g!="undefined")r[d]=g;else{if(r.hasOwnProperty(d))return r[d];throw Error("SubParser named "+d+" not registered!")}},t.extension=function(d,g){"use strict";if(!t.helper.isString(d))throw Error("Extension 'name' must be a string");if(d=t.helper.stdExtName(d),t.helper.isUndefined(g)){if(!s.hasOwnProperty(d))throw Error("Extension named "+d+" is not registered!");return s[d]}else{typeof g=="function"&&(g=g()),t.helper.isArray(g)||(g=[g]);var _=l(g,d);if(_.valid)s[d]=g;else throw Error(_.error)}},t.getAllExtensions=function(){"use strict";return s},t.removeExtension=function(d){"use strict";delete s[d]},t.resetExtensions=function(){"use strict";s={}};function l(d,g){"use strict";var _=g?"Error in "+g+" extension->":"Error in unnamed extension",y={valid:!0,error:""};t.helper.isArray(d)||(d=[d]);for(var O=0;O<d.length;++O){var E=_+" sub-extension "+O+": ",k=d[O];if(typeof k!="object")return y.valid=!1,y.error=E+"must be an object, but "+typeof k+" given",y;if(!t.helper.isString(k.type))return y.valid=!1,y.error=E+'property "type" must be a string, but '+typeof k.type+" given",y;var M=k.type=k.type.toLowerCase();if(M==="language"&&(M=k.type="lang"),M==="html"&&(M=k.type="output"),M!=="lang"&&M!=="output"&&M!=="listener")return y.valid=!1,y.error=E+"type "+M+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',y;if(M==="listener"){if(t.helper.isUndefined(k.listeners))return y.valid=!1,y.error=E+'. Extensions of type "listener" must have a property called "listeners"',y}else if(t.helper.isUndefined(k.filter)&&t.helper.isUndefined(k.regex))return y.valid=!1,y.error=E+M+' extensions must define either a "regex" property or a "filter" method',y;if(k.listeners){if(typeof k.listeners!="object")return y.valid=!1,y.error=E+'"listeners" property must be an object but '+typeof k.listeners+" given",y;for(var q in k.listeners)if(k.listeners.hasOwnProperty(q)&&typeof k.listeners[q]!="function")return y.valid=!1,y.error=E+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+q+" must be a function but "+typeof k.listeners[q]+" given",y}if(k.filter){if(typeof k.filter!="function")return y.valid=!1,y.error=E+'"filter" must be a function, but '+typeof k.filter+" given",y}else if(k.regex){if(t.helper.isString(k.regex)&&(k.regex=new RegExp(k.regex,"g")),!(k.regex instanceof RegExp))return y.valid=!1,y.error=E+'"regex" property must either be a string or a RegExp object, but '+typeof k.regex+" given",y;if(t.helper.isUndefined(k.replace))return y.valid=!1,y.error=E+'"regex" extensions must implement a replace string or function',y}}return y}t.validateExtension=function(d){"use strict";var g=l(d,null);return g.valid?!0:(console.warn(g.error),!1)},t.hasOwnProperty("helper")||(t.helper={}),t.helper.isString=function(d){"use strict";return typeof d=="string"||d instanceof String},t.helper.isFunction=function(d){"use strict";var g={};return d&&g.toString.call(d)==="[object Function]"},t.helper.isArray=function(d){"use strict";return Array.isArray(d)},t.helper.isUndefined=function(d){"use strict";return typeof d=="undefined"},t.helper.forEach=function(d,g){"use strict";if(t.helper.isUndefined(d))throw new Error("obj param is required");if(t.helper.isUndefined(g))throw new Error("callback param is required");if(!t.helper.isFunction(g))throw new Error("callback param must be a function/closure");if(typeof d.forEach=="function")d.forEach(g);else if(t.helper.isArray(d))for(var _=0;_<d.length;_++)g(d[_],_,d);else if(typeof d=="object")for(var y in d)d.hasOwnProperty(y)&&g(d[y],y,d);else throw new Error("obj does not seem to be an array or an iterable object")},t.helper.stdExtName=function(d){"use strict";return d.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function c(d,g){"use strict";var _=g.charCodeAt(0);return"\xA8E"+_+"E"}t.helper.escapeCharactersCallback=c,t.helper.escapeCharacters=function(d,g,_){"use strict";var y="(["+g.replace(/([\[\]\\])/g,"\\$1")+"])";_&&(y="\\\\"+y);var O=new RegExp(y,"g");return d=d.replace(O,c),d},t.helper.unescapeHTMLEntities=function(d){"use strict";return d.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var u=function(d,g,_,y){"use strict";var O=y||"",E=O.indexOf("g")>-1,k=new RegExp(g+"|"+_,"g"+O.replace(/g/g,"")),M=new RegExp(g,O.replace(/g/g,"")),q=[],Y,F,Z,B,Q;do for(Y=0;Z=k.exec(d);)if(M.test(Z[0]))Y++||(F=k.lastIndex,B=F-Z[0].length);else if(Y&&!--Y){Q=Z.index+Z[0].length;var ne={left:{start:B,end:F},match:{start:F,end:Z.index},right:{start:Z.index,end:Q},wholeMatch:{start:B,end:Q}};if(q.push(ne),!E)return q}while(Y&&(k.lastIndex=F));return q};t.helper.matchRecursiveRegExp=function(d,g,_,y){"use strict";for(var O=u(d,g,_,y),E=[],k=0;k<O.length;++k)E.push([d.slice(O[k].wholeMatch.start,O[k].wholeMatch.end),d.slice(O[k].match.start,O[k].match.end),d.slice(O[k].left.start,O[k].left.end),d.slice(O[k].right.start,O[k].right.end)]);return E},t.helper.replaceRecursiveRegExp=function(d,g,_,y,O){"use strict";if(!t.helper.isFunction(g)){var E=g;g=function(){return E}}var k=u(d,_,y,O),M=d,q=k.length;if(q>0){var Y=[];k[0].wholeMatch.start!==0&&Y.push(d.slice(0,k[0].wholeMatch.start));for(var F=0;F<q;++F)Y.push(g(d.slice(k[F].wholeMatch.start,k[F].wholeMatch.end),d.slice(k[F].match.start,k[F].match.end),d.slice(k[F].left.start,k[F].left.end),d.slice(k[F].right.start,k[F].right.end))),F<q-1&&Y.push(d.slice(k[F].wholeMatch.end,k[F+1].wholeMatch.start));k[q-1].wholeMatch.end<d.length&&Y.push(d.slice(k[q-1].wholeMatch.end)),M=Y.join("")}return M},t.helper.regexIndexOf=function(d,g,_){"use strict";if(!t.helper.isString(d))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(g instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var y=d.substring(_||0).search(g);return y>=0?y+(_||0):y},t.helper.splitAtIndex=function(d,g){"use strict";if(!t.helper.isString(d))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[d.substring(0,g),d.substring(g)]},t.helper.encodeEmailAddress=function(d){"use strict";var g=[function(_){return"&#"+_.charCodeAt(0)+";"},function(_){return"&#x"+_.charCodeAt(0).toString(16)+";"},function(_){return _}];return d=d.replace(/./g,function(_){if(_==="@")_=g[Math.floor(Math.random()*2)](_);else{var y=Math.random();_=y>.9?g[2](_):y>.45?g[1](_):g[0](_)}return _}),d},t.helper.padEnd=function(g,_,y){"use strict";return _=_>>0,y=String(y||" "),g.length>_?String(g):(_=_-g.length,_>y.length&&(y+=y.repeat(_/y.length)),String(g)+y.slice(0,_))},typeof console=="undefined"&&(console={warn:function(d){"use strict";alert(d)},log:function(d){"use strict";alert(d)},error:function(d){"use strict";throw d}}),t.helper.regexes={asteriskDashAndColon:/([*_:~])/g},t.helper.emojis={"+1":"\u{1F44D}","-1":"\u{1F44E}",100:"\u{1F4AF}",1234:"\u{1F522}","1st_place_medal":"\u{1F947}","2nd_place_medal":"\u{1F948}","3rd_place_medal":"\u{1F949}","8ball":"\u{1F3B1}",a:"\u{1F170}\uFE0F",ab:"\u{1F18E}",abc:"\u{1F524}",abcd:"\u{1F521}",accept:"\u{1F251}",aerial_tramway:"\u{1F6A1}",airplane:"\u2708\uFE0F",alarm_clock:"\u23F0",alembic:"\u2697\uFE0F",alien:"\u{1F47D}",ambulance:"\u{1F691}",amphora:"\u{1F3FA}",anchor:"\u2693\uFE0F",angel:"\u{1F47C}",anger:"\u{1F4A2}",angry:"\u{1F620}",anguished:"\u{1F627}",ant:"\u{1F41C}",apple:"\u{1F34E}",aquarius:"\u2652\uFE0F",aries:"\u2648\uFE0F",arrow_backward:"\u25C0\uFE0F",arrow_double_down:"\u23EC",arrow_double_up:"\u23EB",arrow_down:"\u2B07\uFE0F",arrow_down_small:"\u{1F53D}",arrow_forward:"\u25B6\uFE0F",arrow_heading_down:"\u2935\uFE0F",arrow_heading_up:"\u2934\uFE0F",arrow_left:"\u2B05\uFE0F",arrow_lower_left:"\u2199\uFE0F",arrow_lower_right:"\u2198\uFE0F",arrow_right:"\u27A1\uFE0F",arrow_right_hook:"\u21AA\uFE0F",arrow_up:"\u2B06\uFE0F",arrow_up_down:"\u2195\uFE0F",arrow_up_small:"\u{1F53C}",arrow_upper_left:"\u2196\uFE0F",arrow_upper_right:"\u2197\uFE0F",arrows_clockwise:"\u{1F503}",arrows_counterclockwise:"\u{1F504}",art:"\u{1F3A8}",articulated_lorry:"\u{1F69B}",artificial_satellite:"\u{1F6F0}",astonished:"\u{1F632}",athletic_shoe:"\u{1F45F}",atm:"\u{1F3E7}",atom_symbol:"\u269B\uFE0F",avocado:"\u{1F951}",b:"\u{1F171}\uFE0F",baby:"\u{1F476}",baby_bottle:"\u{1F37C}",baby_chick:"\u{1F424}",baby_symbol:"\u{1F6BC}",back:"\u{1F519}",bacon:"\u{1F953}",badminton:"\u{1F3F8}",baggage_claim:"\u{1F6C4}",baguette_bread:"\u{1F956}",balance_scale:"\u2696\uFE0F",balloon:"\u{1F388}",ballot_box:"\u{1F5F3}",ballot_box_with_check:"\u2611\uFE0F",bamboo:"\u{1F38D}",banana:"\u{1F34C}",bangbang:"\u203C\uFE0F",bank:"\u{1F3E6}",bar_chart:"\u{1F4CA}",barber:"\u{1F488}",baseball:"\u26BE\uFE0F",basketball:"\u{1F3C0}",basketball_man:"\u26F9\uFE0F",basketball_woman:"\u26F9\uFE0F&zwj;\u2640\uFE0F",bat:"\u{1F987}",bath:"\u{1F6C0}",bathtub:"\u{1F6C1}",battery:"\u{1F50B}",beach_umbrella:"\u{1F3D6}",bear:"\u{1F43B}",bed:"\u{1F6CF}",bee:"\u{1F41D}",beer:"\u{1F37A}",beers:"\u{1F37B}",beetle:"\u{1F41E}",beginner:"\u{1F530}",bell:"\u{1F514}",bellhop_bell:"\u{1F6CE}",bento:"\u{1F371}",biking_man:"\u{1F6B4}",bike:"\u{1F6B2}",biking_woman:"\u{1F6B4}&zwj;\u2640\uFE0F",bikini:"\u{1F459}",biohazard:"\u2623\uFE0F",bird:"\u{1F426}",birthday:"\u{1F382}",black_circle:"\u26AB\uFE0F",black_flag:"\u{1F3F4}",black_heart:"\u{1F5A4}",black_joker:"\u{1F0CF}",black_large_square:"\u2B1B\uFE0F",black_medium_small_square:"\u25FE\uFE0F",black_medium_square:"\u25FC\uFE0F",black_nib:"\u2712\uFE0F",black_small_square:"\u25AA\uFE0F",black_square_button:"\u{1F532}",blonde_man:"\u{1F471}",blonde_woman:"\u{1F471}&zwj;\u2640\uFE0F",blossom:"\u{1F33C}",blowfish:"\u{1F421}",blue_book:"\u{1F4D8}",blue_car:"\u{1F699}",blue_heart:"\u{1F499}",blush:"\u{1F60A}",boar:"\u{1F417}",boat:"\u26F5\uFE0F",bomb:"\u{1F4A3}",book:"\u{1F4D6}",bookmark:"\u{1F516}",bookmark_tabs:"\u{1F4D1}",books:"\u{1F4DA}",boom:"\u{1F4A5}",boot:"\u{1F462}",bouquet:"\u{1F490}",bowing_man:"\u{1F647}",bow_and_arrow:"\u{1F3F9}",bowing_woman:"\u{1F647}&zwj;\u2640\uFE0F",bowling:"\u{1F3B3}",boxing_glove:"\u{1F94A}",boy:"\u{1F466}",bread:"\u{1F35E}",bride_with_veil:"\u{1F470}",bridge_at_night:"\u{1F309}",briefcase:"\u{1F4BC}",broken_heart:"\u{1F494}",bug:"\u{1F41B}",building_construction:"\u{1F3D7}",bulb:"\u{1F4A1}",bullettrain_front:"\u{1F685}",bullettrain_side:"\u{1F684}",burrito:"\u{1F32F}",bus:"\u{1F68C}",business_suit_levitating:"\u{1F574}",busstop:"\u{1F68F}",bust_in_silhouette:"\u{1F464}",busts_in_silhouette:"\u{1F465}",butterfly:"\u{1F98B}",cactus:"\u{1F335}",cake:"\u{1F370}",calendar:"\u{1F4C6}",call_me_hand:"\u{1F919}",calling:"\u{1F4F2}",camel:"\u{1F42B}",camera:"\u{1F4F7}",camera_flash:"\u{1F4F8}",camping:"\u{1F3D5}",cancer:"\u264B\uFE0F",candle:"\u{1F56F}",candy:"\u{1F36C}",canoe:"\u{1F6F6}",capital_abcd:"\u{1F520}",capricorn:"\u2651\uFE0F",car:"\u{1F697}",card_file_box:"\u{1F5C3}",card_index:"\u{1F4C7}",card_index_dividers:"\u{1F5C2}",carousel_horse:"\u{1F3A0}",carrot:"\u{1F955}",cat:"\u{1F431}",cat2:"\u{1F408}",cd:"\u{1F4BF}",chains:"\u26D3",champagne:"\u{1F37E}",chart:"\u{1F4B9}",chart_with_downwards_trend:"\u{1F4C9}",chart_with_upwards_trend:"\u{1F4C8}",checkered_flag:"\u{1F3C1}",cheese:"\u{1F9C0}",cherries:"\u{1F352}",cherry_blossom:"\u{1F338}",chestnut:"\u{1F330}",chicken:"\u{1F414}",children_crossing:"\u{1F6B8}",chipmunk:"\u{1F43F}",chocolate_bar:"\u{1F36B}",christmas_tree:"\u{1F384}",church:"\u26EA\uFE0F",cinema:"\u{1F3A6}",circus_tent:"\u{1F3AA}",city_sunrise:"\u{1F307}",city_sunset:"\u{1F306}",cityscape:"\u{1F3D9}",cl:"\u{1F191}",clamp:"\u{1F5DC}",clap:"\u{1F44F}",clapper:"\u{1F3AC}",classical_building:"\u{1F3DB}",clinking_glasses:"\u{1F942}",clipboard:"\u{1F4CB}",clock1:"\u{1F550}",clock10:"\u{1F559}",clock1030:"\u{1F565}",clock11:"\u{1F55A}",clock1130:"\u{1F566}",clock12:"\u{1F55B}",clock1230:"\u{1F567}",clock130:"\u{1F55C}",clock2:"\u{1F551}",clock230:"\u{1F55D}",clock3:"\u{1F552}",clock330:"\u{1F55E}",clock4:"\u{1F553}",clock430:"\u{1F55F}",clock5:"\u{1F554}",clock530:"\u{1F560}",clock6:"\u{1F555}",clock630:"\u{1F561}",clock7:"\u{1F556}",clock730:"\u{1F562}",clock8:"\u{1F557}",clock830:"\u{1F563}",clock9:"\u{1F558}",clock930:"\u{1F564}",closed_book:"\u{1F4D5}",closed_lock_with_key:"\u{1F510}",closed_umbrella:"\u{1F302}",cloud:"\u2601\uFE0F",cloud_with_lightning:"\u{1F329}",cloud_with_lightning_and_rain:"\u26C8",cloud_with_rain:"\u{1F327}",cloud_with_snow:"\u{1F328}",clown_face:"\u{1F921}",clubs:"\u2663\uFE0F",cocktail:"\u{1F378}",coffee:"\u2615\uFE0F",coffin:"\u26B0\uFE0F",cold_sweat:"\u{1F630}",comet:"\u2604\uFE0F",computer:"\u{1F4BB}",computer_mouse:"\u{1F5B1}",confetti_ball:"\u{1F38A}",confounded:"\u{1F616}",confused:"\u{1F615}",congratulations:"\u3297\uFE0F",construction:"\u{1F6A7}",construction_worker_man:"\u{1F477}",construction_worker_woman:"\u{1F477}&zwj;\u2640\uFE0F",control_knobs:"\u{1F39B}",convenience_store:"\u{1F3EA}",cookie:"\u{1F36A}",cool:"\u{1F192}",policeman:"\u{1F46E}",copyright:"\xA9\uFE0F",corn:"\u{1F33D}",couch_and_lamp:"\u{1F6CB}",couple:"\u{1F46B}",couple_with_heart_woman_man:"\u{1F491}",couple_with_heart_man_man:"\u{1F468}&zwj;\u2764\uFE0F&zwj;\u{1F468}",couple_with_heart_woman_woman:"\u{1F469}&zwj;\u2764\uFE0F&zwj;\u{1F469}",couplekiss_man_man:"\u{1F468}&zwj;\u2764\uFE0F&zwj;\u{1F48B}&zwj;\u{1F468}",couplekiss_man_woman:"\u{1F48F}",couplekiss_woman_woman:"\u{1F469}&zwj;\u2764\uFE0F&zwj;\u{1F48B}&zwj;\u{1F469}",cow:"\u{1F42E}",cow2:"\u{1F404}",cowboy_hat_face:"\u{1F920}",crab:"\u{1F980}",crayon:"\u{1F58D}",credit_card:"\u{1F4B3}",crescent_moon:"\u{1F319}",cricket:"\u{1F3CF}",crocodile:"\u{1F40A}",croissant:"\u{1F950}",crossed_fingers:"\u{1F91E}",crossed_flags:"\u{1F38C}",crossed_swords:"\u2694\uFE0F",crown:"\u{1F451}",cry:"\u{1F622}",crying_cat_face:"\u{1F63F}",crystal_ball:"\u{1F52E}",cucumber:"\u{1F952}",cupid:"\u{1F498}",curly_loop:"\u27B0",currency_exchange:"\u{1F4B1}",curry:"\u{1F35B}",custard:"\u{1F36E}",customs:"\u{1F6C3}",cyclone:"\u{1F300}",dagger:"\u{1F5E1}",dancer:"\u{1F483}",dancing_women:"\u{1F46F}",dancing_men:"\u{1F46F}&zwj;\u2642\uFE0F",dango:"\u{1F361}",dark_sunglasses:"\u{1F576}",dart:"\u{1F3AF}",dash:"\u{1F4A8}",date:"\u{1F4C5}",deciduous_tree:"\u{1F333}",deer:"\u{1F98C}",department_store:"\u{1F3EC}",derelict_house:"\u{1F3DA}",desert:"\u{1F3DC}",desert_island:"\u{1F3DD}",desktop_computer:"\u{1F5A5}",male_detective:"\u{1F575}\uFE0F",diamond_shape_with_a_dot_inside:"\u{1F4A0}",diamonds:"\u2666\uFE0F",disappointed:"\u{1F61E}",disappointed_relieved:"\u{1F625}",dizzy:"\u{1F4AB}",dizzy_face:"\u{1F635}",do_not_litter:"\u{1F6AF}",dog:"\u{1F436}",dog2:"\u{1F415}",dollar:"\u{1F4B5}",dolls:"\u{1F38E}",dolphin:"\u{1F42C}",door:"\u{1F6AA}",doughnut:"\u{1F369}",dove:"\u{1F54A}",dragon:"\u{1F409}",dragon_face:"\u{1F432}",dress:"\u{1F457}",dromedary_camel:"\u{1F42A}",drooling_face:"\u{1F924}",droplet:"\u{1F4A7}",drum:"\u{1F941}",duck:"\u{1F986}",dvd:"\u{1F4C0}","e-mail":"\u{1F4E7}",eagle:"\u{1F985}",ear:"\u{1F442}",ear_of_rice:"\u{1F33E}",earth_africa:"\u{1F30D}",earth_americas:"\u{1F30E}",earth_asia:"\u{1F30F}",egg:"\u{1F95A}",eggplant:"\u{1F346}",eight_pointed_black_star:"\u2734\uFE0F",eight_spoked_asterisk:"\u2733\uFE0F",electric_plug:"\u{1F50C}",elephant:"\u{1F418}",email:"\u2709\uFE0F",end:"\u{1F51A}",envelope_with_arrow:"\u{1F4E9}",euro:"\u{1F4B6}",european_castle:"\u{1F3F0}",european_post_office:"\u{1F3E4}",evergreen_tree:"\u{1F332}",exclamation:"\u2757\uFE0F",expressionless:"\u{1F611}",eye:"\u{1F441}",eye_speech_bubble:"\u{1F441}&zwj;\u{1F5E8}",eyeglasses:"\u{1F453}",eyes:"\u{1F440}",face_with_head_bandage:"\u{1F915}",face_with_thermometer:"\u{1F912}",fist_oncoming:"\u{1F44A}",factory:"\u{1F3ED}",fallen_leaf:"\u{1F342}",family_man_woman_boy:"\u{1F46A}",family_man_boy:"\u{1F468}&zwj;\u{1F466}",family_man_boy_boy:"\u{1F468}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_girl:"\u{1F468}&zwj;\u{1F467}",family_man_girl_boy:"\u{1F468}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_girl_girl:"\u{1F468}&zwj;\u{1F467}&zwj;\u{1F467}",family_man_man_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F466}",family_man_man_boy_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_man_girl:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}",family_man_man_girl_boy:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_man_girl_girl:"\u{1F468}&zwj;\u{1F468}&zwj;\u{1F467}&zwj;\u{1F467}",family_man_woman_boy_boy:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_man_woman_girl:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}",family_man_woman_girl_boy:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_man_woman_girl_girl:"\u{1F468}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",family_woman_boy:"\u{1F469}&zwj;\u{1F466}",family_woman_boy_boy:"\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_woman_girl:"\u{1F469}&zwj;\u{1F467}",family_woman_girl_boy:"\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_woman_girl_girl:"\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",family_woman_woman_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F466}",family_woman_woman_boy_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F466}&zwj;\u{1F466}",family_woman_woman_girl:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}",family_woman_woman_girl_boy:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F466}",family_woman_woman_girl_girl:"\u{1F469}&zwj;\u{1F469}&zwj;\u{1F467}&zwj;\u{1F467}",fast_forward:"\u23E9",fax:"\u{1F4E0}",fearful:"\u{1F628}",feet:"\u{1F43E}",female_detective:"\u{1F575}\uFE0F&zwj;\u2640\uFE0F",ferris_wheel:"\u{1F3A1}",ferry:"\u26F4",field_hockey:"\u{1F3D1}",file_cabinet:"\u{1F5C4}",file_folder:"\u{1F4C1}",film_projector:"\u{1F4FD}",film_strip:"\u{1F39E}",fire:"\u{1F525}",fire_engine:"\u{1F692}",fireworks:"\u{1F386}",first_quarter_moon:"\u{1F313}",first_quarter_moon_with_face:"\u{1F31B}",fish:"\u{1F41F}",fish_cake:"\u{1F365}",fishing_pole_and_fish:"\u{1F3A3}",fist_raised:"\u270A",fist_left:"\u{1F91B}",fist_right:"\u{1F91C}",flags:"\u{1F38F}",flashlight:"\u{1F526}",fleur_de_lis:"\u269C\uFE0F",flight_arrival:"\u{1F6EC}",flight_departure:"\u{1F6EB}",floppy_disk:"\u{1F4BE}",flower_playing_cards:"\u{1F3B4}",flushed:"\u{1F633}",fog:"\u{1F32B}",foggy:"\u{1F301}",football:"\u{1F3C8}",footprints:"\u{1F463}",fork_and_knife:"\u{1F374}",fountain:"\u26F2\uFE0F",fountain_pen:"\u{1F58B}",four_leaf_clover:"\u{1F340}",fox_face:"\u{1F98A}",framed_picture:"\u{1F5BC}",free:"\u{1F193}",fried_egg:"\u{1F373}",fried_shrimp:"\u{1F364}",fries:"\u{1F35F}",frog:"\u{1F438}",frowning:"\u{1F626}",frowning_face:"\u2639\uFE0F",frowning_man:"\u{1F64D}&zwj;\u2642\uFE0F",frowning_woman:"\u{1F64D}",middle_finger:"\u{1F595}",fuelpump:"\u26FD\uFE0F",full_moon:"\u{1F315}",full_moon_with_face:"\u{1F31D}",funeral_urn:"\u26B1\uFE0F",game_die:"\u{1F3B2}",gear:"\u2699\uFE0F",gem:"\u{1F48E}",gemini:"\u264A\uFE0F",ghost:"\u{1F47B}",gift:"\u{1F381}",gift_heart:"\u{1F49D}",girl:"\u{1F467}",globe_with_meridians:"\u{1F310}",goal_net:"\u{1F945}",goat:"\u{1F410}",golf:"\u26F3\uFE0F",golfing_man:"\u{1F3CC}\uFE0F",golfing_woman:"\u{1F3CC}\uFE0F&zwj;\u2640\uFE0F",gorilla:"\u{1F98D}",grapes:"\u{1F347}",green_apple:"\u{1F34F}",green_book:"\u{1F4D7}",green_heart:"\u{1F49A}",green_salad:"\u{1F957}",grey_exclamation:"\u2755",grey_question:"\u2754",grimacing:"\u{1F62C}",grin:"\u{1F601}",grinning:"\u{1F600}",guardsman:"\u{1F482}",guardswoman:"\u{1F482}&zwj;\u2640\uFE0F",guitar:"\u{1F3B8}",gun:"\u{1F52B}",haircut_woman:"\u{1F487}",haircut_man:"\u{1F487}&zwj;\u2642\uFE0F",hamburger:"\u{1F354}",hammer:"\u{1F528}",hammer_and_pick:"\u2692",hammer_and_wrench:"\u{1F6E0}",hamster:"\u{1F439}",hand:"\u270B",handbag:"\u{1F45C}",handshake:"\u{1F91D}",hankey:"\u{1F4A9}",hatched_chick:"\u{1F425}",hatching_chick:"\u{1F423}",headphones:"\u{1F3A7}",hear_no_evil:"\u{1F649}",heart:"\u2764\uFE0F",heart_decoration:"\u{1F49F}",heart_eyes:"\u{1F60D}",heart_eyes_cat:"\u{1F63B}",heartbeat:"\u{1F493}",heartpulse:"\u{1F497}",hearts:"\u2665\uFE0F",heavy_check_mark:"\u2714\uFE0F",heavy_division_sign:"\u2797",heavy_dollar_sign:"\u{1F4B2}",heavy_heart_exclamation:"\u2763\uFE0F",heavy_minus_sign:"\u2796",heavy_multiplication_x:"\u2716\uFE0F",heavy_plus_sign:"\u2795",helicopter:"\u{1F681}",herb:"\u{1F33F}",hibiscus:"\u{1F33A}",high_brightness:"\u{1F506}",high_heel:"\u{1F460}",hocho:"\u{1F52A}",hole:"\u{1F573}",honey_pot:"\u{1F36F}",horse:"\u{1F434}",horse_racing:"\u{1F3C7}",hospital:"\u{1F3E5}",hot_pepper:"\u{1F336}",hotdog:"\u{1F32D}",hotel:"\u{1F3E8}",hotsprings:"\u2668\uFE0F",hourglass:"\u231B\uFE0F",hourglass_flowing_sand:"\u23F3",house:"\u{1F3E0}",house_with_garden:"\u{1F3E1}",houses:"\u{1F3D8}",hugs:"\u{1F917}",hushed:"\u{1F62F}",ice_cream:"\u{1F368}",ice_hockey:"\u{1F3D2}",ice_skate:"\u26F8",icecream:"\u{1F366}",id:"\u{1F194}",ideograph_advantage:"\u{1F250}",imp:"\u{1F47F}",inbox_tray:"\u{1F4E5}",incoming_envelope:"\u{1F4E8}",tipping_hand_woman:"\u{1F481}",information_source:"\u2139\uFE0F",innocent:"\u{1F607}",interrobang:"\u2049\uFE0F",iphone:"\u{1F4F1}",izakaya_lantern:"\u{1F3EE}",jack_o_lantern:"\u{1F383}",japan:"\u{1F5FE}",japanese_castle:"\u{1F3EF}",japanese_goblin:"\u{1F47A}",japanese_ogre:"\u{1F479}",jeans:"\u{1F456}",joy:"\u{1F602}",joy_cat:"\u{1F639}",joystick:"\u{1F579}",kaaba:"\u{1F54B}",key:"\u{1F511}",keyboard:"\u2328\uFE0F",keycap_ten:"\u{1F51F}",kick_scooter:"\u{1F6F4}",kimono:"\u{1F458}",kiss:"\u{1F48B}",kissing:"\u{1F617}",kissing_cat:"\u{1F63D}",kissing_closed_eyes:"\u{1F61A}",kissing_heart:"\u{1F618}",kissing_smiling_eyes:"\u{1F619}",kiwi_fruit:"\u{1F95D}",koala:"\u{1F428}",koko:"\u{1F201}",label:"\u{1F3F7}",large_blue_circle:"\u{1F535}",large_blue_diamond:"\u{1F537}",large_orange_diamond:"\u{1F536}",last_quarter_moon:"\u{1F317}",last_quarter_moon_with_face:"\u{1F31C}",latin_cross:"\u271D\uFE0F",laughing:"\u{1F606}",leaves:"\u{1F343}",ledger:"\u{1F4D2}",left_luggage:"\u{1F6C5}",left_right_arrow:"\u2194\uFE0F",leftwards_arrow_with_hook:"\u21A9\uFE0F",lemon:"\u{1F34B}",leo:"\u264C\uFE0F",leopard:"\u{1F406}",level_slider:"\u{1F39A}",libra:"\u264E\uFE0F",light_rail:"\u{1F688}",link:"\u{1F517}",lion:"\u{1F981}",lips:"\u{1F444}",lipstick:"\u{1F484}",lizard:"\u{1F98E}",lock:"\u{1F512}",lock_with_ink_pen:"\u{1F50F}",lollipop:"\u{1F36D}",loop:"\u27BF",loud_sound:"\u{1F50A}",loudspeaker:"\u{1F4E2}",love_hotel:"\u{1F3E9}",love_letter:"\u{1F48C}",low_brightness:"\u{1F505}",lying_face:"\u{1F925}",m:"\u24C2\uFE0F",mag:"\u{1F50D}",mag_right:"\u{1F50E}",mahjong:"\u{1F004}\uFE0F",mailbox:"\u{1F4EB}",mailbox_closed:"\u{1F4EA}",mailbox_with_mail:"\u{1F4EC}",mailbox_with_no_mail:"\u{1F4ED}",man:"\u{1F468}",man_artist:"\u{1F468}&zwj;\u{1F3A8}",man_astronaut:"\u{1F468}&zwj;\u{1F680}",man_cartwheeling:"\u{1F938}&zwj;\u2642\uFE0F",man_cook:"\u{1F468}&zwj;\u{1F373}",man_dancing:"\u{1F57A}",man_facepalming:"\u{1F926}&zwj;\u2642\uFE0F",man_factory_worker:"\u{1F468}&zwj;\u{1F3ED}",man_farmer:"\u{1F468}&zwj;\u{1F33E}",man_firefighter:"\u{1F468}&zwj;\u{1F692}",man_health_worker:"\u{1F468}&zwj;\u2695\uFE0F",man_in_tuxedo:"\u{1F935}",man_judge:"\u{1F468}&zwj;\u2696\uFE0F",man_juggling:"\u{1F939}&zwj;\u2642\uFE0F",man_mechanic:"\u{1F468}&zwj;\u{1F527}",man_office_worker:"\u{1F468}&zwj;\u{1F4BC}",man_pilot:"\u{1F468}&zwj;\u2708\uFE0F",man_playing_handball:"\u{1F93E}&zwj;\u2642\uFE0F",man_playing_water_polo:"\u{1F93D}&zwj;\u2642\uFE0F",man_scientist:"\u{1F468}&zwj;\u{1F52C}",man_shrugging:"\u{1F937}&zwj;\u2642\uFE0F",man_singer:"\u{1F468}&zwj;\u{1F3A4}",man_student:"\u{1F468}&zwj;\u{1F393}",man_teacher:"\u{1F468}&zwj;\u{1F3EB}",man_technologist:"\u{1F468}&zwj;\u{1F4BB}",man_with_gua_pi_mao:"\u{1F472}",man_with_turban:"\u{1F473}",tangerine:"\u{1F34A}",mans_shoe:"\u{1F45E}",mantelpiece_clock:"\u{1F570}",maple_leaf:"\u{1F341}",martial_arts_uniform:"\u{1F94B}",mask:"\u{1F637}",massage_woman:"\u{1F486}",massage_man:"\u{1F486}&zwj;\u2642\uFE0F",meat_on_bone:"\u{1F356}",medal_military:"\u{1F396}",medal_sports:"\u{1F3C5}",mega:"\u{1F4E3}",melon:"\u{1F348}",memo:"\u{1F4DD}",men_wrestling:"\u{1F93C}&zwj;\u2642\uFE0F",menorah:"\u{1F54E}",mens:"\u{1F6B9}",metal:"\u{1F918}",metro:"\u{1F687}",microphone:"\u{1F3A4}",microscope:"\u{1F52C}",milk_glass:"\u{1F95B}",milky_way:"\u{1F30C}",minibus:"\u{1F690}",minidisc:"\u{1F4BD}",mobile_phone_off:"\u{1F4F4}",money_mouth_face:"\u{1F911}",money_with_wings:"\u{1F4B8}",moneybag:"\u{1F4B0}",monkey:"\u{1F412}",monkey_face:"\u{1F435}",monorail:"\u{1F69D}",moon:"\u{1F314}",mortar_board:"\u{1F393}",mosque:"\u{1F54C}",motor_boat:"\u{1F6E5}",motor_scooter:"\u{1F6F5}",motorcycle:"\u{1F3CD}",motorway:"\u{1F6E3}",mount_fuji:"\u{1F5FB}",mountain:"\u26F0",mountain_biking_man:"\u{1F6B5}",mountain_biking_woman:"\u{1F6B5}&zwj;\u2640\uFE0F",mountain_cableway:"\u{1F6A0}",mountain_railway:"\u{1F69E}",mountain_snow:"\u{1F3D4}",mouse:"\u{1F42D}",mouse2:"\u{1F401}",movie_camera:"\u{1F3A5}",moyai:"\u{1F5FF}",mrs_claus:"\u{1F936}",muscle:"\u{1F4AA}",mushroom:"\u{1F344}",musical_keyboard:"\u{1F3B9}",musical_note:"\u{1F3B5}",musical_score:"\u{1F3BC}",mute:"\u{1F507}",nail_care:"\u{1F485}",name_badge:"\u{1F4DB}",national_park:"\u{1F3DE}",nauseated_face:"\u{1F922}",necktie:"\u{1F454}",negative_squared_cross_mark:"\u274E",nerd_face:"\u{1F913}",neutral_face:"\u{1F610}",new:"\u{1F195}",new_moon:"\u{1F311}",new_moon_with_face:"\u{1F31A}",newspaper:"\u{1F4F0}",newspaper_roll:"\u{1F5DE}",next_track_button:"\u23ED",ng:"\u{1F196}",no_good_man:"\u{1F645}&zwj;\u2642\uFE0F",no_good_woman:"\u{1F645}",night_with_stars:"\u{1F303}",no_bell:"\u{1F515}",no_bicycles:"\u{1F6B3}",no_entry:"\u26D4\uFE0F",no_entry_sign:"\u{1F6AB}",no_mobile_phones:"\u{1F4F5}",no_mouth:"\u{1F636}",no_pedestrians:"\u{1F6B7}",no_smoking:"\u{1F6AD}","non-potable_water":"\u{1F6B1}",nose:"\u{1F443}",notebook:"\u{1F4D3}",notebook_with_decorative_cover:"\u{1F4D4}",notes:"\u{1F3B6}",nut_and_bolt:"\u{1F529}",o:"\u2B55\uFE0F",o2:"\u{1F17E}\uFE0F",ocean:"\u{1F30A}",octopus:"\u{1F419}",oden:"\u{1F362}",office:"\u{1F3E2}",oil_drum:"\u{1F6E2}",ok:"\u{1F197}",ok_hand:"\u{1F44C}",ok_man:"\u{1F646}&zwj;\u2642\uFE0F",ok_woman:"\u{1F646}",old_key:"\u{1F5DD}",older_man:"\u{1F474}",older_woman:"\u{1F475}",om:"\u{1F549}",on:"\u{1F51B}",oncoming_automobile:"\u{1F698}",oncoming_bus:"\u{1F68D}",oncoming_police_car:"\u{1F694}",oncoming_taxi:"\u{1F696}",open_file_folder:"\u{1F4C2}",open_hands:"\u{1F450}",open_mouth:"\u{1F62E}",open_umbrella:"\u2602\uFE0F",ophiuchus:"\u26CE",orange_book:"\u{1F4D9}",orthodox_cross:"\u2626\uFE0F",outbox_tray:"\u{1F4E4}",owl:"\u{1F989}",ox:"\u{1F402}",package:"\u{1F4E6}",page_facing_up:"\u{1F4C4}",page_with_curl:"\u{1F4C3}",pager:"\u{1F4DF}",paintbrush:"\u{1F58C}",palm_tree:"\u{1F334}",pancakes:"\u{1F95E}",panda_face:"\u{1F43C}",paperclip:"\u{1F4CE}",paperclips:"\u{1F587}",parasol_on_ground:"\u26F1",parking:"\u{1F17F}\uFE0F",part_alternation_mark:"\u303D\uFE0F",partly_sunny:"\u26C5\uFE0F",passenger_ship:"\u{1F6F3}",passport_control:"\u{1F6C2}",pause_button:"\u23F8",peace_symbol:"\u262E\uFE0F",peach:"\u{1F351}",peanuts:"\u{1F95C}",pear:"\u{1F350}",pen:"\u{1F58A}",pencil2:"\u270F\uFE0F",penguin:"\u{1F427}",pensive:"\u{1F614}",performing_arts:"\u{1F3AD}",persevere:"\u{1F623}",person_fencing:"\u{1F93A}",pouting_woman:"\u{1F64E}",phone:"\u260E\uFE0F",pick:"\u26CF",pig:"\u{1F437}",pig2:"\u{1F416}",pig_nose:"\u{1F43D}",pill:"\u{1F48A}",pineapple:"\u{1F34D}",ping_pong:"\u{1F3D3}",pisces:"\u2653\uFE0F",pizza:"\u{1F355}",place_of_worship:"\u{1F6D0}",plate_with_cutlery:"\u{1F37D}",play_or_pause_button:"\u23EF",point_down:"\u{1F447}",point_left:"\u{1F448}",point_right:"\u{1F449}",point_up:"\u261D\uFE0F",point_up_2:"\u{1F446}",police_car:"\u{1F693}",policewoman:"\u{1F46E}&zwj;\u2640\uFE0F",poodle:"\u{1F429}",popcorn:"\u{1F37F}",post_office:"\u{1F3E3}",postal_horn:"\u{1F4EF}",postbox:"\u{1F4EE}",potable_water:"\u{1F6B0}",potato:"\u{1F954}",pouch:"\u{1F45D}",poultry_leg:"\u{1F357}",pound:"\u{1F4B7}",rage:"\u{1F621}",pouting_cat:"\u{1F63E}",pouting_man:"\u{1F64E}&zwj;\u2642\uFE0F",pray:"\u{1F64F}",prayer_beads:"\u{1F4FF}",pregnant_woman:"\u{1F930}",previous_track_button:"\u23EE",prince:"\u{1F934}",princess:"\u{1F478}",printer:"\u{1F5A8}",purple_heart:"\u{1F49C}",purse:"\u{1F45B}",pushpin:"\u{1F4CC}",put_litter_in_its_place:"\u{1F6AE}",question:"\u2753",rabbit:"\u{1F430}",rabbit2:"\u{1F407}",racehorse:"\u{1F40E}",racing_car:"\u{1F3CE}",radio:"\u{1F4FB}",radio_button:"\u{1F518}",radioactive:"\u2622\uFE0F",railway_car:"\u{1F683}",railway_track:"\u{1F6E4}",rainbow:"\u{1F308}",rainbow_flag:"\u{1F3F3}\uFE0F&zwj;\u{1F308}",raised_back_of_hand:"\u{1F91A}",raised_hand_with_fingers_splayed:"\u{1F590}",raised_hands:"\u{1F64C}",raising_hand_woman:"\u{1F64B}",raising_hand_man:"\u{1F64B}&zwj;\u2642\uFE0F",ram:"\u{1F40F}",ramen:"\u{1F35C}",rat:"\u{1F400}",record_button:"\u23FA",recycle:"\u267B\uFE0F",red_circle:"\u{1F534}",registered:"\xAE\uFE0F",relaxed:"\u263A\uFE0F",relieved:"\u{1F60C}",reminder_ribbon:"\u{1F397}",repeat:"\u{1F501}",repeat_one:"\u{1F502}",rescue_worker_helmet:"\u26D1",restroom:"\u{1F6BB}",revolving_hearts:"\u{1F49E}",rewind:"\u23EA",rhinoceros:"\u{1F98F}",ribbon:"\u{1F380}",rice:"\u{1F35A}",rice_ball:"\u{1F359}",rice_cracker:"\u{1F358}",rice_scene:"\u{1F391}",right_anger_bubble:"\u{1F5EF}",ring:"\u{1F48D}",robot:"\u{1F916}",rocket:"\u{1F680}",rofl:"\u{1F923}",roll_eyes:"\u{1F644}",roller_coaster:"\u{1F3A2}",rooster:"\u{1F413}",rose:"\u{1F339}",rosette:"\u{1F3F5}",rotating_light:"\u{1F6A8}",round_pushpin:"\u{1F4CD}",rowing_man:"\u{1F6A3}",rowing_woman:"\u{1F6A3}&zwj;\u2640\uFE0F",rugby_football:"\u{1F3C9}",running_man:"\u{1F3C3}",running_shirt_with_sash:"\u{1F3BD}",running_woman:"\u{1F3C3}&zwj;\u2640\uFE0F",sa:"\u{1F202}\uFE0F",sagittarius:"\u2650\uFE0F",sake:"\u{1F376}",sandal:"\u{1F461}",santa:"\u{1F385}",satellite:"\u{1F4E1}",saxophone:"\u{1F3B7}",school:"\u{1F3EB}",school_satchel:"\u{1F392}",scissors:"\u2702\uFE0F",scorpion:"\u{1F982}",scorpius:"\u264F\uFE0F",scream:"\u{1F631}",scream_cat:"\u{1F640}",scroll:"\u{1F4DC}",seat:"\u{1F4BA}",secret:"\u3299\uFE0F",see_no_evil:"\u{1F648}",seedling:"\u{1F331}",selfie:"\u{1F933}",shallow_pan_of_food:"\u{1F958}",shamrock:"\u2618\uFE0F",shark:"\u{1F988}",shaved_ice:"\u{1F367}",sheep:"\u{1F411}",shell:"\u{1F41A}",shield:"\u{1F6E1}",shinto_shrine:"\u26E9",ship:"\u{1F6A2}",shirt:"\u{1F455}",shopping:"\u{1F6CD}",shopping_cart:"\u{1F6D2}",shower:"\u{1F6BF}",shrimp:"\u{1F990}",signal_strength:"\u{1F4F6}",six_pointed_star:"\u{1F52F}",ski:"\u{1F3BF}",skier:"\u26F7",skull:"\u{1F480}",skull_and_crossbones:"\u2620\uFE0F",sleeping:"\u{1F634}",sleeping_bed:"\u{1F6CC}",sleepy:"\u{1F62A}",slightly_frowning_face:"\u{1F641}",slightly_smiling_face:"\u{1F642}",slot_machine:"\u{1F3B0}",small_airplane:"\u{1F6E9}",small_blue_diamond:"\u{1F539}",small_orange_diamond:"\u{1F538}",small_red_triangle:"\u{1F53A}",small_red_triangle_down:"\u{1F53B}",smile:"\u{1F604}",smile_cat:"\u{1F638}",smiley:"\u{1F603}",smiley_cat:"\u{1F63A}",smiling_imp:"\u{1F608}",smirk:"\u{1F60F}",smirk_cat:"\u{1F63C}",smoking:"\u{1F6AC}",snail:"\u{1F40C}",snake:"\u{1F40D}",sneezing_face:"\u{1F927}",snowboarder:"\u{1F3C2}",snowflake:"\u2744\uFE0F",snowman:"\u26C4\uFE0F",snowman_with_snow:"\u2603\uFE0F",sob:"\u{1F62D}",soccer:"\u26BD\uFE0F",soon:"\u{1F51C}",sos:"\u{1F198}",sound:"\u{1F509}",space_invader:"\u{1F47E}",spades:"\u2660\uFE0F",spaghetti:"\u{1F35D}",sparkle:"\u2747\uFE0F",sparkler:"\u{1F387}",sparkles:"\u2728",sparkling_heart:"\u{1F496}",speak_no_evil:"\u{1F64A}",speaker:"\u{1F508}",speaking_head:"\u{1F5E3}",speech_balloon:"\u{1F4AC}",speedboat:"\u{1F6A4}",spider:"\u{1F577}",spider_web:"\u{1F578}",spiral_calendar:"\u{1F5D3}",spiral_notepad:"\u{1F5D2}",spoon:"\u{1F944}",squid:"\u{1F991}",stadium:"\u{1F3DF}",star:"\u2B50\uFE0F",star2:"\u{1F31F}",star_and_crescent:"\u262A\uFE0F",star_of_david:"\u2721\uFE0F",stars:"\u{1F320}",station:"\u{1F689}",statue_of_liberty:"\u{1F5FD}",steam_locomotive:"\u{1F682}",stew:"\u{1F372}",stop_button:"\u23F9",stop_sign:"\u{1F6D1}",stopwatch:"\u23F1",straight_ruler:"\u{1F4CF}",strawberry:"\u{1F353}",stuck_out_tongue:"\u{1F61B}",stuck_out_tongue_closed_eyes:"\u{1F61D}",stuck_out_tongue_winking_eye:"\u{1F61C}",studio_microphone:"\u{1F399}",stuffed_flatbread:"\u{1F959}",sun_behind_large_cloud:"\u{1F325}",sun_behind_rain_cloud:"\u{1F326}",sun_behind_small_cloud:"\u{1F324}",sun_with_face:"\u{1F31E}",sunflower:"\u{1F33B}",sunglasses:"\u{1F60E}",sunny:"\u2600\uFE0F",sunrise:"\u{1F305}",sunrise_over_mountains:"\u{1F304}",surfing_man:"\u{1F3C4}",surfing_woman:"\u{1F3C4}&zwj;\u2640\uFE0F",sushi:"\u{1F363}",suspension_railway:"\u{1F69F}",sweat:"\u{1F613}",sweat_drops:"\u{1F4A6}",sweat_smile:"\u{1F605}",sweet_potato:"\u{1F360}",swimming_man:"\u{1F3CA}",swimming_woman:"\u{1F3CA}&zwj;\u2640\uFE0F",symbols:"\u{1F523}",synagogue:"\u{1F54D}",syringe:"\u{1F489}",taco:"\u{1F32E}",tada:"\u{1F389}",tanabata_tree:"\u{1F38B}",taurus:"\u2649\uFE0F",taxi:"\u{1F695}",tea:"\u{1F375}",telephone_receiver:"\u{1F4DE}",telescope:"\u{1F52D}",tennis:"\u{1F3BE}",tent:"\u26FA\uFE0F",thermometer:"\u{1F321}",thinking:"\u{1F914}",thought_balloon:"\u{1F4AD}",ticket:"\u{1F3AB}",tickets:"\u{1F39F}",tiger:"\u{1F42F}",tiger2:"\u{1F405}",timer_clock:"\u23F2",tipping_hand_man:"\u{1F481}&zwj;\u2642\uFE0F",tired_face:"\u{1F62B}",tm:"\u2122\uFE0F",toilet:"\u{1F6BD}",tokyo_tower:"\u{1F5FC}",tomato:"\u{1F345}",tongue:"\u{1F445}",top:"\u{1F51D}",tophat:"\u{1F3A9}",tornado:"\u{1F32A}",trackball:"\u{1F5B2}",tractor:"\u{1F69C}",traffic_light:"\u{1F6A5}",train:"\u{1F68B}",train2:"\u{1F686}",tram:"\u{1F68A}",triangular_flag_on_post:"\u{1F6A9}",triangular_ruler:"\u{1F4D0}",trident:"\u{1F531}",triumph:"\u{1F624}",trolleybus:"\u{1F68E}",trophy:"\u{1F3C6}",tropical_drink:"\u{1F379}",tropical_fish:"\u{1F420}",truck:"\u{1F69A}",trumpet:"\u{1F3BA}",tulip:"\u{1F337}",tumbler_glass:"\u{1F943}",turkey:"\u{1F983}",turtle:"\u{1F422}",tv:"\u{1F4FA}",twisted_rightwards_arrows:"\u{1F500}",two_hearts:"\u{1F495}",two_men_holding_hands:"\u{1F46C}",two_women_holding_hands:"\u{1F46D}",u5272:"\u{1F239}",u5408:"\u{1F234}",u55b6:"\u{1F23A}",u6307:"\u{1F22F}\uFE0F",u6708:"\u{1F237}\uFE0F",u6709:"\u{1F236}",u6e80:"\u{1F235}",u7121:"\u{1F21A}\uFE0F",u7533:"\u{1F238}",u7981:"\u{1F232}",u7a7a:"\u{1F233}",umbrella:"\u2614\uFE0F",unamused:"\u{1F612}",underage:"\u{1F51E}",unicorn:"\u{1F984}",unlock:"\u{1F513}",up:"\u{1F199}",upside_down_face:"\u{1F643}",v:"\u270C\uFE0F",vertical_traffic_light:"\u{1F6A6}",vhs:"\u{1F4FC}",vibration_mode:"\u{1F4F3}",video_camera:"\u{1F4F9}",video_game:"\u{1F3AE}",violin:"\u{1F3BB}",virgo:"\u264D\uFE0F",volcano:"\u{1F30B}",volleyball:"\u{1F3D0}",vs:"\u{1F19A}",vulcan_salute:"\u{1F596}",walking_man:"\u{1F6B6}",walking_woman:"\u{1F6B6}&zwj;\u2640\uFE0F",waning_crescent_moon:"\u{1F318}",waning_gibbous_moon:"\u{1F316}",warning:"\u26A0\uFE0F",wastebasket:"\u{1F5D1}",watch:"\u231A\uFE0F",water_buffalo:"\u{1F403}",watermelon:"\u{1F349}",wave:"\u{1F44B}",wavy_dash:"\u3030\uFE0F",waxing_crescent_moon:"\u{1F312}",wc:"\u{1F6BE}",weary:"\u{1F629}",wedding:"\u{1F492}",weight_lifting_man:"\u{1F3CB}\uFE0F",weight_lifting_woman:"\u{1F3CB}\uFE0F&zwj;\u2640\uFE0F",whale:"\u{1F433}",whale2:"\u{1F40B}",wheel_of_dharma:"\u2638\uFE0F",wheelchair:"\u267F\uFE0F",white_check_mark:"\u2705",white_circle:"\u26AA\uFE0F",white_flag:"\u{1F3F3}\uFE0F",white_flower:"\u{1F4AE}",white_large_square:"\u2B1C\uFE0F",white_medium_small_square:"\u25FD\uFE0F",white_medium_square:"\u25FB\uFE0F",white_small_square:"\u25AB\uFE0F",white_square_button:"\u{1F533}",wilted_flower:"\u{1F940}",wind_chime:"\u{1F390}",wind_face:"\u{1F32C}",wine_glass:"\u{1F377}",wink:"\u{1F609}",wolf:"\u{1F43A}",woman:"\u{1F469}",woman_artist:"\u{1F469}&zwj;\u{1F3A8}",woman_astronaut:"\u{1F469}&zwj;\u{1F680}",woman_cartwheeling:"\u{1F938}&zwj;\u2640\uFE0F",woman_cook:"\u{1F469}&zwj;\u{1F373}",woman_facepalming:"\u{1F926}&zwj;\u2640\uFE0F",woman_factory_worker:"\u{1F469}&zwj;\u{1F3ED}",woman_farmer:"\u{1F469}&zwj;\u{1F33E}",woman_firefighter:"\u{1F469}&zwj;\u{1F692}",woman_health_worker:"\u{1F469}&zwj;\u2695\uFE0F",woman_judge:"\u{1F469}&zwj;\u2696\uFE0F",woman_juggling:"\u{1F939}&zwj;\u2640\uFE0F",woman_mechanic:"\u{1F469}&zwj;\u{1F527}",woman_office_worker:"\u{1F469}&zwj;\u{1F4BC}",woman_pilot:"\u{1F469}&zwj;\u2708\uFE0F",woman_playing_handball:"\u{1F93E}&zwj;\u2640\uFE0F",woman_playing_water_polo:"\u{1F93D}&zwj;\u2640\uFE0F",woman_scientist:"\u{1F469}&zwj;\u{1F52C}",woman_shrugging:"\u{1F937}&zwj;\u2640\uFE0F",woman_singer:"\u{1F469}&zwj;\u{1F3A4}",woman_student:"\u{1F469}&zwj;\u{1F393}",woman_teacher:"\u{1F469}&zwj;\u{1F3EB}",woman_technologist:"\u{1F469}&zwj;\u{1F4BB}",woman_with_turban:"\u{1F473}&zwj;\u2640\uFE0F",womans_clothes:"\u{1F45A}",womans_hat:"\u{1F452}",women_wrestling:"\u{1F93C}&zwj;\u2640\uFE0F",womens:"\u{1F6BA}",world_map:"\u{1F5FA}",worried:"\u{1F61F}",wrench:"\u{1F527}",writing_hand:"\u270D\uFE0F",x:"\u274C",yellow_heart:"\u{1F49B}",yen:"\u{1F4B4}",yin_yang:"\u262F\uFE0F",yum:"\u{1F60B}",zap:"\u26A1\uFE0F",zipper_mouth_face:"\u{1F910}",zzz:"\u{1F4A4}",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},t.Converter=function(d){"use strict";var g={},_=[],y=[],O={},E=o,k={parsed:{},raw:"",format:""};M();function M(){d=d||{};for(var B in n)n.hasOwnProperty(B)&&(g[B]=n[B]);if(typeof d=="object")for(var Q in d)d.hasOwnProperty(Q)&&(g[Q]=d[Q]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof d+" was passed instead.");g.extensions&&t.helper.forEach(g.extensions,q)}function q(B,Q){if(Q=Q||null,t.helper.isString(B))if(B=t.helper.stdExtName(B),Q=B,t.extensions[B]){console.warn("DEPRECATION WARNING: "+B+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),Y(t.extensions[B],B);return}else if(!t.helper.isUndefined(s[B]))B=s[B];else throw Error('Extension "'+B+'" could not be loaded. It was either not found or is not a valid extension.');typeof B=="function"&&(B=B()),t.helper.isArray(B)||(B=[B]);var ne=l(B,Q);if(!ne.valid)throw Error(ne.error);for(var ce=0;ce<B.length;++ce){switch(B[ce].type){case"lang":_.push(B[ce]);break;case"output":y.push(B[ce]);break}if(B[ce].hasOwnProperty("listeners"))for(var be in B[ce].listeners)B[ce].listeners.hasOwnProperty(be)&&F(be,B[ce].listeners[be])}}function Y(B,Q){typeof B=="function"&&(B=B(new t.Converter)),t.helper.isArray(B)||(B=[B]);var ne=l(B,Q);if(!ne.valid)throw Error(ne.error);for(var ce=0;ce<B.length;++ce)switch(B[ce].type){case"lang":_.push(B[ce]);break;case"output":y.push(B[ce]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function F(B,Q){if(!t.helper.isString(B))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof B+" given");if(typeof Q!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof Q+" given");O.hasOwnProperty(B)||(O[B]=[]),O[B].push(Q)}function Z(B){var Q=B.match(/^\s*/)[0].length,ne=new RegExp("^\\s{0,"+Q+"}","gm");return B.replace(ne,"")}this._dispatch=function(Q,ne,ce,be){if(O.hasOwnProperty(Q))for(var pe=0;pe<O[Q].length;++pe){var Ie=O[Q][pe](Q,ne,this,ce,be);Ie&&typeof Ie!="undefined"&&(ne=Ie)}return ne},this.listen=function(B,Q){return F(B,Q),this},this.makeHtml=function(B){if(!B)return B;var Q={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:_,outputModifiers:y,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return B=B.replace(/¨/g,"\xA8T"),B=B.replace(/\$/g,"\xA8D"),B=B.replace(/\r\n/g,`
`),B=B.replace(/\r/g,`
`),B=B.replace(/\u00A0/g,"&nbsp;"),g.smartIndentationFix&&(B=Z(B)),B=`

`+B+`

`,B=t.subParser("detab")(B,g,Q),B=B.replace(/^[ \t]+$/mg,""),t.helper.forEach(_,function(ne){B=t.subParser("runExtension")(ne,B,g,Q)}),B=t.subParser("metadata")(B,g,Q),B=t.subParser("hashPreCodeTags")(B,g,Q),B=t.subParser("githubCodeBlocks")(B,g,Q),B=t.subParser("hashHTMLBlocks")(B,g,Q),B=t.subParser("hashCodeTags")(B,g,Q),B=t.subParser("stripLinkDefinitions")(B,g,Q),B=t.subParser("blockGamut")(B,g,Q),B=t.subParser("unhashHTMLSpans")(B,g,Q),B=t.subParser("unescapeSpecialChars")(B,g,Q),B=B.replace(/¨D/g,"$$"),B=B.replace(/¨T/g,"\xA8"),B=t.subParser("completeHTMLDocument")(B,g,Q),t.helper.forEach(y,function(ne){B=t.subParser("runExtension")(ne,B,g,Q)}),k=Q.metadata,B},this.makeMarkdown=this.makeMd=function(B,Q){if(B=B.replace(/\r\n/g,`
`),B=B.replace(/\r/g,`
`),B=B.replace(/>[ \t]+</,">\xA8NBSP;<"),!Q)if(window&&window.document)Q=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var ne=Q.createElement("div");ne.innerHTML=B;var ce={preList:le(ne)};ke(ne);for(var be=ne.childNodes,pe="",Ie=0;Ie<be.length;Ie++)pe+=t.subParser("makeMarkdown.node")(be[Ie],ce);function ke(K){for(var oe=0;oe<K.childNodes.length;++oe){var ie=K.childNodes[oe];ie.nodeType===3?!/\S/.test(ie.nodeValue)&&!/^[ ]+$/.test(ie.nodeValue)?(K.removeChild(ie),--oe):(ie.nodeValue=ie.nodeValue.split(`
`).join(" "),ie.nodeValue=ie.nodeValue.replace(/(\s)+/g,"$1")):ie.nodeType===1&&ke(ie)}}function le(K){for(var oe=K.querySelectorAll("pre"),ie=[],U=0;U<oe.length;++U)if(oe[U].childElementCount===1&&oe[U].firstChild.tagName.toLowerCase()==="code"){var z=oe[U].firstChild.innerHTML.trim(),re=oe[U].firstChild.getAttribute("data-language")||"";if(re==="")for(var de=oe[U].firstChild.className.split(" "),X=0;X<de.length;++X){var fe=de[X].match(/^language-(.+)$/);if(fe!==null){re=fe[1];break}}z=t.helper.unescapeHTMLEntities(z),ie.push(z),oe[U].outerHTML='<precode language="'+re+'" precodenum="'+U.toString()+'"></precode>'}else ie.push(oe[U].innerHTML),oe[U].innerHTML="",oe[U].setAttribute("prenum",U.toString());return ie}return pe},this.setOption=function(B,Q){g[B]=Q},this.getOption=function(B){return g[B]},this.getOptions=function(){return g},this.addExtension=function(B,Q){Q=Q||null,q(B,Q)},this.useExtension=function(B){q(B)},this.setFlavor=function(B){if(!a.hasOwnProperty(B))throw Error(B+" flavor was not found");var Q=a[B];E=B;for(var ne in Q)Q.hasOwnProperty(ne)&&(g[ne]=Q[ne])},this.getFlavor=function(){return E},this.removeExtension=function(B){t.helper.isArray(B)||(B=[B]);for(var Q=0;Q<B.length;++Q){for(var ne=B[Q],ce=0;ce<_.length;++ce)_[ce]===ne&&_.splice(ce,1);for(var be=0;be<y.length;++be)y[be]===ne&&y.splice(be,1)}},this.getAllExtensions=function(){return{language:_,output:y}},this.getMetadata=function(B){return B?k.raw:k.parsed},this.getMetadataFormat=function(){return k.format},this._setMetadataPair=function(B,Q){k.parsed[B]=Q},this._setMetadataFormat=function(B){k.format=B},this._setMetadataRaw=function(B){k.raw=B}},t.subParser("anchors",function(d,g,_){"use strict";d=_.converter._dispatch("anchors.before",d,g,_);var y=function(O,E,k,M,q,Y,F){if(t.helper.isUndefined(F)&&(F=""),k=k.toLowerCase(),O.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)M="";else if(!M)if(k||(k=E.toLowerCase().replace(/ ?\n/g," ")),M="#"+k,!t.helper.isUndefined(_.gUrls[k]))M=_.gUrls[k],t.helper.isUndefined(_.gTitles[k])||(F=_.gTitles[k]);else return O;M=M.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var Z='<a href="'+M+'"';return F!==""&&F!==null&&(F=F.replace(/"/g,"&quot;"),F=F.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),Z+=' title="'+F+'"'),g.openLinksInNewWindow&&!/^#/.test(M)&&(Z+=' rel="noopener noreferrer" target="\xA8E95Eblank"'),Z+=">"+E+"</a>",Z};return d=d.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,y),d=d.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,y),d=d.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,y),d=d.replace(/\[([^\[\]]+)]()()()()()/g,y),g.ghMentions&&(d=d.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(O,E,k,M,q){if(k==="\\")return E+M;if(!t.helper.isString(g.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var Y=g.ghMentionsLink.replace(/\{u}/g,q),F="";return g.openLinksInNewWindow&&(F=' rel="noopener noreferrer" target="\xA8E95Eblank"'),E+'<a href="'+Y+'"'+F+">"+M+"</a>"})),d=_.converter._dispatch("anchors.after",d,g,_),d});var p=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,m=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,w=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,x=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,A=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,D=function(d){"use strict";return function(g,_,y,O,E,k,M){y=y.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var q=y,Y="",F="",Z=_||"",B=M||"";return/^www\./i.test(y)&&(y=y.replace(/^www\./i,"http://www.")),d.excludeTrailingPunctuationFromURLs&&k&&(Y=k),d.openLinksInNewWindow&&(F=' rel="noopener noreferrer" target="\xA8E95Eblank"'),Z+'<a href="'+y+'"'+F+">"+q+"</a>"+Y+B}},j=function(d,g){"use strict";return function(_,y,O){var E="mailto:";return y=y||"",O=t.subParser("unescapeSpecialChars")(O,d,g),d.encodeEmails?(E=t.helper.encodeEmailAddress(E+O),O=t.helper.encodeEmailAddress(O)):E=E+O,y+'<a href="'+E+'">'+O+"</a>"}};t.subParser("autoLinks",function(d,g,_){"use strict";return d=_.converter._dispatch("autoLinks.before",d,g,_),d=d.replace(w,D(g)),d=d.replace(A,j(g,_)),d=_.converter._dispatch("autoLinks.after",d,g,_),d}),t.subParser("simplifiedAutoLinks",function(d,g,_){"use strict";return g.simplifiedAutoLink&&(d=_.converter._dispatch("simplifiedAutoLinks.before",d,g,_),g.excludeTrailingPunctuationFromURLs?d=d.replace(m,D(g)):d=d.replace(p,D(g)),d=d.replace(x,j(g,_)),d=_.converter._dispatch("simplifiedAutoLinks.after",d,g,_)),d}),t.subParser("blockGamut",function(d,g,_){"use strict";return d=_.converter._dispatch("blockGamut.before",d,g,_),d=t.subParser("blockQuotes")(d,g,_),d=t.subParser("headers")(d,g,_),d=t.subParser("horizontalRule")(d,g,_),d=t.subParser("lists")(d,g,_),d=t.subParser("codeBlocks")(d,g,_),d=t.subParser("tables")(d,g,_),d=t.subParser("hashHTMLBlocks")(d,g,_),d=t.subParser("paragraphs")(d,g,_),d=_.converter._dispatch("blockGamut.after",d,g,_),d}),t.subParser("blockQuotes",function(d,g,_){"use strict";d=_.converter._dispatch("blockQuotes.before",d,g,_),d=d+`

`;var y=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return g.splitAdjacentBlockquotes&&(y=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),d=d.replace(y,function(O){return O=O.replace(/^[ \t]*>[ \t]?/gm,""),O=O.replace(/¨0/g,""),O=O.replace(/^[ \t]+$/gm,""),O=t.subParser("githubCodeBlocks")(O,g,_),O=t.subParser("blockGamut")(O,g,_),O=O.replace(/(^|\n)/g,"$1  "),O=O.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(E,k){var M=k;return M=M.replace(/^  /mg,"\xA80"),M=M.replace(/¨0/g,""),M}),t.subParser("hashBlock")(`<blockquote>
`+O+`
</blockquote>`,g,_)}),d=_.converter._dispatch("blockQuotes.after",d,g,_),d}),t.subParser("codeBlocks",function(d,g,_){"use strict";d=_.converter._dispatch("codeBlocks.before",d,g,_),d+="\xA80";var y=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g;return d=d.replace(y,function(O,E,k){var M=E,q=k,Y=`
`;return M=t.subParser("outdent")(M,g,_),M=t.subParser("encodeCode")(M,g,_),M=t.subParser("detab")(M,g,_),M=M.replace(/^\n+/g,""),M=M.replace(/\n+$/g,""),g.omitExtraWLInCodeBlocks&&(Y=""),M="<pre><code>"+M+Y+"</code></pre>",t.subParser("hashBlock")(M,g,_)+q}),d=d.replace(/¨0/,""),d=_.converter._dispatch("codeBlocks.after",d,g,_),d}),t.subParser("codeSpans",function(d,g,_){"use strict";return d=_.converter._dispatch("codeSpans.before",d,g,_),typeof d=="undefined"&&(d=""),d=d.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(y,O,E,k){var M=k;return M=M.replace(/^([ \t]*)/g,""),M=M.replace(/[ \t]*$/g,""),M=t.subParser("encodeCode")(M,g,_),M=O+"<code>"+M+"</code>",M=t.subParser("hashHTMLSpans")(M,g,_),M}),d=_.converter._dispatch("codeSpans.after",d,g,_),d}),t.subParser("completeHTMLDocument",function(d,g,_){"use strict";if(!g.completeHTMLDocument)return d;d=_.converter._dispatch("completeHTMLDocument.before",d,g,_);var y="html",O=`<!DOCTYPE HTML>
`,E="",k=`<meta charset="utf-8">
`,M="",q="";typeof _.metadata.parsed.doctype!="undefined"&&(O="<!DOCTYPE "+_.metadata.parsed.doctype+`>
`,y=_.metadata.parsed.doctype.toString().toLowerCase(),(y==="html"||y==="html5")&&(k='<meta charset="utf-8">'));for(var Y in _.metadata.parsed)if(_.metadata.parsed.hasOwnProperty(Y))switch(Y.toLowerCase()){case"doctype":break;case"title":E="<title>"+_.metadata.parsed.title+`</title>
`;break;case"charset":y==="html"||y==="html5"?k='<meta charset="'+_.metadata.parsed.charset+`">
`:k='<meta name="charset" content="'+_.metadata.parsed.charset+`">
`;break;case"language":case"lang":M=' lang="'+_.metadata.parsed[Y]+'"',q+='<meta name="'+Y+'" content="'+_.metadata.parsed[Y]+`">
`;break;default:q+='<meta name="'+Y+'" content="'+_.metadata.parsed[Y]+`">
`}return d=O+"<html"+M+`>
<head>
`+E+k+q+`</head>
<body>
`+d.trim()+`
</body>
</html>`,d=_.converter._dispatch("completeHTMLDocument.after",d,g,_),d}),t.subParser("detab",function(d,g,_){"use strict";return d=_.converter._dispatch("detab.before",d,g,_),d=d.replace(/\t(?=\t)/g,"    "),d=d.replace(/\t/g,"\xA8A\xA8B"),d=d.replace(/¨B(.+?)¨A/g,function(y,O){for(var E=O,k=4-E.length%4,M=0;M<k;M++)E+=" ";return E}),d=d.replace(/¨A/g,"    "),d=d.replace(/¨B/g,""),d=_.converter._dispatch("detab.after",d,g,_),d}),t.subParser("ellipsis",function(d,g,_){"use strict";return g.ellipsis&&(d=_.converter._dispatch("ellipsis.before",d,g,_),d=d.replace(/\.\.\./g,"\u2026"),d=_.converter._dispatch("ellipsis.after",d,g,_)),d}),t.subParser("emoji",function(d,g,_){"use strict";if(!g.emoji)return d;d=_.converter._dispatch("emoji.before",d,g,_);var y=/:([\S]+?):/g;return d=d.replace(y,function(O,E){return t.helper.emojis.hasOwnProperty(E)?t.helper.emojis[E]:O}),d=_.converter._dispatch("emoji.after",d,g,_),d}),t.subParser("encodeAmpsAndAngles",function(d,g,_){"use strict";return d=_.converter._dispatch("encodeAmpsAndAngles.before",d,g,_),d=d.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),d=d.replace(/<(?![a-z\/?$!])/gi,"&lt;"),d=d.replace(/</g,"&lt;"),d=d.replace(/>/g,"&gt;"),d=_.converter._dispatch("encodeAmpsAndAngles.after",d,g,_),d}),t.subParser("encodeBackslashEscapes",function(d,g,_){"use strict";return d=_.converter._dispatch("encodeBackslashEscapes.before",d,g,_),d=d.replace(/\\(\\)/g,t.helper.escapeCharactersCallback),d=d.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,t.helper.escapeCharactersCallback),d=_.converter._dispatch("encodeBackslashEscapes.after",d,g,_),d}),t.subParser("encodeCode",function(d,g,_){"use strict";return d=_.converter._dispatch("encodeCode.before",d,g,_),d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,t.helper.escapeCharactersCallback),d=_.converter._dispatch("encodeCode.after",d,g,_),d}),t.subParser("escapeSpecialCharsWithinTagAttributes",function(d,g,_){"use strict";d=_.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",d,g,_);var y=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,O=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return d=d.replace(y,function(E){return E.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),d=d.replace(O,function(E){return E.replace(/([\\`*_~=|])/g,t.helper.escapeCharactersCallback)}),d=_.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",d,g,_),d}),t.subParser("githubCodeBlocks",function(d,g,_){"use strict";return g.ghCodeBlocks?(d=_.converter._dispatch("githubCodeBlocks.before",d,g,_),d+="\xA80",d=d.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(y,O,E,k){var M=g.omitExtraWLInCodeBlocks?"":`
`;return k=t.subParser("encodeCode")(k,g,_),k=t.subParser("detab")(k,g,_),k=k.replace(/^\n+/g,""),k=k.replace(/\n+$/g,""),k="<pre><code"+(E?' class="'+E+" language-"+E+'"':"")+">"+k+M+"</code></pre>",k=t.subParser("hashBlock")(k,g,_),`

\xA8G`+(_.ghCodeBlocks.push({text:y,codeblock:k})-1)+`G

`}),d=d.replace(/¨0/,""),_.converter._dispatch("githubCodeBlocks.after",d,g,_)):d}),t.subParser("hashBlock",function(d,g,_){"use strict";return d=_.converter._dispatch("hashBlock.before",d,g,_),d=d.replace(/(^\n+|\n+$)/g,""),d=`

\xA8K`+(_.gHtmlBlocks.push(d)-1)+`K

`,d=_.converter._dispatch("hashBlock.after",d,g,_),d}),t.subParser("hashCodeTags",function(d,g,_){"use strict";d=_.converter._dispatch("hashCodeTags.before",d,g,_);var y=function(O,E,k,M){var q=k+t.subParser("encodeCode")(E,g,_)+M;return"\xA8C"+(_.gHtmlSpans.push(q)-1)+"C"};return d=t.helper.replaceRecursiveRegExp(d,y,"<code\\b[^>]*>","</code>","gim"),d=_.converter._dispatch("hashCodeTags.after",d,g,_),d}),t.subParser("hashElement",function(d,g,_){"use strict";return function(y,O){var E=O;return E=E.replace(/\n\n/g,`
`),E=E.replace(/^\n/,""),E=E.replace(/\n+$/g,""),E=`

\xA8K`+(_.gHtmlBlocks.push(E)-1)+`K

`,E}}),t.subParser("hashHTMLBlocks",function(d,g,_){"use strict";d=_.converter._dispatch("hashHTMLBlocks.before",d,g,_);var y=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],O=function(B,Q,ne,ce){var be=B;return ne.search(/\bmarkdown\b/)!==-1&&(be=ne+_.converter.makeHtml(Q)+ce),`

\xA8K`+(_.gHtmlBlocks.push(be)-1)+`K

`};g.backslashEscapesHTMLTags&&(d=d.replace(/\\<(\/?[^>]+?)>/g,function(B,Q){return"&lt;"+Q+"&gt;"}));for(var E=0;E<y.length;++E)for(var k,M=new RegExp("^ {0,3}(<"+y[E]+"\\b[^>]*>)","im"),q="<"+y[E]+"\\b[^>]*>",Y="</"+y[E]+">";(k=t.helper.regexIndexOf(d,M))!==-1;){var F=t.helper.splitAtIndex(d,k),Z=t.helper.replaceRecursiveRegExp(F[1],O,q,Y,"im");if(Z===F[1])break;d=F[0].concat(Z)}return d=d.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(d,g,_)),d=t.helper.replaceRecursiveRegExp(d,function(B){return`

\xA8K`+(_.gHtmlBlocks.push(B)-1)+`K

`},"^ {0,3}<!--","-->","gm"),d=d.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,t.subParser("hashElement")(d,g,_)),d=_.converter._dispatch("hashHTMLBlocks.after",d,g,_),d}),t.subParser("hashHTMLSpans",function(d,g,_){"use strict";d=_.converter._dispatch("hashHTMLSpans.before",d,g,_);function y(O){return"\xA8C"+(_.gHtmlSpans.push(O)-1)+"C"}return d=d.replace(/<[^>]+?\/>/gi,function(O){return y(O)}),d=d.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(O){return y(O)}),d=d.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(O){return y(O)}),d=d.replace(/<[^>]+?>/gi,function(O){return y(O)}),d=_.converter._dispatch("hashHTMLSpans.after",d,g,_),d}),t.subParser("unhashHTMLSpans",function(d,g,_){"use strict";d=_.converter._dispatch("unhashHTMLSpans.before",d,g,_);for(var y=0;y<_.gHtmlSpans.length;++y){for(var O=_.gHtmlSpans[y],E=0;/¨C(\d+)C/.test(O);){var k=RegExp.$1;if(O=O.replace("\xA8C"+k+"C",_.gHtmlSpans[k]),E===10){console.error("maximum nesting of 10 spans reached!!!");break}++E}d=d.replace("\xA8C"+y+"C",O)}return d=_.converter._dispatch("unhashHTMLSpans.after",d,g,_),d}),t.subParser("hashPreCodeTags",function(d,g,_){"use strict";d=_.converter._dispatch("hashPreCodeTags.before",d,g,_);var y=function(O,E,k,M){var q=k+t.subParser("encodeCode")(E,g,_)+M;return`

\xA8G`+(_.ghCodeBlocks.push({text:O,codeblock:q})-1)+`G

`};return d=t.helper.replaceRecursiveRegExp(d,y,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),d=_.converter._dispatch("hashPreCodeTags.after",d,g,_),d}),t.subParser("headers",function(d,g,_){"use strict";d=_.converter._dispatch("headers.before",d,g,_);var y=isNaN(parseInt(g.headerLevelStart))?1:parseInt(g.headerLevelStart),O=g.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,E=g.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;d=d.replace(O,function(q,Y){var F=t.subParser("spanGamut")(Y,g,_),Z=g.noHeaderId?"":' id="'+M(Y)+'"',B=y,Q="<h"+B+Z+">"+F+"</h"+B+">";return t.subParser("hashBlock")(Q,g,_)}),d=d.replace(E,function(q,Y){var F=t.subParser("spanGamut")(Y,g,_),Z=g.noHeaderId?"":' id="'+M(Y)+'"',B=y+1,Q="<h"+B+Z+">"+F+"</h"+B+">";return t.subParser("hashBlock")(Q,g,_)});var k=g.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;d=d.replace(k,function(q,Y,F){var Z=F;g.customizedHeaderId&&(Z=F.replace(/\s?\{([^{]+?)}\s*$/,""));var B=t.subParser("spanGamut")(Z,g,_),Q=g.noHeaderId?"":' id="'+M(F)+'"',ne=y-1+Y.length,ce="<h"+ne+Q+">"+B+"</h"+ne+">";return t.subParser("hashBlock")(ce,g,_)});function M(q){var Y,F;if(g.customizedHeaderId){var Z=q.match(/\{([^{]+?)}\s*$/);Z&&Z[1]&&(q=Z[1])}return Y=q,t.helper.isString(g.prefixHeaderId)?F=g.prefixHeaderId:g.prefixHeaderId===!0?F="section-":F="",g.rawPrefixHeaderId||(Y=F+Y),g.ghCompatibleHeaderId?Y=Y.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():g.rawHeaderId?Y=Y.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"\xA8").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():Y=Y.replace(/[^\w]/g,"").toLowerCase(),g.rawPrefixHeaderId&&(Y=F+Y),_.hashLinkCounts[Y]?Y=Y+"-"+_.hashLinkCounts[Y]++:_.hashLinkCounts[Y]=1,Y}return d=_.converter._dispatch("headers.after",d,g,_),d}),t.subParser("horizontalRule",function(d,g,_){"use strict";d=_.converter._dispatch("horizontalRule.before",d,g,_);var y=t.subParser("hashBlock")("<hr />",g,_);return d=d.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,y),d=d.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,y),d=d.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,y),d=_.converter._dispatch("horizontalRule.after",d,g,_),d}),t.subParser("images",function(d,g,_){"use strict";d=_.converter._dispatch("images.before",d,g,_);var y=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,O=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,E=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,k=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,M=/!\[([^\[\]]+)]()()()()()/g;function q(F,Z,B,Q,ne,ce,be,pe){return Q=Q.replace(/\s/g,""),Y(F,Z,B,Q,ne,ce,be,pe)}function Y(F,Z,B,Q,ne,ce,be,pe){var Ie=_.gUrls,ke=_.gTitles,le=_.gDimensions;if(B=B.toLowerCase(),pe||(pe=""),F.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)Q="";else if(Q===""||Q===null)if((B===""||B===null)&&(B=Z.toLowerCase().replace(/ ?\n/g," ")),Q="#"+B,!t.helper.isUndefined(Ie[B]))Q=Ie[B],t.helper.isUndefined(ke[B])||(pe=ke[B]),t.helper.isUndefined(le[B])||(ne=le[B].width,ce=le[B].height);else return F;Z=Z.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),Q=Q.replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback);var K='<img src="'+Q+'" alt="'+Z+'"';return pe&&t.helper.isString(pe)&&(pe=pe.replace(/"/g,"&quot;").replace(t.helper.regexes.asteriskDashAndColon,t.helper.escapeCharactersCallback),K+=' title="'+pe+'"'),ne&&ce&&(ne=ne==="*"?"auto":ne,ce=ce==="*"?"auto":ce,K+=' width="'+ne+'"',K+=' height="'+ce+'"'),K+=" />",K}return d=d.replace(k,Y),d=d.replace(E,q),d=d.replace(O,Y),d=d.replace(y,Y),d=d.replace(M,Y),d=_.converter._dispatch("images.after",d,g,_),d}),t.subParser("italicsAndBold",function(d,g,_){"use strict";d=_.converter._dispatch("italicsAndBold.before",d,g,_);function y(O,E,k){return E+O+k}return g.literalMidWordUnderscores?(d=d.replace(/\b___(\S[\s\S]*?)___\b/g,function(O,E){return y(E,"<strong><em>","</em></strong>")}),d=d.replace(/\b__(\S[\s\S]*?)__\b/g,function(O,E){return y(E,"<strong>","</strong>")}),d=d.replace(/\b_(\S[\s\S]*?)_\b/g,function(O,E){return y(E,"<em>","</em>")})):(d=d.replace(/___(\S[\s\S]*?)___/g,function(O,E){return/\S$/.test(E)?y(E,"<strong><em>","</em></strong>"):O}),d=d.replace(/__(\S[\s\S]*?)__/g,function(O,E){return/\S$/.test(E)?y(E,"<strong>","</strong>"):O}),d=d.replace(/_([^\s_][\s\S]*?)_/g,function(O,E){return/\S$/.test(E)?y(E,"<em>","</em>"):O})),g.literalMidWordAsterisks?(d=d.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(O,E,k){return y(k,E+"<strong><em>","</em></strong>")}),d=d.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(O,E,k){return y(k,E+"<strong>","</strong>")}),d=d.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(O,E,k){return y(k,E+"<em>","</em>")})):(d=d.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(O,E){return/\S$/.test(E)?y(E,"<strong><em>","</em></strong>"):O}),d=d.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(O,E){return/\S$/.test(E)?y(E,"<strong>","</strong>"):O}),d=d.replace(/\*([^\s*][\s\S]*?)\*/g,function(O,E){return/\S$/.test(E)?y(E,"<em>","</em>"):O})),d=_.converter._dispatch("italicsAndBold.after",d,g,_),d}),t.subParser("lists",function(d,g,_){"use strict";function y(k,M){_.gListLevel++,k=k.replace(/\n{2,}$/,`
`),k+="\xA80";var q=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,Y=/\n[ \t]*\n(?!¨0)/.test(k);return g.disableForced4SpacesIndentedSublists&&(q=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),k=k.replace(q,function(F,Z,B,Q,ne,ce,be){be=be&&be.trim()!=="";var pe=t.subParser("outdent")(ne,g,_),Ie="";return ce&&g.tasklists&&(Ie=' class="task-list-item" style="list-style-type: none;"',pe=pe.replace(/^[ \t]*\[(x|X| )?]/m,function(){var ke='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return be&&(ke+=" checked"),ke+=">",ke})),pe=pe.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(ke){return"\xA8A"+ke}),Z||pe.search(/\n{2,}/)>-1?(pe=t.subParser("githubCodeBlocks")(pe,g,_),pe=t.subParser("blockGamut")(pe,g,_)):(pe=t.subParser("lists")(pe,g,_),pe=pe.replace(/\n$/,""),pe=t.subParser("hashHTMLBlocks")(pe,g,_),pe=pe.replace(/\n\n+/g,`

`),Y?pe=t.subParser("paragraphs")(pe,g,_):pe=t.subParser("spanGamut")(pe,g,_)),pe=pe.replace("\xA8A",""),pe="<li"+Ie+">"+pe+`</li>
`,pe}),k=k.replace(/¨0/g,""),_.gListLevel--,M&&(k=k.replace(/\s+$/,"")),k}function O(k,M){if(M==="ol"){var q=k.match(/^ *(\d+)\./);if(q&&q[1]!=="1")return' start="'+q[1]+'"'}return""}function E(k,M,q){var Y=g.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,F=g.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,Z=M==="ul"?Y:F,B="";if(k.search(Z)!==-1)(function ne(ce){var be=ce.search(Z),pe=O(k,M);be!==-1?(B+=`

<`+M+pe+`>
`+y(ce.slice(0,be),!!q)+"</"+M+`>
`,M=M==="ul"?"ol":"ul",Z=M==="ul"?Y:F,ne(ce.slice(be))):B+=`

<`+M+pe+`>
`+y(ce,!!q)+"</"+M+`>
`})(k);else{var Q=O(k,M);B=`

<`+M+Q+`>
`+y(k,!!q)+"</"+M+`>
`}return B}return d=_.converter._dispatch("lists.before",d,g,_),d+="\xA80",_.gListLevel?d=d.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(k,M,q){var Y=q.search(/[*+-]/g)>-1?"ul":"ol";return E(M,Y,!0)}):d=d.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(k,M,q,Y){var F=Y.search(/[*+-]/g)>-1?"ul":"ol";return E(q,F,!1)}),d=d.replace(/¨0/,""),d=_.converter._dispatch("lists.after",d,g,_),d}),t.subParser("metadata",function(d,g,_){"use strict";if(!g.metadata)return d;d=_.converter._dispatch("metadata.before",d,g,_);function y(O){_.metadata.raw=O,O=O.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),O=O.replace(/\n {4}/g," "),O.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(E,k,M){return _.metadata.parsed[k]=M,""})}return d=d.replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(O,E,k){return y(k),"\xA8M"}),d=d.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(O,E,k){return E&&(_.metadata.format=E),y(k),"\xA8M"}),d=d.replace(/¨M/g,""),d=_.converter._dispatch("metadata.after",d,g,_),d}),t.subParser("outdent",function(d,g,_){"use strict";return d=_.converter._dispatch("outdent.before",d,g,_),d=d.replace(/^(\t|[ ]{1,4})/gm,"\xA80"),d=d.replace(/¨0/g,""),d=_.converter._dispatch("outdent.after",d,g,_),d}),t.subParser("paragraphs",function(d,g,_){"use strict";d=_.converter._dispatch("paragraphs.before",d,g,_),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,"");for(var y=d.split(/\n{2,}/g),O=[],E=y.length,k=0;k<E;k++){var M=y[k];M.search(/¨(K|G)(\d+)\1/g)>=0?O.push(M):M.search(/\S/)>=0&&(M=t.subParser("spanGamut")(M,g,_),M=M.replace(/^([ \t]*)/g,"<p>"),M+="</p>",O.push(M))}for(E=O.length,k=0;k<E;k++){for(var q="",Y=O[k],F=!1;/¨(K|G)(\d+)\1/.test(Y);){var Z=RegExp.$1,B=RegExp.$2;Z==="K"?q=_.gHtmlBlocks[B]:F?q=t.subParser("encodeCode")(_.ghCodeBlocks[B].text,g,_):q=_.ghCodeBlocks[B].codeblock,q=q.replace(/\$/g,"$$$$"),Y=Y.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,q),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(Y)&&(F=!0)}O[k]=Y}return d=O.join(`
`),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),_.converter._dispatch("paragraphs.after",d,g,_)}),t.subParser("runExtension",function(d,g,_,y){"use strict";if(d.filter)g=d.filter(g,y.converter,_);else if(d.regex){var O=d.regex;O instanceof RegExp||(O=new RegExp(O,"g")),g=g.replace(O,d.replace)}return g}),t.subParser("spanGamut",function(d,g,_){"use strict";return d=_.converter._dispatch("spanGamut.before",d,g,_),d=t.subParser("codeSpans")(d,g,_),d=t.subParser("escapeSpecialCharsWithinTagAttributes")(d,g,_),d=t.subParser("encodeBackslashEscapes")(d,g,_),d=t.subParser("images")(d,g,_),d=t.subParser("anchors")(d,g,_),d=t.subParser("autoLinks")(d,g,_),d=t.subParser("simplifiedAutoLinks")(d,g,_),d=t.subParser("emoji")(d,g,_),d=t.subParser("underline")(d,g,_),d=t.subParser("italicsAndBold")(d,g,_),d=t.subParser("strikethrough")(d,g,_),d=t.subParser("ellipsis")(d,g,_),d=t.subParser("hashHTMLSpans")(d,g,_),d=t.subParser("encodeAmpsAndAngles")(d,g,_),g.simpleLineBreaks?/\n\n¨K/.test(d)||(d=d.replace(/\n+/g,`<br />
`)):d=d.replace(/  +\n/g,`<br />
`),d=_.converter._dispatch("spanGamut.after",d,g,_),d}),t.subParser("strikethrough",function(d,g,_){"use strict";function y(O){return g.simplifiedAutoLink&&(O=t.subParser("simplifiedAutoLinks")(O,g,_)),"<del>"+O+"</del>"}return g.strikethrough&&(d=_.converter._dispatch("strikethrough.before",d,g,_),d=d.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(O,E){return y(E)}),d=_.converter._dispatch("strikethrough.after",d,g,_)),d}),t.subParser("stripLinkDefinitions",function(d,g,_){"use strict";var y=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,O=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm;d+="\xA80";var E=function(k,M,q,Y,F,Z,B){return M=M.toLowerCase(),d.toLowerCase().split(M).length-1<2?k:(q.match(/^data:.+?\/.+?;base64,/)?_.gUrls[M]=q.replace(/\s/g,""):_.gUrls[M]=t.subParser("encodeAmpsAndAngles")(q,g,_),Z?Z+B:(B&&(_.gTitles[M]=B.replace(/"|'/g,"&quot;")),g.parseImgDimensions&&Y&&F&&(_.gDimensions[M]={width:Y,height:F}),""))};return d=d.replace(O,E),d=d.replace(y,E),d=d.replace(/¨0/,""),d}),t.subParser("tables",function(d,g,_){"use strict";if(!g.tables)return d;var y=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,O=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function E(F){return/^:[ \t]*--*$/.test(F)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(F)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(F)?' style="text-align:center;"':""}function k(F,Z){var B="";return F=F.trim(),(g.tablesHeaderId||g.tableHeaderId)&&(B=' id="'+F.replace(/ /g,"_").toLowerCase()+'"'),F=t.subParser("spanGamut")(F,g,_),"<th"+B+Z+">"+F+`</th>
`}function M(F,Z){var B=t.subParser("spanGamut")(F,g,_);return"<td"+Z+">"+B+`</td>
`}function q(F,Z){for(var B=`<table>
<thead>
<tr>
`,Q=F.length,ne=0;ne<Q;++ne)B+=F[ne];for(B+=`</tr>
</thead>
<tbody>
`,ne=0;ne<Z.length;++ne){B+=`<tr>
`;for(var ce=0;ce<Q;++ce)B+=Z[ne][ce];B+=`</tr>
`}return B+=`</tbody>
</table>
`,B}function Y(F){var Z,B=F.split(`
`);for(Z=0;Z<B.length;++Z)/^ {0,3}\|/.test(B[Z])&&(B[Z]=B[Z].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(B[Z])&&(B[Z]=B[Z].replace(/\|[ \t]*$/,"")),B[Z]=t.subParser("codeSpans")(B[Z],g,_);var Q=B[0].split("|").map(function(K){return K.trim()}),ne=B[1].split("|").map(function(K){return K.trim()}),ce=[],be=[],pe=[],Ie=[];for(B.shift(),B.shift(),Z=0;Z<B.length;++Z)B[Z].trim()!==""&&ce.push(B[Z].split("|").map(function(K){return K.trim()}));if(Q.length<ne.length)return F;for(Z=0;Z<ne.length;++Z)pe.push(E(ne[Z]));for(Z=0;Z<Q.length;++Z)t.helper.isUndefined(pe[Z])&&(pe[Z]=""),be.push(k(Q[Z],pe[Z]));for(Z=0;Z<ce.length;++Z){for(var ke=[],le=0;le<be.length;++le)t.helper.isUndefined(ce[Z][le]),ke.push(M(ce[Z][le],pe[le]));Ie.push(ke)}return q(be,Ie)}return d=_.converter._dispatch("tables.before",d,g,_),d=d.replace(/\\(\|)/g,t.helper.escapeCharactersCallback),d=d.replace(y,Y),d=d.replace(O,Y),d=_.converter._dispatch("tables.after",d,g,_),d}),t.subParser("underline",function(d,g,_){"use strict";return g.underline&&(d=_.converter._dispatch("underline.before",d,g,_),g.literalMidWordUnderscores?(d=d.replace(/\b___(\S[\s\S]*?)___\b/g,function(y,O){return"<u>"+O+"</u>"}),d=d.replace(/\b__(\S[\s\S]*?)__\b/g,function(y,O){return"<u>"+O+"</u>"})):(d=d.replace(/___(\S[\s\S]*?)___/g,function(y,O){return/\S$/.test(O)?"<u>"+O+"</u>":y}),d=d.replace(/__(\S[\s\S]*?)__/g,function(y,O){return/\S$/.test(O)?"<u>"+O+"</u>":y})),d=d.replace(/(_)/g,t.helper.escapeCharactersCallback),d=_.converter._dispatch("underline.after",d,g,_)),d}),t.subParser("unescapeSpecialChars",function(d,g,_){"use strict";return d=_.converter._dispatch("unescapeSpecialChars.before",d,g,_),d=d.replace(/¨E(\d+)E/g,function(y,O){var E=parseInt(O);return String.fromCharCode(E)}),d=_.converter._dispatch("unescapeSpecialChars.after",d,g,_),d}),t.subParser("makeMarkdown.blockquote",function(d,g){"use strict";var _="";if(d.hasChildNodes())for(var y=d.childNodes,O=y.length,E=0;E<O;++E){var k=t.subParser("makeMarkdown.node")(y[E],g);k!==""&&(_+=k)}return _=_.trim(),_="> "+_.split(`
`).join(`
> `),_}),t.subParser("makeMarkdown.codeBlock",function(d,g){"use strict";var _=d.getAttribute("language"),y=d.getAttribute("precodenum");return"```"+_+`
`+g.preList[y]+"\n```"}),t.subParser("makeMarkdown.codeSpan",function(d){"use strict";return"`"+d.innerHTML+"`"}),t.subParser("makeMarkdown.emphasis",function(d,g){"use strict";var _="";if(d.hasChildNodes()){_+="*";for(var y=d.childNodes,O=y.length,E=0;E<O;++E)_+=t.subParser("makeMarkdown.node")(y[E],g);_+="*"}return _}),t.subParser("makeMarkdown.header",function(d,g,_){"use strict";var y=new Array(_+1).join("#"),O="";if(d.hasChildNodes()){O=y+" ";for(var E=d.childNodes,k=E.length,M=0;M<k;++M)O+=t.subParser("makeMarkdown.node")(E[M],g)}return O}),t.subParser("makeMarkdown.hr",function(){"use strict";return"---"}),t.subParser("makeMarkdown.image",function(d){"use strict";var g="";return d.hasAttribute("src")&&(g+="!["+d.getAttribute("alt")+"](",g+="<"+d.getAttribute("src")+">",d.hasAttribute("width")&&d.hasAttribute("height")&&(g+=" ="+d.getAttribute("width")+"x"+d.getAttribute("height")),d.hasAttribute("title")&&(g+=' "'+d.getAttribute("title")+'"'),g+=")"),g}),t.subParser("makeMarkdown.links",function(d,g){"use strict";var _="";if(d.hasChildNodes()&&d.hasAttribute("href")){var y=d.childNodes,O=y.length;_="[";for(var E=0;E<O;++E)_+=t.subParser("makeMarkdown.node")(y[E],g);_+="](",_+="<"+d.getAttribute("href")+">",d.hasAttribute("title")&&(_+=' "'+d.getAttribute("title")+'"'),_+=")"}return _}),t.subParser("makeMarkdown.list",function(d,g,_){"use strict";var y="";if(!d.hasChildNodes())return"";for(var O=d.childNodes,E=O.length,k=d.getAttribute("start")||1,M=0;M<E;++M)if(!(typeof O[M].tagName=="undefined"||O[M].tagName.toLowerCase()!=="li")){var q="";_==="ol"?q=k.toString()+". ":q="- ",y+=q+t.subParser("makeMarkdown.listItem")(O[M],g),++k}return y+=`
<!-- -->
`,y.trim()}),t.subParser("makeMarkdown.listItem",function(d,g){"use strict";for(var _="",y=d.childNodes,O=y.length,E=0;E<O;++E)_+=t.subParser("makeMarkdown.node")(y[E],g);return/\n$/.test(_)?_=_.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):_+=`
`,_}),t.subParser("makeMarkdown.node",function(d,g,_){"use strict";_=_||!1;var y="";if(d.nodeType===3)return t.subParser("makeMarkdown.txt")(d,g);if(d.nodeType===8)return"<!--"+d.data+`-->

`;if(d.nodeType!==1)return"";var O=d.tagName.toLowerCase();switch(O){case"h1":_||(y=t.subParser("makeMarkdown.header")(d,g,1)+`

`);break;case"h2":_||(y=t.subParser("makeMarkdown.header")(d,g,2)+`

`);break;case"h3":_||(y=t.subParser("makeMarkdown.header")(d,g,3)+`

`);break;case"h4":_||(y=t.subParser("makeMarkdown.header")(d,g,4)+`

`);break;case"h5":_||(y=t.subParser("makeMarkdown.header")(d,g,5)+`

`);break;case"h6":_||(y=t.subParser("makeMarkdown.header")(d,g,6)+`

`);break;case"p":_||(y=t.subParser("makeMarkdown.paragraph")(d,g)+`

`);break;case"blockquote":_||(y=t.subParser("makeMarkdown.blockquote")(d,g)+`

`);break;case"hr":_||(y=t.subParser("makeMarkdown.hr")(d,g)+`

`);break;case"ol":_||(y=t.subParser("makeMarkdown.list")(d,g,"ol")+`

`);break;case"ul":_||(y=t.subParser("makeMarkdown.list")(d,g,"ul")+`

`);break;case"precode":_||(y=t.subParser("makeMarkdown.codeBlock")(d,g)+`

`);break;case"pre":_||(y=t.subParser("makeMarkdown.pre")(d,g)+`

`);break;case"table":_||(y=t.subParser("makeMarkdown.table")(d,g)+`

`);break;case"code":y=t.subParser("makeMarkdown.codeSpan")(d,g);break;case"em":case"i":y=t.subParser("makeMarkdown.emphasis")(d,g);break;case"strong":case"b":y=t.subParser("makeMarkdown.strong")(d,g);break;case"del":y=t.subParser("makeMarkdown.strikethrough")(d,g);break;case"a":y=t.subParser("makeMarkdown.links")(d,g);break;case"img":y=t.subParser("makeMarkdown.image")(d,g);break;default:y=d.outerHTML+`

`}return y}),t.subParser("makeMarkdown.paragraph",function(d,g){"use strict";var _="";if(d.hasChildNodes())for(var y=d.childNodes,O=y.length,E=0;E<O;++E)_+=t.subParser("makeMarkdown.node")(y[E],g);return _=_.trim(),_}),t.subParser("makeMarkdown.pre",function(d,g){"use strict";var _=d.getAttribute("prenum");return"<pre>"+g.preList[_]+"</pre>"}),t.subParser("makeMarkdown.strikethrough",function(d,g){"use strict";var _="";if(d.hasChildNodes()){_+="~~";for(var y=d.childNodes,O=y.length,E=0;E<O;++E)_+=t.subParser("makeMarkdown.node")(y[E],g);_+="~~"}return _}),t.subParser("makeMarkdown.strong",function(d,g){"use strict";var _="";if(d.hasChildNodes()){_+="**";for(var y=d.childNodes,O=y.length,E=0;E<O;++E)_+=t.subParser("makeMarkdown.node")(y[E],g);_+="**"}return _}),t.subParser("makeMarkdown.table",function(d,g){"use strict";var _="",y=[[],[]],O=d.querySelectorAll("thead>tr>th"),E=d.querySelectorAll("tbody>tr"),k,M;for(k=0;k<O.length;++k){var q=t.subParser("makeMarkdown.tableCell")(O[k],g),Y="---";if(O[k].hasAttribute("style")){var F=O[k].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(F){case"text-align:left;":Y=":---";break;case"text-align:right;":Y="---:";break;case"text-align:center;":Y=":---:";break}}y[0][k]=q.trim(),y[1][k]=Y}for(k=0;k<E.length;++k){var Z=y.push([])-1,B=E[k].getElementsByTagName("td");for(M=0;M<O.length;++M){var Q=" ";typeof B[M]!="undefined"&&(Q=t.subParser("makeMarkdown.tableCell")(B[M],g)),y[Z].push(Q)}}var ne=3;for(k=0;k<y.length;++k)for(M=0;M<y[k].length;++M){var ce=y[k][M].length;ce>ne&&(ne=ce)}for(k=0;k<y.length;++k){for(M=0;M<y[k].length;++M)k===1?y[k][M].slice(-1)===":"?y[k][M]=t.helper.padEnd(y[k][M].slice(-1),ne-1,"-")+":":y[k][M]=t.helper.padEnd(y[k][M],ne,"-"):y[k][M]=t.helper.padEnd(y[k][M],ne);_+="| "+y[k].join(" | ")+` |
`}return _.trim()}),t.subParser("makeMarkdown.tableCell",function(d,g){"use strict";var _="";if(!d.hasChildNodes())return"";for(var y=d.childNodes,O=y.length,E=0;E<O;++E)_+=t.subParser("makeMarkdown.node")(y[E],g,!0);return _.trim()}),t.subParser("makeMarkdown.txt",function(d){"use strict";var g=d.nodeValue;return g=g.replace(/ +/g," "),g=g.replace(/¨NBSP;/g," "),g=t.helper.unescapeHTMLEntities(g),g=g.replace(/([*_~|`])/g,"\\$1"),g=g.replace(/^(\s*)>/g,"\\$1>"),g=g.replace(/^#/gm,"\\#"),g=g.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),g=g.replace(/^( {0,3}\d+)\./gm,"$1\\."),g=g.replace(/^( {0,3})([+-])/gm,"$1\\$2"),g=g.replace(/]([\s]*)\(/g,"\\]$1\\("),g=g.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),g});var ee=this;typeof define=="function"&&define.amd?define(function(){"use strict";return t}):typeof Mn!="undefined"&&Mn.exports?Mn.exports=t:ee.showdown=t}).call(qh)});var Xh=te((exports,module)=>{frappe.provide("frappe.search");frappe.provide("frappe.tags");frappe.search.AwesomeBar=class{setup(i){var e=this;$(".search-bar").removeClass("hidden");var t=$(i),r=t.get(0);this.options=[],this.global_results=[];var s=new Awesomplete(r,{minChars:0,maxItems:99,autoFirst:!0,list:[],filter:function(o,a){return!0},data:function(o,a){return{label:o.index||"",value:o.value}},item:function(o,a){let l=this.get_item(o.value),c="#";l.route&&(c=frappe.router.make_url(frappe.router.convert_from_standard_route(frappe.router.get_route_from_arguments(typeof l.route=="string"?[l.route]:l.route))));let u=`<span>${__(l.label||l.value)}</span>`;return l.description&&l.value!==l.description&&(u+='<br><span class="text-muted ellipsis">'+__(l.description)+"</span>"),$("<li></li>").data("item.autocomplete",l).html(`<a style="font-weight:normal" href="${c}">${u}</a>`).get(0)},sort:function(o,a){return a.label-o.label}});r.awesomplete=s,this.awesomplete=s,t.on("input",frappe.utils.debounce(function(o){var a=o.target.value,l=a.trim().replace(/\s\s+/g," "),c=l.lastIndexOf(" ");e.global_results=[],e.options=[],l&&l.length>1?(c!==-1&&e.set_specifics(l.slice(0,c),l.slice(c+1)),e.add_defaults(l),e.options=e.options.concat(e.build_options(l)),e.options=e.options.concat(e.global_results)):(e.options=e.options.concat(e.deduplicate(frappe.search.utils.get_recent_pages(l||""))),e.options=e.options.concat(frappe.search.utils.get_frequent_links())),e.add_help(),s.list=e.deduplicate(e.options)},100));var n=function(){this.autocomplete_open||$(this).trigger("input")};t.on("focus",n),t.on("awesomplete-open",function(o){e.autocomplete_open=o.target}),t.on("awesomplete-close",function(o){e.autocomplete_open=!1}),t.on("awesomplete-select",function(o){var a=o.originalEvent,l=a.text.value,c=s.get_item(l);if(c.route_options&&(frappe.route_options=c.route_options),c.onclick)c.onclick(c.match);else{let u=a.originalEvent;if((u.ctrlKey||u.metaKey)&&(frappe.open_in_new_tab=!0),c.route[0].startsWith("https://")){window.open(c.route[0],"_blank");return}frappe.set_route(c.route)}t.val(""),t.trigger("blur")}),t.on("awesomplete-selectcomplete",function(o){t.val("")}),t.on("keydown",o=>{o.key=="Escape"&&t.trigger("blur")}),frappe.search.utils.setup_recent()}add_help(){this.options.push({value:__("Help on Search"),index:-10,default:"Help",onclick:function(){var i='<table class="table table-bordered">					<tr><td style="width: 50%">'+__("Create a new record")+"</td><td>"+__("new type of document")+"</td></tr>					<tr><td>"+__("List a document type")+"</td><td>"+__("document type..., e.g. customer")+"</td></tr>					<tr><td>"+__("Search in a document type")+"</td><td>"+__("text in document type")+"</td></tr>					<tr><td>"+__("Tags")+"</td><td>"+__("tag name..., e.g. #tag")+"</td></tr>					<tr><td>"+__("Open a module or tool")+"</td><td>"+__("module name...")+"</td></tr>					<tr><td>"+__("Calculate")+"</td><td>"+__("e.g. (55 + 434) / 4 or =Math.sin(Math.PI/2)...")+"</td></tr>				</table>";frappe.msgprint(i,__("Search Help"))}})}set_specifics(i,e){var t=this,r=this.build_options(i);r.forEach(function(s){s.type&&s.type.toLowerCase().indexOf(e.toLowerCase())===0&&t.options.push(s)})}add_defaults(i){this.make_global_search(i),this.make_search_in_current(i),this.make_calculator(i),this.make_random(i)}build_options(i){var e=frappe.search.utils.get_creatables(i).concat(frappe.search.utils.get_search_in_list(i),frappe.search.utils.get_doctypes(i),frappe.search.utils.get_reports(i),frappe.search.utils.get_pages(i),frappe.search.utils.get_workspaces(i),frappe.search.utils.get_dashboards(i),frappe.search.utils.get_recent_pages(i||""),frappe.search.utils.get_executables(i),frappe.search.utils.get_marketplace_apps(i));i.charAt(0)==="#"&&(e=frappe.tags.utils.get_tags(i));var t=this.deduplicate(e);return t.sort(function(r,s){return s.index-r.index})}deduplicate(i){var e=[],t=[];return i.forEach(function(r){if(r.route){r.route[0]==="List"&&r.route[2]!=="Report"&&r.route[2]!=="Inbox"&&r.route.splice(2);var s=typeof r.route=="string"?r.route:r.route.join("/");if(t.indexOf(s)===-1)e.push(r),t.push(s);else{var n=t.indexOf(s);e[n].index<r.index&&!r.recent&&(e[n]=r)}}else e.push(r),t.push("")}),e}set_global_results(i,e){this.global_results=this.global_results.concat(i)}make_global_search(i){i.charAt(0)!=="#"&&this.options.push({label:`
				<span class="flex justify-between text-medium">
					<span class="ellipsis">${__("Search for {0}",[frappe.utils.xss_sanitise(i).bold()])}</span>
					<kbd>\u21B5</kbd>
				</span>
			`,value:__("Search for {0}",[i]),match:i,index:100,default:"Search",onclick:function(){frappe.searchdialog.search.init_search(i,"global_search")}})}make_search_in_current(i){var n,o;var e=frappe.get_route();if(e[0]==="List"&&i.indexOf(" in")===-1){let a=(o=(n=frappe.container.page)==null?void 0:n.list_view)==null?void 0:o.doctype;if(!a)return;var t=frappe.get_meta(a),r=t.title_field||"name",s={};s[r]=["like","%"+i+"%"],this.options.push({label:__("Find {0} in {1}",[frappe.utils.xss_sanitise(i).bold(),__(e[1]).bold()]),value:__("Find {0} in {1}",[i,__(e[1])]),route_options:s,onclick:function(){cur_list.show()},index:90,default:"Current",match:i})}}make_calculator(txt){function getDecimalPlaces(i){return Math.floor(i)===i?0:i.toString().split(".")[1].length||0}var first=txt.substr(0,1);if(first==parseInt(first)||first==="("||first==="="){first==="="&&(txt=txt.substr(1));try{var val=eval(txt),numbers=txt.match(/[+-]?([0-9]*[.])?[0-9]+/g),maxDecimalPlaces=0;numbers&&(maxDecimalPlaces=Math.max(...numbers.map(i=>getDecimalPlaces(parseFloat(i))))),maxDecimalPlaces===0&&(maxDecimalPlaces=2);var rounded_val=parseFloat(val.toFixed(maxDecimalPlaces)),formatted_value=__("{0} = {1}",[txt,(rounded_val+"").bold()]);this.options.push({label:formatted_value,value:__("{0} = {1}",[txt,rounded_val]),match:rounded_val,index:80,default:"Calculator",onclick:function(){frappe.msgprint(formatted_value,__("Result"))}})}catch(i){}}}make_random(i){i.toLowerCase().includes("random")&&this.options.push({label:__("Generate Random Password"),value:frappe.utils.get_random(16),onclick:function(){frappe.msgprint(frappe.utils.get_random(16),__("Result"))}})}}});var ef=te((Qh,ca)=>{(function(i){if(typeof Qh=="object"&&typeof ca!="undefined")ca.exports=i();else if(typeof define=="function"&&define.amd)define([],i);else{var e;typeof window!="undefined"?e=window:typeof global!="undefined"?e=global:typeof self!="undefined"?e=self:e=this,e.localforage=i()}})(function(){var i,e,t;return function r(s,n,o){function a(u,p){if(!n[u]){if(!s[u]){var m=typeof Nr=="function"&&Nr;if(!p&&m)return m(u,!0);if(l)return l(u,!0);var w=new Error("Cannot find module '"+u+"'");throw w.code="MODULE_NOT_FOUND",w}var x=n[u]={exports:{}};s[u][0].call(x.exports,function(A){var D=s[u][1][A];return a(D||A)},x,x.exports,r,s,n,o)}return n[u].exports}for(var l=typeof Nr=="function"&&Nr,c=0;c<o.length;c++)a(o[c]);return a}({1:[function(r,s,n){(function(o){"use strict";var a=o.MutationObserver||o.WebKitMutationObserver,l;if(a){var c=0,u=new a(A),p=o.document.createTextNode("");u.observe(p,{characterData:!0}),l=function(){p.data=c=++c%2}}else if(!o.setImmediate&&typeof o.MessageChannel!="undefined"){var m=new o.MessageChannel;m.port1.onmessage=A,l=function(){m.port2.postMessage(0)}}else"document"in o&&"onreadystatechange"in o.document.createElement("script")?l=function(){var j=o.document.createElement("script");j.onreadystatechange=function(){A(),j.onreadystatechange=null,j.parentNode.removeChild(j),j=null},o.document.documentElement.appendChild(j)}:l=function(){setTimeout(A,0)};var w,x=[];function A(){w=!0;for(var j,ee,d=x.length;d;){for(ee=x,x=[],j=-1;++j<d;)ee[j]();d=x.length}w=!1}s.exports=D;function D(j){x.push(j)===1&&!w&&l()}}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(r,s,n){"use strict";var o=r(1);function a(){}var l={},c=["REJECTED"],u=["FULFILLED"],p=["PENDING"];s.exports=m;function m(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,y!==a&&D(this,y)}m.prototype.catch=function(y){return this.then(null,y)},m.prototype.then=function(y,O){if(typeof y!="function"&&this.state===u||typeof O!="function"&&this.state===c)return this;var E=new this.constructor(a);if(this.state!==p){var k=this.state===u?y:O;x(E,k,this.outcome)}else this.queue.push(new w(E,y,O));return E};function w(y,O,E){this.promise=y,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}w.prototype.callFulfilled=function(y){l.resolve(this.promise,y)},w.prototype.otherCallFulfilled=function(y){x(this.promise,this.onFulfilled,y)},w.prototype.callRejected=function(y){l.reject(this.promise,y)},w.prototype.otherCallRejected=function(y){x(this.promise,this.onRejected,y)};function x(y,O,E){o(function(){var k;try{k=O(E)}catch(M){return l.reject(y,M)}k===y?l.reject(y,new TypeError("Cannot resolve promise with itself")):l.resolve(y,k)})}l.resolve=function(y,O){var E=j(A,O);if(E.status==="error")return l.reject(y,E.value);var k=E.value;if(k)D(y,k);else{y.state=u,y.outcome=O;for(var M=-1,q=y.queue.length;++M<q;)y.queue[M].callFulfilled(O)}return y},l.reject=function(y,O){y.state=c,y.outcome=O;for(var E=-1,k=y.queue.length;++E<k;)y.queue[E].callRejected(O);return y};function A(y){var O=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof O=="function")return function(){O.apply(y,arguments)}}function D(y,O){var E=!1;function k(F){E||(E=!0,l.reject(y,F))}function M(F){E||(E=!0,l.resolve(y,F))}function q(){O(M,k)}var Y=j(q);Y.status==="error"&&k(Y.value)}function j(y,O){var E={};try{E.value=y(O),E.status="success"}catch(k){E.status="error",E.value=k}return E}m.resolve=ee;function ee(y){return y instanceof this?y:l.resolve(new this(a),y)}m.reject=d;function d(y){var O=new this(a);return l.reject(O,y)}m.all=g;function g(y){var O=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=y.length,k=!1;if(!E)return this.resolve([]);for(var M=new Array(E),q=0,Y=-1,F=new this(a);++Y<E;)Z(y[Y],Y);return F;function Z(B,Q){O.resolve(B).then(ne,function(ce){k||(k=!0,l.reject(F,ce))});function ne(ce){M[Q]=ce,++q===E&&!k&&(k=!0,l.resolve(F,M))}}}m.race=_;function _(y){var O=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=y.length,k=!1;if(!E)return this.resolve([]);for(var M=-1,q=new this(a);++M<E;)Y(y[M]);return q;function Y(F){O.resolve(F).then(function(Z){k||(k=!0,l.resolve(q,Z))},function(Z){k||(k=!0,l.reject(q,Z))})}}},{1:1}],3:[function(r,s,n){(function(o){"use strict";typeof o.Promise!="function"&&(o.Promise=r(2))}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{2:2}],4:[function(r,s,n){"use strict";var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T};function a(T,N){if(!(T instanceof N))throw new TypeError("Cannot call a class as a function")}function l(){try{if(typeof indexedDB!="undefined")return indexedDB;if(typeof webkitIndexedDB!="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!="undefined")return mozIndexedDB;if(typeof OIndexedDB!="undefined")return OIndexedDB;if(typeof msIndexedDB!="undefined")return msIndexedDB}catch(T){return}}var c=l();function u(){try{if(!c||!c.open)return!1;var T=typeof openDatabase!="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),N=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!T||N)&&typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(L){return!1}}function p(T,N){T=T||[],N=N||{};try{return new Blob(T,N)}catch(h){if(h.name!=="TypeError")throw h;for(var L=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,P=new L,W=0;W<T.length;W+=1)P.append(T[W]);return P.getBlob(N.type)}}typeof Promise=="undefined"&&r(3);var m=Promise;function w(T,N){N&&T.then(function(L){N(null,L)},function(L){N(L)})}function x(T,N,L){typeof N=="function"&&T.then(N),typeof L=="function"&&T.catch(L)}function A(T){return typeof T!="string"&&(console.warn(T+" used as a key, but it is not a string."),T=String(T)),T}function D(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var j="local-forage-detect-blob-support",ee=void 0,d={},g=Object.prototype.toString,_="readonly",y="readwrite";function O(T){for(var N=T.length,L=new ArrayBuffer(N),P=new Uint8Array(L),W=0;W<N;W++)P[W]=T.charCodeAt(W);return L}function E(T){return new m(function(N){var L=T.transaction(j,y),P=p([""]);L.objectStore(j).put(P,"key"),L.onabort=function(W){W.preventDefault(),W.stopPropagation(),N(!1)},L.oncomplete=function(){var W=navigator.userAgent.match(/Chrome\/(\d+)/),h=navigator.userAgent.match(/Edge\//);N(h||!W||parseInt(W[1],10)>=43)}}).catch(function(){return!1})}function k(T){return typeof ee=="boolean"?m.resolve(ee):E(T).then(function(N){return ee=N,ee})}function M(T){var N=d[T.name],L={};L.promise=new m(function(P,W){L.resolve=P,L.reject=W}),N.deferredOperations.push(L),N.dbReady?N.dbReady=N.dbReady.then(function(){return L.promise}):N.dbReady=L.promise}function q(T){var N=d[T.name],L=N.deferredOperations.pop();if(L)return L.resolve(),L.promise}function Y(T,N){var L=d[T.name],P=L.deferredOperations.pop();if(P)return P.reject(N),P.promise}function F(T,N){return new m(function(L,P){if(d[T.name]=d[T.name]||le(),T.db)if(N)M(T),T.db.close();else return L(T.db);var W=[T.name];N&&W.push(T.version);var h=c.open.apply(c,W);N&&(h.onupgradeneeded=function(b){var v=h.result;try{v.createObjectStore(T.storeName),b.oldVersion<=1&&v.createObjectStore(j)}catch(S){if(S.name==="ConstraintError")console.warn('The database "'+T.name+'" has been upgraded from version '+b.oldVersion+" to version "+b.newVersion+', but the storage "'+T.storeName+'" already exists.');else throw S}}),h.onerror=function(b){b.preventDefault(),P(h.error)},h.onsuccess=function(){var b=h.result;b.onversionchange=function(v){v.target.close()},L(b),q(T)}})}function Z(T){return F(T,!1)}function B(T){return F(T,!0)}function Q(T,N){if(!T.db)return!0;var L=!T.db.objectStoreNames.contains(T.storeName),P=T.version<T.db.version,W=T.version>T.db.version;if(P&&(T.version!==N&&console.warn('The database "'+T.name+`" can't be downgraded from version `+T.db.version+" to version "+T.version+"."),T.version=T.db.version),W||L){if(L){var h=T.db.version+1;h>T.version&&(T.version=h)}return!0}return!1}function ne(T){return new m(function(N,L){var P=new FileReader;P.onerror=L,P.onloadend=function(W){var h=btoa(W.target.result||"");N({__local_forage_encoded_blob:!0,data:h,type:T.type})},P.readAsBinaryString(T)})}function ce(T){var N=O(atob(T.data));return p([N],{type:T.type})}function be(T){return T&&T.__local_forage_encoded_blob}function pe(T){var N=this,L=N._initReady().then(function(){var P=d[N._dbInfo.name];if(P&&P.dbReady)return P.dbReady});return x(L,T,T),L}function Ie(T){M(T);for(var N=d[T.name],L=N.forages,P=0;P<L.length;P++){var W=L[P];W._dbInfo.db&&(W._dbInfo.db.close(),W._dbInfo.db=null)}return T.db=null,Z(T).then(function(h){return T.db=h,Q(T)?B(T):h}).then(function(h){T.db=N.db=h;for(var b=0;b<L.length;b++)L[b]._dbInfo.db=h}).catch(function(h){throw Y(T,h),h})}function ke(T,N,L,P){P===void 0&&(P=1);try{var W=T.db.transaction(T.storeName,N);L(null,W)}catch(h){if(P>0&&(!T.db||h.name==="InvalidStateError"||h.name==="NotFoundError"))return m.resolve().then(function(){if(!T.db||h.name==="NotFoundError"&&!T.db.objectStoreNames.contains(T.storeName)&&T.version<=T.db.version)return T.db&&(T.version=T.db.version+1),B(T)}).then(function(){return Ie(T).then(function(){ke(T,N,L,P-1)})}).catch(L);L(h)}}function le(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function K(T){var N=this,L={db:null};if(T)for(var P in T)L[P]=T[P];var W=d[L.name];W||(W=le(),d[L.name]=W),W.forages.push(N),N._initReady||(N._initReady=N.ready,N.ready=pe);var h=[];function b(){return m.resolve()}for(var v=0;v<W.forages.length;v++){var S=W.forages[v];S!==N&&h.push(S._initReady().catch(b))}var C=W.forages.slice(0);return m.all(h).then(function(){return L.db=W.db,Z(L)}).then(function(I){return L.db=I,Q(L,N._defaultConfig.version)?B(L):I}).then(function(I){L.db=W.db=I,N._dbInfo=L;for(var R=0;R<C.length;R++){var H=C[R];H!==N&&(H._dbInfo.db=L.db,H._dbInfo.version=L.version)}})}function oe(T,N){var L=this;T=A(T);var P=new m(function(W,h){L.ready().then(function(){ke(L._dbInfo,_,function(b,v){if(b)return h(b);try{var S=v.objectStore(L._dbInfo.storeName),C=S.get(T);C.onsuccess=function(){var I=C.result;I===void 0&&(I=null),be(I)&&(I=ce(I)),W(I)},C.onerror=function(){h(C.error)}}catch(I){h(I)}})}).catch(h)});return w(P,N),P}function ie(T,N){var L=this,P=new m(function(W,h){L.ready().then(function(){ke(L._dbInfo,_,function(b,v){if(b)return h(b);try{var S=v.objectStore(L._dbInfo.storeName),C=S.openCursor(),I=1;C.onsuccess=function(){var R=C.result;if(R){var H=R.value;be(H)&&(H=ce(H));var J=T(H,R.key,I++);J!==void 0?W(J):R.continue()}else W()},C.onerror=function(){h(C.error)}}catch(R){h(R)}})}).catch(h)});return w(P,N),P}function U(T,N,L){var P=this;T=A(T);var W=new m(function(h,b){var v;P.ready().then(function(){return v=P._dbInfo,g.call(N)==="[object Blob]"?k(v.db).then(function(S){return S?N:ne(N)}):N}).then(function(S){ke(P._dbInfo,y,function(C,I){if(C)return b(C);try{var R=I.objectStore(P._dbInfo.storeName);S===null&&(S=void 0);var H=R.put(S,T);I.oncomplete=function(){S===void 0&&(S=null),h(S)},I.onabort=I.onerror=function(){var J=H.error?H.error:H.transaction.error;b(J)}}catch(J){b(J)}})}).catch(b)});return w(W,L),W}function z(T,N){var L=this;T=A(T);var P=new m(function(W,h){L.ready().then(function(){ke(L._dbInfo,y,function(b,v){if(b)return h(b);try{var S=v.objectStore(L._dbInfo.storeName),C=S.delete(T);v.oncomplete=function(){W()},v.onerror=function(){h(C.error)},v.onabort=function(){var I=C.error?C.error:C.transaction.error;h(I)}}catch(I){h(I)}})}).catch(h)});return w(P,N),P}function re(T){var N=this,L=new m(function(P,W){N.ready().then(function(){ke(N._dbInfo,y,function(h,b){if(h)return W(h);try{var v=b.objectStore(N._dbInfo.storeName),S=v.clear();b.oncomplete=function(){P()},b.onabort=b.onerror=function(){var C=S.error?S.error:S.transaction.error;W(C)}}catch(C){W(C)}})}).catch(W)});return w(L,T),L}function de(T){var N=this,L=new m(function(P,W){N.ready().then(function(){ke(N._dbInfo,_,function(h,b){if(h)return W(h);try{var v=b.objectStore(N._dbInfo.storeName),S=v.count();S.onsuccess=function(){P(S.result)},S.onerror=function(){W(S.error)}}catch(C){W(C)}})}).catch(W)});return w(L,T),L}function X(T,N){var L=this,P=new m(function(W,h){if(T<0){W(null);return}L.ready().then(function(){ke(L._dbInfo,_,function(b,v){if(b)return h(b);try{var S=v.objectStore(L._dbInfo.storeName),C=!1,I=S.openKeyCursor();I.onsuccess=function(){var R=I.result;if(!R){W(null);return}T===0||C?W(R.key):(C=!0,R.advance(T))},I.onerror=function(){h(I.error)}}catch(R){h(R)}})}).catch(h)});return w(P,N),P}function fe(T){var N=this,L=new m(function(P,W){N.ready().then(function(){ke(N._dbInfo,_,function(h,b){if(h)return W(h);try{var v=b.objectStore(N._dbInfo.storeName),S=v.openKeyCursor(),C=[];S.onsuccess=function(){var I=S.result;if(!I){P(C);return}C.push(I.key),I.continue()},S.onerror=function(){W(S.error)}}catch(I){W(I)}})}).catch(W)});return w(L,T),L}function ue(T,N){N=D.apply(this,arguments);var L=this.config();T=typeof T!="function"&&T||{},T.name||(T.name=T.name||L.name,T.storeName=T.storeName||L.storeName);var P=this,W;if(!T.name)W=m.reject("Invalid arguments");else{var h=T.name===L.name&&P._dbInfo.db,b=h?m.resolve(P._dbInfo.db):Z(T).then(function(v){var S=d[T.name],C=S.forages;S.db=v;for(var I=0;I<C.length;I++)C[I]._dbInfo.db=v;return v});T.storeName?W=b.then(function(v){if(!!v.objectStoreNames.contains(T.storeName)){var S=v.version+1;M(T);var C=d[T.name],I=C.forages;v.close();for(var R=0;R<I.length;R++){var H=I[R];H._dbInfo.db=null,H._dbInfo.version=S}var J=new m(function(se,he){var me=c.open(T.name,S);me.onerror=function($e){var we=me.result;we.close(),he($e)},me.onupgradeneeded=function(){var $e=me.result;$e.deleteObjectStore(T.storeName)},me.onsuccess=function(){var $e=me.result;$e.close(),se($e)}});return J.then(function(se){C.db=se;for(var he=0;he<I.length;he++){var me=I[he];me._dbInfo.db=se,q(me._dbInfo)}}).catch(function(se){throw(Y(T,se)||m.resolve()).catch(function(){}),se})}}):W=b.then(function(v){M(T);var S=d[T.name],C=S.forages;v.close();for(var I=0;I<C.length;I++){var R=C[I];R._dbInfo.db=null}var H=new m(function(J,se){var he=c.deleteDatabase(T.name);he.onerror=function(){var me=he.result;me&&me.close(),se(he.error)},he.onblocked=function(){console.warn('dropInstance blocked for database "'+T.name+'" until all open connections are closed')},he.onsuccess=function(){var me=he.result;me&&me.close(),J(me)}});return H.then(function(J){S.db=J;for(var se=0;se<C.length;se++){var he=C[se];q(he._dbInfo)}}).catch(function(J){throw(Y(T,J)||m.resolve()).catch(function(){}),J})})}return w(W,N),W}var ye={_driver:"asyncStorage",_initStorage:K,_support:u(),iterate:ie,getItem:oe,setItem:U,removeItem:z,clear:re,length:de,key:X,keys:fe,dropInstance:ue};function Ue(){return typeof openDatabase=="function"}var De="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Le="~~local_forage_type~",dt=/^~~local_forage_type~([^~]+)~/,ut="__lfsc__:",et=ut.length,$t="arbf",_t="blob",Yt="si08",ae="ui08",_e="uic8",Se="si16",We="si32",nt="ur16",Ot="ui32",zt="fl32",li="fl64",Gt=et+$t.length,ci=Object.prototype.toString;function yi(T){var N=T.length*.75,L=T.length,P,W=0,h,b,v,S;T[T.length-1]==="="&&(N--,T[T.length-2]==="="&&N--);var C=new ArrayBuffer(N),I=new Uint8Array(C);for(P=0;P<L;P+=4)h=De.indexOf(T[P]),b=De.indexOf(T[P+1]),v=De.indexOf(T[P+2]),S=De.indexOf(T[P+3]),I[W++]=h<<2|b>>4,I[W++]=(b&15)<<4|v>>2,I[W++]=(v&3)<<6|S&63;return C}function tt(T){var N=new Uint8Array(T),L="",P;for(P=0;P<N.length;P+=3)L+=De[N[P]>>2],L+=De[(N[P]&3)<<4|N[P+1]>>4],L+=De[(N[P+1]&15)<<2|N[P+2]>>6],L+=De[N[P+2]&63];return N.length%3===2?L=L.substring(0,L.length-1)+"=":N.length%3===1&&(L=L.substring(0,L.length-2)+"=="),L}function di(T,N){var L="";if(T&&(L=ci.call(T)),T&&(L==="[object ArrayBuffer]"||T.buffer&&ci.call(T.buffer)==="[object ArrayBuffer]")){var P,W=ut;T instanceof ArrayBuffer?(P=T,W+=$t):(P=T.buffer,L==="[object Int8Array]"?W+=Yt:L==="[object Uint8Array]"?W+=ae:L==="[object Uint8ClampedArray]"?W+=_e:L==="[object Int16Array]"?W+=Se:L==="[object Uint16Array]"?W+=nt:L==="[object Int32Array]"?W+=We:L==="[object Uint32Array]"?W+=Ot:L==="[object Float32Array]"?W+=zt:L==="[object Float64Array]"?W+=li:N(new Error("Failed to get type for BinaryArray"))),N(W+tt(P))}else if(L==="[object Blob]"){var h=new FileReader;h.onload=function(){var b=Le+T.type+"~"+tt(this.result);N(ut+_t+b)},h.readAsArrayBuffer(T)}else try{N(JSON.stringify(T))}catch(b){console.error("Couldn't convert value into a JSON string: ",T),N(null,b)}}function ji(T){if(T.substring(0,et)!==ut)return JSON.parse(T);var N=T.substring(Gt),L=T.substring(et,Gt),P;if(L===_t&&dt.test(N)){var W=N.match(dt);P=W[1],N=N.substring(W[0].length)}var h=yi(N);switch(L){case $t:return h;case _t:return p([h],{type:P});case Yt:return new Int8Array(h);case ae:return new Uint8Array(h);case _e:return new Uint8ClampedArray(h);case Se:return new Int16Array(h);case nt:return new Uint16Array(h);case We:return new Int32Array(h);case Ot:return new Uint32Array(h);case zt:return new Float32Array(h);case li:return new Float64Array(h);default:throw new Error("Unkown type: "+L)}}var ui={serialize:di,deserialize:ji,stringToBuffer:yi,bufferToString:tt};function pi(T,N,L,P){T.executeSql("CREATE TABLE IF NOT EXISTS "+N.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],L,P)}function zi(T){var N=this,L={db:null};if(T)for(var P in T)L[P]=typeof T[P]!="string"?T[P].toString():T[P];var W=new m(function(h,b){try{L.db=openDatabase(L.name,String(L.version),L.description,L.size)}catch(v){return b(v)}L.db.transaction(function(v){pi(v,L,function(){N._dbInfo=L,h()},function(S,C){b(C)})},b)});return L.serializer=ui,W}function At(T,N,L,P,W,h){T.executeSql(L,P,W,function(b,v){v.code===v.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[N.storeName],function(S,C){C.rows.length?h(S,v):pi(S,N,function(){S.executeSql(L,P,W,h)},h)},h):h(b,v)},h)}function Sr(T,N){var L=this;T=A(T);var P=new m(function(W,h){L.ready().then(function(){var b=L._dbInfo;b.db.transaction(function(v){At(v,b,"SELECT * FROM "+b.storeName+" WHERE key = ? LIMIT 1",[T],function(S,C){var I=C.rows.length?C.rows.item(0).value:null;I&&(I=b.serializer.deserialize(I)),W(I)},function(S,C){h(C)})})}).catch(h)});return w(P,N),P}function Fi(T,N){var L=this,P=new m(function(W,h){L.ready().then(function(){var b=L._dbInfo;b.db.transaction(function(v){At(v,b,"SELECT * FROM "+b.storeName,[],function(S,C){for(var I=C.rows,R=I.length,H=0;H<R;H++){var J=I.item(H),se=J.value;if(se&&(se=b.serializer.deserialize(se)),se=T(se,J.key,H+1),se!==void 0){W(se);return}}W()},function(S,C){h(C)})})}).catch(h)});return w(P,N),P}function wi(T,N,L,P){var W=this;T=A(T);var h=new m(function(b,v){W.ready().then(function(){N===void 0&&(N=null);var S=N,C=W._dbInfo;C.serializer.serialize(N,function(I,R){R?v(R):C.db.transaction(function(H){At(H,C,"INSERT OR REPLACE INTO "+C.storeName+" (key, value) VALUES (?, ?)",[T,I],function(){b(S)},function(J,se){v(se)})},function(H){if(H.code===H.QUOTA_ERR){if(P>0){b(wi.apply(W,[T,S,L,P-1]));return}v(H)}})})}).catch(v)});return w(h,L),h}function Hi(T,N,L){return wi.apply(this,[T,N,L,1])}function Qs(T,N){var L=this;T=A(T);var P=new m(function(W,h){L.ready().then(function(){var b=L._dbInfo;b.db.transaction(function(v){At(v,b,"DELETE FROM "+b.storeName+" WHERE key = ?",[T],function(){W()},function(S,C){h(C)})})}).catch(h)});return w(P,N),P}function uo(T){var N=this,L=new m(function(P,W){N.ready().then(function(){var h=N._dbInfo;h.db.transaction(function(b){At(b,h,"DELETE FROM "+h.storeName,[],function(){P()},function(v,S){W(S)})})}).catch(W)});return w(L,T),L}function en(T){var N=this,L=new m(function(P,W){N.ready().then(function(){var h=N._dbInfo;h.db.transaction(function(b){At(b,h,"SELECT COUNT(key) as c FROM "+h.storeName,[],function(v,S){var C=S.rows.item(0).c;P(C)},function(v,S){W(S)})})}).catch(W)});return w(L,T),L}function tn(T,N){var L=this,P=new m(function(W,h){L.ready().then(function(){var b=L._dbInfo;b.db.transaction(function(v){At(v,b,"SELECT key FROM "+b.storeName+" WHERE id = ? LIMIT 1",[T+1],function(S,C){var I=C.rows.length?C.rows.item(0).key:null;W(I)},function(S,C){h(C)})})}).catch(h)});return w(P,N),P}function rn(T){var N=this,L=new m(function(P,W){N.ready().then(function(){var h=N._dbInfo;h.db.transaction(function(b){At(b,h,"SELECT key FROM "+h.storeName,[],function(v,S){for(var C=[],I=0;I<S.rows.length;I++)C.push(S.rows.item(I).key);P(C)},function(v,S){W(S)})})}).catch(W)});return w(L,T),L}function sn(T){return new m(function(N,L){T.transaction(function(P){P.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(W,h){for(var b=[],v=0;v<h.rows.length;v++)b.push(h.rows.item(v).name);N({db:T,storeNames:b})},function(W,h){L(h)})},function(P){L(P)})})}function nn(T,N){N=D.apply(this,arguments);var L=this.config();T=typeof T!="function"&&T||{},T.name||(T.name=T.name||L.name,T.storeName=T.storeName||L.storeName);var P=this,W;return T.name?W=new m(function(h){var b;T.name===L.name?b=P._dbInfo.db:b=openDatabase(T.name,"","",0),T.storeName?h({db:b,storeNames:[T.storeName]}):h(sn(b))}).then(function(h){return new m(function(b,v){h.db.transaction(function(S){function C(J){return new m(function(se,he){S.executeSql("DROP TABLE IF EXISTS "+J,[],function(){se()},function(me,$e){he($e)})})}for(var I=[],R=0,H=h.storeNames.length;R<H;R++)I.push(C(h.storeNames[R]));m.all(I).then(function(){b()}).catch(function(J){v(J)})},function(S){v(S)})})}):W=m.reject("Invalid arguments"),w(W,N),W}var Kt={_driver:"webSQLStorage",_initStorage:zi,_support:Ue(),iterate:Fi,getItem:Sr,setItem:Hi,removeItem:Qs,clear:uo,length:en,key:tn,keys:rn,dropInstance:nn};function po(){try{return typeof localStorage!="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch(T){return!1}}function ve(T,N){var L=T.name+"/";return T.storeName!==N.storeName&&(L+=T.storeName+"/"),L}function qi(){var T="_localforage_support_test";try{return localStorage.setItem(T,!0),localStorage.removeItem(T),!1}catch(N){return!0}}function Tr(){return!qi()||localStorage.length>0}function ho(T){var N=this,L={};if(T)for(var P in T)L[P]=T[P];return L.keyPrefix=ve(T,N._defaultConfig),Tr()?(N._dbInfo=L,L.serializer=ui,m.resolve()):m.reject()}function Ui(T){var N=this,L=N.ready().then(function(){for(var P=N._dbInfo.keyPrefix,W=localStorage.length-1;W>=0;W--){var h=localStorage.key(W);h.indexOf(P)===0&&localStorage.removeItem(h)}});return w(L,T),L}function Er(T,N){var L=this;T=A(T);var P=L.ready().then(function(){var W=L._dbInfo,h=localStorage.getItem(W.keyPrefix+T);return h&&(h=W.serializer.deserialize(h)),h});return w(P,N),P}function ki(T,N){var L=this,P=L.ready().then(function(){for(var W=L._dbInfo,h=W.keyPrefix,b=h.length,v=localStorage.length,S=1,C=0;C<v;C++){var I=localStorage.key(C);if(I.indexOf(h)===0){var R=localStorage.getItem(I);if(R&&(R=W.serializer.deserialize(R)),R=T(R,I.substring(b),S++),R!==void 0)return R}}});return w(P,N),P}function $r(T,N){var L=this,P=L.ready().then(function(){var W=L._dbInfo,h;try{h=localStorage.key(T)}catch(b){h=null}return h&&(h=h.substring(W.keyPrefix.length)),h});return w(P,N),P}function Or(T){var N=this,L=N.ready().then(function(){for(var P=N._dbInfo,W=localStorage.length,h=[],b=0;b<W;b++){var v=localStorage.key(b);v.indexOf(P.keyPrefix)===0&&h.push(v.substring(P.keyPrefix.length))}return h});return w(L,T),L}function Ar(T){var N=this,L=N.keys().then(function(P){return P.length});return w(L,T),L}function Wi(T,N){var L=this;T=A(T);var P=L.ready().then(function(){var W=L._dbInfo;localStorage.removeItem(W.keyPrefix+T)});return w(P,N),P}function xi(T,N,L){var P=this;T=A(T);var W=P.ready().then(function(){N===void 0&&(N=null);var h=N;return new m(function(b,v){var S=P._dbInfo;S.serializer.serialize(N,function(C,I){if(I)v(I);else try{localStorage.setItem(S.keyPrefix+T,C),b(h)}catch(R){(R.name==="QuotaExceededError"||R.name==="NS_ERROR_DOM_QUOTA_REACHED")&&v(R),v(R)}})})});return w(W,L),W}function Xe(T,N){if(N=D.apply(this,arguments),T=typeof T!="function"&&T||{},!T.name){var L=this.config();T.name=T.name||L.name,T.storeName=T.storeName||L.storeName}var P=this,W;return T.name?W=new m(function(h){T.storeName?h(ve(T,P._defaultConfig)):h(T.name+"/")}).then(function(h){for(var b=localStorage.length-1;b>=0;b--){var v=localStorage.key(b);v.indexOf(h)===0&&localStorage.removeItem(v)}}):W=m.reject("Invalid arguments"),w(W,N),W}var Lr={_driver:"localStorageWrapper",_initStorage:ho,_support:po(),iterate:ki,getItem:Er,setItem:xi,removeItem:Wi,clear:Ui,length:Ar,key:$r,keys:Or,dropInstance:Xe},Vi=function(N,L){return N===L||typeof N=="number"&&typeof L=="number"&&isNaN(N)&&isNaN(L)},on=function(N,L){for(var P=N.length,W=0;W<P;){if(Vi(N[W],L))return!0;W++}return!1},vt=Array.isArray||function(T){return Object.prototype.toString.call(T)==="[object Array]"},Xt={},hi={},Ft={INDEXEDDB:ye,WEBSQL:Kt,LOCALSTORAGE:Lr},Br=[Ft.INDEXEDDB._driver,Ft.WEBSQL._driver,Ft.LOCALSTORAGE._driver],Ht=["dropInstance"],mt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ht),Re={description:"",driver:Br.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ci(T,N){T[N]=function(){var L=arguments;return T.ready().then(function(){return T[N].apply(T,L)})}}function fi(){for(var T=1;T<arguments.length;T++){var N=arguments[T];if(N)for(var L in N)N.hasOwnProperty(L)&&(vt(N[L])?arguments[0][L]=N[L].slice():arguments[0][L]=N[L])}return arguments[0]}var Ce=function(){function T(N){a(this,T);for(var L in Ft)if(Ft.hasOwnProperty(L)){var P=Ft[L],W=P._driver;this[L]=W,Xt[W]||this.defineDriver(P)}this._defaultConfig=fi({},Re),this._config=fi({},this._defaultConfig,N),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return T.prototype.config=function(L){if((typeof L=="undefined"?"undefined":o(L))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var P in L){if(P==="storeName"&&(L[P]=L[P].replace(/\W/g,"_")),P==="version"&&typeof L[P]!="number")return new Error("Database version must be a number.");this._config[P]=L[P]}return"driver"in L&&L.driver?this.setDriver(this._config.driver):!0}else return typeof L=="string"?this._config[L]:this._config},T.prototype.defineDriver=function(L,P,W){var h=new m(function(b,v){try{var S=L._driver,C=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!L._driver){v(C);return}for(var I=mt.concat("_initStorage"),R=0,H=I.length;R<H;R++){var J=I[R],se=!on(Ht,J);if((se||L[J])&&typeof L[J]!="function"){v(C);return}}var he=function(){for(var we=function(Me){return function(){var wt=new Error("Method "+Me+" is not implemented by the current driver"),pt=m.reject(wt);return w(pt,arguments[arguments.length-1]),pt}},Pe=0,Te=Ht.length;Pe<Te;Pe++){var je=Ht[Pe];L[je]||(L[je]=we(je))}};he();var me=function(we){Xt[S]&&console.info("Redefining LocalForage driver: "+S),Xt[S]=L,hi[S]=we,b()};"_support"in L?L._support&&typeof L._support=="function"?L._support().then(me,v):me(!!L._support):me(!0)}catch($e){v($e)}});return x(h,P,W),h},T.prototype.driver=function(){return this._driver||null},T.prototype.getDriver=function(L,P,W){var h=Xt[L]?m.resolve(Xt[L]):m.reject(new Error("Driver not found."));return x(h,P,W),h},T.prototype.getSerializer=function(L){var P=m.resolve(ui);return x(P,L),P},T.prototype.ready=function(L){var P=this,W=P._driverSet.then(function(){return P._ready===null&&(P._ready=P._initDriver()),P._ready});return x(W,L,L),W},T.prototype.setDriver=function(L,P,W){var h=this;vt(L)||(L=[L]);var b=this._getSupportedDrivers(L);function v(){h._config.driver=h.driver()}function S(R){return h._extend(R),v(),h._ready=h._initStorage(h._config),h._ready}function C(R){return function(){var H=0;function J(){for(;H<R.length;){var se=R[H];return H++,h._dbInfo=null,h._ready=null,h.getDriver(se).then(S).catch(J)}v();var he=new Error("No available storage method found.");return h._driverSet=m.reject(he),h._driverSet}return J()}}var I=this._driverSet!==null?this._driverSet.catch(function(){return m.resolve()}):m.resolve();return this._driverSet=I.then(function(){var R=b[0];return h._dbInfo=null,h._ready=null,h.getDriver(R).then(function(H){h._driver=H._driver,v(),h._wrapLibraryMethodsWithReady(),h._initDriver=C(b)})}).catch(function(){v();var R=new Error("No available storage method found.");return h._driverSet=m.reject(R),h._driverSet}),x(this._driverSet,P,W),this._driverSet},T.prototype.supports=function(L){return!!hi[L]},T.prototype._extend=function(L){fi(this,L)},T.prototype._getSupportedDrivers=function(L){for(var P=[],W=0,h=L.length;W<h;W++){var b=L[W];this.supports(b)&&P.push(b)}return P},T.prototype._wrapLibraryMethodsWithReady=function(){for(var L=0,P=mt.length;L<P;L++)Ci(this,mt[L])},T.prototype.createInstance=function(L){return new T(L)},T}(),gt=new Ce;s.exports=gt},{3:3}]},{},[4])(4)})});var Lf=te((Kn,ol)=>{(function(i,e){typeof Kn=="object"&&typeof ol=="object"?ol.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Kn=="object"?Kn.Undo=e():i.Undo=e()})(window,function(){return function(i){var e={};function t(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return i[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}return t.m=i,t.c=e,t.d=function(r,s,n){t.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:n})},t.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,s){if(1&s&&(r=t(r)),8&s||4&s&&typeof r=="object"&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&s&&typeof r!="string")for(var o in r)t.d(n,o,function(a){return r[a]}.bind(null,o));return n},t.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(s,"a",s),s},t.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},t.p="/",t(t.s=0)}([function(i,e,t){"use strict";function r(a,l){for(var c=0;c<l.length;c++){var u=l[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}t.r(e),t.d(e,"default",function(){return o});var s=function(){function a(p,m){(function(w,x){if(!(w instanceof x))throw new TypeError("Cannot call a class as a function")})(this,a),this.holder=typeof m=="string"?document.getElementById(m):m,this.observer=null,this.debounceTimer=200,this.mutationDebouncer=this.debounce(function(){p()},this.debounceTimer)}var l,c,u;return l=a,(c=[{key:"setMutationObserver",value:function(){var p=this,m=this.holder;this.observer=new MutationObserver(function(w){p.mutationHandler(w)}),this.observer.observe(m,{childList:!0,attributes:!0,subtree:!0,characterData:!0,characterDataOldValue:!0})}},{key:"mutationHandler",value:function(p){var m=this,w=!1;p.forEach(function(x){switch(x.type){case"childList":x.target===m.holder?m.onDestroy():w=!0;break;case"characterData":w=!0;break;case"attributes":x.target.classList.contains("ce-block")||(w=!0)}}),w&&this.mutationDebouncer()}},{key:"debounce",value:function(p,m){var w,x=this;return function(){for(var A=arguments.length,D=new Array(A),j=0;j<A;j++)D[j]=arguments[j];var ee=x;clearTimeout(w),w=setTimeout(function(){return p.apply(ee,D)},m)}}},{key:"onDestroy",value:function(){var p=new CustomEvent("destroy");document.dispatchEvent(p),this.observer.disconnect()}}])&&r(l.prototype,c),u&&r(l,u),a}();function n(a,l){for(var c=0;c<l.length;c++){var u=l[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}var o=function(){function a(p){var m=this,w=p.editor,x=p.onUpdate,A=p.maxLength;(function(ee,d){if(!(ee instanceof d))throw new TypeError("Cannot call a class as a function")})(this,a);var D={maxLength:30,onUpdate:function(){}},j=w.configuration;this.editor=w,this.shouldSaveHistory=!0,this.readOnly=j.readOnly,this.maxLength=A||D.maxLength,this.onUpdate=x||D.onUpdate,new s(function(){return m.registerChange()},j.holder).setMutationObserver(),this.setEventListeners(),this.initialItem=null,this.clear()}var l,c,u;return l=a,u=[{key:"isReadOnlySupported",get:function(){return!0}}],(c=[{key:"truncate",value:function(p,m){for(;p.length>m;)p.shift()}},{key:"initialize",value:function(p){var m="blocks"in p?p.blocks:p,w={index:m.length-1,state:m};this.stack[0]=w,this.initialItem=w}},{key:"clear",value:function(){this.stack=this.initialItem?[this.initialItem]:[{index:0,state:[]}],this.position=0,this.onUpdate()}},{key:"registerChange",value:function(){var p=this;this.readOnly||(this.editor&&this.editor.save&&this.shouldSaveHistory&&this.editor.save().then(function(m){p.editorDidUpdate(m.blocks)&&p.save(m.blocks)}),this.shouldSaveHistory=!0)}},{key:"editorDidUpdate",value:function(p){var m=this.stack[this.position].state;return p.length!==m.length||JSON.stringify(m)!==JSON.stringify(p)}},{key:"save",value:function(p){this.position>=this.maxLength&&this.truncate(this.stack,this.maxLength),this.position=Math.min(this.position,this.stack.length-1),this.stack=this.stack.slice(0,this.position+1);var m=this.editor.blocks.getCurrentBlockIndex();this.stack.push({index:m,state:p}),this.position+=1,this.onUpdate()}},{key:"undo",value:function(){var p=this;if(this.canUndo()){this.shouldSaveHistory=!1;var m=this.stack[this.position-=1],w=m.index,x=m.state;this.onUpdate(),this.editor.blocks.render({blocks:x}).then(function(){return p.editor.caret.setToBlock(w,"end")})}}},{key:"redo",value:function(){var p=this;if(this.canRedo()){this.shouldSaveHistory=!1;var m=this.stack[this.position+=1],w=m.index,x=m.state;this.onUpdate(),this.editor.blocks.render({blocks:x}).then(function(){return p.editor.caret.setToBlock(w,"end")})}}},{key:"canUndo",value:function(){return!this.readOnly&&this.position>0}},{key:"canRedo",value:function(){return!this.readOnly&&this.position<this.count()}},{key:"count",value:function(){return this.stack.length-1}},{key:"setEventListeners",value:function(){var p=this,m=/(Mac)/i.test(navigator.platform)?"metaKey":"ctrlKey",w=function(A){A[m]&&A.key==="z"&&(A.preventDefault(),p.undo())},x=function(A){A[m]&&A.key==="y"&&(A.preventDefault(),p.redo())};document.addEventListener("keydown",w),document.addEventListener("keydown",x),document.addEventListener("destroy",function(){document.removeEventListener("keydown",w),document.removeEventListener("keydown",x)})}}])&&n(l.prototype,c),u&&n(l,u),a}()}]).default})});var Mf=te((exports,module)=>{frappe.dashboard_utils={render_chart_filters:function(i,e,t,r){i.forEach(s=>{let n="",o="";s.icon&&(n=frappe.utils.icon(s.icon)),s.class&&(o=s.class);let a=`<div class="${e} ${o} btn-group dropdown pull-right">
					<a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<button class="btn btn-secondary btn-xs">
							${n}
							<span class="filter-label">${__(s.label)}</span>
							${frappe.utils.icon("select","xs")}
						</button>
				</a>`,l;s.fieldnames?l=s.options.map((p,m)=>`<li>
						<a class="dropdown-item" data-fieldname="${s.fieldnames[m]}" data-option="${encodeURIComponent(p)}">${__(p)}</a>
					</li>`).join(""):l=s.options.map(p=>`<li><a class="dropdown-item" data-option="${encodeURIComponent(p)}">${__(p)}</a></li>`).join("");let c=a+`<ul class="dropdown-menu">${l}</ul></div>`,u=$(c);r?u.prependTo(t):u.appendTo(t),u.find(".dropdown-menu").on("click","li a",p=>{let m=$(p.currentTarget),w;m.attr("data-fieldname")&&(w=m.attr("data-fieldname"));let x=decodeURIComponent(m.data("option"));m.parents(`.${e}`).find(".filter-label").html(__(x)),s.action(x,w)})})},get_filters_for_chart_type:function(i){if(i.chart_type==="Custom"&&i.source){let e="frappe.desk.doctype.dashboard_chart_source.dashboard_chart_source.get_config";return frappe.xcall(e,{name:i.source}).then(t=>(frappe.dom.eval(t),frappe.dashboards.chart_sources[i.source].filters))}else return i.chart_type==="Report"&&i.report_name?frappe.report_utils.get_report_filters(i.report_name).then(e=>e):Promise.resolve()},get_dashboard_settings(){return frappe.db.get_list("Dashboard Settings",{filters:{name:frappe.session.user},fields:["*"]}).then(i=>i.length?i[0]:this.create_dashboard_settings().then(e=>e))},create_dashboard_settings(){return frappe.xcall("frappe.desk.doctype.dashboard_settings.dashboard_settings.create_dashboard_settings",{user:frappe.session.user}).then(i=>i)},get_years_since_creation(i){let e=this.get_year(i),t=this.get_year(frappe.datetime.now_date()),r=[];for(var s=t;s>=e;s--)r.push(s);return r},get_year(i){return i.substring(0,i.indexOf("-"))},remove_common_static_filter_values(i,e){if(e)if($.isArray(i))i=i.filter(t=>{for(let r of e)if(t[0]==r[0]&&t[1]==r[1])return!1;return!0});else for(let t of Object.keys(e))delete i[t];return i},get_fields_for_dynamic_filter_dialog(i,e,t){let r=[{fieldtype:"HTML",fieldname:"description",options:`<div>
						<p>${__("Set dynamic filter values in JavaScript for the required fields here.")}
						</p>
						<p>${__("For example:")}
							<code>frappe.defaults.get_user_default("Company")</code>
						</p>
					</div>`}];if(i)t&&(e=[...e,...t]),e.forEach(s=>{for(let n of r)if(n.fieldname==s[0]+":"+s[1])return;s[2]=="="&&r.push({label:`${s[1]} (${s[0]})`,fieldname:s[0]+":"+s[1],fieldtype:"Data"})});else{e=Ee(Ee({},t),e);for(let s of Object.keys(e))r.push({label:s,fieldname:s,fieldtype:"Data"})}return r},get_all_filters(doc){let filters=doc.filters_json?JSON.parse(doc.filters_json):null,dynamic_filters=doc.dynamic_filters_json?JSON.parse(doc.dynamic_filters_json):null;if(!dynamic_filters||!Object.keys(dynamic_filters).length)return filters;if(Array.isArray(dynamic_filters))dynamic_filters.forEach(f=>{try{f[3]=eval(f[3])}catch(i){frappe.throw(__("Invalid expression set in filter {0} ({1})",[f[1],f[0]]))}}),filters=[...filters,...dynamic_filters];else{for(let key of Object.keys(dynamic_filters))try{let val=eval(dynamic_filters[key]);dynamic_filters[key]=val}catch(i){frappe.throw(__("Invalid expression set in filter {0}",[key]))}Object.assign(filters,dynamic_filters)}return filters},get_dashboard_link_field(){let i={label:__("Select Dashboard"),fieldtype:"Link",fieldname:"dashboard",options:"Dashboard"};return frappe.boot.developer_mode||(i.get_query=()=>({filters:{is_standard:0}})),i},get_add_to_dashboard_dialog(i,e,t){let r=this.get_dashboard_link_field(),s=new frappe.ui.Dialog({title:__("Add to Dashboard"),fields:[r],primary_action:n=>{n.name=i,n.set_standard=frappe.boot.developer_mode,frappe.xcall(t,{args:n}).then(()=>{let o=`<a href = "/app/dashboard/${n.dashboard}">${n.dashboard}</a>`,a=__("{0} {1} added to Dashboard {2}",[e,n.name,o]);frappe.msgprint(a)}),s.hide()}});return s}}});var l_=te(($l,Ol)=>{(function(i,e){typeof $l=="object"&&typeof Ol!="undefined"?Ol.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self).Sortable=e()})($l,function(){"use strict";function i(h,b){var v,S=Object.keys(h);return Object.getOwnPropertySymbols&&(v=Object.getOwnPropertySymbols(h),b&&(v=v.filter(function(C){return Object.getOwnPropertyDescriptor(h,C).enumerable})),S.push.apply(S,v)),S}function e(h){for(var b=1;b<arguments.length;b++){var v=arguments[b]!=null?arguments[b]:{};b%2?i(Object(v),!0).forEach(function(S){var C,I;C=h,S=v[I=S],I in C?Object.defineProperty(C,I,{value:S,enumerable:!0,configurable:!0,writable:!0}):C[I]=S}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(v)):i(Object(v)).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(v,S))})}return h}function t(h){return(t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(h)}function r(){return(r=Object.assign||function(h){for(var b=1;b<arguments.length;b++){var v,S=arguments[b];for(v in S)Object.prototype.hasOwnProperty.call(S,v)&&(h[v]=S[v])}return h}).apply(this,arguments)}function s(h,b){if(h==null)return{};var v,S=function(R,H){if(R==null)return{};for(var J,se={},he=Object.keys(R),me=0;me<he.length;me++)J=he[me],0<=H.indexOf(J)||(se[J]=R[J]);return se}(h,b);if(Object.getOwnPropertySymbols)for(var C=Object.getOwnPropertySymbols(h),I=0;I<C.length;I++)v=C[I],0<=b.indexOf(v)||Object.prototype.propertyIsEnumerable.call(h,v)&&(S[v]=h[v]);return S}function n(h){return function(b){if(Array.isArray(b))return o(b)}(h)||function(b){if(typeof Symbol!="undefined"&&b[Symbol.iterator]!=null||b["@@iterator"]!=null)return Array.from(b)}(h)||function(b,v){if(b){if(typeof b=="string")return o(b,v);var S=Object.prototype.toString.call(b).slice(8,-1);return(S=S==="Object"&&b.constructor?b.constructor.name:S)==="Map"||S==="Set"?Array.from(b):S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S)?o(b,v):void 0}}(h)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function o(h,b){(b==null||b>h.length)&&(b=h.length);for(var v=0,S=new Array(b);v<b;v++)S[v]=h[v];return S}function a(h){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(h)}var l=a(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),c=a(/Edge/i),u=a(/firefox/i),p=a(/safari/i)&&!a(/chrome/i)&&!a(/android/i),m=a(/iP(ad|od|hone)/i),hi=a(/chrome/i)&&a(/android/i),w={capture:!1,passive:!1};function x(h,b,v){h.addEventListener(b,v,!l&&w)}function A(h,b,v){h.removeEventListener(b,v,!l&&w)}function D(h,b){if(b&&(b[0]===">"&&(b=b.substring(1)),h))try{if(h.matches)return h.matches(b);if(h.msMatchesSelector)return h.msMatchesSelector(b);if(h.webkitMatchesSelector)return h.webkitMatchesSelector(b)}catch(v){return}}function j(h,b,v,S){if(h){v=v||document;do if(b!=null&&(b[0]!==">"||h.parentNode===v)&&D(h,b)||S&&h===v)return h;while(h!==v&&(h=(C=h).host&&C!==document&&C.host.nodeType?C.host:C.parentNode))}var C;return null}var ee,d=/\s+/g;function g(h,b,v){var S;h&&b&&(h.classList?h.classList[v?"add":"remove"](b):(S=(" "+h.className+" ").replace(d," ").replace(" "+b+" "," "),h.className=(S+(v?" "+b:"")).replace(d," ")))}function _(h,b,v){var S=h&&h.style;if(S){if(v===void 0)return document.defaultView&&document.defaultView.getComputedStyle?v=document.defaultView.getComputedStyle(h,""):h.currentStyle&&(v=h.currentStyle),b===void 0?v:v[b];S[b=b in S||b.indexOf("webkit")!==-1?b:"-webkit-"+b]=v+(typeof v=="string"?"":"px")}}function y(h,b){var v="";if(typeof h=="string")v=h;else do var S=_(h,"transform");while(S&&S!=="none"&&(v=S+" "+v),!b&&(h=h.parentNode));var C=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return C&&new C(v)}function O(h,b,v){if(h){var S=h.getElementsByTagName(b),C=0,I=S.length;if(v)for(;C<I;C++)v(S[C],C);return S}return[]}function E(){var h=document.scrollingElement;return h||document.documentElement}function k(h,b,v,S,C){if(h.getBoundingClientRect||h===window){var I,R,H,J,se,he,me=h!==window&&h.parentNode&&h!==E()?(R=(I=h.getBoundingClientRect()).top,H=I.left,J=I.bottom,se=I.right,he=I.height,I.width):(H=R=0,J=window.innerHeight,se=window.innerWidth,he=window.innerHeight,window.innerWidth);if((b||v)&&h!==window&&(C=C||h.parentNode,!l))do if(C&&C.getBoundingClientRect&&(_(C,"transform")!=="none"||v&&_(C,"position")!=="static")){var $e=C.getBoundingClientRect();R-=$e.top+parseInt(_(C,"border-top-width")),H-=$e.left+parseInt(_(C,"border-left-width")),J=R+I.height,se=H+I.width;break}while(C=C.parentNode);return S&&h!==window&&(S=(b=y(C||h))&&b.a,h=b&&b.d,b&&(J=(R/=h)+(he/=h),se=(H/=S)+(me/=S))),{top:R,left:H,bottom:J,right:se,width:me,height:he}}}function M(h,b,v){for(var S=B(h,!0),C=k(h)[b];S;){var I=k(S)[v];if(!(v==="top"||v==="left"?I<=C:C<=I))return S;if(S===E())break;S=B(S,!1)}return!1}function q(h,b,v,S){for(var C=0,I=0,R=h.children;I<R.length;){if(R[I].style.display!=="none"&&R[I]!==ve.ghost&&(S||R[I]!==ve.dragged)&&j(R[I],v.draggable,h,!1)){if(C===b)return R[I];C++}I++}return null}function Y(h,b){for(var v=h.lastElementChild;v&&(v===ve.ghost||_(v,"display")==="none"||b&&!D(v,b));)v=v.previousElementSibling;return v||null}function F(h,b){var v=0;if(!h||!h.parentNode)return-1;for(;h=h.previousElementSibling;)h.nodeName.toUpperCase()==="TEMPLATE"||h===ve.clone||b&&!D(h,b)||v++;return v}function Z(h){var b=0,v=0,S=E();if(h)do var I=y(h),C=I.a,I=I.d;while(b+=h.scrollLeft*C,v+=h.scrollTop*I,h!==S&&(h=h.parentNode));return[b,v]}function B(h,b){if(!h||!h.getBoundingClientRect)return E();var v=h,S=!1;do if(v.clientWidth<v.scrollWidth||v.clientHeight<v.scrollHeight){var C=_(v);if(v.clientWidth<v.scrollWidth&&(C.overflowX=="auto"||C.overflowX=="scroll")||v.clientHeight<v.scrollHeight&&(C.overflowY=="auto"||C.overflowY=="scroll")){if(!v.getBoundingClientRect||v===document.body)return E();if(S||b)return v;S=!0}}while(v=v.parentNode);return E()}function Q(h,b){return Math.round(h.top)===Math.round(b.top)&&Math.round(h.left)===Math.round(b.left)&&Math.round(h.height)===Math.round(b.height)&&Math.round(h.width)===Math.round(b.width)}function ne(h,b){return function(){var v;ee||((v=arguments).length===1?h.call(this,v[0]):h.apply(this,v),ee=setTimeout(function(){ee=void 0},b))}}function ce(h,b,v){h.scrollLeft+=b,h.scrollTop+=v}function be(h){var b=window.Polymer,v=window.jQuery||window.Zepto;return b&&b.dom?b.dom(h).cloneNode(!0):v?v(h).clone(!0)[0]:h.cloneNode(!0)}function pe(h,b){_(h,"position","absolute"),_(h,"top",b.top),_(h,"left",b.left),_(h,"width",b.width),_(h,"height",b.height)}function Ie(h){_(h,"position",""),_(h,"top",""),_(h,"left",""),_(h,"width",""),_(h,"height","")}var ke="Sortable"+new Date().getTime();function le(){var h,b=[];return{captureAnimationState:function(){b=[],this.options.animation&&[].slice.call(this.el.children).forEach(function(v){var S,C;_(v,"display")!=="none"&&v!==ve.ghost&&(b.push({target:v,rect:k(v)}),S=e({},b[b.length-1].rect),!v.thisAnimationDuration||(C=y(v,!0))&&(S.top-=C.f,S.left-=C.e),v.fromRect=S)})},addAnimationState:function(v){b.push(v)},removeAnimationState:function(v){b.splice(function(S,C){for(var I in S)if(S.hasOwnProperty(I)){for(var R in C)if(C.hasOwnProperty(R)&&C[R]===S[I][R])return Number(I)}return-1}(b,{target:v}),1)},animateAll:function(v){var S=this;if(!this.options.animation)return clearTimeout(h),void(typeof v=="function"&&v());var C=!1,I=0;b.forEach(function(R){var H=0,J=R.target,se=J.fromRect,he=k(J),me=J.prevFromRect,$e=J.prevToRect,we=R.rect,Pe=y(J,!0);Pe&&(he.top-=Pe.f,he.left-=Pe.e),J.toRect=he,J.thisAnimationDuration&&Q(me,he)&&!Q(se,he)&&(we.top-he.top)/(we.left-he.left)==(se.top-he.top)/(se.left-he.left)&&(R=we,Pe=me,me=$e,$e=S.options,H=Math.sqrt(Math.pow(Pe.top-R.top,2)+Math.pow(Pe.left-R.left,2))/Math.sqrt(Math.pow(Pe.top-me.top,2)+Math.pow(Pe.left-me.left,2))*$e.animation),Q(he,se)||(J.prevFromRect=se,J.prevToRect=he,H=H||S.options.animation,S.animate(J,we,he,H)),H&&(C=!0,I=Math.max(I,H),clearTimeout(J.animationResetTimer),J.animationResetTimer=setTimeout(function(){J.animationTime=0,J.prevFromRect=null,J.fromRect=null,J.prevToRect=null,J.thisAnimationDuration=null},H),J.thisAnimationDuration=H)}),clearTimeout(h),C?h=setTimeout(function(){typeof v=="function"&&v()},I):typeof v=="function"&&v(),b=[]},animate:function(v,S,C,I){var R,H;I&&(_(v,"transition",""),_(v,"transform",""),R=(H=y(this.el))&&H.a,H=H&&H.d,R=(S.left-C.left)/(R||1),H=(S.top-C.top)/(H||1),v.animatingX=!!R,v.animatingY=!!H,_(v,"transform","translate3d("+R+"px,"+H+"px,0)"),this.forRepaintDummy=v.offsetWidth,_(v,"transition","transform "+I+"ms"+(this.options.easing?" "+this.options.easing:"")),_(v,"transform","translate3d(0,0,0)"),typeof v.animated=="number"&&clearTimeout(v.animated),v.animated=setTimeout(function(){_(v,"transition",""),_(v,"transform",""),v.animated=!1,v.animatingX=!1,v.animatingY=!1},I))}}}var K=[],oe={initializeByDefault:!0},ie={mount:function(h){for(var b in oe)!oe.hasOwnProperty(b)||b in h||(h[b]=oe[b]);K.forEach(function(v){if(v.pluginName===h.pluginName)throw"Sortable: Cannot mount plugin ".concat(h.pluginName," more than once")}),K.push(h)},pluginEvent:function(h,b,v){var S=this;this.eventCanceled=!1,v.cancel=function(){S.eventCanceled=!0};var C=h+"Global";K.forEach(function(I){b[I.pluginName]&&(b[I.pluginName][C]&&b[I.pluginName][C](e({sortable:b},v)),b.options[I.pluginName]&&b[I.pluginName][h]&&b[I.pluginName][h](e({sortable:b},v)))})},initializePlugins:function(h,b,v,S){for(var C in K.forEach(function(R){var H=R.pluginName;(h.options[H]||R.initializeByDefault)&&((R=new R(h,b,h.options)).sortable=h,R.options=h.options,h[H]=R,r(v,R.defaults))}),h.options){var I;h.options.hasOwnProperty(C)&&(I=this.modifyOption(h,C,h.options[C]))!==void 0&&(h.options[C]=I)}},getEventProperties:function(h,b){var v={};return K.forEach(function(S){typeof S.eventProperties=="function"&&r(v,S.eventProperties.call(b[S.pluginName],h))}),v},modifyOption:function(h,b,v){var S;return K.forEach(function(C){h[C.pluginName]&&C.optionListeners&&typeof C.optionListeners[b]=="function"&&(S=C.optionListeners[b].call(h[C.pluginName],v))}),S}};function U(h){var b=h.sortable,v=h.rootEl,S=h.name,C=h.targetEl,I=h.cloneEl,R=h.toEl,H=h.fromEl,J=h.oldIndex,se=h.newIndex,he=h.oldDraggableIndex,me=h.newDraggableIndex,$e=h.originalEvent,we=h.putSortable,Pe=h.extraEventProperties;if(b=b||v&&v[ke]){var Te,je=b.options,h="on"+S.charAt(0).toUpperCase()+S.substr(1);!window.CustomEvent||l||c?(Te=document.createEvent("Event")).initEvent(S,!0,!0):Te=new CustomEvent(S,{bubbles:!0,cancelable:!0}),Te.to=R||v,Te.from=H||v,Te.item=C||v,Te.clone=I,Te.oldIndex=J,Te.newIndex=se,Te.oldDraggableIndex=he,Te.newDraggableIndex=me,Te.originalEvent=$e,Te.pullMode=we?we.lastPutMode:void 0;var yt,Me=e(e({},Pe),ie.getEventProperties(S,b));for(yt in Me)Te[yt]=Me[yt];v&&v.dispatchEvent(Te),je[h]&&je[h].call(b,Te)}}function z(h,b){var v=(S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{}).evt,S=s(S,re);ie.pluginEvent.bind(ve)(h,b,e({dragEl:X,parentEl:fe,ghostEl:ue,rootEl:ye,nextEl:Ue,lastDownEl:De,cloneEl:Le,cloneHidden:dt,dragStarted:li,putSortable:ae,activeSortable:ve.active,originalEvent:v,oldIndex:ut,oldDraggableIndex:$t,newIndex:et,newDraggableIndex:_t,hideGhostForTarget:sn,unhideGhostForTarget:nn,cloneNowHidden:function(){dt=!0},cloneNowShown:function(){dt=!1},dispatchSortableEvent:function(C){de({sortable:b,name:C,originalEvent:v})}},S))}var re=["evt"];function de(h){U(e({putSortable:ae,cloneEl:Le,targetEl:X,rootEl:ye,oldIndex:ut,oldDraggableIndex:$t,newIndex:et,newDraggableIndex:_t},h))}var X,fe,ue,ye,Ue,De,Le,dt,ut,et,$t,_t,Yt,ae,_e,Se,We,nt,Ot,zt,li,Gt,ci,yi,tt,di=!1,ji=!1,ui=[],pi=!1,zi=!1,At=[],Sr=!1,Fi=[],wi=typeof document!="undefined",Hi=m,Qs=c||l?"cssFloat":"float",uo=wi&&!hi&&!m&&"draggable"in document.createElement("div"),en=function(){if(wi){if(l)return!1;var h=document.createElement("x");return h.style.cssText="pointer-events:auto",h.style.pointerEvents==="auto"}}(),tn=function(se,b){var v=_(se),S=parseInt(v.width)-parseInt(v.paddingLeft)-parseInt(v.paddingRight)-parseInt(v.borderLeftWidth)-parseInt(v.borderRightWidth),C=q(se,0,b),I=q(se,1,b),R=C&&_(C),H=I&&_(I),J=R&&parseInt(R.marginLeft)+parseInt(R.marginRight)+k(C).width,se=H&&parseInt(H.marginLeft)+parseInt(H.marginRight)+k(I).width;return v.display==="flex"?v.flexDirection==="column"||v.flexDirection==="column-reverse"?"vertical":"horizontal":v.display==="grid"?v.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal":C&&R.float&&R.float!=="none"?(b=R.float==="left"?"left":"right",!I||H.clear!=="both"&&H.clear!==b?"horizontal":"vertical"):C&&(R.display==="block"||R.display==="flex"||R.display==="table"||R.display==="grid"||S<=J&&v[Qs]==="none"||I&&v[Qs]==="none"&&S<J+se)?"vertical":"horizontal"},rn=function(h){function b(C,I){return function(R,H,J,se){var he=R.options.group.name&&H.options.group.name&&R.options.group.name===H.options.group.name;return C==null&&(I||he)?!0:C==null||C===!1?!1:I&&C==="clone"?C:typeof C=="function"?b(C(R,H,J,se),I)(R,H,J,se):(H=(I?R:H).options.group.name,C===!0||typeof C=="string"&&C===H||C.join&&-1<C.indexOf(H))}}var v={},S=h.group;S&&t(S)=="object"||(S={name:S}),v.name=S.name,v.checkPull=b(S.pull,!0),v.checkPut=b(S.put),v.revertClone=S.revertClone,h.group=v},sn=function(){!en&&ue&&_(ue,"display","none")},nn=function(){!en&&ue&&_(ue,"display","")};wi&&!hi&&document.addEventListener("click",function(h){if(ji)return h.preventDefault(),h.stopPropagation&&h.stopPropagation(),h.stopImmediatePropagation&&h.stopImmediatePropagation(),ji=!1},!0);function Kt(h){if(X){h=h.touches?h.touches[0]:h;var b=(C=h.clientX,I=h.clientY,ui.some(function(H){var J=H[ke].options.emptyInsertThreshold;if(J&&!Y(H)){var se=k(H),he=C>=se.left-J&&C<=se.right+J,J=I>=se.top-J&&I<=se.bottom+J;return he&&J?R=H:void 0}}),R);if(b){var v,S={};for(v in h)h.hasOwnProperty(v)&&(S[v]=h[v]);S.target=S.rootEl=b,S.preventDefault=void 0,S.stopPropagation=void 0,b[ke]._onDragOver(S)}}var C,I,R}function po(h){X&&X.parentNode[ke]._isOutsideThisEl(h.target)}function ve(h,b){if(!h||!h.nodeType||h.nodeType!==1)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(h));this.el=h,this.options=b=r({},b),h[ke]=this;var v,S,C={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(h.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return tn(h,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(I,R){I.setData("Text",R.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:ve.supportPointer!==!1&&"PointerEvent"in window&&!p,emptyInsertThreshold:5};for(v in ie.initializePlugins(this,h,C),C)v in b||(b[v]=C[v]);for(S in rn(b),this)S.charAt(0)==="_"&&typeof this[S]=="function"&&(this[S]=this[S].bind(this));this.nativeDraggable=!b.forceFallback&&uo,this.nativeDraggable&&(this.options.touchStartThreshold=1),b.supportPointer?x(h,"pointerdown",this._onTapStart):(x(h,"mousedown",this._onTapStart),x(h,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(h,"dragover",this),x(h,"dragenter",this)),ui.push(this.el),b.store&&b.store.get&&this.sort(b.store.get(this)||[]),r(this,le())}function qi(h,b,v,S,C,I,R,H){var J,se,he=h[ke],me=he.options.onMove;return!window.CustomEvent||l||c?(J=document.createEvent("Event")).initEvent("move",!0,!0):J=new CustomEvent("move",{bubbles:!0,cancelable:!0}),J.to=b,J.from=h,J.dragged=v,J.draggedRect=S,J.related=C||b,J.relatedRect=I||k(b),J.willInsertAfter=H,J.originalEvent=R,h.dispatchEvent(J),se=me?me.call(he,J,R):se}function Tr(h){h.draggable=!1}function ho(){Sr=!1}function Ui(h){return setTimeout(h,0)}function Er(h){return clearTimeout(h)}ve.prototype={constructor:ve,_isOutsideThisEl:function(h){this.el.contains(h)||h===this.el||(Gt=null)},_getDirection:function(h,b){return typeof this.options.direction=="function"?this.options.direction.call(this,h,b,X):this.options.direction},_onTapStart:function(h){if(h.cancelable){var b=this,v=this.el,S=this.options,C=S.preventOnFilter,I=h.type,R=h.touches&&h.touches[0]||h.pointerType&&h.pointerType==="touch"&&h,H=(R||h).target,J=h.target.shadowRoot&&(h.path&&h.path[0]||h.composedPath&&h.composedPath()[0])||H,se=S.filter;if(function(he){Fi.length=0;for(var me=he.getElementsByTagName("input"),$e=me.length;$e--;){var we=me[$e];we.checked&&Fi.push(we)}}(v),!X&&!(/mousedown|pointerdown/.test(I)&&h.button!==0||S.disabled)&&!J.isContentEditable&&(this.nativeDraggable||!p||!H||H.tagName.toUpperCase()!=="SELECT")&&!((H=j(H,S.draggable,v,!1))&&H.animated||De===H)){if(ut=F(H),$t=F(H,S.draggable),typeof se=="function"){if(se.call(this,h,H,this))return de({sortable:b,rootEl:J,name:"filter",targetEl:H,toEl:v,fromEl:v}),z("filter",b,{evt:h}),void(C&&h.cancelable&&h.preventDefault())}else if(se=se&&se.split(",").some(function(he){if(he=j(J,he.trim(),v,!1))return de({sortable:b,rootEl:he,name:"filter",targetEl:H,fromEl:v,toEl:v}),z("filter",b,{evt:h}),!0}))return void(C&&h.cancelable&&h.preventDefault());S.handle&&!j(J,S.handle,v,!1)||this._prepareDragStart(h,R,H)}}},_prepareDragStart:function(h,b,v){var S,C=this,I=C.el,R=C.options,H=I.ownerDocument;v&&!X&&v.parentNode===I&&(S=k(v),ye=I,fe=(X=v).parentNode,Ue=X.nextSibling,De=v,Yt=R.group,_e={target:ve.dragged=X,clientX:(b||h).clientX,clientY:(b||h).clientY},Ot=_e.clientX-S.left,zt=_e.clientY-S.top,this._lastX=(b||h).clientX,this._lastY=(b||h).clientY,X.style["will-change"]="all",S=function(){z("delayEnded",C,{evt:h}),ve.eventCanceled?C._onDrop():(C._disableDelayedDragEvents(),!u&&C.nativeDraggable&&(X.draggable=!0),C._triggerDragStart(h,b),de({sortable:C,name:"choose",originalEvent:h}),g(X,R.chosenClass,!0))},R.ignore.split(",").forEach(function(J){O(X,J.trim(),Tr)}),x(H,"dragover",Kt),x(H,"mousemove",Kt),x(H,"touchmove",Kt),x(H,"mouseup",C._onDrop),x(H,"touchend",C._onDrop),x(H,"touchcancel",C._onDrop),u&&this.nativeDraggable&&(this.options.touchStartThreshold=4,X.draggable=!0),z("delayStart",this,{evt:h}),!R.delay||R.delayOnTouchOnly&&!b||this.nativeDraggable&&(c||l)?S():ve.eventCanceled?this._onDrop():(x(H,"mouseup",C._disableDelayedDrag),x(H,"touchend",C._disableDelayedDrag),x(H,"touchcancel",C._disableDelayedDrag),x(H,"mousemove",C._delayedDragTouchMoveHandler),x(H,"touchmove",C._delayedDragTouchMoveHandler),R.supportPointer&&x(H,"pointermove",C._delayedDragTouchMoveHandler),C._dragStartTimer=setTimeout(S,R.delay)))},_delayedDragTouchMoveHandler:function(h){h=h.touches?h.touches[0]:h,Math.max(Math.abs(h.clientX-this._lastX),Math.abs(h.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){X&&Tr(X),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var h=this.el.ownerDocument;A(h,"mouseup",this._disableDelayedDrag),A(h,"touchend",this._disableDelayedDrag),A(h,"touchcancel",this._disableDelayedDrag),A(h,"mousemove",this._delayedDragTouchMoveHandler),A(h,"touchmove",this._delayedDragTouchMoveHandler),A(h,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(h,b){b=b||h.pointerType=="touch"&&h,!this.nativeDraggable||b?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):x(document,b?"touchmove":"mousemove",this._onTouchMove):(x(X,"dragend",this),x(ye,"dragstart",this._onDragStart));try{document.selection?Ui(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(v){}},_dragStarted:function(h,b){var v;di=!1,ye&&X?(z("dragStarted",this,{evt:b}),this.nativeDraggable&&x(document,"dragover",po),v=this.options,h||g(X,v.dragClass,!1),g(X,v.ghostClass,!0),ve.active=this,h&&this._appendGhost(),de({sortable:this,name:"start",originalEvent:b})):this._nulling()},_emulateDragOver:function(){if(Se){this._lastX=Se.clientX,this._lastY=Se.clientY,sn();for(var h=document.elementFromPoint(Se.clientX,Se.clientY),b=h;h&&h.shadowRoot&&(h=h.shadowRoot.elementFromPoint(Se.clientX,Se.clientY))!==b;)b=h;if(X.parentNode[ke]._isOutsideThisEl(h),b)do if(b[ke]&&b[ke]._onDragOver({clientX:Se.clientX,clientY:Se.clientY,target:h,rootEl:b})&&!this.options.dragoverBubble)break;while(b=(h=b).parentNode);nn()}},_onTouchMove:function(h){if(_e){var I=this.options,b=I.fallbackTolerance,v=I.fallbackOffset,S=h.touches?h.touches[0]:h,C=ue&&y(ue,!0),R=ue&&C&&C.a,H=ue&&C&&C.d,I=Hi&&tt&&Z(tt),R=(S.clientX-_e.clientX+v.x)/(R||1)+(I?I[0]-At[0]:0)/(R||1),H=(S.clientY-_e.clientY+v.y)/(H||1)+(I?I[1]-At[1]:0)/(H||1);if(!ve.active&&!di){if(b&&Math.max(Math.abs(S.clientX-this._lastX),Math.abs(S.clientY-this._lastY))<b)return;this._onDragStart(h,!0)}ue&&(C?(C.e+=R-(We||0),C.f+=H-(nt||0)):C={a:1,b:0,c:0,d:1,e:R,f:H},C="matrix(".concat(C.a,",").concat(C.b,",").concat(C.c,",").concat(C.d,",").concat(C.e,",").concat(C.f,")"),_(ue,"webkitTransform",C),_(ue,"mozTransform",C),_(ue,"msTransform",C),_(ue,"transform",C),We=R,nt=H,Se=S),h.cancelable&&h.preventDefault()}},_appendGhost:function(){if(!ue){var h=this.options.fallbackOnBody?document.body:ye,b=k(X,!0,Hi,!0,h),v=this.options;if(Hi){for(tt=h;_(tt,"position")==="static"&&_(tt,"transform")==="none"&&tt!==document;)tt=tt.parentNode;tt!==document.body&&tt!==document.documentElement?(tt===document&&(tt=E()),b.top+=tt.scrollTop,b.left+=tt.scrollLeft):tt=E(),At=Z(tt)}g(ue=X.cloneNode(!0),v.ghostClass,!1),g(ue,v.fallbackClass,!0),g(ue,v.dragClass,!0),_(ue,"transition",""),_(ue,"transform",""),_(ue,"box-sizing","border-box"),_(ue,"margin",0),_(ue,"top",b.top),_(ue,"left",b.left),_(ue,"width",b.width),_(ue,"height",b.height),_(ue,"opacity","0.8"),_(ue,"position",Hi?"absolute":"fixed"),_(ue,"zIndex","100000"),_(ue,"pointerEvents","none"),ve.ghost=ue,h.appendChild(ue),_(ue,"transform-origin",Ot/parseInt(ue.style.width)*100+"% "+zt/parseInt(ue.style.height)*100+"%")}},_onDragStart:function(h,b){var v=this,S=h.dataTransfer,C=v.options;z("dragStart",this,{evt:h}),ve.eventCanceled?this._onDrop():(z("setupClone",this),ve.eventCanceled||((Le=be(X)).removeAttribute("id"),Le.draggable=!1,Le.style["will-change"]="",this._hideClone(),g(Le,this.options.chosenClass,!1),ve.clone=Le),v.cloneId=Ui(function(){z("clone",v),ve.eventCanceled||(v.options.removeCloneOnHide||ye.insertBefore(Le,X),v._hideClone(),de({sortable:v,name:"clone"}))}),b||g(X,C.dragClass,!0),b?(ji=!0,v._loopId=setInterval(v._emulateDragOver,50)):(A(document,"mouseup",v._onDrop),A(document,"touchend",v._onDrop),A(document,"touchcancel",v._onDrop),S&&(S.effectAllowed="move",C.setData&&C.setData.call(v,S,X)),x(document,"drop",v),_(X,"transform","translateZ(0)")),di=!0,v._dragStartId=Ui(v._dragStarted.bind(v,b,h)),x(document,"selectstart",v),li=!0,p&&_(document.body,"user-select","none"))},_onDragOver:function(h){var b,v,S,C,I=this.el,R=h.target,H=this.options,J=H.group,se=ve.active,he=Yt===J,me=H.sort,$e=ae||se,we=this,Pe=!1;if(!Sr){if(h.preventDefault!==void 0&&h.cancelable&&h.preventDefault(),R=j(R,H.draggable,I,!0),it("dragOver"),ve.eventCanceled)return Pe;if(X.contains(h.target)||R.animated&&R.animatingX&&R.animatingY||we._ignoreWhileAnimating===R)return Ct(!1);if(ji=!1,se&&!H.disabled&&(he?me||(v=fe!==ye):ae===this||(this.lastPutMode=Yt.checkPull(this,se,X,h))&&J.checkPut(this,se,X,h))){if(S=this._getDirection(h,R)==="vertical",b=k(X),it("dragOverValid"),ve.eventCanceled)return Pe;if(v)return fe=ye,Qt(),this._hideClone(),it("revert"),ve.eventCanceled||(Ue?ye.insertBefore(X,Ue):ye.appendChild(X)),Ct(!0);var Te=Y(I,H.draggable);if(!Te||function(Ze,Mr,Ve){return Ve=k(Y(Ve.el,Ve.options.draggable)),Mr?Ze.clientX>Ve.right+10||Ze.clientX<=Ve.right&&Ze.clientY>Ve.bottom&&Ze.clientX>=Ve.left:Ze.clientX>Ve.right&&Ze.clientY>Ve.top||Ze.clientX<=Ve.right&&Ze.clientY>Ve.bottom+10}(h,S,this)&&!Te.animated){if(Te===X)return Ct(!1);if((R=Te&&I===h.target?Te:R)&&(pt=k(R)),qi(ye,I,X,b,R,pt,h,!!R)!==!1)return Qt(),Te&&Te.nextSibling?I.insertBefore(X,Te.nextSibling):I.appendChild(X),fe=I,Si(),Ct(!0)}else if(Te&&function(Ze,Mr,Ve){return Ve=k(q(Ve.el,0,Ve.options,!0)),Mr?Ze.clientX<Ve.left-10||Ze.clientY<Ve.top&&Ze.clientX<Ve.right:Ze.clientY<Ve.top-10||Ze.clientY<Ve.bottom&&Ze.clientX<Ve.left}(h,S,this)){var je=q(I,0,H,!0);if(je===X)return Ct(!1);if(pt=k(R=je),qi(ye,I,X,b,R,pt,h,!1)!==!1)return Qt(),I.insertBefore(X,je),fe=I,Si(),Ct(!0)}else if(R.parentNode===I){var yt,Me,wt,pt=k(R),Zt=X.parentNode!==I,Ye=(Ye=X.animated&&X.toRect||b,Je=R.animated&&R.toRect||pt,Jt=(C=S)?Ye.left:Ye.top,J=C?Ye.right:Ye.bottom,Te=C?Ye.width:Ye.height,je=C?Je.left:Je.top,Ye=C?Je.right:Je.bottom,Je=C?Je.width:Je.height,!(Jt===je||J===Ye||Jt+Te/2===je+Je/2)),Jt=S?"top":"left",Te=M(R,"top","top")||M(X,"top","top"),je=Te?Te.scrollTop:void 0;if(Gt!==R&&(Me=pt[Jt],pi=!1,zi=!Ye&&H.invertSwap||Zt),(yt=function(mi,fo,qt,ti,_o,an,Ul,O_){var ei=ti?mi.clientY:mi.clientX,_i=ti?qt.height:qt.width,mi=ti?qt.top:qt.left,ti=ti?qt.bottom:qt.right,qt=!1;if(!Ul){if(O_&&yi<_i*_o){if(pi=!pi&&(ci===1?mi+_i*an/2<ei:ei<ti-_i*an/2)?!0:pi)qt=!0;else if(ci===1?ei<mi+yi:ti-yi<ei)return-ci}else if(mi+_i*(1-_o)/2<ei&&ei<ti-_i*(1-_o)/2)return function(A_){return F(X)<F(A_)?1:-1}(fo)}return(qt=qt||Ul)&&(ei<mi+_i*an/2||ti-_i*an/2<ei)?mi+_i/2<ei?1:-1:0}(h,R,pt,S,Ye?1:H.swapThreshold,H.invertedSwapThreshold==null?H.swapThreshold:H.invertedSwapThreshold,zi,Gt===R))!==0)for(var Ir=F(X);(wt=fe.children[Ir-=yt])&&(_(wt,"display")==="none"||wt===ue););if(yt===0||wt===R)return Ct(!1);ci=yt;var Je=(Gt=R).nextElementSibling,Zt=!1,Ye=qi(ye,I,X,b,R,pt,h,Zt=yt===1);if(Ye!==!1)return Ye!==1&&Ye!==-1||(Zt=Ye===1),Sr=!0,setTimeout(ho,30),Qt(),Zt&&!Je?I.appendChild(X):R.parentNode.insertBefore(X,Zt?Je:R),Te&&ce(Te,0,je-Te.scrollTop),fe=X.parentNode,Me===void 0||zi||(yi=Math.abs(Me-k(R)[Jt])),Si(),Ct(!0)}if(I.contains(X))return Ct(!1)}return!1}function it(Ze,Mr){z(Ze,we,e({evt:h,isOwner:he,axis:S?"vertical":"horizontal",revert:v,dragRect:b,targetRect:pt,canSort:me,fromSortable:$e,target:R,completed:Ct,onMove:function(Ve,fo){return qi(ye,I,X,b,Ve,k(Ve),h,fo)},changed:Si},Mr))}function Qt(){it("dragOverAnimationCapture"),we.captureAnimationState(),we!==$e&&$e.captureAnimationState()}function Ct(Ze){return it("dragOverCompleted",{insertion:Ze}),Ze&&(he?se._hideClone():se._showClone(we),we!==$e&&(g(X,(ae||se).options.ghostClass,!1),g(X,H.ghostClass,!0)),ae!==we&&we!==ve.active?ae=we:we===ve.active&&ae&&(ae=null),$e===we&&(we._ignoreWhileAnimating=R),we.animateAll(function(){it("dragOverAnimationComplete"),we._ignoreWhileAnimating=null}),we!==$e&&($e.animateAll(),$e._ignoreWhileAnimating=null)),(R===X&&!X.animated||R===I&&!R.animated)&&(Gt=null),H.dragoverBubble||h.rootEl||R===document||(X.parentNode[ke]._isOutsideThisEl(h.target),Ze||Kt(h)),!H.dragoverBubble&&h.stopPropagation&&h.stopPropagation(),Pe=!0}function Si(){et=F(X),_t=F(X,H.draggable),de({sortable:we,name:"change",toEl:I,newIndex:et,newDraggableIndex:_t,originalEvent:h})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){A(document,"mousemove",this._onTouchMove),A(document,"touchmove",this._onTouchMove),A(document,"pointermove",this._onTouchMove),A(document,"dragover",Kt),A(document,"mousemove",Kt),A(document,"touchmove",Kt)},_offUpEvents:function(){var h=this.el.ownerDocument;A(h,"mouseup",this._onDrop),A(h,"touchend",this._onDrop),A(h,"pointerup",this._onDrop),A(h,"touchcancel",this._onDrop),A(document,"selectstart",this)},_onDrop:function(h){var b=this.el,v=this.options;et=F(X),_t=F(X,v.draggable),z("drop",this,{evt:h}),fe=X&&X.parentNode,et=F(X),_t=F(X,v.draggable),ve.eventCanceled||(pi=zi=di=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Er(this.cloneId),Er(this._dragStartId),this.nativeDraggable&&(A(document,"drop",this),A(b,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),p&&_(document.body,"user-select",""),_(X,"transform",""),h&&(li&&(h.cancelable&&h.preventDefault(),v.dropBubble||h.stopPropagation()),ue&&ue.parentNode&&ue.parentNode.removeChild(ue),(ye===fe||ae&&ae.lastPutMode!=="clone")&&Le&&Le.parentNode&&Le.parentNode.removeChild(Le),X&&(this.nativeDraggable&&A(X,"dragend",this),Tr(X),X.style["will-change"]="",li&&!di&&g(X,(ae||this).options.ghostClass,!1),g(X,this.options.chosenClass,!1),de({sortable:this,name:"unchoose",toEl:fe,newIndex:null,newDraggableIndex:null,originalEvent:h}),ye!==fe?(0<=et&&(de({rootEl:fe,name:"add",toEl:fe,fromEl:ye,originalEvent:h}),de({sortable:this,name:"remove",toEl:fe,originalEvent:h}),de({rootEl:fe,name:"sort",toEl:fe,fromEl:ye,originalEvent:h}),de({sortable:this,name:"sort",toEl:fe,originalEvent:h})),ae&&ae.save()):et!==ut&&0<=et&&(de({sortable:this,name:"update",toEl:fe,originalEvent:h}),de({sortable:this,name:"sort",toEl:fe,originalEvent:h})),ve.active&&(et!=null&&et!==-1||(et=ut,_t=$t),de({sortable:this,name:"end",toEl:fe,originalEvent:h}),this.save())))),this._nulling()},_nulling:function(){z("nulling",this),ye=X=fe=ue=Ue=Le=De=dt=_e=Se=li=et=_t=ut=$t=Gt=ci=ae=Yt=ve.dragged=ve.ghost=ve.clone=ve.active=null,Fi.forEach(function(h){h.checked=!0}),Fi.length=We=nt=0},handleEvent:function(h){switch(h.type){case"drop":case"dragend":this._onDrop(h);break;case"dragenter":case"dragover":X&&(this._onDragOver(h),function(b){b.dataTransfer&&(b.dataTransfer.dropEffect="move"),b.cancelable&&b.preventDefault()}(h));break;case"selectstart":h.preventDefault()}},toArray:function(){for(var h,b=[],v=this.el.children,S=0,C=v.length,I=this.options;S<C;S++)j(h=v[S],I.draggable,this.el,!1)&&b.push(h.getAttribute(I.dataIdAttr)||function(R){for(var H=R.tagName+R.className+R.src+R.href+R.textContent,J=H.length,se=0;J--;)se+=H.charCodeAt(J);return se.toString(36)}(h));return b},sort:function(h,b){var v={},S=this.el;this.toArray().forEach(function(C,I){I=S.children[I],j(I,this.options.draggable,S,!1)&&(v[C]=I)},this),b&&this.captureAnimationState(),h.forEach(function(C){v[C]&&(S.removeChild(v[C]),S.appendChild(v[C]))}),b&&this.animateAll()},save:function(){var h=this.options.store;h&&h.set&&h.set(this)},closest:function(h,b){return j(h,b||this.options.draggable,this.el,!1)},option:function(h,b){var v=this.options;if(b===void 0)return v[h];var S=ie.modifyOption(this,h,b);v[h]=S!==void 0?S:b,h==="group"&&rn(v)},destroy:function(){z("destroy",this);var h=this.el;h[ke]=null,A(h,"mousedown",this._onTapStart),A(h,"touchstart",this._onTapStart),A(h,"pointerdown",this._onTapStart),this.nativeDraggable&&(A(h,"dragover",this),A(h,"dragenter",this)),Array.prototype.forEach.call(h.querySelectorAll("[draggable]"),function(b){b.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ui.splice(ui.indexOf(this.el),1),this.el=h=null},_hideClone:function(){dt||(z("hideClone",this),ve.eventCanceled||(_(Le,"display","none"),this.options.removeCloneOnHide&&Le.parentNode&&Le.parentNode.removeChild(Le),dt=!0))},_showClone:function(h){h.lastPutMode==="clone"?dt&&(z("showClone",this),ve.eventCanceled||(X.parentNode!=ye||this.options.group.revertClone?Ue?ye.insertBefore(Le,Ue):ye.appendChild(Le):ye.insertBefore(Le,X),this.options.group.revertClone&&this.animate(X,Le),_(Le,"display",""),dt=!1)):this._hideClone()}},wi&&x(document,"touchmove",function(h){(ve.active||di)&&h.cancelable&&h.preventDefault()}),ve.utils={on:x,off:A,css:_,find:O,is:function(h,b){return!!j(h,b,h,!1)},extend:function(h,b){if(h&&b)for(var v in b)b.hasOwnProperty(v)&&(h[v]=b[v]);return h},throttle:ne,closest:j,toggleClass:g,clone:be,index:F,nextTick:Ui,cancelNextTick:Er,detectDirection:tn,getChild:q},ve.get=function(h){return h[ke]},ve.mount=function(){for(var h=arguments.length,b=new Array(h),v=0;v<h;v++)b[v]=arguments[v];(b=b[0].constructor===Array?b[0]:b).forEach(function(S){if(!S.prototype||!S.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(S));S.utils&&(ve.utils=e(e({},ve.utils),S.utils)),ie.mount(S)})},ve.create=function(h,b){return new ve(h,b)};var ki,$r,Or,Ar,Wi,xi,Xe=[],Lr=!(ve.version="1.15.0");function Vi(){Xe.forEach(function(h){clearInterval(h.pid)}),Xe=[]}function on(){clearInterval(xi)}var vt,Xt=ne(function(h,b,v,S){if(b.scroll){var C,I=(h.touches?h.touches[0]:h).clientX,R=(h.touches?h.touches[0]:h).clientY,H=b.scrollSensitivity,J=b.scrollSpeed,se=E(),he=!1;$r!==v&&($r=v,Vi(),ki=b.scroll,C=b.scrollFn,ki===!0&&(ki=B(v,!0)));var me=0,$e=ki;do{var we=$e,it=k(we),Pe=it.top,Te=it.bottom,je=it.left,yt=it.right,Me=it.width,wt=it.height,pt=void 0,Zt=void 0,Jt=we.scrollWidth,Ir=we.scrollHeight,Je=_(we),Ye=we.scrollLeft,it=we.scrollTop,Zt=we===se?(pt=Me<Jt&&(Je.overflowX==="auto"||Je.overflowX==="scroll"||Je.overflowX==="visible"),wt<Ir&&(Je.overflowY==="auto"||Je.overflowY==="scroll"||Je.overflowY==="visible")):(pt=Me<Jt&&(Je.overflowX==="auto"||Je.overflowX==="scroll"),wt<Ir&&(Je.overflowY==="auto"||Je.overflowY==="scroll")),Ye=pt&&(Math.abs(yt-I)<=H&&Ye+Me<Jt)-(Math.abs(je-I)<=H&&!!Ye),it=Zt&&(Math.abs(Te-R)<=H&&it+wt<Ir)-(Math.abs(Pe-R)<=H&&!!it);if(!Xe[me])for(var Qt=0;Qt<=me;Qt++)Xe[Qt]||(Xe[Qt]={});Xe[me].vx==Ye&&Xe[me].vy==it&&Xe[me].el===we||(Xe[me].el=we,Xe[me].vx=Ye,Xe[me].vy=it,clearInterval(Xe[me].pid),Ye==0&&it==0||(he=!0,Xe[me].pid=setInterval(function(){S&&this.layer===0&&ve.active._onTouchMove(Wi);var Ct=Xe[this.layer].vy?Xe[this.layer].vy*J:0,Si=Xe[this.layer].vx?Xe[this.layer].vx*J:0;typeof C=="function"&&C.call(ve.dragged.parentNode[ke],Si,Ct,h,Wi,Xe[this.layer].el)!=="continue"||ce(Xe[this.layer].el,Si,Ct)}.bind({layer:me}),24))),me++}while(b.bubbleScroll&&$e!==se&&($e=B($e,!1)));Lr=he}},30),hi=function(H){var b=H.originalEvent,v=H.putSortable,S=H.dragEl,C=H.activeSortable,I=H.dispatchSortableEvent,R=H.hideGhostForTarget,H=H.unhideGhostForTarget;b&&(C=v||C,R(),b=b.changedTouches&&b.changedTouches.length?b.changedTouches[0]:b,b=document.elementFromPoint(b.clientX,b.clientY),H(),C&&!C.el.contains(b)&&(I("spill"),this.onSpill({dragEl:S,putSortable:v})))};function Ft(){}function Br(){}Ft.prototype={startIndex:null,dragStart:function(h){h=h.oldDraggableIndex,this.startIndex=h},onSpill:function(h){var b=h.dragEl,v=h.putSortable;this.sortable.captureAnimationState(),v&&v.captureAnimationState(),h=q(this.sortable.el,this.startIndex,this.options),h?this.sortable.el.insertBefore(b,h):this.sortable.el.appendChild(b),this.sortable.animateAll(),v&&v.animateAll()},drop:hi},r(Ft,{pluginName:"revertOnSpill"}),Br.prototype={onSpill:function(v){var b=v.dragEl,v=v.putSortable||this.sortable;v.captureAnimationState(),b.parentNode&&b.parentNode.removeChild(b),v.animateAll()},drop:hi},r(Br,{pluginName:"removeOnSpill"});var Ht,mt,Re,Ci,fi,Ce=[],gt=[],T=!1,N=!1,L=!1;function P(h,b){gt.forEach(function(v,S){S=b.children[v.sortableIndex+(h?Number(S):0)],S?b.insertBefore(v,S):b.appendChild(v)})}function W(){Ce.forEach(function(h){h!==Re&&h.parentNode&&h.parentNode.removeChild(h)})}return ve.mount(new function(){function h(){for(var b in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)b.charAt(0)==="_"&&typeof this[b]=="function"&&(this[b]=this[b].bind(this))}return h.prototype={dragStarted:function(b){b=b.originalEvent,this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):b.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(b){b=b.originalEvent,this.options.dragOverBubble||b.rootEl||this._handleAutoScroll(b)},drop:function(){this.sortable.nativeDraggable?A(document,"dragover",this._handleAutoScroll):(A(document,"pointermove",this._handleFallbackAutoScroll),A(document,"touchmove",this._handleFallbackAutoScroll),A(document,"mousemove",this._handleFallbackAutoScroll)),on(),Vi(),clearTimeout(ee),ee=void 0},nulling:function(){Wi=$r=ki=Lr=xi=Or=Ar=null,Xe.length=0},_handleFallbackAutoScroll:function(b){this._handleAutoScroll(b,!0)},_handleAutoScroll:function(b,v){var S,C=this,I=(b.touches?b.touches[0]:b).clientX,R=(b.touches?b.touches[0]:b).clientY,H=document.elementFromPoint(I,R);Wi=b,v||this.options.forceAutoScrollFallback||c||l||p?(Xt(b,this.options,H,v),S=B(H,!0),!Lr||xi&&I===Or&&R===Ar||(xi&&on(),xi=setInterval(function(){var J=B(document.elementFromPoint(I,R),!0);J!==S&&(S=J,Vi()),Xt(b,C.options,J,v)},10),Or=I,Ar=R)):this.options.bubbleScroll&&B(H,!0)!==E()?Xt(b,this.options,B(H,!1),!1):Vi()}},r(h,{pluginName:"scroll",initializeByDefault:!0})}),ve.mount(Br,Ft),ve.mount(new function(){function h(){this.defaults={swapClass:"sortable-swap-highlight"}}return h.prototype={dragStart:function(b){b=b.dragEl,vt=b},dragOverValid:function(b){var v=b.completed,S=b.target,C=b.onMove,I=b.activeSortable,R=b.changed,H=b.cancel;I.options.swap&&(b=this.sortable.el,I=this.options,S&&S!==b&&(b=vt,vt=C(S)!==!1?(g(S,I.swapClass,!0),S):null,b&&b!==vt&&g(b,I.swapClass,!1)),R(),v(!0),H())},drop:function(b){var v,S,C=b.activeSortable,I=b.putSortable,R=b.dragEl,H=I||this.sortable,J=this.options;vt&&g(vt,J.swapClass,!1),vt&&(J.swap||I&&I.options.swap)&&R!==vt&&(H.captureAnimationState(),H!==C&&C.captureAnimationState(),S=vt,b=(v=R).parentNode,J=S.parentNode,b&&J&&!b.isEqualNode(S)&&!J.isEqualNode(v)&&(I=F(v),R=F(S),b.isEqualNode(J)&&I<R&&R++,b.insertBefore(S,b.children[I]),J.insertBefore(v,J.children[R])),H.animateAll(),H!==C&&C.animateAll())},nulling:function(){vt=null}},r(h,{pluginName:"swap",eventProperties:function(){return{swapItem:vt}}})}),ve.mount(new function(){function h(b){for(var v in this)v.charAt(0)==="_"&&typeof this[v]=="function"&&(this[v]=this[v].bind(this));b.options.avoidImplicitDeselect||(b.options.supportPointer?x(document,"pointerup",this._deselectMultiDrag):(x(document,"mouseup",this._deselectMultiDrag),x(document,"touchend",this._deselectMultiDrag))),x(document,"keydown",this._checkKeyDown),x(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,avoidImplicitDeselect:!1,setData:function(S,C){var I="";Ce.length&&mt===b?Ce.forEach(function(R,H){I+=(H?", ":"")+R.textContent}):I=C.textContent,S.setData("Text",I)}}}return h.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(b){b=b.dragEl,Re=b},delayEnded:function(){this.isMultiDrag=~Ce.indexOf(Re)},setupClone:function(S){var v=S.sortable,S=S.cancel;if(this.isMultiDrag){for(var C=0;C<Ce.length;C++)gt.push(be(Ce[C])),gt[C].sortableIndex=Ce[C].sortableIndex,gt[C].draggable=!1,gt[C].style["will-change"]="",g(gt[C],this.options.selectedClass,!1),Ce[C]===Re&&g(gt[C],this.options.chosenClass,!1);v._hideClone(),S()}},clone:function(I){var v=I.sortable,S=I.rootEl,C=I.dispatchSortableEvent,I=I.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||Ce.length&&mt===v&&(P(!0,S),C("clone"),I()))},showClone:function(C){var v=C.cloneNowShown,S=C.rootEl,C=C.cancel;this.isMultiDrag&&(P(!1,S),gt.forEach(function(I){_(I,"display","")}),v(),fi=!1,C())},hideClone:function(C){var v=this,S=(C.sortable,C.cloneNowHidden),C=C.cancel;this.isMultiDrag&&(gt.forEach(function(I){_(I,"display","none"),v.options.removeCloneOnHide&&I.parentNode&&I.parentNode.removeChild(I)}),S(),fi=!0,C())},dragStartGlobal:function(b){b.sortable,!this.isMultiDrag&&mt&&mt.multiDrag._deselectMultiDrag(),Ce.forEach(function(v){v.sortableIndex=F(v)}),Ce=Ce.sort(function(v,S){return v.sortableIndex-S.sortableIndex}),L=!0},dragStarted:function(C){var v,S=this,C=C.sortable;this.isMultiDrag&&(this.options.sort&&(C.captureAnimationState(),this.options.animation&&(Ce.forEach(function(I){I!==Re&&_(I,"position","absolute")}),v=k(Re,!1,!0,!0),Ce.forEach(function(I){I!==Re&&pe(I,v)}),T=N=!0)),C.animateAll(function(){T=N=!1,S.options.animation&&Ce.forEach(function(I){Ie(I)}),S.options.sort&&W()}))},dragOver:function(C){var v=C.target,S=C.completed,C=C.cancel;N&&~Ce.indexOf(v)&&(S(!1),C())},revert:function(b){var v,S,C=b.fromSortable,I=b.rootEl,R=b.sortable,H=b.dragRect;1<Ce.length&&(Ce.forEach(function(J){R.addAnimationState({target:J,rect:N?k(J):H}),Ie(J),J.fromRect=H,C.removeAnimationState(J)}),N=!1,v=!this.options.removeCloneOnHide,S=I,Ce.forEach(function(J,se){se=S.children[J.sortableIndex+(v?Number(se):0)],se?S.insertBefore(J,se):S.appendChild(J)}))},dragOverCompleted:function(se){var v,S=se.sortable,C=se.isOwner,I=se.insertion,R=se.activeSortable,H=se.parentEl,J=se.putSortable,se=this.options;I&&(C&&R._hideClone(),T=!1,se.animation&&1<Ce.length&&(N||!C&&!R.options.sort&&!J)&&(v=k(Re,!1,!0,!0),Ce.forEach(function(he){he!==Re&&(pe(he,v),H.appendChild(he))}),N=!0),C||(N||W(),1<Ce.length?(C=fi,R._showClone(S),R.options.animation&&!fi&&C&&gt.forEach(function(he){R.addAnimationState({target:he,rect:Ci}),he.fromRect=Ci,he.thisAnimationDuration=null})):R._showClone(S)))},dragOverAnimationCapture:function(C){var v=C.dragRect,S=C.isOwner,C=C.activeSortable;Ce.forEach(function(I){I.thisAnimationDuration=null}),C.options.animation&&!S&&C.multiDrag.isMultiDrag&&(Ci=r({},v),v=y(Re,!0),Ci.top-=v.f,Ci.left-=v.e)},dragOverAnimationComplete:function(){N&&(N=!1,W())},drop:function(b){var v=b.originalEvent,S=b.rootEl,C=b.parentEl,I=b.sortable,R=b.dispatchSortableEvent,H=b.oldIndex,J=b.putSortable,se=J||this.sortable;if(v){var he,me,$e,we=this.options,Pe=C.children;if(!L)if(we.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),g(Re,we.selectedClass,!~Ce.indexOf(Re)),~Ce.indexOf(Re))Ce.splice(Ce.indexOf(Re),1),Ht=null,U({sortable:I,rootEl:S,name:"deselect",targetEl:Re,originalEvent:v});else{if(Ce.push(Re),U({sortable:I,rootEl:S,name:"select",targetEl:Re,originalEvent:v}),v.shiftKey&&Ht&&I.el.contains(Ht)){var Te=F(Ht),b=F(Re);if(~Te&&~b&&Te!==b)for(var je,yt=Te<b?(je=Te,b):(je=b,Te+1);je<yt;je++)~Ce.indexOf(Pe[je])||(g(Pe[je],we.selectedClass,!0),Ce.push(Pe[je]),U({sortable:I,rootEl:S,name:"select",targetEl:Pe[je],originalEvent:v}))}else Ht=Re;mt=se}L&&this.isMultiDrag&&(N=!1,(C[ke].options.sort||C!==S)&&1<Ce.length&&(he=k(Re),me=F(Re,":not(."+this.options.selectedClass+")"),!T&&we.animation&&(Re.thisAnimationDuration=null),se.captureAnimationState(),T||(we.animation&&(Re.fromRect=he,Ce.forEach(function(Me){var wt;Me.thisAnimationDuration=null,Me!==Re&&(wt=N?k(Me):he,Me.fromRect=wt,se.addAnimationState({target:Me,rect:wt}))})),W(),Ce.forEach(function(Me){Pe[me]?C.insertBefore(Me,Pe[me]):C.appendChild(Me),me++}),H===F(Re)&&($e=!1,Ce.forEach(function(Me){Me.sortableIndex!==F(Me)&&($e=!0)}),$e&&R("update"))),Ce.forEach(function(Me){Ie(Me)}),se.animateAll()),mt=se),(S===C||J&&J.lastPutMode!=="clone")&&gt.forEach(function(Me){Me.parentNode&&Me.parentNode.removeChild(Me)})}},nullingGlobal:function(){this.isMultiDrag=L=!1,gt.length=0},destroyGlobal:function(){this._deselectMultiDrag(),A(document,"pointerup",this._deselectMultiDrag),A(document,"mouseup",this._deselectMultiDrag),A(document,"touchend",this._deselectMultiDrag),A(document,"keydown",this._checkKeyDown),A(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(b){if(!(L!==void 0&&L||mt!==this.sortable||b&&j(b.target,this.options.draggable,this.sortable.el,!1)||b&&b.button!==0))for(;Ce.length;){var v=Ce[0];g(v,this.options.selectedClass,!1),Ce.shift(),U({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:v,originalEvent:b})}},_checkKeyDown:function(b){b.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(b){b.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},r(h,{pluginName:"multiDrag",utils:{select:function(b){var v=b.parentNode[ke];v&&v.options.multiDrag&&!~Ce.indexOf(b)&&(mt&&mt!==v&&(mt.multiDrag._deselectMultiDrag(),mt=v),g(b,v.options.selectedClass,!0),Ce.push(b))},deselect:function(b){var v=b.parentNode[ke],S=Ce.indexOf(b);v&&v.options.multiDrag&&~S&&(g(b,v.options.selectedClass,!1),Ce.splice(S,1))}},eventProperties:function(){var b=this,v=[],S=[];return Ce.forEach(function(C){var I;v.push({multiDragElement:C,index:C.sortableIndex}),I=N&&C!==Re?-1:N?F(C,":not(."+b.options.selectedClass+")"):F(C),S.push({multiDragElement:C,index:I})}),{items:n(Ce),clones:[].concat(gt),oldIndicies:v,newIndicies:S}},optionListeners:{multiDragKey:function(b){return(b=b.toLowerCase())==="ctrl"?b="Control":1<b.length&&(b=b.charAt(0).toUpperCase()+b.substr(1)),b}}})}),ve})});var S_=te((uA,C_)=>{"use strict";function Dx(i){return i&&typeof i=="object"&&"default"in i?i.default:i}var Px=Dx(l_());function V(i,e){return typeof i=="string"?(e||document).querySelector(i):i||null}V.each=(i,e)=>typeof i=="string"?Array.from((e||document).querySelectorAll(i)):i||null;V.create=(i,e)=>{let t=document.createElement(i);for(let r in e){let s=e[r];if(r==="inside")V(s).appendChild(t);else if(r==="around"){let n=V(s);n.parentNode.insertBefore(t,n),t.appendChild(n)}else r==="styles"?typeof s=="object"&&Object.keys(s).map(n=>{t.style[n]=s[n]}):r in t?t[r]=s:t.setAttribute(r,s)}return t};V.on=(i,e,t,r)=>{r?V.delegate(i,e,t,r):(r=t,V.bind(i,e,r))};V.off=(i,e,t)=>{i.removeEventListener(e,t)};V.bind=(i,e,t)=>{e.split(/\s+/).forEach(function(r){i.addEventListener(r,t)})};V.delegate=(i,e,t,r)=>{i.addEventListener(e,function(s){let n=s.target.closest(t);n&&(s.delegatedTarget=n,r.call(this,s,n))})};V.unbind=(i,e)=>{if(i)for(let t in e){let r=e[t];t.split(/\s+/).forEach(function(s){i.removeEventListener(s,r)})}};V.fire=(i,e,t)=>{let r=document.createEvent("HTMLEvents");r.initEvent(e,!0,!0);for(let s in t)r[s]=t[s];return i.dispatchEvent(r)};V.data=(i,e)=>{if(!e)return i.dataset;for(let t in e)i.dataset[t]=e[t]};V.style=(i,e)=>{if(typeof e=="string")return V.getStyle(i,e);Array.isArray(i)||(i=[i]),i.map(t=>{for(let r in e)t.style[r]=e[r]})};V.removeStyle=(i,e)=>{Array.isArray(i)||(i=[i]),Array.isArray(e)||(e=[e]),i.map(t=>{for(let r of e)t.style[r]=""})};V.getStyle=(i,e)=>{if(!e)return getComputedStyle(i);let t=getComputedStyle(i)[e];return["width","height"].includes(e)&&(t=parseFloat(t)),t};V.closest=(i,e)=>e?e.matches(i)?e:V.closest(i,e.parentNode):null;V.inViewport=(i,e)=>{let{top:t,left:r,bottom:s,right:n}=i.getBoundingClientRect(),{top:o,left:a,bottom:l,right:c}=e.getBoundingClientRect();return t>=o&&r>=a&&s<=l&&n<=c};V.scrollTop=function(e,t){requestAnimationFrame(()=>{e.scrollTop=t})};V.scrollbarSize=function(){return V.scrollBarSizeValue||(V.scrollBarSizeValue=jx()),V.scrollBarSizeValue};function jx(){let i=document.createElement("div");V.style(i,{width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}),document.body.appendChild(i);let e=i.offsetWidth-i.clientWidth;return document.body.removeChild(i),e}V.hasVerticalOverflow=function(i){return i.scrollHeight>i.offsetHeight+10};V.hasHorizontalOverflow=function(i){return i.scrollWidth>i.offsetWidth+10};V.measureTextWidth=function(i){let e=document.createElement("div");return e.style.position="absolute",e.style.visibility="hidden",e.style.height="auto",e.style.width="auto",e.style.whiteSpace="nowrap",e.innerText=i,document.body.appendChild(e),e.clientWidth+1};function zx(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var yr=zx,io=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ro(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function Fx(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Hx(i,e){return e={exports:{}},i(e,e.exports),e.exports}var qx=typeof io=="object"&&io&&io.Object===Object&&io,Ux=qx,Wx=typeof self=="object"&&self&&self.Object===Object&&self,Vx=Ux||Wx||Function("return this")(),Zs=Vx,Yx=function(){return Zs.Date.now()},Al=Yx,Gx=Zs.Symbol,so=Gx,b_=Object.prototype,Kx=b_.hasOwnProperty,Xx=b_.toString,Vs=so?so.toStringTag:void 0;function Jx(i){var e=Kx.call(i,Vs),t=i[Vs];try{i[Vs]=void 0}catch(s){}var r=Xx.call(i);return e?i[Vs]=t:delete i[Vs],r}var Zx=Jx,Qx=Object.prototype,eC=Qx.toString;function tC(i){return eC.call(i)}var iC=tC,rC="[object Null]",sC="[object Undefined]",c_=so?so.toStringTag:void 0;function nC(i){return i==null?i===void 0?sC:rC:c_&&c_ in Object(i)?Zx(i):iC(i)}var v_=nC;function oC(i){return i!=null&&typeof i=="object"}var aC=oC,lC="[object Symbol]";function cC(i){return typeof i=="symbol"||aC(i)&&v_(i)==lC}var dC=cC,d_=0/0,uC=/^\s+|\s+$/g,pC=/^[-+]0x[0-9a-f]+$/i,hC=/^0b[01]+$/i,fC=/^0o[0-7]+$/i,_C=parseInt;function mC(i){if(typeof i=="number")return i;if(dC(i))return d_;if(yr(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=yr(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=i.replace(uC,"");var t=hC.test(i);return t||fC.test(i)?_C(i.slice(2),t?2:8):pC.test(i)?d_:+i}var u_=mC,gC="Expected a function",bC=Math.max,vC=Math.min;function yC(i,e,t){var r,s,n,o,a,l,c=0,u=!1,p=!1,m=!0;if(typeof i!="function")throw new TypeError(gC);e=u_(e)||0,yr(t)&&(u=!!t.leading,p="maxWait"in t,n=p?bC(u_(t.maxWait)||0,e):n,m="trailing"in t?!!t.trailing:m);function w(y){var O=r,E=s;return r=s=void 0,c=y,o=i.apply(E,O),o}function x(y){return c=y,a=setTimeout(j,e),u?w(y):o}function A(y){var O=y-l,E=y-c,k=e-O;return p?vC(k,n-E):k}function D(y){var O=y-l,E=y-c;return l===void 0||O>=e||O<0||p&&E>=n}function j(){var y=Al();if(D(y))return ee(y);a=setTimeout(j,A(y))}function ee(y){return a=void 0,m&&r?w(y):(r=s=void 0,o)}function d(){a!==void 0&&clearTimeout(a),c=0,r=l=s=a=void 0}function g(){return a===void 0?o:ee(Al())}function _(){var y=Al(),O=D(y);if(r=arguments,s=this,l=y,O){if(a===void 0)return x(l);if(p)return a=setTimeout(j,e),w(l)}return a===void 0&&(a=setTimeout(j,e)),o}return _.cancel=d,_.flush=g,_}var y_=yC,wC="Expected a function";function kC(i,e,t){var r=!0,s=!0;if(typeof i!="function")throw new TypeError(wC);return yr(t)&&(r="leading"in t?!!t.leading:r,s="trailing"in t?!!t.trailing:s),y_(i,e,{leading:r,maxWait:e,trailing:s})}var xC=kC,CC="[object AsyncFunction]",SC="[object Function]",TC="[object GeneratorFunction]",EC="[object Proxy]";function $C(i){if(!yr(i))return!1;var e=v_(i);return e==SC||e==TC||e==CC||e==EC}var OC=$C,AC=Zs["__core-js_shared__"],Ll=AC,p_=function(){var i=/[^.]+$/.exec(Ll&&Ll.keys&&Ll.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function LC(i){return!!p_&&p_ in i}var BC=LC,IC=Function.prototype,MC=IC.toString;function NC(i){if(i!=null){try{return MC.call(i)}catch(e){}try{return i+""}catch(e){}}return""}var RC=NC,DC=/[\\^$.*+?()[\]{}|]/g,PC=/^\[object .+?Constructor\]$/,jC=Function.prototype,zC=Object.prototype,FC=jC.toString,HC=zC.hasOwnProperty,qC=RegExp("^"+FC.call(HC).replace(DC,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function UC(i){if(!yr(i)||BC(i))return!1;var e=OC(i)?qC:PC;return e.test(RC(i))}var WC=UC;function VC(i,e){return i==null?void 0:i[e]}var YC=VC;function GC(i,e){var t=YC(i,e);return WC(t)?t:void 0}var Hl=GC,KC=Hl(Object,"create"),Js=KC;function XC(){this.__data__=Js?Js(null):{},this.size=0}var JC=XC;function ZC(i){var e=this.has(i)&&delete this.__data__[i];return this.size-=e?1:0,e}var QC=ZC,eS="__lodash_hash_undefined__",tS=Object.prototype,iS=tS.hasOwnProperty;function rS(i){var e=this.__data__;if(Js){var t=e[i];return t===eS?void 0:t}return iS.call(e,i)?e[i]:void 0}var sS=rS,nS=Object.prototype,oS=nS.hasOwnProperty;function aS(i){var e=this.__data__;return Js?e[i]!==void 0:oS.call(e,i)}var lS=aS,cS="__lodash_hash_undefined__";function dS(i,e){var t=this.__data__;return this.size+=this.has(i)?0:1,t[i]=Js&&e===void 0?cS:e,this}var uS=dS;function kr(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}kr.prototype.clear=JC;kr.prototype.delete=QC;kr.prototype.get=sS;kr.prototype.has=lS;kr.prototype.set=uS;var h_=kr;function pS(){this.__data__=[],this.size=0}var hS=pS;function fS(i,e){return i===e||i!==i&&e!==e}var _S=fS;function mS(i,e){for(var t=i.length;t--;)if(_S(i[t][0],e))return t;return-1}var oo=mS,gS=Array.prototype,bS=gS.splice;function vS(i){var e=this.__data__,t=oo(e,i);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():bS.call(e,t,1),--this.size,!0}var yS=vS;function wS(i){var e=this.__data__,t=oo(e,i);return t<0?void 0:e[t][1]}var kS=wS;function xS(i){return oo(this.__data__,i)>-1}var CS=xS;function SS(i,e){var t=this.__data__,r=oo(t,i);return r<0?(++this.size,t.push([i,e])):t[r][1]=e,this}var TS=SS;function xr(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}xr.prototype.clear=hS;xr.prototype.delete=yS;xr.prototype.get=kS;xr.prototype.has=CS;xr.prototype.set=TS;var ES=xr,$S=Hl(Zs,"Map"),OS=$S;function AS(){this.size=0,this.__data__={hash:new h_,map:new(OS||ES),string:new h_}}var LS=AS;function BS(i){var e=typeof i;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?i!=="__proto__":i===null}var IS=BS;function MS(i,e){var t=i.__data__;return IS(e)?t[typeof e=="string"?"string":"hash"]:t.map}var ao=MS;function NS(i){var e=ao(this,i).delete(i);return this.size-=e?1:0,e}var RS=NS;function DS(i){return ao(this,i).get(i)}var PS=DS;function jS(i){return ao(this,i).has(i)}var zS=jS;function FS(i,e){var t=ao(this,i),r=t.size;return t.set(i,e),this.size+=t.size==r?0:1,this}var HS=FS;function Cr(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}Cr.prototype.clear=LS;Cr.prototype.delete=RS;Cr.prototype.get=PS;Cr.prototype.has=zS;Cr.prototype.set=HS;var qS=Cr,US="__lodash_hash_undefined__";function WS(i){return this.__data__.set(i,US),this}var VS=WS;function YS(i){return this.__data__.has(i)}var GS=YS;function no(i){var e=-1,t=i==null?0:i.length;for(this.__data__=new qS;++e<t;)this.add(i[e])}no.prototype.add=no.prototype.push=VS;no.prototype.has=GS;var KS=no;function XS(i,e,t,r){for(var s=i.length,n=t+(r?1:-1);r?n--:++n<s;)if(e(i[n],n,i))return n;return-1}var JS=XS;function ZS(i){return i!==i}var QS=ZS;function eT(i,e,t){for(var r=t-1,s=i.length;++r<s;)if(i[r]===e)return r;return-1}var tT=eT;function iT(i,e,t){return e===e?tT(i,e,t):JS(i,QS,t)}var rT=iT;function sT(i,e){var t=i==null?0:i.length;return!!t&&rT(i,e,0)>-1}var nT=sT;function oT(i,e,t){for(var r=-1,s=i==null?0:i.length;++r<s;)if(t(e,i[r]))return!0;return!1}var aT=oT;function lT(i,e){return i.has(e)}var cT=lT,dT=Hl(Zs,"Set"),Bl=dT;function uT(){}var pT=uT;function hT(i){var e=-1,t=Array(i.size);return i.forEach(function(r){t[++e]=r}),t}var w_=hT,fT=1/0,_T=Bl&&1/w_(new Bl([,-0]))[1]==fT?function(i){return new Bl(i)}:pT,mT=_T,gT=200;function bT(i,e,t){var r=-1,s=nT,n=i.length,o=!0,a=[],l=a;if(t)o=!1,s=aT;else if(n>=gT){var c=e?null:mT(i);if(c)return w_(c);o=!1,s=cT,l=new KS}else l=e?[]:a;e:for(;++r<n;){var u=i[r],p=e?e(u):u;if(u=t||u!==0?u:0,o&&p===p){for(var m=l.length;m--;)if(l[m]===p)continue e;e&&l.push(p),a.push(u)}else s(l,p,t)||(l!==a&&l.push(p),a.push(u))}return a}var vT=bT;function yT(i){return i&&i.length?vT(i):[]}var wT=yT;function k_(i){return i.replace(/([A-Z])/g,e=>`-${e[0].toLowerCase()}`)}function Il(i){return Object.keys(i).map(t=>{let r=k_(t),s=i[t];return s===void 0?"":`data-${r}="${s}" `}).join("").trim()}function f_(i){var e=document.createElement("textarea");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=i,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(e)}function kT(i){return!isNaN(i)}var x_=xC,xT=y_;function Gs(i,e=null){return(...t)=>new Promise(r=>{setTimeout(()=>{let n=i.apply(e,t);r(n)})})}function lo(i,e,t){let r=t.reduce((s,n)=>(s[n]={get(){return e[n]}},s),{});Object.defineProperties(i,r)}function CT(i){return i!==void 0||i!==null}function ST(i){return!CT(i)}function Ks(i){return!isNaN(i)}function TT(i){return Array.isArray(i)?i:[i]}function m_(i){return wT(i)}function Ys(i,e){return i-e}function g_(i){return i.replace(/<[^>]*>/g,"")}function ET(i,e){return i&&(Object.keys(e).forEach(t=>{let r=new RegExp(`{(${t})}`,"g");i=i.replace(r,e[t])}),i)}function $T(i){if(!i)return"";let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(i).replace(/[&<>"'`=/]/g,t=>e[t]||t)}var Ml=class{constructor(e){this.options=e,this.sortRows=Gs(this.sortRows,this),this.switchColumn=Gs(this.switchColumn,this),this.removeColumn=Gs(this.removeColumn,this),this.options.filterRows=Gs(this.options.filterRows,this)}init(e,t){e||(e=this.options.data),t&&(this.options.columns=t),this.data=e,this.rowCount=0,this.columns=[],this.rows=[],this.prepareColumns(),this.validateData(this.data),this.rows=this.prepareRows(this.data),this.prepareTreeRows(),this.prepareRowView(),this.prepareNumericColumns()}get currentSort(){return this.columns.find(t=>t.sortOrder!=="none")||{colIndex:-1,sortOrder:"none"}}prepareColumns(){this.columns=[],this.validateColumns(),this.prepareDefaultColumns(),this.prepareHeader()}prepareDefaultColumns(){if(this.options.checkboxColumn&&!this.hasColumnById("_checkbox")){let e={id:"_checkbox",content:this.getCheckboxHTML(),editable:!1,resizable:!1,sortable:!1,focusable:!1,dropdown:!1,width:32};this.columns.push(e)}if(this.options.serialNoColumn&&!this.hasColumnById("_rowIndex")){let e={id:"_rowIndex",content:"",align:"center",editable:!1,resizable:!1,focusable:!1,dropdown:!1};this.columns.push(e)}}prepareHeader(){let e=this.columns.concat(this.options.columns),t={isHeader:1,editable:!0,sortable:!0,resizable:!0,focusable:!0,dropdown:!0,width:null,format:r=>r==null?"":r+""};this.columns=e.map((r,s)=>this.prepareCell(r,s)).map(r=>Object.assign({},t,r)).map(r=>(r.content=r.content||r.name||"",r.id=r.id||r.content,r))}prepareCell(e,t){let r={content:"",sortOrder:"none",colIndex:t,column:this.columns[t]};return e!==null&&typeof e=="object"?Object.assign(r,e):r.content=e,r}prepareNumericColumns(){let e=this.getRow(0);!e||(this.columns=this.columns.map((t,r)=>{let s=e[r].content;return!t.align&&kT(s)&&(t.align="right"),t}))}prepareRows(e){return e.map((t,r)=>{let s=this._getNextRowCount(),n=[],o={rowIndex:s};if(Array.isArray(t))for(this.options.checkboxColumn&&n.push(this.getCheckboxHTML()),this.options.serialNoColumn&&n.push(s+1+""),n=n.concat(t);n.length<this.columns.length;)n.push("");else{for(let a of this.columns)a.id==="_checkbox"?n.push(this.getCheckboxHTML()):a.id==="_rowIndex"?n.push(s+1+""):n.push(t[a.id]);o.indent=t.indent||0}return this.prepareRow(n,o)})}prepareTreeRows(){this.rows.forEach((e,t)=>{if(Ks(e.meta.indent)){let r=this.getRow(t+1);e.meta.isLeaf=!r||ST(r.meta.indent)||r.meta.indent<=e.meta.indent,e.meta.isTreeNodeClose=!1}})}prepareRowView(){this.rowViewOrder=this.rows.map(e=>e.meta.rowIndex)}prepareRow(e,t){let r={rowIndex:t.rowIndex,indent:t.indent};return e=e.map((s,n)=>this.prepareCell(s,n)).map(s=>Object.assign({},r,s)),e.meta=t,e}validateColumns(){let e=this.options.columns;if(!Array.isArray(e))throw new Xs("`columns` must be an array");e.forEach((t,r)=>{if(typeof t!="string"&&typeof t!="object")throw new Xs(`column "${r}" must be a string or an object`)})}validateData(e){if(Array.isArray(e)&&(e.length===0||Array.isArray(e[0])||typeof e[0]=="object"))return!0;throw new Xs("`data` must be an array of arrays or objects")}appendRows(e){this.validateData(e),this.rows=this.rows.concat(this.prepareRows(e)),this.prepareTreeRows(),this.prepareRowView()}sortRows(e,t="none"){e=+e,this.getColumns().map(r=>{r.colIndex===e?r.sortOrder=t:r.sortOrder="none"}),this._sortRows(e,t)}_sortRows(e,t){if(this.currentSort.colIndex===e&&(this.currentSort.sortOrder==="asc"&&t==="desc"||this.currentSort.sortOrder==="desc"&&t==="asc")){this.reverseArray(this.rowViewOrder),this.currentSort.sortOrder=t;return}if(this.rowViewOrder.sort((r,s)=>{let n=r,o=s,a=this.getCell(e,r).content,l=this.getCell(e,s).content;if(a=a==null?"":a,l=l==null?"":l,t==="none")return n-o;if(t==="asc"){if(a<l)return-1;if(a>l)return 1;if(a===l)return 0}else if(t==="desc"){if(a<l)return 1;if(a>l)return-1;if(a===l)return 0}return 0}),this.hasColumnById("_rowIndex")){let r=this.getColumnIndexById("_rowIndex");this.rows.forEach((s,n)=>{let o=this.rowViewOrder.indexOf(n),a=s[r];a.content=o+1+""})}}reverseArray(e){let t=null,r=null,s=e.length;for(t=0,r=s-1;t<r;t+=1,r-=1){let n=e[t];e[t]=e[r],e[r]=n}}switchColumn(e,t){let r=this.columns[e];this.columns[e]=this.columns[t],this.columns[t]=r,this.columns[e].colIndex=e,this.columns[t].colIndex=t,this.rows.forEach(s=>{let n=Object.assign({},s[e],{colIndex:t}),o=Object.assign({},s[t],{colIndex:e});s[t]=n,s[e]=o})}removeColumn(e){e=+e;let t=s=>s.colIndex!==e,r=(s,n)=>Object.assign({},s,{colIndex:n});this.columns=this.columns.filter(t).map(r),this.rows.forEach(s=>{s.splice(e,1),s.forEach((n,o)=>{n.colIndex=o})})}updateRow(e,t){e.length<this.columns.length&&(this.hasColumnById("_rowIndex")&&(e=[t+1+""].concat(e)),this.hasColumnById("_checkbox")&&(e=['<input type="checkbox" />'].concat(e)));let r=this.prepareRow(e,{rowIndex:t}),s=this.rows.findIndex(n=>n[0].rowIndex===t);return this.rows[s]=r,r}updateCell(e,t,r){let s;typeof e=="object"&&(s=e,e=s.colIndex,t=s.rowIndex,r=s),s=this.getCell(e,t);for(let n in r){let o=r[n];o!==void 0&&(s[n]=o)}return s}updateColumn(e,t){let r=this.getColumn(e);for(let s in t){let n=t[s];n!==void 0&&(r[s]=n)}return r}filterRows(e){return this.options.filterRows(this.rows,e,this).then(t=>(t||(t=this.getAllRowIndices()),t.then||(t=Promise.resolve(t)),t.then(r=>(this._filteredRows=r,{rowsToHide:this.getAllRowIndices().filter(n=>!r.includes(n)),rowsToShow:r}))))}getFilteredRowIndices(){return this._filteredRows||this.getAllRowIndices()}getAllRowIndices(){return this.rows.map(e=>e.meta.rowIndex)}getRowCount(){return this.rowCount}_getNextRowCount(){let e=this.rowCount;return this.rowCount++,e}getRows(e,t){return this.rows.slice(e,t)}getRowsForView(e,t){return this.rowViewOrder.map(s=>this.rows[s]).slice(e,t)}getColumns(e){let t=this.columns;return e&&(t=t.slice(this.getStandardColumnCount())),t}getStandardColumnCount(){return this.options.checkboxColumn&&this.options.serialNoColumn?2:this.options.checkboxColumn||this.options.serialNoColumn?1:0}getColumnCount(e){let t=this.columns.length;return e&&(t=t-this.getStandardColumnCount()),t}getColumn(e){return e=+e,e<0&&(e=this.columns.length+e),this.columns.find(t=>t.colIndex===e)}getColumnById(e){return this.columns.find(t=>t.id===e)}getRow(e){return e=+e,this.rows[e]}getCell(e,t){return t=+t,e=+e,this.getRow(t)[e]}getChildren(e){e=+e;let t=this.getRow(e).meta.indent,r=[];for(let s=e+1;s<this.rowCount;s++){let n=this.getRow(s);if(!isNaN(n.meta.indent)&&(n.meta.indent>t&&r.push(s),n.meta.indent===t))break}return r}getImmediateChildren(e){e=+e;let t=this.getRow(e).meta.indent,r=[],s=t+1;for(let n=e+1;n<this.rowCount;n++){let o=this.getRow(n);if(!(isNaN(o.meta.indent)||o.meta.indent>s)&&(o.meta.indent===s&&r.push(n),o.meta.indent===t))break}return r}get(){return{columns:this.columns,rows:this.rows}}getData(e){return this.data[e]}hasColumn(e){return Boolean(this.columns.find(t=>t.content===e))}hasColumnById(e){return Boolean(this.columns.find(t=>t.id===e))}getColumnIndex(e){return this.columns.findIndex(t=>t.content===e)}getColumnIndexById(e){return this.columns.findIndex(t=>t.id===e)}getCheckboxHTML(){return'<input type="checkbox" />'}},Xs=class extends TypeError{},Nl={chevronDown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronRight:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>'},wr=class{constructor(e){this.instance=e,lo(this,this.instance,["wrapper","options","style","header","bodyScrollable","columnmanager","rowmanager","datamanager","keyboard","footer"]),this.bindEvents(),this.stickyRowWidth=0,this.stickyColWitdh=[]}bindEvents(){this.bindFocusCell(),this.bindEditCell(),this.bindKeyboardSelection(),this.bindCopyCellContents(),this.bindMouseEvents(),this.bindTreeEvents()}bindFocusCell(){this.bindKeyboardNav()}bindEditCell(){this.$editingCell=null,V.on(this.bodyScrollable,"dblclick",".dt-cell",(e,t)=>{this.activateEditing(t)}),this.keyboard.on("enter",()=>{this.$focusedCell&&!this.$editingCell?this.activateEditing(this.$focusedCell):this.$editingCell&&this.deactivateEditing()})}bindKeyboardNav(){let e=t=>{if(!this.$focusedCell||this.$editingCell)return!1;let r=this.$focusedCell,{rowIndex:s,colIndex:n}=V.data(r);return t==="left"?r=this.getLeftMostCell$(s):t==="right"?r=this.getRightMostCell$(s):t==="up"?r=this.getTopMostCell$(n):t==="down"&&(r=this.getBottomMostCell$(n)),this.focusCell(r),!0};["left","right","up","down","tab","shift+tab"].map(t=>this.keyboard.on(t,()=>this.focusCellInDirection(t))),["left","right","up","down"].map(t=>this.keyboard.on(`ctrl+${t}`,()=>e(t))),this.keyboard.on("esc",()=>{this.deactivateEditing(!1),this.columnmanager.toggleFilter(!1)}),this.options.inlineFilters&&(this.keyboard.on("ctrl+f",t=>{let r=V.closest(".dt-cell",t.target),{colIndex:s}=V.data(r);return this.activateFilter(s),!0}),V.on(this.header,"focusin",".dt-filter",()=>{this.unfocusCell(this.$focusedCell)}))}bindKeyboardSelection(){let e=t=>{let r=this.getSelectionCursor();return t==="left"?r=this.getLeftCell$(r):t==="right"?r=this.getRightCell$(r):t==="up"?r=this.getAboveCell$(r):t==="down"&&(r=this.getBelowCell$(r)),r};["left","right","up","down"].map(t=>this.keyboard.on(`shift+${t}`,()=>this.selectArea(e(t))))}bindCopyCellContents(){this.keyboard.on("ctrl+c",()=>{let e=this.copyCellContents(this.$focusedCell,this.$selectionCursor),t=this.instance.translate("{count} cells copied",{count:e});e&&this.instance.showToastMessage(t,2)}),this.options.pasteFromClipboard&&this.keyboard.on("ctrl+v",e=>(this.instance.pasteTarget.focus(),setTimeout(()=>{let t=this.instance.pasteTarget.value;this.instance.pasteTarget.value="",this.pasteContentInCell(t)},10),!1))}bindMouseEvents(){let e=null;V.on(this.bodyScrollable,"mousedown",".dt-cell",r=>{e=!0,this.focusCell(V(r.delegatedTarget))}),V.on(this.bodyScrollable,"mouseup",()=>{e=!1}),this.options.showTotalRow&&V.on(this.footer,"click",".dt-cell",r=>{this.focusCell(V(r.delegatedTarget))});let t=r=>{!e||this.selectArea(V(r.delegatedTarget))};V.on(this.bodyScrollable,"mousemove",".dt-cell",x_(t,50))}bindTreeEvents(){V.on(this.bodyScrollable,"click",".dt-tree-node__toggle",(e,t)=>{let r=V.closest(".dt-cell",t),{rowIndex:s}=V.data(r);r.classList.contains("dt-cell--tree-close")?this.rowmanager.openSingleNode(s):this.rowmanager.closeSingleNode(s)})}focusCell(e,{skipClearSelection:t=0,skipDOMFocus:r=0,skipScrollToCell:s=0}={}){if(!e||e===this.$editingCell)return;let{colIndex:n,isHeader:o}=V.data(e);o||this.columnmanager.getColumn(n).focusable===!1||(s||this.scrollToCell(e),this.deactivateEditing(),t||this.clearSelection(),this.$focusedCell&&this.$focusedCell.classList.remove("dt-cell--focus"),this.$focusedCell=e,e.classList.add("dt-cell--focus"),r||e.focus(),this.highlightRowColumnHeader(e))}unfocusCell(e){!e||(e.classList.remove("dt-cell--focus"),this.$focusedCell=null,this.lastHeaders&&this.lastHeaders.forEach(t=>t&&t.classList.remove("dt-cell--highlight")))}highlightRowColumnHeader(e){let{colIndex:t,rowIndex:r}=V.data(e),s=this.datamanager.getColumnIndexById("_rowIndex"),n=`.dt-cell--header-${t}`,o=`.dt-cell--${s}-${r}`;this.lastHeaders&&this.lastHeaders.forEach(c=>c&&c.classList.remove("dt-cell--highlight"));let a=V(n,this.wrapper),l=V(o,this.wrapper);this.lastHeaders=[a,l],this.lastHeaders.forEach(c=>c&&c.classList.add("dt-cell--highlight"))}selectAreaOnClusterChanged(){if(!(this.$focusedCell&&this.$selectionCursor))return;let{colIndex:e,rowIndex:t}=V.data(this.$selectionCursor),r=this.getCell$(e,t);if(!r||r===this.$selectionCursor)return;let s=V.data(this.$focusedCell);this.$focusedCell=this.getCell$(s.colIndex,s.rowIndex),this.selectArea(r)}focusCellOnClusterChanged(){if(!this.$focusedCell)return;let{colIndex:e,rowIndex:t}=V.data(this.$focusedCell),r=this.getCell$(e,t);!r||this.focusCell(r,{skipClearSelection:1,skipDOMFocus:1,skipScrollToCell:1})}selectArea(e){!this.$focusedCell||this._selectArea(this.$focusedCell,e)&&(this.$selectionCursor=e)}_selectArea(e,t){if(e===t)return!1;let r=this.getCellsInRange(e,t);return r?(this.clearSelection(),this._selectedCells=r.map(s=>this.getCell$(...s)),requestAnimationFrame(()=>{this._selectedCells.map(s=>s.classList.add("dt-cell--highlight"))}),!0):!1}getCellsInRange(e,t){let r,s,n,o;if(typeof e=="number")[r,s,n,o]=arguments;else if(typeof e=="object"){if(!(e&&t))return!1;let p=V.data(e),m=V.data(t);r=+p.colIndex,s=+p.rowIndex,n=+m.colIndex,o=+m.rowIndex}if(s>o&&([s,o]=[o,s]),r>n&&([r,n]=[n,r]),this.isStandardCell(r)||this.isStandardCell(n))return!1;let a=[],l=r,c=s,u=[];for(;c<=o;)u.push(c),c+=1;return u.map(p=>{for(;l<=n;)a.push([l,p]),l++;l=r}),a}clearSelection(){(this._selectedCells||[]).forEach(e=>e.classList.remove("dt-cell--highlight")),this._selectedCells=[],this.$selectionCursor=null}getSelectionCursor(){return this.$selectionCursor||this.$focusedCell}activateEditing(e){this.focusCell(e);let{rowIndex:t,colIndex:r}=V.data(e),s=this.columnmanager.getColumn(r);if(s&&(s.editable===!1||s.focusable===!1))return;let n=this.getCell(r,t);if(n&&n.editable===!1)return;if(this.$editingCell){let{_rowIndex:l,_colIndex:c}=V.data(this.$editingCell);if(t===l&&r===c)return}this.$editingCell=e,e.classList.add("dt-cell--editing");let o=V(".dt-cell__edit",e);o.innerHTML="";let a=this.getEditor(r,t,n.content,o);a&&(this.currentCellEditor=a,a.initValue(n.content,t,s))}deactivateEditing(e=!0){e&&this.submitEditing(),this.$focusedCell&&this.$focusedCell.focus(),this.$editingCell&&(this.$editingCell.classList.remove("dt-cell--editing"),this.$editingCell=null)}getEditor(e,t,r,s){let n=this.datamanager.getColumn(e),o=this.datamanager.getRow(t),a=this.datamanager.getData(t),l=this.options.getEditor?this.options.getEditor(e,t,r,s,n,o,a):this.getDefaultEditor(s);return l===!1?!1:(l===void 0&&(l=this.getDefaultEditor(s)),l)}getDefaultEditor(e){let t=V.create("input",{class:"dt-input",type:"text",inside:e});return{initValue(r){t.focus(),t.value=r},getValue(){return t.value},setValue(r){t.value=r}}}submitEditing(){let e=Promise.resolve();if(!this.$editingCell)return e;let t=this.$editingCell,{rowIndex:r,colIndex:s}=V.data(t),n=this.datamanager.getColumn(s);if(t){let o=this.currentCellEditor;if(o){let a=o.getValue();a.then||(a=Promise.resolve(a)),e=a.then(l=>{let c=this.getCell(s,r).content;if(c===l)return!1;let u=o.setValue(l,r,n);return this.updateCell(s,r,l,!0),t.focus(),u&&u.then&&u.catch(p=>{console.log(p),this.updateCell(s,r,c)}),u})}}return this.currentCellEditor=null,e}copyCellContents(e,t){if(!t&&e){let{colIndex:o,rowIndex:a,isTotalRow:l}=V.data(e),c="";return l?c=this.$focusedCell.children[0].title:c=this.getCell(o,a).content,f_(c),1}let r=this.getCellsInRange(e,t);if(!r)return 0;let s=r.map(o=>this.getCell(...o)).reduce((o,a)=>{let l=a.rowIndex;return o[l]=o[l]||[],o[l].push(a.content),o},[]),n=s.map(o=>o.join("	")).join(`
`);return f_(n),s.reduce((o,a)=>o+a.length,0)}pasteContentInCell(e){if(!this.$focusedCell)return;let t=e.split(`
`).map(o=>o.split("	")).filter(o=>o.length&&o.every(a=>a)),{colIndex:r,rowIndex:s}=V.data(this.$focusedCell),n={colIndex:+r,rowIndex:+s};t.forEach((o,a)=>{let l=a+n.rowIndex;o.forEach((c,u)=>{let p=u+n.colIndex;this.updateCell(p,l,c,!0)})})}activateFilter(e){this.columnmanager.toggleFilter(),this.columnmanager.focusFilter(e),this.columnmanager.isFilterShown||this.$focusedCell&&this.$focusedCell.focus()}updateCell(e,t,r,s=!1){let n=this.datamanager.updateCell(e,t,{content:r});this.refreshCell(n,s)}refreshCell(e,t=!1){let r=V(this.selector(e.colIndex,e.rowIndex),this.bodyScrollable);r.innerHTML=this.getCellContent(e,t)}toggleTreeButton(e,t){let r=this.columnmanager.getFirstColumnIndex(),s=this.getCell$(r,e);s&&s.classList[t?"remove":"add"]("dt-cell--tree-close")}isStandardCell(e){return e<this.columnmanager.getFirstColumnIndex()}focusCellInDirection(e){if(!this.$focusedCell||this.$editingCell&&["left","right","up","down"].includes(e))return!1;this.$editingCell&&["tab","shift+tab"].includes(e)&&this.deactivateEditing();let t=this.$focusedCell;if(e==="left"||e==="shift+tab"?t=this.getLeftCell$(t):e==="right"||e==="tab"?t=this.getRightCell$(t):e==="up"?t=this.getAboveCell$(t):e==="down"&&(t=this.getBelowCell$(t)),!t)return!1;let{colIndex:r}=V.data(t);if(!this.columnmanager.getColumn(r).focusable){let n=this.$focusedCell;this.unfocusCell(n),this.$focusedCell=t;let o=this.focusCellInDirection(e);return o||this.focusCell(n),o}return this.focusCell(t),!0}getCell$(e,t){return V(this.selector(e,t),this.bodyScrollable)}getAboveCell$(e){let{colIndex:t}=V.data(e),r=e.parentElement.previousElementSibling;for(;r&&r.classList.contains("dt-row--hide");)r=r.previousElementSibling;return r?V(`.dt-cell--col-${t}`,r):e}getBelowCell$(e){let{colIndex:t}=V.data(e),r=e.parentElement.nextElementSibling;for(;r&&r.classList.contains("dt-row--hide");)r=r.nextElementSibling;return r?V(`.dt-cell--col-${t}`,r):e}getLeftCell$(e){return e.previousElementSibling}getRightCell$(e){return e.nextElementSibling}getLeftMostCell$(e){return this.getCell$(this.columnmanager.getFirstColumnIndex(),e)}getRightMostCell$(e){return this.getCell$(this.columnmanager.getLastColumnIndex(),e)}getTopMostCell$(e){return this.getCell$(e,this.rowmanager.getFirstRowIndex())}getBottomMostCell$(e){return this.getCell$(e,this.rowmanager.getLastRowIndex())}getCell(e,t){return this.instance.datamanager.getCell(e,t)}getRowHeight(){return V.style(V(".dt-row",this.bodyScrollable),"height")}scrollToCell(e){if(V.inViewport(e,this.bodyScrollable)||V.inViewport(e,this.footer))return!1;let{rowIndex:t}=V.data(e);return this.rowmanager.scrollToRow(t),!1}getRowCountPerPage(){return Math.ceil(this.instance.getViewportHeight()/this.getRowHeight())}getCellHTML(e){let{rowIndex:t,colIndex:r,isHeader:s,isFilter:n,isTotalRow:o}=e,a=Il({rowIndex:t,colIndex:r,isHeader:s,isFilter:n,isTotalRow:o}),l="",c=this.datamanager.getRow(t),u=!(s||n||o),p=!this.options.checkboxColumn&&this.options.serialNoColumn?0:1,m=!1,w="";return r===0&&this.options.checkboxColumn?(e.isHeader&&!(e.id in this.stickyColWitdh)&&(this.stickyRowWidth=34),w="dt-cell-checkbox",m=!0):r===p&&this.options.serialNoColumn?(e.isHeader&&!(e.id in this.stickyColWitdh)&&(this.stickyColWitdh[e.id]=this.stickyRowWidth,this.stickyRowWidth+=e.width||37,w="dt-cell-serial-no"),l=`left:${this.stickyColWitdh[u?e.column.id:e.id]}px;`,m=!0):e.sticky?(e.isHeader&&!(e.id in this.stickyColWitdh)&&(this.stickyColWitdh[e.id]=this.stickyRowWidth,this.stickyRowWidth+=(e.width||100)+1),l=`left:${this.stickyColWitdh[e.id]}px;`,m=!0):(u||o)&&e.column.sticky&&(l=`left:${this.stickyColWitdh[e.column.id]}px;`,m=!0),`
            <div class="${["dt-cell","dt-cell--col-"+r,u?`dt-cell--${r}-${t}`:"",u?"dt-cell--row-"+t:"",s?"dt-cell--header":"",s?`dt-cell--header-${r}`:"",n?"dt-cell--filter":"",u&&c&&c.meta.isTreeNodeClose?"dt-cell--tree-close":"",m?"dt-sticky-col":"",w].join(" ")}" ${a} tabindex="0" style="${l}">
                ${this.getCellContent(e)}
            </div>
        `}getCellContent(e,t=!1){let{isHeader:r,isFilter:s,colIndex:n}=e,a=!r&&e.editable!==!1?this.getEditCellHTML(n):"",c=r&&e.sortable!==!1?`<span class="sort-indicator">
                ${this.options.sortIndicator[e.sortOrder]}
            </span>`:"",p=r&&e.resizable!==!1?'<span class="dt-cell__resize-handle"></span>':"",w=r&&e.dropdown!==!1?this.columnmanager.getDropdownHTML():"",x=wr.getCustomCellFormatter(e),A;if(r||s||!x)A=e.content;else if(!e.html||t){let g=this.datamanager.getRow(e.rowIndex),_=this.datamanager.getData(e.rowIndex);A=x(e.content,g,e.column,_)}else A=e.html;if(e.html=A,this.options.treeView&&!(r||s)&&e.indent!==void 0){let g=this.datamanager.getRow(e.rowIndex+1),_=g&&g.meta.indent>e.indent,y=20,O="px";if(this.datamanager.getColumnIndexById("_rowIndex")+1===e.colIndex){let k=(e.indent||0)*y,M=_?`<span class="dt-tree-node__toggle" style="left: ${k-y}${O}">
                        <span class="icon-open">${Nl.chevronDown}</span>
                        <span class="icon-close">${Nl.chevronRight}</span>
                    </span>`:"";A=`<span class="dt-tree-node" style="padding-left: ${k}${O}">
                    ${M}
                    <span>${A}</span>
                </span>`}}let j=`
            <div class="${["dt-cell__content",r?`dt-cell__content--header-${n}`:`dt-cell__content--col-${n}`].join(" ")}">
                ${A}
                ${c}
                ${p}
                ${w}
            </div>
            ${a}
        `,ee=document.createElement("div");ee.innerHTML=A;let d=ee.textContent;return d=d.replace(/\s+/g," ").trim(),j=j.replace(">",` title="${$T(d)}">`),j}getEditCellHTML(e){return`<div class="dt-cell__edit dt-cell__edit--col-${e}"></div>`}selector(e,t){return`.dt-cell--${e}-${t}`}static getCustomCellFormatter(e){return e.format||e.column&&e.column.format||null}},Rl=class{constructor(e){this.instance=e,lo(this,this.instance,["options","fireEvent","header","datamanager","cellmanager","style","wrapper","rowmanager","bodyScrollable","bodyRenderer"]),this.bindEvents()}renderHeader(){this.header.innerHTML="<div></div>",this.refreshHeader()}refreshHeader(){let e=this.datamanager.getColumns();V("div",this.header).innerHTML=this.getHeaderHTML(e),this.$filterRow=V(".dt-row-filter",this.header),this.$filterRow&&V.style(this.$filterRow,{display:"none"}),this.$columnMap=[],this.bindMoveColumn()}getHeaderHTML(e){let t=this.rowmanager.getRowHTML(e,{isHeader:1});return this.options.inlineFilters&&(t+=this.rowmanager.getRowHTML(e,{isFilter:1})),t}bindEvents(){this.bindDropdown(),this.bindResizeColumn(),this.bindPerfectColumnWidth(),this.bindFilter()}bindDropdown(){let e=".dt-dropdown__toggle",t=".dt-dropdown__list";this.instance.dropdownContainer.innerHTML=this.getDropdownListHTML(),this.$dropdownList=this.instance.dropdownContainer.firstElementChild,V.on(this.header,"click",e,o=>{this.openDropdown(o)});let r=o=>{let a=[e,e+" *",t,t+" *"].join(",");o.target.matches(a)||n()};V.on(document.body,"click",r),document.addEventListener("scroll",n,!0),this.instance.on("onDestroy",()=>{V.off(document.body,"click",r),V.off(document,"scroll",n)}),V.on(this.$dropdownList,"click",".dt-dropdown__list-item",(o,a)=>{if(!this._dropdownActiveColIndex)return;let l=this.options.headerDropdown,{index:c}=V.data(a),u=this._dropdownActiveColIndex,p=l[c].action;p&&p.call(this.instance,this.getColumn(u)),this.hideDropdown()});let s=this;function n(o){s.hideDropdown()}this.hideDropdown()}openDropdown(e){this._dropdownWidth||(V.style(this.$dropdownList,{display:""}),this._dropdownWidth=V.style(this.$dropdownList,"width")),V.style(this.$dropdownList,{display:"",left:e.clientX-this._dropdownWidth+4+"px",top:e.clientY+4+"px"});let t=V.closest(".dt-cell",e.target),{colIndex:r}=V.data(t);this._dropdownActiveColIndex=r}hideDropdown(){V.style(this.$dropdownList,{display:"none"}),this._dropdownActiveColIndex=null}bindResizeColumn(){let e=!1,t,r,s;V.on(this.header,"mousedown",".dt-cell .dt-cell__resize-handle",(a,l)=>{document.body.classList.add("dt-resize"),t=l.parentNode.parentNode;let{colIndex:u}=V.data(t),p=this.getColumn(u);p&&p.resizable===!1||(e=!0,r=V.style(V(".dt-cell__content",t),"width"),s=a.pageX)});let n=a=>{if(document.body.classList.remove("dt-resize"),!t)return;e=!1;let{colIndex:l}=V.data(t);this.setColumnWidth(l),this.style.setBodyStyle(),t=null};V.on(document.body,"mouseup",n),this.instance.on("onDestroy",()=>{V.off(document.body,"mouseup",n)});let o=a=>{if(!e)return;let l=a.pageX-s;this.options.direction==="rtl"&&(l=-1*l);let c=r+l,{colIndex:u}=V.data(t);this.options.minimumColumnWidth>c||(this.datamanager.updateColumn(u,{width:c}),this.setColumnHeaderWidth(u))};V.on(document.body,"mousemove",o),this.instance.on("onDestroy",()=>{V.off(document.body,"mousemove",o)})}bindPerfectColumnWidth(){V.on(this.header,"dblclick",".dt-cell .dt-cell__resize-handle",(e,t)=>{let r=t.parentNode.parentNode,{colIndex:s}=V.data(r),n=this.bodyRenderer.visibleRows.map(A=>A[s]).reduce((A,D)=>A.content.length>D.content.length?A:D),o=this.cellmanager.getCellHTML(n),a=document.createElement("div");a.innerHTML=o;let l=a.querySelector(".dt-cell__content").textContent,{borderLeftWidth:c,borderRightWidth:u,paddingLeft:p,paddingRight:m}=V.getStyle(this.bodyScrollable.querySelector(".dt-cell__content")),w=[c,u,p,m].map(parseFloat).reduce((A,D)=>A+D),x=V.measureTextWidth(l)+w;this.datamanager.updateColumn(s,{width:x}),this.setColumnHeaderWidth(s),this.setColumnWidth(s)})}bindMoveColumn(){if(this.options.disableReorderColumn)return;let e=V(".dt-row",this.header);this.sortable=Px.create(e,{onEnd:t=>{let{oldIndex:r,newIndex:s}=t,n=t.item,{colIndex:o}=V.data(n);+o!==s&&this.switchColumn(r,s)},preventOnFilter:!1,filter:".dt-cell__resize-handle, .dt-dropdown",chosenClass:"dt-cell--dragging",animation:150})}sortColumn(e,t){this.instance.freeze(),this.sortRows(e,t).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>this.instance.unfreeze()).then(()=>{this.fireEvent("onSortColumn",this.getColumn(e))})}removeColumn(e){let t=this.getColumn(e);this.instance.freeze(),this.datamanager.removeColumn(e).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>this.instance.unfreeze()).then(()=>{this.fireEvent("onRemoveColumn",t)})}switchColumn(e,t){this.instance.freeze(),this.datamanager.switchColumn(e,t).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>{this.setColumnWidth(e),this.setColumnWidth(t),this.instance.unfreeze()}).then(()=>{this.fireEvent("onSwitchColumn",this.getColumn(e),this.getColumn(t))})}toggleFilter(e){if(!this.options.inlineFilters)return;let t;e===void 0?t=!this.isFilterShown:t=e,t?V.style(this.$filterRow,{display:""}):V.style(this.$filterRow,{display:"none"}),this.isFilterShown=t,this.style.setBodyStyle()}focusFilter(e){if(!this.isFilterShown)return;V(`.dt-cell--col-${e} .dt-filter`,this.$filterRow).focus()}bindFilter(){if(!this.options.inlineFilters)return;let e=t=>{this.applyFilter(this.getAppliedFilters())};V.on(this.header,"keydown",".dt-filter",xT(e,300))}applyFilter(e){this.datamanager.filterRows(e).then(({rowsToShow:t})=>{this.rowmanager.showRows(t)})}getAppliedFilters(){let e={};return V.each(".dt-filter",this.header).map(t=>{let r=t.value;r&&(e[t.dataset.colIndex]=r)}),e}applyDefaultSortOrder(){let e=this.getColumns().filter(t=>t.sortOrder!=="none");if(e.length===1){let t=e[0];this.sortColumn(t.colIndex,t.sortOrder)}}sortRows(e,t){return this.datamanager.sortRows(e,t)}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}setColumnWidth(e,t){e=+e;let r=t||this.getColumn(e).width,s=[`.dt-cell__content--col-${e}`,`.dt-cell__edit--col-${e}`].join(", "),n={width:r+"px"};this.style.setStyle(s,n)}setColumnHeaderWidth(e){e=+e,this.$columnMap=this.$columnMap||[];let t=`.dt-cell__content--header-${e}`,{width:r}=this.getColumn(e),s=this.$columnMap[e];s||(s=this.header.querySelector(t),this.$columnMap[e]=s),s.style.width=r+"px"}getColumnMinWidth(e){return e=+e,this.getColumn(e).minWidth||24}getFirstColumnIndex(){return this.datamanager.getColumnIndexById("_rowIndex")+1}getHeaderCell$(e){return V(`.dt-cell--header-${e}`,this.header)}getLastColumnIndex(){return this.datamanager.getColumnCount()-1}getDropdownHTML(){let{dropdownButton:e}=this.options;return`
            <div class="dt-dropdown">
                <div class="dt-dropdown__toggle">${e}</div>
            </div>
      `}getDropdownListHTML(){let{headerDropdown:e}=this.options;return`
            <div class="dt-dropdown__list">
            ${e.map((t,r)=>`
                <div class="dt-dropdown__list-item" data-index="${r}">${t.label}</div>
            `).join("")}
            </div>
        `}},Dl=class{constructor(e){this.instance=e,lo(this,this.instance,["options","fireEvent","wrapper","bodyScrollable","bodyRenderer","style"]),this.bindEvents(),this.refreshRows=Gs(this.refreshRows,this)}get datamanager(){return this.instance.datamanager}get cellmanager(){return this.instance.cellmanager}bindEvents(){this.bindCheckbox()}bindCheckbox(){!this.options.checkboxColumn||(this.checkMap=[],V.on(this.wrapper,"click",'.dt-cell--col-0 [type="checkbox"]',(e,t)=>{let r=t.closest(".dt-cell"),{rowIndex:s,isHeader:n}=V.data(r),o=t.checked;n?this.checkAll(o):this.checkRow(s,o)}))}refreshRows(){this.instance.renderBody(),this.instance.setDimensions()}refreshRow(e,t){this.datamanager.updateRow(e,t).forEach(s=>{this.cellmanager.refreshCell(s,!0)})}getCheckedRows(){if(!this.checkMap)return[];let e=[];for(let t in this.checkMap)this.checkMap[t]===1&&e.push(t);return e}highlightCheckedRows(){this.getCheckedRows().map(e=>this.checkRow(e,!0))}checkRow(e,t){let r=t?1:0,s=n=>`.dt-cell--0-${n} [type="checkbox"]`;this.checkMap[e]=r,V.each(s(e),this.bodyScrollable).map(n=>{n.checked=t}),this.highlightRow(e,t),this.showCheckStatus(),this.fireEvent("onCheckRow",this.datamanager.getRow(e))}checkAll(e){let t=e?1:0;e?this.datamanager._filteredRows?this.datamanager._filteredRows.forEach(r=>{this.checkRow(r,e)}):this.checkMap=Array.from(Array(this.getTotalRows())).map(r=>t):this.checkMap=[],V.each('.dt-cell--col-0 [type="checkbox"]',this.bodyScrollable).map(r=>{r.checked=e}),this.highlightAll(e),this.showCheckStatus(),this.fireEvent("onCheckRow")}showCheckStatus(){if(!this.options.checkedRowStatus)return;let t=this.getCheckedRows().length;if(t>0){let r=this.instance.translate("{count} rows selected",{count:t});this.bodyRenderer.showToastMessage(r)}else this.bodyRenderer.clearToastMessage()}highlightRow(e,t=!0){let r=this.getRow$(e);if(!!r){if(!t&&this.bodyScrollable.classList.contains("dt-scrollable--highlight-all")){r.classList.add("dt-row--unhighlight");return}t&&r.classList.contains("dt-row--unhighlight")&&r.classList.remove("dt-row--unhighlight"),this._highlightedRows=this._highlightedRows||{},t?(r.classList.add("dt-row--highlight"),this._highlightedRows[e]=r):(r.classList.remove("dt-row--highlight"),delete this._highlightedRows[e])}}highlightAll(e=!0){if(e)this.bodyScrollable.classList.add("dt-scrollable--highlight-all");else{this.bodyScrollable.classList.remove("dt-scrollable--highlight-all");for(let t in this._highlightedRows)this._highlightedRows[t].classList.remove("dt-row--highlight");this._highlightedRows={}}}showRows(e){e=TT(e);let t=e.map(r=>this.datamanager.getRow(r));this.bodyRenderer.renderRows(t)}showAllRows(){let e=this.datamanager.getAllRowIndices();this.showRows(e)}getChildrenToShowForNode(e){let t=this.datamanager.getRow(e);return t.meta.isTreeNodeClose=!1,this.datamanager.getImmediateChildren(e)}openSingleNode(e){let t=this.getChildrenToShowForNode(e),r=this.bodyRenderer.visibleRowIndices,s=m_([...t,...r]).sort(Ys);this.showRows(s)}getChildrenToHideForNode(e){let t=this.datamanager.getRow(e);t.meta.isTreeNodeClose=!0;let r=this.datamanager.getChildren(e);return r.forEach(s=>{let n=this.datamanager.getRow(s);n.meta.isLeaf||(n.meta.isTreeNodeClose=!0)}),r}closeSingleNode(e){let t=this.getChildrenToHideForNode(e),s=this.bodyRenderer.visibleRowIndices.filter(n=>!t.includes(n)).sort(Ys);this.showRows(s)}expandAllNodes(){let r=this.datamanager.getRows().filter(o=>!o.meta.isLeaf).map(o=>this.getChildrenToShowForNode(o.meta.rowIndex)).flat(),s=this.bodyRenderer.visibleRowIndices,n=m_([...r,...s]).sort(Ys);this.showRows(n)}collapseAllNodes(){let r=this.datamanager.getRows().filter(o=>o.meta.indent===0).map(o=>this.getChildrenToHideForNode(o.meta.rowIndex)).flat(),n=this.bodyRenderer.visibleRowIndices.filter(o=>!r.includes(o)).sort(Ys);this.showRows(n)}setTreeDepth(e){let t=this.datamanager.getRows(),r=t.filter(a=>a.meta.indent<e),s=t.filter(a=>a.meta.indent>=e),n=s.filter(a=>a.meta.indent>e);s.forEach(a=>{a.meta.isLeaf||(a.meta.isTreeNodeClose=!0)}),r.forEach(a=>{a.meta.isLeaf||(a.meta.isTreeNodeClose=!1)});let o=t.filter(a=>!n.includes(a)).map(a=>a.meta.rowIndex).sort(Ys);this.showRows(o)}getRow$(e){return V(this.selector(e),this.bodyScrollable)}getTotalRows(){return this.datamanager.getRowCount()}getFirstRowIndex(){return 0}getLastRowIndex(){return this.datamanager.getRowCount()-1}scrollToRow(e){e=+e,this._lastScrollTo=this._lastScrollTo||0;let t=this.getRow$(e);if(V.inViewport(t,this.bodyScrollable))return;let{height:r}=t.getBoundingClientRect(),{top:s,bottom:n}=this.bodyScrollable.getBoundingClientRect(),o=Math.floor((n-s)/r),a=0;e>this._lastScrollTo?a=r*(e+1-o):a=r*(e+1-1),this._lastScrollTo=e,V.scrollTop(this.bodyScrollable,a)}getRowHTML(e,t){let r=Il(t),s=t.rowIndex;return t.isFilter&&(e=e.map(n=>Object.assign({},n,{content:this.getFilterInput({colIndex:n.colIndex,name:n.name}),isFilter:1,isHeader:void 0,editable:!1})),s="filter"),t.isHeader&&(s="header"),`
            <div class="dt-row dt-row-${s}" ${r}>
                ${e.map(n=>this.cellmanager.getCellHTML(n)).join("")}
            </div>
        `}getFilterInput(e){let t=`title="Filter based on ${e.name||"Index"}"`;return`<input class="dt-filter dt-input" type="text" ${Il(e)} tabindex="1"
            ${e.colIndex===0?"disabled":t} />`}selector(e){return`.dt-row-${e}`}},OT=Hx(function(i,e){(function(t){i.exports=t()})(function(){return function t(r,s,n){function o(c,u){if(!s[c]){if(!r[c]){var p=typeof ro=="function"&&ro;if(!u&&p)return p(c,!0);if(a)return a(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var w=s[c]={exports:{}};r[c][0].call(w.exports,function(x){var A=r[c][1][x];return o(A||x)},w,w.exports,t,r,s,n)}return s[c].exports}for(var a=typeof ro=="function"&&ro,l=0;l<n.length;l++)o(n[l]);return o}({1:[function(t,r,s){Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function u(p,m){for(var w=0;w<m.length;w++){var x=m[w];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(p,x.key,x)}}return function(p,m,w){return m&&u(p.prototype,m),w&&u(p,w),p}}();function o(u,p){if(!(u instanceof p))throw new TypeError("Cannot call a class as a function")}var a={width:"100%",height:"100%"},l=function(p){return Number(p)===Number(p)},c=function(){n(u,null,[{key:"create",value:function(m,w){return new u(m,w)}},{key:"mergeStyle",value:function(m,w){for(var x in w)m.style[x]!==w[x]&&(m.style[x]=w[x])}},{key:"getMaxBrowserHeight",value:function(){var m=document.createElement("div"),w=document.createElement("div");u.mergeStyle(m,{position:"absolute",height:"1px",opacity:0}),u.mergeStyle(w,{height:"1e7px"}),m.appendChild(w),document.body.appendChild(m);var x=w.offsetHeight;return document.body.removeChild(m),x}}]);function u(p,m){var w=this;o(this,u),this._config={},this._lastRepaint=null,this._maxElementHeight=u.getMaxBrowserHeight(),this.refresh(p,m);var x=this._config,A=function D(){var j=w._getScrollPosition(),ee=w._lastRepaint;if(w._renderAnimationFrame=window.requestAnimationFrame(D),j!==ee&&(!ee||Math.abs(j-ee)>w._averageHeight)){var d=w._renderChunk();w._lastRepaint=j,d!==!1&&typeof x.afterRender=="function"&&x.afterRender()}};A()}return n(u,[{key:"destroy",value:function(){window.cancelAnimationFrame(this._renderAnimationFrame)}},{key:"refresh",value:function(m,w){var x=this;if(Object.assign(this._config,a,w),!m||m.nodeType!==1)throw new Error("HyperList requires a valid DOM Node container");this._element=m;var A=this._config,D=this._scroller||A.scroller||document.createElement(A.scrollerTagName||"tr");if(typeof A.useFragment!="boolean"&&(this._config.useFragment=!0),!A.generate)throw new Error("Missing required `generate` function");if(!l(A.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(A.itemHeight)&&!l(A.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());l(A.itemHeight)?this._itemHeights=Array(A.total).fill(A.itemHeight):this._itemHeights=A.itemHeight,Object.keys(a).filter(function(_){return _ in A}).forEach(function(_){var y=A[_],O=l(y),E=O?!1:y.slice(-1)==="%";if(y&&typeof y!="string"&&typeof y!="number"){var k="Invalid optional `"+_+"`, expected string or number";throw new Error(k)}else O&&(A[_]=y+"px");if(_==="height"){var M=O?y:parseInt(y.replace(/px|%/,""),10);E?x._containerHeight=window.innerHeight*M/100:x._containerHeight=l(y)?y:M}});var j={width:""+A.width,height:""+A.height,overflow:"auto",position:"relative"};u.mergeStyle(m,j);var ee=A.itemHeight*A.total,d=this._maxElementHeight;ee>d&&console.warn(["HyperList: The maximum element height",d+"px has","been exceeded; please reduce your item height."].join(" "));var g={opacity:"0",position:"absolute",width:"1px",height:ee+"px"};u.mergeStyle(D,g),this._scroller||m.appendChild(D),this._scroller=D,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(A.total).fill(0),this._computePositions(0),this._renderChunk(this._lastRepaint!==null),typeof A.afterRender=="function"&&A.afterRender()}},{key:"_getRow",value:function(m){var w=this._config,x=w.generate(m),A=x.height;if(A!==void 0&&l(A)?(x=x.element,A!==this._itemHeights&&(this._itemHeights[m]=A,this._computePositions(m),this._scrollHeight=this._computeScrollHeight(m))):A=this._itemHeights[m],!x||x.nodeType!==1)throw new Error("Generator did not return a DOM Node for index: "+m);var D=x.getAttribute("class")||"";x.setAttribute("class",D+" "+(w.rowClassName||"vrow"));var j=this._itemPositions[m];return u.mergeStyle(x,{position:"absolute",top:j+"px"}),x}},{key:"_getScrollPosition",value:function(){var m=this._config;return typeof m.overrideScrollPosition=="function"?m.overrideScrollPosition():this._element.scrollTop}},{key:"_renderChunk",value:function(m){var w=this._config,x=this._element,A=this._getScrollPosition(),D=w.total,j=w.reverse?this._getReverseFrom(A):this._getFrom(A)-1;if((j<0||j-this._screenItemsLen<0)&&(j=0),!m&&this._lastFrom===j)return!1;this._lastFrom=j;var ee=j+this._cachedItemsLen;(ee>D||ee+this._cachedItemsLen>D)&&(ee=D);var d=w.useFragment?document.createDocumentFragment():[],g=this._scroller;d[w.useFragment?"appendChild":"push"](g);for(var _=j;_<ee;_++){var y=this._getRow(_);d[w.useFragment?"appendChild":"push"](y)}if(w.applyPatch)return w.applyPatch(x,d);x.innerHTML="",x.appendChild(d)}},{key:"_computePositions",value:function(){var m=arguments.length<=0||arguments[0]===void 0?1:arguments[0],w=this._config,x=w.total,A=w.reverse;m<1&&!A&&(m=1);for(var D=m;D<x;D++)A?D===0?this._itemPositions[0]=this._scrollHeight-this._itemHeights[0]:this._itemPositions[D]=this._itemPositions[D-1]-this._itemHeights[D]:this._itemPositions[D]=this._itemHeights[D-1]+this._itemPositions[D-1]}},{key:"_computeScrollHeight",value:function(){var m=this,w=this._config,x=w.total,A=this._itemHeights.reduce(function(g,_){return g+_},0);u.mergeStyle(this._scroller,{opacity:0,position:"absolute",width:"1px",height:A+"px"});var D=this._itemHeights.slice(0).sort(function(g,_){return g-_}),j=Math.floor(x/2),ee=x%2===0?(D[j]+D[j-1])/2:D[j],d=this._element.clientHeight?this._element.clientHeight:this._containerHeight;return this._screenItemsLen=Math.ceil(d/ee),this._containerHeight=d,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,this._screenItemsLen*3),this._averageHeight=ee,w.reverse&&window.requestAnimationFrame(function(){m._element.scrollTop=A}),A}},{key:"_getFrom",value:function(m){for(var w=0;this._itemPositions[w]<m;)w++;return w}},{key:"_getReverseFrom",value:function(m){for(var w=this._config.total-1;w>0&&this._itemPositions[w]<m+this._containerHeight;)w--;return w}}]),u}();s.default=c,r.exports=s.default},{}]},{},[1])(1)})}),AT=Fx(OT),Pl=class{constructor(e){this.instance=e,this.options=e.options,this.datamanager=e.datamanager,this.rowmanager=e.rowmanager,this.cellmanager=e.cellmanager,this.bodyScrollable=e.bodyScrollable,this.footer=this.instance.footer,this.log=e.log}renderRows(e){if(this.visibleRows=e,this.visibleRowIndices=e.map(o=>o.meta.rowIndex),e.length===0){this.bodyScrollable.innerHTML=this.getNoDataHTML(),this.footer.innerHTML="";return}let t=new Set(this.visibleRowIndices),r=this.datamanager.rowViewOrder.map(o=>t.has(o)?o:null).filter(o=>o!==null),s=getComputedStyle(this.bodyScrollable),n={width:s.width,height:s.height,itemHeight:this.options.cellHeight,total:e.length,generate:o=>{let a=document.createElement("div"),l=r[o],c=this.datamanager.getRow(l),u=this.rowmanager.getRowHTML(c,c.meta);return a.innerHTML=u,a.children[0]},afterRender:()=>{this.restoreState()}};this.hyperlist?this.hyperlist.refresh(this.bodyScrollable,n):this.hyperlist=new AT(this.bodyScrollable,n),this.renderFooter()}render(){let e=this.datamanager.getRowsForView();this.renderRows(e),this.instance.setDimensions()}renderFooter(){if(!this.options.showTotalRow)return;let e=this.getTotalRow(),t=this.rowmanager.getRowHTML(e,{isTotalRow:1,rowIndex:"totalRow"});this.footer.innerHTML=t}getTotalRow(){return this.datamanager.getColumns().map(s=>{let n=null;return["_rowIndex","_checkbox"].includes(s.id)&&(n=""),{content:n,isTotalRow:1,colIndex:s.colIndex,column:s}}).map((s,n)=>{if(s.content==="")return s;if(this.options.hooks.columnTotal){let o=this.visibleRows.map(l=>l[n].content),a=this.options.hooks.columnTotal.call(this.instance,o,s);if(a!=null)return s.content=a,s}return s.content=this.visibleRows.reduce((o,a)=>{let l=a[n];return typeof l.content=="number"?(o==null&&(o=0),o+l.content):o},s.content),s})}restoreState(){this.rowmanager.highlightCheckedRows(),this.cellmanager.selectAreaOnClusterChanged(),this.cellmanager.focusCellOnClusterChanged()}showToastMessage(e,t){this.instance.toastMessage.innerHTML=this.getToastMessageHTML(e),t&&setTimeout(()=>{this.clearToastMessage()},t*1e3)}clearToastMessage(){this.instance.toastMessage.innerHTML=""}getNoDataHTML(){return`<div class="dt-scrollable__no-data">${this.options.noDataMessage}</div>`}getToastMessageHTML(e){return`<span class="dt-toast__message">${e}</span>`}},jl=class{constructor(e){this.instance=e,lo(this,this.instance,["options","datamanager","columnmanager","header","footer","bodyScrollable","datatableWrapper","getColumn","bodyRenderer"]),this.scopeClass="dt-instance-"+e.constructor.instances,e.datatableWrapper.classList.add(this.scopeClass);let t=document.createElement("style");e.wrapper.insertBefore(t,e.datatableWrapper),this.styleEl=t,this.bindResizeWindow(),this.bindScrollHeader()}get stylesheet(){return this.styleEl.sheet}bindResizeWindow(){this.onWindowResize=this.onWindowResize.bind(this),this.onWindowResize=x_(this.onWindowResize,300),this.options.layout==="fluid"&&V.on(window,"resize",this.onWindowResize)}bindScrollHeader(){this._settingHeaderPosition=!1,V.on(this.bodyScrollable,"scroll",e=>{this._settingHeaderPosition||(this._settingHeaderPosition=!0,requestAnimationFrame(()=>{let t=e.target.scrollLeft,r=this.header.querySelectorAll(".dt-cell:not(.dt-sticky-col)"),s=this.footer.querySelectorAll(".dt-cell:not(.dt-sticky-col)");r.forEach(o=>{V.style(o,{transform:`translateX(${-t}px)`})}),s.forEach(o=>{V.style(o,{transform:`translateX(${-t}px)`})}),this.header.querySelectorAll(".dt-cell.dt-sticky-col:not(.dt-cell-serial-no):not(.dt-cell-checkbox)").forEach(o=>{let a=o.getAttribute("data-col-index"),l=this.bodyScrollable.querySelector(`.dt-cell[data-col-index="${a}"]`),c=parseFloat(o.style.left)||0,u=this.footer.querySelector(`.dt-cell[data-col-index="${a}"]`);~~(l.offsetLeft-t)>c?(o.style.transform=`translateX(${-t-1}px)`,u&&(u.style.transform=`translateX(${t?-t-1:0}px)`)):(o.style.transform=`translateX(${c-o.offsetLeft}px)`,u&&(u.style.transform=`translateX(${c-u.offsetLeft}px)`))}),this._settingHeaderPosition=!1}))})}onWindowResize(){this.distributeRemainingWidth(),this.refreshColumnWidth(),this.setBodyStyle()}destroy(){this.styleEl.remove(),V.off(window,"resize",this.onWindowResize)}setStyle(e,t){if(e.includes(",")){e.split(",").map(o=>o.trim()).forEach(o=>{this.setStyle(o,t)});return}if(e=e.trim(),!e)return;this._styleRulesMap=this._styleRulesMap||{};let r=this._getPrefixedSelector(e);this._styleRulesMap[r]&&(this.removeStyle(e),t=Object.assign({},this._styleRulesMap[r],t));let s=this._getRuleString(t),n=`${r} { ${s} }`;this._styleRulesMap[r]=t,this.stylesheet.insertRule(n)}removeStyle(e){if(e.includes(",")){e.split(",").map(s=>s.trim()).forEach(s=>{this.removeStyle(s)});return}if(e=e.trim(),!e)return;let t=this._getPrefixedSelector(e),r=Array.from(this.stylesheet.cssRules).findIndex(s=>s.selectorText===t);r!==-1&&this.stylesheet.deleteRule(r)}_getPrefixedSelector(e){return`.${this.scopeClass} ${e}`}_getRuleString(e){return Object.keys(e).map(t=>{let r=t;return t.includes("-")||(r=k_(t)),`${r}:${e[t]};`}).join("")}setDimensions(){this.setCellHeight(),this.setupMinWidth(),this.setupNaturalColumnWidth(),this.setupColumnWidth(),this.distributeRemainingWidth(),this.setColumnStyle(),this.setBodyStyle()}setCellHeight(){this.setStyle(".dt-cell",{height:this.options.cellHeight+"px"})}setupMinWidth(){V.each(".dt-cell--header",this.header).map(e=>{let{colIndex:t}=V.data(e),r=this.getColumn(t);if(!r.minWidth){let s=V.style(V(".dt-cell__content",e),"width");r.minWidth=s}})}setupNaturalColumnWidth(){!V(".dt-row")||(V.each(".dt-row-header .dt-cell",this.header).map(e=>{let{colIndex:t}=V.data(e),r=this.datamanager.getColumn(t),s=V.style(V(".dt-cell__content",e),"width");typeof s=="number"&&s>=this.options.minimumColumnWidth?r.naturalWidth=s:r.naturalWidth=this.options.minimumColumnWidth}),V.each(".dt-row-0 .dt-cell",this.bodyScrollable).map(e=>{let{colIndex:t}=V.data(e),r=this.datamanager.getColumn(t),s=V.style(V(".dt-cell__content",e),"width");typeof s=="number"&&s>=r.naturalWidth?r.naturalWidth=s:r.naturalWidth=r.naturalWidth}))}setupColumnWidth(){if(this.options.layout==="ratio"){let e=V.style(this.datatableWrapper,"width");if(this.options.serialNoColumn){let s=this.datamanager.getColumnById("_rowIndex");e=e-s.width-1}if(this.options.checkboxColumn){let s=this.datamanager.getColumnById("_checkbox");e=e-s.width-1}let t=this.datamanager.getColumns().map(s=>s.id==="_rowIndex"||s.id==="_checkbox"?0:(s.width||(s.width=1),s.ratioWidth=parseInt(s.width,10),s.ratioWidth)).reduce((s,n)=>s+n),r=e/t;this.datamanager.getColumns().map(s=>{s.id==="_rowIndex"||s.id==="_checkbox"||(s.width=Math.floor(r*s.ratioWidth)-1)})}else this.datamanager.getColumns().map(e=>{e.width||(e.width=e.naturalWidth),e.id==="_rowIndex"&&(e.width=this.getRowIndexColumnWidth()),e.width<this.options.minimumColumnWidth&&(e.width=this.options.minimumColumnWidth)})}distributeRemainingWidth(){if(this.options.layout!=="fluid")return;let e=V.style(this.instance.datatableWrapper,"width"),t=V(".dt-row",this.bodyScrollable),r=e;if(t)r=V.style(t,"width");else{let o=V(".dt-row",this.instance.header);r=Array.from(o.children).map(l=>l.offsetWidth).reduce((l,c)=>l+c,0)}let s=this.datamanager.getColumns().filter(o=>o.resizable),n=(e-r)/s.length;s.map(o=>{let a=V.style(this.getColumnHeaderElement(o.colIndex),"width"),l=Math.floor(a+n)-2;this.datamanager.updateColumn(o.colIndex,{width:l})})}setColumnStyle(){this.datamanager.getColumns().map(e=>{e.align||(e.align="left"),["left","center","right"].includes(e.align)||(e.align="left"),this.setStyle(`.dt-cell--col-${e.colIndex}`,{"text-align":e.align}),this.columnmanager.setColumnHeaderWidth(e.colIndex),this.columnmanager.setColumnWidth(e.colIndex)})}refreshColumnWidth(){this.datamanager.getColumns().map(e=>{this.columnmanager.setColumnHeaderWidth(e.colIndex),this.columnmanager.setColumnWidth(e.colIndex)})}setBodyStyle(){let e=V.style(this.datatableWrapper,"width"),t=V(".dt-row",this.bodyScrollable);if(!t)return;let r=V.style(t,"width"),s=e>r?r+10:e;V.style(this.bodyScrollable,{width:s+"px"}),V.removeStyle(this.bodyScrollable,"height");let n=V.getStyle(this.bodyScrollable,"height"),o=(this.bodyRenderer.hyperlist||{})._scrollHeight||1/0,a=V.hasHorizontalOverflow(this.bodyScrollable),l;o<n&&(l=o,a&&(l+=V.scrollbarSize()),V.style(this.bodyScrollable,{height:l+"px"})),this.bodyScrollable.scrollHeight-this.bodyScrollable.offsetHeight<V.scrollbarSize()&&V.style(this.bodyScrollable,{overflowY:"hidden"}),this.options.layout==="fluid"&&V.style(this.bodyScrollable,{overflowX:"hidden"})}getColumnHeaderElement(e){return e=+e,e<0?null:V(`.dt-cell--col-${e}`,this.header)}getRowIndexColumnWidth(){let e=this.datamanager.getRowCount(),t=22;return V.measureTextWidth(e+"")+t}},LT={13:"enter",91:"meta",16:"shift",17:"ctrl",18:"alt",37:"left",38:"up",39:"right",40:"down",9:"tab",27:"esc",67:"c",70:"f",86:"v"},zl=class{constructor(e){this.listeners={},V.on(e,"keydown",this.handler.bind(this))}handler(e){let t=LT[e.keyCode];e.shiftKey&&t!=="shift"&&(t="shift+"+t),(e.ctrlKey&&t!=="ctrl"||e.metaKey&&t!=="meta")&&(t="ctrl+"+t);let r=this.listeners[t];if(r&&r.length>0)for(let s of r){let n=s(e);(n===void 0||n===!0)&&e.preventDefault()}}on(e,t){e.split(",").map(s=>s.trim()).map(s=>{this.listeners[s]=this.listeners[s]||[],this.listeners[s].push(t)})}},BT={"Sort Ascending":"Sort Ascending","Sort Descending":"Sort Descending","Reset sorting":"Reset sorting","Remove column":"Remove column","No Data":"No Data","{count} cells copied":{1:"{count} cell copied",default:"{count} cells copied"},"{count} rows selected":{1:"{count} row selected",default:"{count} rows selected"}},IT={"Sort Ascending":"Aufsteigend sortieren","Sort Descending":"Absteigend sortieren","Reset sorting":"Sortierung zur\xFCcksetzen","Remove column":"Spalte entfernen","No Data":"Keine Daten","{count} cells copied":{1:"{count} Zelle kopiert",default:"{count} Zellen kopiert"},"{count} rows selected":{1:"{count} Zeile ausgew\xE4hlt",default:"{count} Zeilen ausgew\xE4hlt"}},MT={"Sort Ascending":"Trier par ordre croissant","Sort Descending":"Trier par ordre d\xE9croissant","Reset sorting":"R\xE9initialiser le tri","Remove column":"Supprimer colonne","No Data":"Pas de donn\xE9es","{count} cells copied":{1:"{count} cellule copi\xE9e",default:"{count} cellules copi\xE9es"},"{count} rows selected":{1:"{count} ligne s\xE9lectionn\xE9e",default:"{count} lignes s\xE9lectionn\xE9es"}},NT={"Sort Ascending":"Ordinamento ascendente","Sort Descending":"Ordinamento decrescente","Reset sorting":"Azzeramento ordinamento","Remove column":"Rimuovi colonna","No Data":"Nessun dato","{count} cells copied":{1:"Copiato {count} cella",default:"{count} celle copiate"},"{count} rows selected":{1:"{count} linea selezionata",default:"{count} linee selezionate"}};function RT(){return{en:BT,de:IT,fr:MT,it:NT}}var Fl=class{constructor(e){this.language=e,this.translations=RT()}addTranslations(e){this.translations=Object.assign(this.translations,e)}translate(e,t){let r=this.translations[this.language]&&this.translations[this.language][e]||e;return typeof r=="object"&&(r=t&&t.count?this.getPluralizedTranslation(r,t.count):e),ET(r,t||{})}getPluralizedTranslation(e,t){return e[t]||e.default}};function DT(i,e,t){let r=[];if(Object.keys(e).length===0)return i.map(s=>s.meta.rowIndex);for(let s in e){let n=e[s],a=(r.length?r.map(u=>i[u]):i).map(u=>u[s]),l=jT(n),c=PT(i,t,l);c?r=c(l.text,a):r=a.map(u=>u.rowIndex)}return r}function PT(i,e,t){let r=l=>{let c=wr.getCustomCellFormatter(l),u=i[l.rowIndex];return e&&e.data&&e.data.length&&(u=e.data[l.rowIndex]),c&&l.content?(l.html=c(l.content,i[l.rowIndex],l.column,u,t),g_(l.html)):l.content||""},s=l=>String(g_(l.html||"")||r(l)).toLowerCase(),n=l=>parseFloat(l.content),o=(l,c)=>{if(l.column.compareValue){let p=l.column.compareValue(l,c);if(p&&Array.isArray(p))return p}let u=n(l);return isNaN(u)?[s(l),c]:[u,c]};return{contains(l,c){return c.filter(u=>{let p=(l||"").toLowerCase();return!p||(u.content||"").toLowerCase().includes(p)||s(u).includes(p)}).map(u=>u.rowIndex)},greaterThan(l,c){return c.filter(u=>{let[p,m]=o(u,l);return p>m}).map(u=>u.rowIndex)},lessThan(l,c){return c.filter(u=>{let[p,m]=o(u,l);return p<m}).map(u=>u.rowIndex)},equals(l,c){return c.filter(u=>parseFloat(u.content)===l).map(u=>u.rowIndex)},notEquals(l,c){return c.filter(u=>parseFloat(u.content)!==l).map(u=>u.rowIndex)},range(l,c){return c.filter(u=>{let p=o(u,l[0]),m=o(u,l[1]),w=p[0];return w>=p[1]&&w<=m[1]}).map(u=>u.rowIndex)},containsNumber(l,c){return c.filter(u=>{let p=parseFloat(l,10),m=l,w=n(u),x=s(u);return p===w||x.includes(m)}).map(u=>u.rowIndex)}}[t.type]}function jT(i=""){if(i.length===0)return{};let e=i;return[">","<","="].includes(e[0])?e=i.slice(1):e.startsWith("!=")&&(e=i.slice(2)),i.startsWith(">")&&e?{type:"greaterThan",text:e.trim()}:i.startsWith("<")&&e?{type:"lessThan",text:e.trim()}:i.startsWith("=")&&Ks(e)?{type:"equals",text:Number(i.slice(1).trim())}:Ks(e)?{type:"containsNumber",text:e}:i.startsWith("!=")&&Ks(e)?{type:"notEquals",text:Number(i.slice(2).trim())}:i.split(":").length===2&&i.split(":").every(t=>Ks(t.trim()))?(e=i.split(":"),{type:"range",text:e.map(t=>t.trim())}):{type:"contains",text:e.toLowerCase()}}function zT(i){return{columns:[],data:[],dropdownButton:Nl.chevronDown,headerDropdown:[{label:i.translate("Sort Ascending"),action:function(e){this.sortColumn(e.colIndex,"asc")}},{label:i.translate("Sort Descending"),action:function(e){this.sortColumn(e.colIndex,"desc")}},{label:i.translate("Reset sorting"),action:function(e){this.sortColumn(e.colIndex,"none")}},{label:i.translate("Remove column"),action:function(e){this.removeColumn(e.colIndex)}}],events:{onRemoveColumn(e){},onSwitchColumn(e,t){},onSortColumn(e){},onCheckRow(e){},onDestroy(){}},hooks:{columnTotal:null},sortIndicator:{asc:"\u2191",desc:"\u2193",none:""},overrideComponents:{},filterRows:DT,freezeMessage:"",getEditor:null,serialNoColumn:!0,checkboxColumn:!1,clusterize:!0,logs:!1,layout:"fixed",noDataMessage:i.translate("No Data"),cellHeight:40,minimumColumnWidth:30,inlineFilters:!1,treeView:!1,checkedRowStatus:!0,dynamicRowHeight:!1,pasteFromClipboard:!1,showTotalRow:!1,direction:"ltr",disableReorderColumn:!1}}var FT={DataManager:Ml,CellManager:wr,ColumnManager:Rl,RowManager:Dl,BodyRenderer:Pl,Style:jl,Keyboard:zl},Pi=class{constructor(e,t){if(Pi.instances++,typeof e=="string"&&(e=document.querySelector(e)),this.wrapper=e,!(this.wrapper instanceof HTMLElement))throw new Error("Invalid argument given for `wrapper`");this.initializeTranslations(t),this.setDefaultOptions(),this.buildOptions(t),this.prepare(),this.initializeComponents(),this.options.data&&(this.refresh(),this.columnmanager.applyDefaultSortOrder())}initializeTranslations(e){this.language=e.language||"en",this.translationManager=new Fl(this.language),e.translations&&this.translationManager.addTranslations(e.translations)}setDefaultOptions(){this.DEFAULT_OPTIONS=zT(this)}buildOptions(e){this.options=this.options||{},this.options=Object.assign({},this.DEFAULT_OPTIONS,this.options||{},e),e.headerDropdown=e.headerDropdown||[],this.options.headerDropdown=[...this.DEFAULT_OPTIONS.headerDropdown,...e.headerDropdown],this.events=Object.assign({},this.DEFAULT_OPTIONS.events,this.options.events||{},e.events||{}),this.fireEvent=this.fireEvent.bind(this)}prepare(){this.prepareDom(),this.unfreeze()}initializeComponents(){let e=Object.assign({},FT,this.options.overrideComponents),{Style:t,Keyboard:r,DataManager:s,RowManager:n,ColumnManager:o,CellManager:a,BodyRenderer:l}=e;this.style=new t(this),this.keyboard=new r(this.wrapper),this.datamanager=new s(this.options),this.rowmanager=new n(this),this.columnmanager=new o(this),this.cellmanager=new a(this),this.bodyRenderer=new l(this)}prepareDom(){this.wrapper.innerHTML=`
            <div class="datatable" dir="${this.options.direction}">
                <div class="datatable-content">
                    <div class="dt-header"></div>
                    <div class="dt-scrollable"></div>
                    <div class="dt-footer"></div>
                </div>
                <div class="dt-freeze">
                    <span class="dt-freeze__message">
                        ${this.options.freezeMessage}
                    </span>
                </div>
                <div class="dt-toast"></div>
                <div class="dt-dropdown-container"></div>
                <textarea class="dt-paste-target"></textarea>
            </div>
        `,this.datatableWrapper=V(".datatable",this.wrapper),this.header=V(".dt-header",this.wrapper),this.footer=V(".dt-footer",this.wrapper),this.bodyScrollable=V(".dt-scrollable",this.wrapper),this.freezeContainer=V(".dt-freeze",this.wrapper),this.toastMessage=V(".dt-toast",this.wrapper),this.pasteTarget=V(".dt-paste-target",this.wrapper),this.dropdownContainer=V(".dt-dropdown-container",this.wrapper)}refresh(e,t){this.datamanager.init(e,t),this.render(),this.setDimensions()}destroy(){this.wrapper.innerHTML="",this.style.destroy(),this.fireEvent("onDestroy")}appendRows(e){this.datamanager.appendRows(e),this.rowmanager.refreshRows()}refreshRow(e,t){this.rowmanager.refreshRow(e,t)}render(){this.renderHeader(),this.renderBody()}renderHeader(){this.columnmanager.renderHeader()}renderBody(){this.bodyRenderer.render()}setDimensions(){this.style.setDimensions()}showToastMessage(e,t){this.bodyRenderer.showToastMessage(e,t)}clearToastMessage(){this.bodyRenderer.clearToastMessage()}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}getRows(){return this.datamanager.getRows()}getCell(e,t){return this.datamanager.getCell(e,t)}getColumnHeaderElement(e){return this.columnmanager.getColumnHeaderElement(e)}getViewportHeight(){return this.viewportHeight||(this.viewportHeight=V.style(this.bodyScrollable,"height")),this.viewportHeight}sortColumn(e,t){this.columnmanager.sortColumn(e,t)}removeColumn(e){this.columnmanager.removeColumn(e)}scrollToLastColumn(){this.datatableWrapper.scrollLeft=9999}freeze(){V.style(this.freezeContainer,{display:""})}unfreeze(){V.style(this.freezeContainer,{display:"none"})}updateOptions(e){this.buildOptions(e)}fireEvent(e,...t){let r=[...this._internalEventHandlers[e]||[],this.events[e]].filter(Boolean);for(let s of r)s.apply(this,t)}on(e,t){this._internalEventHandlers=this._internalEventHandlers||{},this._internalEventHandlers[e]=this._internalEventHandlers[e]||[],this._internalEventHandlers[e].push(t)}log(){this.options.logs&&console.log.apply(console,arguments)}translate(e,t){return this.translationManager.translate(e,t)}};Pi.instances=0;var HT="frappe-datatable",qT="0.0.0-development",UT="A modern datatable library for the web",WT="dist/frappe-datatable.cjs.js",VT="dist/frappe-datatable.min.js",YT="dist/frappe-datatable.min.js",GT={start:"yarn run dev",build:"rollup -c && NODE_ENV=production rollup -c",dev:"rollup -c -w","cy:server":"http-server -p 8989","cy:open":"cypress open","cy:run":"cypress run",test:"start-server-and-test cy:server http://localhost:8989 cy:run","test-local":"start-server-and-test cy:server http://localhost:8989 cy:open","travis-deploy-once":"travis-deploy-once","semantic-release":"semantic-release",lint:"eslint src","lint-and-build":"yarn lint && yarn build",commit:"npx git-cz"},KT=["dist","src"],XT={autoprefixer:"^9.0.0",chai:"3.5.0",cypress:"^9.2.0","cz-conventional-changelog":"^2.1.0",deepmerge:"^2.0.1",eslint:"^5.0.1","eslint-config-airbnb":"^16.1.0","eslint-config-airbnb-base":"^12.1.0","eslint-plugin-import":"^2.11.0","http-server":"^0.11.1",mocha:"3.3.0","postcss-custom-properties":"^7.0.0","postcss-nested":"^3.0.0",rollup:"^0.59.4","rollup-plugin-commonjs":"^8.3.0","rollup-plugin-eslint":"^4.0.0","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.3","rollup-plugin-postcss":"^1.2.8","rollup-plugin-uglify-es":"^0.0.1","semantic-release":"^17.1.1","start-server-and-test":"^1.4.1","travis-deploy-once":"^5.0.1"},JT={type:"git",url:"https://github.com/frappe/datatable.git"},ZT=["datatable","data","grid","table"],QT="Faris Ansari",eE="MIT",tE={url:"https://github.com/frappe/datatable/issues"},iE="https://frappe.io/datatable",rE={hyperlist:"^1.0.0-beta",lodash:"^4.17.5",sortablejs:"^1.7.0"},sE={commitizen:{path:"cz-conventional-changelog"}},nE={name:HT,version:qT,description:UT,main:WT,unpkg:VT,jsdelivr:YT,scripts:GT,files:KT,devDependencies:XT,repository:JT,keywords:ZT,author:QT,license:eE,bugs:tE,homepage:iE,dependencies:rE,config:sE};Pi.__version__=nE.version;C_.exports=Pi});var E_=te((co,ql)=>{(function(i,e){typeof co=="object"&&typeof ql=="object"?ql.exports=e():typeof define=="function"&&define.amd?define([],e):typeof co=="object"?co.Driver=e():i.Driver=e()})(window,function(){return function(i){var e={};function t(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return i[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}return t.m=i,t.c=e,t.d=function(r,s,n){t.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:n})},t.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,s){if(1&s&&(r=t(r)),8&s||4&s&&typeof r=="object"&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&s&&typeof r!="string")for(var o in r)t.d(n,o,function(a){return r[a]}.bind(null,o));return n},t.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(s,"a",s),s},t.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},t.p="/dist/",t(t.s=57)}([function(i,e,t){var r=t(2),s=t(11),n=t(4),o=t(13),a=t(22),l=function(c,u,p){var m,w,x,A,D=c&l.F,j=c&l.G,ee=c&l.S,d=c&l.P,g=c&l.B,_=j?r:ee?r[u]||(r[u]={}):(r[u]||{}).prototype,y=j?s:s[u]||(s[u]={}),O=y.prototype||(y.prototype={});for(m in j&&(p=u),p)x=((w=!D&&_&&_[m]!==void 0)?_:p)[m],A=g&&w?a(x,r):d&&typeof x=="function"?a(Function.call,x):x,_&&o(_,m,x,c&l.U),y[m]!=x&&n(y,m,A),d&&O[m]!=x&&(O[m]=x)};r.core=s,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,i.exports=l},function(i,e,t){var r=t(17)("wks"),s=t(14),n=t(2).Symbol,o=typeof n=="function";(i.exports=function(a){return r[a]||(r[a]=o&&n[a]||(o?n:s)("Symbol."+a))}).store=r},function(i,e){var t=i.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=t)},function(i,e){i.exports=function(t){return typeof t=="object"?t!==null:typeof t=="function"}},function(i,e,t){var r=t(5),s=t(16);i.exports=t(6)?function(n,o,a){return r.f(n,o,s(1,a))}:function(n,o,a){return n[o]=a,n}},function(i,e,t){var r=t(12),s=t(35),n=t(21),o=Object.defineProperty;e.f=t(6)?Object.defineProperty:function(a,l,c){if(r(a),l=n(l,!0),r(c),s)try{return o(a,l,c)}catch(u){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[l]=c.value),a}},function(i,e,t){i.exports=!t(7)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(i,e){i.exports=function(t){try{return!!t()}catch(r){return!0}}},function(i,e){var t={}.hasOwnProperty;i.exports=function(r,s){return t.call(r,s)}},function(i,e,t){var r=t(39),s=t(24);i.exports=function(n){return r(s(n))}},function(i,e,t){var r=t(0);r(r.S+r.F*!t(6),"Object",{defineProperty:t(5).f})},function(i,e){var t=i.exports={version:"2.6.9"};typeof __e=="number"&&(__e=t)},function(i,e,t){var r=t(3);i.exports=function(s){if(!r(s))throw TypeError(s+" is not an object!");return s}},function(i,e,t){var r=t(2),s=t(4),n=t(8),o=t(14)("src"),a=t(59),l=(""+a).split("toString");t(11).inspectSource=function(c){return a.call(c)},(i.exports=function(c,u,p,m){var w=typeof p=="function";w&&(n(p,"name")||s(p,"name",u)),c[u]!==p&&(w&&(n(p,o)||s(p,o,c[u]?""+c[u]:l.join(String(u)))),c===r?c[u]=p:m?c[u]?c[u]=p:s(c,u,p):(delete c[u],s(c,u,p)))})(Function.prototype,"toString",function(){return typeof this=="function"&&this[o]||a.call(this)})},function(i,e){var t=0,r=Math.random();i.exports=function(s){return"Symbol(".concat(s===void 0?"":s,")_",(++t+r).toString(36))}},function(i,e,t){var r=t(45),s=t(28);i.exports=Object.keys||function(n){return r(n,s)}},function(i,e){i.exports=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}}},function(i,e,t){var r=t(11),s=t(2),n=s["__core-js_shared__"]||(s["__core-js_shared__"]={});(i.exports=function(o,a){return n[o]||(n[o]=a!==void 0?a:{})})("versions",[]).push({version:r.version,mode:t(18)?"pure":"global",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})},function(i,e){i.exports=!1},function(i,e,t){var r=t(24);i.exports=function(s){return Object(r(s))}},function(i,e,t){"use strict";var r=t(2),s=t(8),n=t(6),o=t(0),a=t(13),l=t(62).KEY,c=t(7),u=t(17),p=t(26),m=t(14),w=t(1),x=t(43),A=t(44),D=t(63),j=t(42),ee=t(12),d=t(3),g=t(19),_=t(9),y=t(21),O=t(16),E=t(30),k=t(67),M=t(49),q=t(47),Y=t(5),F=t(15),Z=M.f,B=Y.f,Q=k.f,ne=r.Symbol,ce=r.JSON,be=ce&&ce.stringify,pe=w("_hidden"),Ie=w("toPrimitive"),ke={}.propertyIsEnumerable,le=u("symbol-registry"),K=u("symbols"),oe=u("op-symbols"),ie=Object.prototype,U=typeof ne=="function"&&!!q.f,z=r.QObject,re=!z||!z.prototype||!z.prototype.findChild,de=n&&c(function(){return E(B({},"a",{get:function(){return B(this,"a",{value:7}).a}})).a!=7})?function(ae,_e,Se){var We=Z(ie,_e);We&&delete ie[_e],B(ae,_e,Se),We&&ae!==ie&&B(ie,_e,We)}:B,X=function(ae){var _e=K[ae]=E(ne.prototype);return _e._k=ae,_e},fe=U&&typeof ne.iterator=="symbol"?function(ae){return typeof ae=="symbol"}:function(ae){return ae instanceof ne},ue=function(ae,_e,Se){return ae===ie&&ue(oe,_e,Se),ee(ae),_e=y(_e,!0),ee(Se),s(K,_e)?(Se.enumerable?(s(ae,pe)&&ae[pe][_e]&&(ae[pe][_e]=!1),Se=E(Se,{enumerable:O(0,!1)})):(s(ae,pe)||B(ae,pe,O(1,{})),ae[pe][_e]=!0),de(ae,_e,Se)):B(ae,_e,Se)},ye=function(ae,_e){ee(ae);for(var Se,We=D(_e=_(_e)),nt=0,Ot=We.length;Ot>nt;)ue(ae,Se=We[nt++],_e[Se]);return ae},Ue=function(ae){var _e=ke.call(this,ae=y(ae,!0));return!(this===ie&&s(K,ae)&&!s(oe,ae))&&(!(_e||!s(this,ae)||!s(K,ae)||s(this,pe)&&this[pe][ae])||_e)},De=function(ae,_e){if(ae=_(ae),_e=y(_e,!0),ae!==ie||!s(K,_e)||s(oe,_e)){var Se=Z(ae,_e);return!Se||!s(K,_e)||s(ae,pe)&&ae[pe][_e]||(Se.enumerable=!0),Se}},Le=function(ae){for(var _e,Se=Q(_(ae)),We=[],nt=0;Se.length>nt;)s(K,_e=Se[nt++])||_e==pe||_e==l||We.push(_e);return We},dt=function(ae){for(var _e,Se=ae===ie,We=Q(Se?oe:_(ae)),nt=[],Ot=0;We.length>Ot;)!s(K,_e=We[Ot++])||Se&&!s(ie,_e)||nt.push(K[_e]);return nt};U||(a((ne=function(){if(this instanceof ne)throw TypeError("Symbol is not a constructor!");var ae=m(arguments.length>0?arguments[0]:void 0),_e=function(Se){this===ie&&_e.call(oe,Se),s(this,pe)&&s(this[pe],ae)&&(this[pe][ae]=!1),de(this,ae,O(1,Se))};return n&&re&&de(ie,ae,{configurable:!0,set:_e}),X(ae)}).prototype,"toString",function(){return this._k}),M.f=De,Y.f=ue,t(48).f=k.f=Le,t(29).f=Ue,q.f=dt,n&&!t(18)&&a(ie,"propertyIsEnumerable",Ue,!0),x.f=function(ae){return X(w(ae))}),o(o.G+o.W+o.F*!U,{Symbol:ne});for(var ut="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;ut.length>et;)w(ut[et++]);for(var $t=F(w.store),_t=0;$t.length>_t;)A($t[_t++]);o(o.S+o.F*!U,"Symbol",{for:function(ae){return s(le,ae+="")?le[ae]:le[ae]=ne(ae)},keyFor:function(ae){if(!fe(ae))throw TypeError(ae+" is not a symbol!");for(var _e in le)if(le[_e]===ae)return _e},useSetter:function(){re=!0},useSimple:function(){re=!1}}),o(o.S+o.F*!U,"Object",{create:function(ae,_e){return _e===void 0?E(ae):ye(E(ae),_e)},defineProperty:ue,defineProperties:ye,getOwnPropertyDescriptor:De,getOwnPropertyNames:Le,getOwnPropertySymbols:dt});var Yt=c(function(){q.f(1)});o(o.S+o.F*Yt,"Object",{getOwnPropertySymbols:function(ae){return q.f(g(ae))}}),ce&&o(o.S+o.F*(!U||c(function(){var ae=ne();return be([ae])!="[null]"||be({a:ae})!="{}"||be(Object(ae))!="{}"})),"JSON",{stringify:function(ae){for(var _e,Se,We=[ae],nt=1;arguments.length>nt;)We.push(arguments[nt++]);if(Se=_e=We[1],(d(_e)||ae!==void 0)&&!fe(ae))return j(_e)||(_e=function(Ot,zt){if(typeof Se=="function"&&(zt=Se.call(this,Ot,zt)),!fe(zt))return zt}),We[1]=_e,be.apply(ce,We)}}),ne.prototype[Ie]||t(4)(ne.prototype,Ie,ne.prototype.valueOf),p(ne,"Symbol"),p(Math,"Math",!0),p(r.JSON,"JSON",!0)},function(i,e,t){var r=t(3);i.exports=function(s,n){if(!r(s))return s;var o,a;if(n&&typeof(o=s.toString)=="function"&&!r(a=o.call(s))||typeof(o=s.valueOf)=="function"&&!r(a=o.call(s))||!n&&typeof(o=s.toString)=="function"&&!r(a=o.call(s)))return a;throw TypeError("Can't convert object to primitive value")}},function(i,e,t){var r=t(37);i.exports=function(s,n,o){if(r(s),n===void 0)return s;switch(o){case 1:return function(a){return s.call(n,a)};case 2:return function(a,l){return s.call(n,a,l)};case 3:return function(a,l,c){return s.call(n,a,l,c)}}return function(){return s.apply(n,arguments)}}},function(i,e){var t={}.toString;i.exports=function(r){return t.call(r).slice(8,-1)}},function(i,e){i.exports=function(t){if(t==null)throw TypeError("Can't call method on  "+t);return t}},function(i,e,t){"use strict";var r=t(7);i.exports=function(s,n){return!!s&&r(function(){n?s.call(null,function(){},1):s.call(null)})}},function(i,e,t){var r=t(5).f,s=t(8),n=t(1)("toStringTag");i.exports=function(o,a,l){o&&!s(o=l?o:o.prototype,n)&&r(o,n,{configurable:!0,value:a})}},function(i,e,t){var r=t(17)("keys"),s=t(14);i.exports=function(n){return r[n]||(r[n]=s(n))}},function(i,e){i.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(i,e){e.f={}.propertyIsEnumerable},function(i,e,t){var r=t(12),s=t(65),n=t(28),o=t(27)("IE_PROTO"),a=function(){},l=function(){var c,u=t(36)("iframe"),p=n.length;for(u.style.display="none",t(66).appendChild(u),u.src="javascript:",(c=u.contentWindow.document).open(),c.write("<script>document.F=Object<\/script>"),c.close(),l=c.F;p--;)delete l.prototype[n[p]];return l()};i.exports=Object.create||function(c,u){var p;return c!==null?(a.prototype=r(c),p=new a,a.prototype=null,p[o]=c):p=l(),u===void 0?p:s(p,u)}},function(i,e,t){"use strict";var r=t(68),s=t(69),n=t(32),o=t(9);i.exports=t(70)(Array,"Array",function(a,l){this._t=o(a),this._i=0,this._k=l},function(){var a=this._t,l=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,s(1)):s(0,l=="keys"?c:l=="values"?a[c]:[c,a[c]])},"values"),n.Arguments=n.Array,r("keys"),r("values"),r("entries")},function(i,e){i.exports={}},function(i,e,t){t(44)("asyncIterator")},function(i,e,t){"use strict";var r=t(0),s=t(38)(0),n=t(25)([].forEach,!0);r(r.P+r.F*!n,"Array",{forEach:function(o){return s(this,o,arguments[1])}})},function(i,e,t){i.exports=!t(6)&&!t(7)(function(){return Object.defineProperty(t(36)("div"),"a",{get:function(){return 7}}).a!=7})},function(i,e,t){var r=t(3),s=t(2).document,n=r(s)&&r(s.createElement);i.exports=function(o){return n?s.createElement(o):{}}},function(i,e){i.exports=function(t){if(typeof t!="function")throw TypeError(t+" is not a function!");return t}},function(i,e,t){var r=t(22),s=t(39),n=t(19),o=t(40),a=t(60);i.exports=function(l,c){var u=l==1,p=l==2,m=l==3,w=l==4,x=l==6,A=l==5||x,D=c||a;return function(j,ee,d){for(var g,_,y=n(j),O=s(y),E=r(ee,d,3),k=o(O.length),M=0,q=u?D(j,k):p?D(j,0):void 0;k>M;M++)if((A||M in O)&&(_=E(g=O[M],M,y),l)){if(u)q[M]=_;else if(_)switch(l){case 3:return!0;case 5:return g;case 6:return M;case 2:q.push(g)}else if(w)return!1}return x?-1:m||w?w:q}}},function(i,e,t){var r=t(23);i.exports=Object("z").propertyIsEnumerable(0)?Object:function(s){return r(s)=="String"?s.split(""):Object(s)}},function(i,e,t){var r=t(41),s=Math.min;i.exports=function(n){return n>0?s(r(n),9007199254740991):0}},function(i,e){var t=Math.ceil,r=Math.floor;i.exports=function(s){return isNaN(s=+s)?0:(s>0?r:t)(s)}},function(i,e,t){var r=t(23);i.exports=Array.isArray||function(s){return r(s)=="Array"}},function(i,e,t){e.f=t(1)},function(i,e,t){var r=t(2),s=t(11),n=t(18),o=t(43),a=t(5).f;i.exports=function(l){var c=s.Symbol||(s.Symbol=n?{}:r.Symbol||{});l.charAt(0)=="_"||l in c||a(c,l,{value:o.f(l)})}},function(i,e,t){var r=t(8),s=t(9),n=t(46)(!1),o=t(27)("IE_PROTO");i.exports=function(a,l){var c,u=s(a),p=0,m=[];for(c in u)c!=o&&r(u,c)&&m.push(c);for(;l.length>p;)r(u,c=l[p++])&&(~n(m,c)||m.push(c));return m}},function(i,e,t){var r=t(9),s=t(40),n=t(64);i.exports=function(o){return function(a,l,c){var u,p=r(a),m=s(p.length),w=n(c,m);if(o&&l!=l){for(;m>w;)if((u=p[w++])!=u)return!0}else for(;m>w;w++)if((o||w in p)&&p[w]===l)return o||w||0;return!o&&-1}}},function(i,e){e.f=Object.getOwnPropertySymbols},function(i,e,t){var r=t(45),s=t(28).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return r(n,s)}},function(i,e,t){var r=t(29),s=t(16),n=t(9),o=t(21),a=t(8),l=t(35),c=Object.getOwnPropertyDescriptor;e.f=t(6)?c:function(u,p){if(u=n(u),p=o(p,!0),l)try{return c(u,p)}catch(m){}if(a(u,p))return s(!r.f.call(u,p),u[p])}},function(i,e,t){for(var r=t(31),s=t(15),n=t(13),o=t(2),a=t(4),l=t(32),c=t(1),u=c("iterator"),p=c("toStringTag"),m=l.Array,w={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},x=s(w),A=0;A<x.length;A++){var D,j=x[A],ee=w[j],d=o[j],g=d&&d.prototype;if(g&&(g[u]||a(g,u,m),g[p]||a(g,p,j),l[j]=m,ee))for(D in r)g[D]||n(g,D,r[D],!0)}},function(i,e,t){"use strict";var r=t(73),s={};s[t(1)("toStringTag")]="z",s+""!="[object z]"&&t(13)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(i,e,t){var r=t(19),s=t(15);t(74)("keys",function(){return function(n){return s(r(n))}})},function(i,e,t){"use strict";var r=t(0),s=t(38)(2);r(r.P+r.F*!t(25)([].filter,!0),"Array",{filter:function(n){return s(this,n,arguments[1])}})},function(i,e,t){var r=t(0);r(r.P,"Function",{bind:t(75)})},function(i,e,t){var r=t(0);r(r.S,"Object",{create:t(30)})},function(i,e,t){var r=t(0);r(r.S,"Object",{setPrototypeOf:t(81).set})},function(i,e,t){t(58),i.exports=t(82)},function(i,e){},function(i,e,t){i.exports=t(17)("native-function-to-string",Function.toString)},function(i,e,t){var r=t(61);i.exports=function(s,n){return new(r(s))(n)}},function(i,e,t){var r=t(3),s=t(42),n=t(1)("species");i.exports=function(o){var a;return s(o)&&(typeof(a=o.constructor)!="function"||a!==Array&&!s(a.prototype)||(a=void 0),r(a)&&(a=a[n])===null&&(a=void 0)),a===void 0?Array:a}},function(i,e,t){var r=t(14)("meta"),s=t(3),n=t(8),o=t(5).f,a=0,l=Object.isExtensible||function(){return!0},c=!t(7)(function(){return l(Object.preventExtensions({}))}),u=function(m){o(m,r,{value:{i:"O"+ ++a,w:{}}})},p=i.exports={KEY:r,NEED:!1,fastKey:function(m,w){if(!s(m))return typeof m=="symbol"?m:(typeof m=="string"?"S":"P")+m;if(!n(m,r)){if(!l(m))return"F";if(!w)return"E";u(m)}return m[r].i},getWeak:function(m,w){if(!n(m,r)){if(!l(m))return!0;if(!w)return!1;u(m)}return m[r].w},onFreeze:function(m){return c&&p.NEED&&l(m)&&!n(m,r)&&u(m),m}}},function(i,e,t){var r=t(15),s=t(47),n=t(29);i.exports=function(o){var a=r(o),l=s.f;if(l)for(var c,u=l(o),p=n.f,m=0;u.length>m;)p.call(o,c=u[m++])&&a.push(c);return a}},function(i,e,t){var r=t(41),s=Math.max,n=Math.min;i.exports=function(o,a){return(o=r(o))<0?s(o+a,0):n(o,a)}},function(i,e,t){var r=t(5),s=t(12),n=t(15);i.exports=t(6)?Object.defineProperties:function(o,a){s(o);for(var l,c=n(a),u=c.length,p=0;u>p;)r.f(o,l=c[p++],a[l]);return o}},function(i,e,t){var r=t(2).document;i.exports=r&&r.documentElement},function(i,e,t){var r=t(9),s=t(48).f,n={}.toString,o=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];i.exports.f=function(a){return o&&n.call(a)=="[object Window]"?function(l){try{return s(l)}catch(c){return o.slice()}}(a):s(r(a))}},function(i,e,t){var r=t(1)("unscopables"),s=Array.prototype;s[r]==null&&t(4)(s,r,{}),i.exports=function(n){s[r][n]=!0}},function(i,e){i.exports=function(t,r){return{value:r,done:!!t}}},function(i,e,t){"use strict";var r=t(18),s=t(0),n=t(13),o=t(4),a=t(32),l=t(71),c=t(26),u=t(72),p=t(1)("iterator"),m=!([].keys&&"next"in[].keys()),w=function(){return this};i.exports=function(x,A,D,j,ee,d,g){l(D,A,j);var _,y,O,E=function(ne){if(!m&&ne in Y)return Y[ne];switch(ne){case"keys":case"values":return function(){return new D(this,ne)}}return function(){return new D(this,ne)}},k=A+" Iterator",M=ee=="values",q=!1,Y=x.prototype,F=Y[p]||Y["@@iterator"]||ee&&Y[ee],Z=F||E(ee),B=ee?M?E("entries"):Z:void 0,Q=A=="Array"&&Y.entries||F;if(Q&&(O=u(Q.call(new x)))!==Object.prototype&&O.next&&(c(O,k,!0),r||typeof O[p]=="function"||o(O,p,w)),M&&F&&F.name!=="values"&&(q=!0,Z=function(){return F.call(this)}),r&&!g||!m&&!q&&Y[p]||o(Y,p,Z),a[A]=Z,a[k]=w,ee)if(_={values:M?Z:E("values"),keys:d?Z:E("keys"),entries:B},g)for(y in _)y in Y||n(Y,y,_[y]);else s(s.P+s.F*(m||q),A,_);return _}},function(i,e,t){"use strict";var r=t(30),s=t(16),n=t(26),o={};t(4)(o,t(1)("iterator"),function(){return this}),i.exports=function(a,l,c){a.prototype=r(o,{next:s(1,c)}),n(a,l+" Iterator")}},function(i,e,t){var r=t(8),s=t(19),n=t(27)("IE_PROTO"),o=Object.prototype;i.exports=Object.getPrototypeOf||function(a){return a=s(a),r(a,n)?a[n]:typeof a.constructor=="function"&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?o:null}},function(i,e,t){var r=t(23),s=t(1)("toStringTag"),n=r(function(){return arguments}())=="Arguments";i.exports=function(o){var a,l,c;return o===void 0?"Undefined":o===null?"Null":typeof(l=function(u,p){try{return u[p]}catch(m){}}(a=Object(o),s))=="string"?l:n?r(a):(c=r(a))=="Object"&&typeof a.callee=="function"?"Arguments":c}},function(i,e,t){var r=t(0),s=t(11),n=t(7);i.exports=function(o,a){var l=(s.Object||{})[o]||Object[o],c={};c[o]=a(l),r(r.S+r.F*n(function(){l(1)}),"Object",c)}},function(i,e,t){"use strict";var r=t(37),s=t(3),n=t(76),o=[].slice,a={};i.exports=Function.bind||function(l){var c=r(this),u=o.call(arguments,1),p=function(){var m=u.concat(o.call(arguments));return this instanceof p?function(w,x,A){if(!(x in a)){for(var D=[],j=0;j<x;j++)D[j]="a["+j+"]";a[x]=Function("F,a","return new F("+D.join(",")+")")}return a[x](w,A)}(c,m.length,m):n(c,m,l)};return s(c.prototype)&&(p.prototype=c.prototype),p}},function(i,e){i.exports=function(t,r,s){var n=s===void 0;switch(r.length){case 0:return n?t():t.call(s);case 1:return n?t(r[0]):t.call(s,r[0]);case 2:return n?t(r[0],r[1]):t.call(s,r[0],r[1]);case 3:return n?t(r[0],r[1],r[2]):t.call(s,r[0],r[1],r[2]);case 4:return n?t(r[0],r[1],r[2],r[3]):t.call(s,r[0],r[1],r[2],r[3])}return t.apply(s,r)}},function(i,e,t){"use strict";t(78)("trim",function(r){return function(){return r(this,3)}})},function(i,e,t){var r=t(0),s=t(24),n=t(7),o=t(79),a="["+o+"]",l=RegExp("^"+a+a+"*"),c=RegExp(a+a+"*$"),u=function(m,w,x){var A={},D=n(function(){return!!o[m]()||"\u200B\x85"[m]()!="\u200B\x85"}),j=A[m]=D?w(p):o[m];x&&(A[x]=j),r(r.P+r.F*D,"String",A)},p=u.trim=function(m,w){return m=String(s(m)),1&w&&(m=m.replace(l,"")),2&w&&(m=m.replace(c,"")),m};i.exports=u},function(i,e){i.exports=`	
\v\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`},function(i,e,t){"use strict";var r=t(0),s=t(46)(!1),n=[].indexOf,o=!!n&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(o||!t(25)(n)),"Array",{indexOf:function(a){return o?n.apply(this,arguments)||0:s(this,a,arguments[1])}})},function(i,e,t){var r=t(3),s=t(12),n=function(o,a){if(s(o),!r(a)&&a!==null)throw TypeError(a+": can't set as prototype!")};i.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(o,a,l){try{(l=t(22)(Function.call,t(49).f(Object.prototype,"__proto__").set,2))(o,[]),a=!(o instanceof Array)}catch(c){a=!0}return function(c,u){return n(c,u),a?c.__proto__=u:l(c,u),c}}({},!1):void 0),check:n}},function(i,e,t){"use strict";t.r(e),t(34),t(20),t(50),t(31),t(51),t(52),t(10),t(53),t(54);var r=.75,s=10,n=!0,o=!0,a=!0,l=!1,c="driver-highlighted-element-stage",u='<div id="'.concat("driver-page-overlay",'"></div>'),p='<div id="'.concat(c,'"></div>');t(33),t(77);function m(le){return(m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K})(le)}var w=function(le){var K=document.createElement("div");return K.innerHTML=le.trim(),K.firstChild},x=function le(K,oe){if(arguments.length>2&&arguments[2]!==void 0&&arguments[2]){for(var ie=["","-webkit-","-ms-","moz-","-o-"],U=0;U<ie.length;U++){var z=le(K,ie[U]+oe);if(z)return z}return""}var re="";return K.currentStyle?re=K.currentStyle[oe]:document.defaultView&&document.defaultView.getComputedStyle&&(re=document.defaultView.getComputedStyle(K,null).getPropertyValue(oe)),re&&re.toLowerCase?re.toLowerCase():re},A=function(le){return le&&m(le)==="object"&&"nodeType"in le};function D(le,K){for(var oe=0;oe<K.length;oe++){var ie=K[oe];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(le,ie.key,ie)}}var j=function(){function le(U,z,re){(function(de,X){if(!(de instanceof X))throw new TypeError("Cannot call a class as a function")})(this,le),this.options=U,this.highlightedElement=null,this.lastHighlightedElement=null,this.hideTimer=null,this.window=z,this.document=re,this.removeNode=this.removeNode.bind(this)}var K,oe,ie;return K=le,(oe=[{key:"attachNode",value:function(){var U=this.document.getElementById("driver-page-overlay");U||(U=w(u),document.body.appendChild(U)),this.node=U,this.node.style.opacity="0",this.options.animate||this.node.parentElement&&this.node.parentElement.removeChild(this.node)}},{key:"highlight",value:function(U){U&&U.node?U.isSame(this.highlightedElement)||(this.window.clearTimeout(this.hideTimer),U.onHighlightStarted(),this.highlightedElement&&!this.highlightedElement.isSame(this.lastHighlightedElement)&&this.highlightedElement.onDeselected(),U.getCalculatedPosition().canHighlight()&&(this.lastHighlightedElement=this.highlightedElement,this.highlightedElement=U,this.show(),this.highlightedElement.onHighlighted())):console.warn("Invalid element to highlight. Must be an instance of `Element`")}},{key:"show",value:function(){var U=this;this.node&&this.node.parentElement||(this.attachNode(),window.setTimeout(function(){U.node.style.opacity="".concat(U.options.opacity),U.node.style.position="fixed",U.node.style.left="0",U.node.style.top="0",U.node.style.bottom="0",U.node.style.right="0"}))}},{key:"getHighlightedElement",value:function(){return this.highlightedElement}},{key:"getLastHighlightedElement",value:function(){return this.lastHighlightedElement}},{key:"clear",value:function(){var U=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.options.onReset&&this.options.onReset(this.highlightedElement),this.highlightedElement&&this.highlightedElement.onDeselected(!0),this.highlightedElement=null,this.lastHighlightedElement=null,this.node&&(this.window.clearTimeout(this.hideTimer),this.options.animate&&!U?(this.node.style.opacity="0",this.hideTimer=this.window.setTimeout(this.removeNode,300)):this.removeNode())}},{key:"removeNode",value:function(){this.node&&this.node.parentElement&&this.node.parentElement.removeChild(this.node)}},{key:"refresh",value:function(){this.highlightedElement&&(this.highlightedElement.showPopover(),this.highlightedElement.showStage())}}])&&D(K.prototype,oe),ie&&D(K,ie),le}();t(80);function ee(le,K){for(var oe=0;oe<K.length;oe++){var ie=K[oe];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(le,ie.key,ie)}}var d=function(){function le(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=U.left,re=z===void 0?0:z,de=U.top,X=de===void 0?0:de,fe=U.right,ue=fe===void 0?0:fe,ye=U.bottom,Ue=ye===void 0?0:ye;(function(De,Le){if(!(De instanceof Le))throw new TypeError("Cannot call a class as a function")})(this,le),this.left=re,this.right=ue,this.top=X,this.bottom=Ue}var K,oe,ie;return K=le,(oe=[{key:"canHighlight",value:function(){return this.left<this.right&&this.top<this.bottom}}])&&ee(K.prototype,oe),ie&&ee(K,ie),le}();function g(le,K){for(var oe=0;oe<K.length;oe++){var ie=K[oe];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(le,ie.key,ie)}}var _=function(){function le(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=U.node,re=U.options,de=U.popover,X=U.stage,fe=U.overlay,ue=U.window,ye=U.document;(function(Ue,De){if(!(Ue instanceof De))throw new TypeError("Cannot call a class as a function")})(this,le),this.node=z,this.document=ye,this.window=ue,this.options=re,this.overlay=fe,this.popover=de,this.stage=X,this.animationTimeout=null}var K,oe,ie;return K=le,(oe=[{key:"isInView",value:function(){for(var U=this.node.offsetTop,z=this.node.offsetLeft,re=this.node.offsetWidth,de=this.node.offsetHeight,X=this.node;X.offsetParent;)U+=(X=X.offsetParent).offsetTop,z+=X.offsetLeft;return U>=this.window.pageYOffset&&z>=this.window.pageXOffset&&U+de<=this.window.pageYOffset+this.window.innerHeight&&z+re<=this.window.pageXOffset+this.window.innerWidth}},{key:"scrollManually",value:function(){var U=this.node.getBoundingClientRect().top+this.window.pageYOffset-this.window.innerHeight/2;this.window.scrollTo(0,U)}},{key:"bringInView",value:function(){if(this.node&&!this.isInView())if(this.node.scrollIntoView)try{this.node.scrollIntoView(this.options.scrollIntoViewOptions||{behavior:"instant",block:"center"})}catch(U){this.scrollManually()}else this.scrollManually()}},{key:"getCalculatedPosition",value:function(){var U=this.document.body,z=this.document.documentElement,re=this.window,de=this.window.pageYOffset||z.scrollTop||U.scrollTop,X=re.pageXOffset||z.scrollLeft||U.scrollLeft,fe=this.node.getBoundingClientRect();return new d({top:fe.top+de,left:fe.left+X,right:fe.left+X+fe.width,bottom:fe.top+de+fe.height})}},{key:"getPopover",value:function(){return this.popover}},{key:"onDeselected",value:function(){var U=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.hidePopover(),U&&this.hideStage(),this.removeHighlightClasses(),this.window.clearTimeout(this.animationTimeout),this.options.onDeselected&&this.options.onDeselected(this)}},{key:"isSame",value:function(U){return!(!U||!U.node)&&U.node===this.node}},{key:"onHighlightStarted",value:function(){this.options.onHighlightStarted&&this.options.onHighlightStarted(this)}},{key:"onHighlighted",value:function(){this.isInView()||this.bringInView(),this.showPopover(),this.showStage(),this.addHighlightClasses(),this.options.onHighlighted&&this.options.onHighlighted(this)}},{key:"removeHighlightClasses",value:function(){this.node.classList.remove("driver-highlighted-element"),this.node.classList.remove("driver-position-relative");for(var U=this.document.querySelectorAll(".".concat("driver-fix-stacking")),z=0;z<U.length;z++)U[z].classList.remove("driver-fix-stacking")}},{key:"addHighlightClasses",value:function(){this.node.classList.add("driver-highlighted-element"),this.canMakeRelative()&&this.node.classList.add("driver-position-relative"),this.fixStackingContext()}},{key:"fixStackingContext",value:function(){for(var U=this.node.parentNode;U&&U.tagName&&U.tagName.toLowerCase()!=="body";){var z=x(U,"z-index"),re=parseFloat(x(U,"opacity")),de=x(U,"transform",!0),X=x(U,"transform-style",!0),fe=x(U,"transform-box",!0),ue=x(U,"filter",!0),ye=x(U,"perspective",!0);(/[0-9]+/.test(z)||re<1||de&&de!=="none"||X&&X!=="flat"||fe&&fe!=="border-box"||ue&&ue!=="none"||ye&&ye!=="none")&&U.classList.add("driver-fix-stacking"),U=U.parentNode}}},{key:"canMakeRelative",value:function(){var U=this.getStyleProperty("position");return["absolute","fixed","relative"].indexOf(U)===-1}},{key:"getStyleProperty",value:function(U){return x(this.node,U)}},{key:"showStage",value:function(){this.stage.show(this.getCalculatedPosition())}},{key:"getNode",value:function(){return this.node}},{key:"hideStage",value:function(){this.stage.hide()}},{key:"hidePopover",value:function(){this.popover&&this.popover.hide()}},{key:"showPopover",value:function(){var U=this;if(this.popover){var z=this.getCalculatedPosition(),re=300;this.options.animate&&this.overlay.lastHighlightedElement||(re=0),this.animationTimeout=this.window.setTimeout(function(){U.popover.show(z)},re)}}},{key:"getFullPageSize",value:function(){var U=this.document.body,z=this.document.documentElement;return{height:Math.max(U.scrollHeight,U.offsetHeight,z.scrollHeight,z.offsetHeight),width:Math.max(U.scrollWidth,U.offsetWidth,z.scrollWidth,z.offsetWidth)}}},{key:"getSize",value:function(){return{height:Math.max(this.node.scrollHeight,this.node.offsetHeight),width:Math.max(this.node.scrollWidth,this.node.offsetWidth)}}}])&&g(K.prototype,oe),ie&&g(K,ie),le}();t(55),t(56);function y(le){return(y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K})(le)}function O(le,K,oe){return K in le?Object.defineProperty(le,K,{value:oe,enumerable:!0,configurable:!0,writable:!0}):le[K]=oe,le}function E(le,K){for(var oe=0;oe<K.length;oe++){var ie=K[oe];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(le,ie.key,ie)}}function k(le,K){return!K||y(K)!=="object"&&typeof K!="function"?function(oe){if(oe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return oe}(le):K}function M(le){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(K){return K.__proto__||Object.getPrototypeOf(K)})(le)}function q(le,K){return(q=Object.setPrototypeOf||function(oe,ie){return oe.__proto__=ie,oe})(le,K)}var Y=function(le){function K(z,re,de){var X;return function(fe,ue){if(!(fe instanceof ue))throw new TypeError("Cannot call a class as a function")}(this,K),(X=k(this,M(K).call(this))).options=function(fe){for(var ue=1;ue<arguments.length;ue++){var ye=arguments[ue]!=null?arguments[ue]:{},Ue=Object.keys(ye);typeof Object.getOwnPropertySymbols=="function"&&(Ue=Ue.concat(Object.getOwnPropertySymbols(ye).filter(function(De){return Object.getOwnPropertyDescriptor(ye,De).enumerable}))),Ue.forEach(function(De){O(fe,De,ye[De])})}return fe}({isFirst:!0,isLast:!0,totalCount:1,currentIndex:0,offset:0,showButtons:!0,closeBtnText:"Close",doneBtnText:"Done",startBtnText:"Next &rarr;",nextBtnText:"Next &rarr;",prevBtnText:"&larr; Previous"},z),X.window=re,X.document=de,X}var oe,ie,U;return function(z,re){if(typeof re!="function"&&re!==null)throw new TypeError("Super expression must either be null or a function");z.prototype=Object.create(re&&re.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),re&&q(z,re)}(K,_),oe=K,(ie=[{key:"attachNode",value:function(){var z=this.document.getElementById("driver-popover-item");z&&z.parentElement.removeChild(z),z=w(function(){var re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return`
  <div id="`.concat("driver-popover-item",'" class="').concat(re,`">
    <div class="`).concat("driver-popover-tip",`"></div>
    <div class="`).concat("driver-popover-title",`">Popover Title</div>
    <div class="`).concat("driver-popover-description",`">Popover Description</div>
    <div class="driver-clearfix `).concat("driver-popover-footer",`">
      <button class="`).concat("driver-close-btn",`">Close</button>
      <span class="driver-btn-group `).concat("driver-navigation-btns",`">
        <button class="`).concat("driver-prev-btn",`">&larr; Previous</button>
        <button class="`).concat("driver-next-btn",`">Next &rarr;</button>
      </span>
    </div>
  </div>`)}(this.options.className)),document.body.appendChild(z),this.node=z,this.tipNode=z.querySelector(".".concat("driver-popover-tip")),this.titleNode=z.querySelector(".".concat("driver-popover-title")),this.descriptionNode=z.querySelector(".".concat("driver-popover-description")),this.footerNode=z.querySelector(".".concat("driver-popover-footer")),this.nextBtnNode=z.querySelector(".".concat("driver-next-btn")),this.prevBtnNode=z.querySelector(".".concat("driver-prev-btn")),this.closeBtnNode=z.querySelector(".".concat("driver-close-btn"))}},{key:"getTitleNode",value:function(){return this.titleNode}},{key:"getDescriptionNode",value:function(){return this.descriptionNode}},{key:"hide",value:function(){this.node&&(this.node.style.display="none")}},{key:"setInitialState",value:function(){this.node.style.display="block",this.node.style.left="0",this.node.style.top="0",this.node.style.bottom="",this.node.style.right="",this.node.querySelector(".".concat("driver-popover-tip")).className="driver-popover-tip"}},{key:"show",value:function(z){switch(this.attachNode(),this.setInitialState(),this.titleNode.innerHTML=this.options.title,this.descriptionNode.innerHTML=this.options.description||"",this.renderFooter(),this.options.position){case"left":case"left-top":this.positionOnLeft(z);break;case"left-center":this.positionOnLeftCenter(z);break;case"left-bottom":this.positionOnLeftBottom(z);break;case"right":case"right-top":this.positionOnRight(z);break;case"right-center":this.positionOnRightCenter(z);break;case"right-bottom":this.positionOnRightBottom(z);break;case"top":case"top-left":this.positionOnTop(z);break;case"top-center":this.positionOnTopCenter(z);break;case"top-right":this.positionOnTopRight(z);break;case"bottom":case"bottom-left":this.positionOnBottom(z);break;case"bottom-center":this.positionOnBottomCenter(z);break;case"bottom-right":this.positionOnBottomRight(z);break;case"mid-center":this.positionOnMidCenter(z);break;case"auto":default:this.autoPosition(z)}this.bringInView()}},{key:"renderFooter",value:function(){this.nextBtnNode.innerHTML=this.options.nextBtnText,this.prevBtnNode.innerHTML=this.options.prevBtnText,this.closeBtnNode.innerHTML=this.options.closeBtnText;var z=this.options.totalCount&&this.options.totalCount!==1;this.options.showButtons?(z?(this.nextBtnNode.style.display="inline-block",this.prevBtnNode.style.display="inline-block",this.closeBtnNode.classList.remove("driver-close-only-btn")):(this.nextBtnNode.style.display="none",this.prevBtnNode.style.display="none",this.closeBtnNode.classList.add("driver-close-only-btn")),this.footerNode.style.display="block",this.options.isFirst?(this.prevBtnNode.classList.add("driver-disabled"),this.nextBtnNode.innerHTML=this.options.startBtnText):this.prevBtnNode.classList.remove("driver-disabled"),this.options.isLast?this.nextBtnNode.innerHTML=this.options.doneBtnText:this.nextBtnNode.innerHTML=this.options.nextBtnText):this.footerNode.style.display="none"}},{key:"positionOnLeft",value:function(z){var re=this.getSize().width,de=this.options.padding+10;this.node.style.left="".concat(z.left-re-de,"px"),this.node.style.top="".concat(z.top+this.options.offset-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("right")}},{key:"positionOnLeftBottom",value:function(z){var re=this.getSize(),de=re.width,X=this.options.padding+10;this.node.style.left="".concat(z.left-de-X,"px"),this.node.style.top="".concat(z.bottom+this.options.padding+this.options.offset-re.height,"px"),this.node.style.bottom="",this.node.style.right="",this.tipNode.classList.add("right","position-bottom")}},{key:"positionOnLeftCenter",value:function(z){var re=this.getSize(),de=re.width,X=re.height/2,fe=this.options.padding+10,ue=(z.bottom-z.top)/2,ye=z.top-X+ue+this.options.offset;this.node.style.left="".concat(z.left-de-fe,"px"),this.node.style.top="".concat(ye,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("right","position-center")}},{key:"positionOnRight",value:function(z){var re=this.options.padding+10;this.node.style.left="".concat(z.right+re,"px"),this.node.style.top="".concat(z.top+this.options.offset-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("left")}},{key:"positionOnRightCenter",value:function(z){var re=this.getSize(),de=this.options.padding+10,X=re.height/2,fe=(z.bottom-z.top)/2,ue=z.top-X+fe+this.options.offset;this.node.style.left="".concat(z.right+de,"px"),this.node.style.top="".concat(ue,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("left","position-center")}},{key:"positionOnRightBottom",value:function(z){var re=this.options.padding+10,de=this.getSize();this.node.style.left="".concat(z.right+re,"px"),this.node.style.top="".concat(z.bottom+this.options.padding+this.options.offset-de.height,"px"),this.node.style.bottom="",this.node.style.right="",this.tipNode.classList.add("left","position-bottom")}},{key:"positionOnTop",value:function(z){var re=this.getSize().height,de=this.options.padding+10;this.node.style.top="".concat(z.top-re-de,"px"),this.node.style.left="".concat(z.left-this.options.padding+this.options.offset,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("bottom")}},{key:"positionOnTopCenter",value:function(z){var re=this.getSize(),de=re.height,X=re.width/2,fe=this.options.padding+10,ue=this.options.offset+z.left+(z.right-z.left)/2;this.node.style.top="".concat(z.top-de-fe,"px"),this.node.style.left="".concat(ue-X-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("bottom","position-center")}},{key:"positionOnTopRight",value:function(z){var re=this.getSize(),de=re.height,X=this.options.padding+10;this.node.style.top="".concat(z.top-de-X,"px"),this.node.style.left="".concat(z.right+this.options.padding+this.options.offset-re.width,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("bottom","position-right")}},{key:"positionOnBottom",value:function(z){var re=this.options.padding+10;this.node.style.top="".concat(z.bottom+re,"px"),this.node.style.left="".concat(z.left-this.options.padding+this.options.offset,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("top")}},{key:"positionOnBottomCenter",value:function(z){var re=this.getSize().width/2,de=this.options.padding+10,X=this.options.offset+z.left+(z.right-z.left)/2;this.node.style.top="".concat(z.bottom+de,"px"),this.node.style.left="".concat(X-re-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("top","position-center")}},{key:"positionOnBottomRight",value:function(z){var re=this.getSize(),de=this.options.padding+10;this.node.style.top="".concat(z.bottom+de,"px"),this.node.style.left="".concat(z.right+this.options.padding+this.options.offset-re.width,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("top","position-right")}},{key:"positionOnMidCenter",value:function(z){var re=this.getSize(),de=re.height,X=re.width/2,fe=de/2,ue=(z.bottom-z.top)/2,ye=z.top-fe+ue+this.options.offset,Ue=this.options.offset+z.left+(z.right-z.left)/2;this.node.style.top="".concat(ye,"px"),this.node.style.left="".concat(Ue-X-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("mid-center")}},{key:"autoPosition",value:function(z){var re=this.getFullPageSize(),de=this.getSize(),X=re.height,fe=de.height,ue=this.options.padding+10;z.bottom+fe+ue>=X?this.positionOnTop(z):this.positionOnBottom(z)}}])&&E(oe.prototype,ie),U&&E(oe,U),K}();function F(le){return(F=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K})(le)}function Z(le,K){for(var oe=0;oe<K.length;oe++){var ie=K[oe];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(le,ie.key,ie)}}function B(le,K){return!K||F(K)!=="object"&&typeof K!="function"?function(oe){if(oe===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return oe}(le):K}function Q(le){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(K){return K.__proto__||Object.getPrototypeOf(K)})(le)}function ne(le,K){return(ne=Object.setPrototypeOf||function(oe,ie){return oe.__proto__=ie,oe})(le,K)}var ce=function(le){function K(z,re,de){var X;return function(fe,ue){if(!(fe instanceof ue))throw new TypeError("Cannot call a class as a function")}(this,K),(X=B(this,Q(K).call(this))).options=z,X.window=re,X.document=de,X}var oe,ie,U;return function(z,re){if(typeof re!="function"&&re!==null)throw new TypeError("Super expression must either be null or a function");z.prototype=Object.create(re&&re.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),re&&ne(z,re)}(K,_),oe=K,(ie=[{key:"attachNode",value:function(){var z=this.document.getElementById(c);z||(z=w(p),document.body.appendChild(z)),this.node=z,this.options.animate?this.node.classList.remove("driver-stage-no-animation"):this.node.classList.add("driver-stage-no-animation")}},{key:"hide",value:function(){this.node&&this.node.parentElement&&this.node.parentElement.removeChild(this.node)}},{key:"setInitialStyle",value:function(){this.node.style.display="block",this.node.style.left="0",this.node.style.top="0",this.node.style.bottom="",this.node.style.right=""}},{key:"show",value:function(z){this.attachNode(),this.setInitialStyle();var re=2*this.options.padding,de=z.right-z.left+re,X=z.bottom-z.top+re;this.node.style.display="block",this.node.style.position="absolute",this.node.style.width="".concat(de,"px"),this.node.style.height="".concat(X,"px"),this.node.style.top="".concat(z.top-re/2,"px"),this.node.style.left="".concat(z.left-re/2,"px"),this.node.style.backgroundColor=this.options.stageBackground}}])&&Z(oe.prototype,ie),U&&Z(oe,U),K}();function be(le){for(var K=1;K<arguments.length;K++){var oe=arguments[K]!=null?arguments[K]:{},ie=Object.keys(oe);typeof Object.getOwnPropertySymbols=="function"&&(ie=ie.concat(Object.getOwnPropertySymbols(oe).filter(function(U){return Object.getOwnPropertyDescriptor(oe,U).enumerable}))),ie.forEach(function(U){pe(le,U,oe[U])})}return le}function pe(le,K,oe){return K in le?Object.defineProperty(le,K,{value:oe,enumerable:!0,configurable:!0,writable:!0}):le[K]=oe,le}function Ie(le,K){for(var oe=0;oe<K.length;oe++){var ie=K[oe];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(le,ie.key,ie)}}t.d(e,"default",function(){return ke});var ke=function(){function le(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(function(z,re){if(!(z instanceof re))throw new TypeError("Cannot call a class as a function")})(this,le),this.options=be({animate:n,opacity:r,padding:s,scrollIntoViewOptions:null,allowClose:o,keyboardControl:a,overlayClickNext:l,stageBackground:"#ffffff",onHighlightStarted:function(){return null},onHighlighted:function(){return null},onDeselected:function(){return null},onReset:function(){return null},onNext:function(){return null},onPrevious:function(){return null}},U),this.document=document,this.window=window,this.isActivated=!1,this.steps=[],this.currentStep=0,this.currentMovePrevented=!1,this.overlay=new j(this.options,window,document),this.onResize=this.onResize.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onClick=this.onClick.bind(this),this.moveNext=this.moveNext.bind(this),this.movePrevious=this.movePrevious.bind(this),this.preventMove=this.preventMove.bind(this),this.bind()}var K,oe,ie;return K=le,(oe=[{key:"getSteps",value:function(){return this.steps}},{key:"setSteps",value:function(U){this.steps=U}},{key:"bind",value:function(){this.window.addEventListener("resize",this.onResize,!1),this.window.addEventListener("keyup",this.onKeyUp,!1),"ontouchstart"in document.documentElement?this.window.addEventListener("touchstart",this.onClick,!1):this.window.addEventListener("click",this.onClick,!1)}},{key:"onClick",value:function(U){if(this.isActivated&&this.hasHighlightedElement()){U.stopPropagation();var z=this.overlay.getHighlightedElement(),re=this.document.getElementById("driver-popover-item"),de=z.node.contains(U.target),X=re&&re.contains(U.target);if(de||X||!this.options.overlayClickNext)if(de||X||!this.options.allowClose){var fe=U.target.classList.contains("driver-next-btn"),ue=U.target.classList.contains("driver-prev-btn");U.target.classList.contains("driver-close-btn")?this.reset():fe?this.handleNext():ue&&this.handlePrevious()}else this.reset();else this.handleNext()}}},{key:"onResize",value:function(){this.isActivated&&this.refresh()}},{key:"refresh",value:function(){this.overlay.refresh()}},{key:"onKeyUp",value:function(U){if(this.isActivated&&this.options.keyboardControl)if(U.keyCode!==27){var z=this.getHighlightedElement();z&&z.popover&&(U.keyCode===39?this.handleNext():U.keyCode===37&&this.handlePrevious())}else this.reset()}},{key:"movePrevious",value:function(){var U=this.steps[this.currentStep-1];U?(this.overlay.highlight(U),this.currentStep-=1):this.reset()}},{key:"preventMove",value:function(){this.currentMovePrevented=!0}},{key:"handleNext",value:function(){this.currentMovePrevented=!1;var U=this.steps[this.currentStep];U&&U.options&&U.options.onNext&&U.options.onNext(this.overlay.highlightedElement),this.currentMovePrevented||this.moveNext()}},{key:"handlePrevious",value:function(){this.currentMovePrevented=!1;var U=this.steps[this.currentStep];U&&U.options&&U.options.onPrevious&&U.options.onPrevious(this.overlay.highlightedElement),this.currentMovePrevented||this.movePrevious()}},{key:"moveNext",value:function(){var U=this.steps[this.currentStep+1];U?(this.overlay.highlight(U),this.currentStep+=1):this.reset()}},{key:"hasNextStep",value:function(){return!!this.steps[this.currentStep+1]}},{key:"hasPreviousStep",value:function(){return!!this.steps[this.currentStep-1]}},{key:"reset",value:function(){var U=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.currentStep=0,this.isActivated=!1,this.overlay.clear(U)}},{key:"hasHighlightedElement",value:function(){var U=this.overlay.getHighlightedElement();return U&&U.node}},{key:"getHighlightedElement",value:function(){return this.overlay.getHighlightedElement()}},{key:"getLastHighlightedElement",value:function(){return this.overlay.getLastHighlightedElement()}},{key:"defineSteps",value:function(U){this.steps=[];for(var z=0;z<U.length;z++){var re=this.prepareElementFromStep(U[z],U,z);re&&this.steps.push(re)}}},{key:"prepareElementFromStep",value:function(U){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],re=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,de=be({},this.options),X=U,fe=typeof U!="string"&&!A(U);if(!U||fe&&!U.element)throw new Error("Element is required in step ".concat(re));fe&&(X=U.element,de=be({},this.options,U));var ue=A(X)?X:this.document.querySelector(X);if(!ue)return console.warn("Element to highlight ".concat(X," not found")),null;var ye=null;if(de.popover&&de.popover.title){var Ue=[this.options.className,de.popover.className].filter(function(ut){return ut}).join(" "),De=be({},de,de.popover,{className:Ue,totalCount:z.length,currentIndex:re,isFirst:re===0,isLast:z.length===0||re===z.length-1});ye=new Y(De,this.window,this.document)}var Le=be({},de),dt=new ce(Le,this.window,this.document);return new _({node:ue,options:de,popover:ye,stage:dt,overlay:this.overlay,window:this.window,document:this.document})}},{key:"start",value:function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(!this.steps||this.steps.length===0)throw new Error("There are no steps defined to iterate");this.isActivated=!0,this.currentStep=U,this.overlay.highlight(this.steps[U])}},{key:"highlight",value:function(U){this.isActivated=!0;var z=this.prepareElementFromStep(U);z&&this.overlay.highlight(z)}}])&&Ie(K.prototype,oe),ie&&Ie(K,ie),le}()}]).default})});window.frappe||(window.frappe={});frappe.provide=function(i){for(var e=i.split("."),t=window,r=0;r<e.length;r++){var s=e[r];t[s]||(t[s]={}),t=t[s]}return t};frappe.provide("locals");frappe.provide("frappe.flags");frappe.provide("frappe.settings");frappe.provide("frappe.utils");frappe.provide("frappe.ui.form");frappe.provide("frappe.modules");frappe.provide("frappe.templates");frappe.provide("frappe.test_data");frappe.provide("frappe.utils");frappe.provide("frappe.model");frappe.provide("frappe.user");frappe.provide("frappe.session");frappe.provide("frappe._messages");frappe.provide("locals.DocType");frappe.provide("frappe.listview_settings");frappe.provide("frappe.tour");frappe.provide("frappe.listview_parent_route");window.NEWLINE=`
`;window.TAB=9;window.UP_ARROW=38;window.DOWN_ARROW=40;window.cur_frm=null;frappe._=function(i,e,t=null){if(!i||typeof i!="string")return i;let r="",s=i;return t&&(r=frappe._messages[`${s}:${t}`]),r||(r=frappe._messages[s]||i),e&&typeof e=="object"&&(r=$.format(r,e)),r};window.__=frappe._;frappe.get_languages=function(){return frappe.languages||(frappe.languages=[],$.each(frappe.boot.lang_dict,function(i,e){frappe.languages.push({label:i,value:e})}),frappe.languages=frappe.languages.sort(function(i,e){return i.value<e.value?-1:1})),frappe.languages};(function(i){"use strict";var e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;function t(){}t.extend=function(r){var s=this.prototype,n=Object.create(s);for(var o in r)n[o]=typeof r[o]=="function"&&typeof s[o]=="function"&&e.test(r[o])?function(l,c){return function(){var u=this._super;this._super=s[l];var p=c.apply(this,arguments);return this._super=u,p}}(o,r[o]):r[o];var a=typeof n.init=="function"?n.hasOwnProperty("init")?n.init:function(){s.init.apply(this,arguments)}:function(){};return a.prototype=n,n.constructor=a,a.extend=t.extend,a},i.Class=t})(window);String.prototype.includes||(String.prototype.includes=function(i,e){"use strict";return typeof e!="number"&&(e=0),e+i.length>this.length?!1:this.indexOf(i,e)!==-1});Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(i,e){if(this==null)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if(r===0)return!1;for(var s=e|0,n=Math.max(s>=0?s:r-Math.abs(s),0);n<r;){if(t[n]===i)return!0;n++}return!1}});typeof String.prototype.trimLeft!="function"&&(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")});typeof String.prototype.trimRight!="function"&&(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")});typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(e){"use strict";if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var s=arguments[r];if(s!=null)for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},writable:!0,configurable:!0});frappe.require=function(i,e){return typeof i=="string"&&(i=[i]),i=i.map(t=>frappe.assets.bundled_asset(t)),new Promise(t=>{frappe.assets.execute(i,()=>{t(),e&&e()})})};var go=class{constructor(){this._executed=[],this._handlers={js:function(e){frappe.dom.eval(e)},css:function(e){frappe.dom.set_style(e)}}}check(){if(window._version_number!=localStorage.getItem("_version_number")&&(this.clear_local_storage(),console.log("Cleared App Cache.")),localStorage._last_load){let e=new Date-new Date(localStorage._last_load);(e<5e3&&j_()||e>2*864e5)&&this.clear_local_storage()}else this.clear_local_storage();this.init_local_storage()}init_local_storage(){localStorage._last_load=new Date,localStorage._version_number=window._version_number,frappe.boot&&(localStorage.metadata_version=frappe.boot.metadata_version)}clear_local_storage(){["_last_load","_version_number","metadata_version","page_info","last_visited"].forEach(e=>localStorage.removeItem(e));for(let e in localStorage)(e.startsWith("_page:")||e.startsWith("_doctype:")||e.startsWith("preferred_breadcrumbs:"))&&localStorage.removeItem(e);console.log("localStorage cleared")}eval_assets(e,t){this._executed.includes(e)||(this._handlers[this.extn(e)](t),this._executed.push(e))}execute(e,t){let r=this,s=frappe.boot.developer_mode||window.dev_server?Date.now():window._version_number,n={};async function o(l){let c=new URL(l,window.location.origin);!l.includes(".bundle.")&&!c.searchParams.get("v")&&c.searchParams.append("v",s);let u=await fetch(c.toString());n[l]=await u.text()}frappe.dom.freeze();let a=e.map(o);Promise.all(a).then(()=>{e.forEach(l=>{let c=n[l];r.eval_assets(l,c)}),frappe.dom.unfreeze(),t==null||t()})}extn(e){return e.indexOf("?")!=-1&&(e=e.split("?").slice(-1)[0]),e.split(".").slice(-1)[0]}bundled_asset(e,t=null){return!e.startsWith("/assets")&&e.includes(".bundle.")&&(e.endsWith(".css")&&t&&(e=`rtl_${e}`),e=frappe.boot.assets_json[e]||e),e}};function j_(){var i;try{return(i=window.performance)==null?void 0:i.getEntriesByType("navigation").map(e=>e.type).includes("reload")}catch(e){return!0}}frappe.assets=new go;function z_(i,e){return i==null?i:(this.unkeyed_index=0,i.replace(/\{(\w*)\}/g,function(t,r){if(r===""&&(r=this.unkeyed_index,this.unkeyed_index++),r==+r)return e[r]!==void 0?e[r]:t}.bind(this)))}jQuery&&(jQuery.format=z_);frappe.provide("frappe.form.formatters");frappe.form.link_formatters={};frappe.form.formatters={_right:function(i,e){return e&&(e.inline||e.only_value)?i:"<div style='text-align: right'>"+i+"</div>"},_apply_custom_formatter:function(i,e){if(e){let t=frappe.meta.docfield_map[e.parent]&&frappe.meta.docfield_map[e.parent][e.fieldname];t&&t.formatter&&typeof t.formatter=="function"&&(i=t.formatter(i,e))}return i},Data:function(i,e){return e&&e.options=="URL"?i?`<a href="${i}" title="Open Link" target="_blank">${i}</a>`:void 0:(i=i==null?"":i,frappe.form.formatters._apply_custom_formatter(i,e))},Autocomplete:function(i,e){return __(frappe.form.formatters.Data(i,e))},Select:function(i,e){return __(frappe.form.formatters.Data(i,e))},Float:function(i,e,t,r){if(i===null)return"";var s=e.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||null;if(e.options&&e.options.trim())return e.precision=s,frappe.form.formatters.Currency(i,e,t,r);if(!(t||{}).always_show_decimals&&!is_null(i)){var n=cstr(i).split(".");(n[1]==null||cint(n[1])===0)&&(s=0)}return i=i==null||i===""?"":i,frappe.form.formatters._right(format_number(i,null,s),t)},Int:function(i,e,t){return i===null?"":cstr(e.options).trim()==="File Size"?frappe.form.formatters.FileSize(i):frappe.form.formatters._right(i==null?"":cint(i),t)},Percent:function(i,e,t){if(i===null)return"";let r=e.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||2;return frappe.form.formatters._right(flt(i,r)+"%",t)},Rating:function(i,e){let t="",r=e.options||5;return i=i*r,i=Math.round(i*2)/2,Array.from({length:cint(r)},(s,n)=>n+1).forEach(s=>{t+=`<svg class="icon icon-md" data-rating=${s} viewBox="0 0 24 24" fill="none">
				<path class="right-half ${s<=(i||0)?"star-click":""}" d="M11.9987 3.00011C12.177 3.00011 12.3554 3.09303 12.4471 3.27888L14.8213 8.09112C14.8941 8.23872 15.0349 8.34102 15.1978 8.3647L20.5069 9.13641C20.917 9.19602 21.0807 9.69992 20.7841 9.9892L16.9421 13.7354C16.8243 13.8503 16.7706 14.0157 16.7984 14.1779L17.7053 19.4674C17.7753 19.8759 17.3466 20.1874 16.9798 19.9945L12.2314 17.4973C12.1586 17.459 12.0786 17.4398 11.9987 17.4398V3.00011Z" fill="var(--star-fill)" stroke="var(--star-fill)"/>
				<path class="left-half ${s<=(i||0)||s-.5==i?"star-click":""}" d="M11.9987 3.00011C11.8207 3.00011 11.6428 3.09261 11.5509 3.27762L9.15562 8.09836C9.08253 8.24546 8.94185 8.34728 8.77927 8.37075L3.42887 9.14298C3.01771 9.20233 2.85405 9.70811 3.1525 9.99707L7.01978 13.7414C7.13858 13.8564 7.19283 14.0228 7.16469 14.1857L6.25116 19.4762C6.18071 19.8842 6.6083 20.1961 6.97531 20.0045L11.7672 17.5022C11.8397 17.4643 11.9192 17.4454 11.9987 17.4454V3.00011Z" fill="var(--star-fill)" stroke="var(--star-fill)"/>
			</svg>`}),`<div class="rating">
			${t}
		</div>`},Currency:function(i,e,t,r){if(i===null)return"";var s=frappe.meta.get_field_currency(e,r);let n;if(typeof e.precision=="number"?n=e.precision:n=cint(e.precision||frappe.boot.sysdefaults.currency_precision||2),n>2){var o=cstr(i).split("."),a=o.length>1?o[1]:"";if(a.length<3||a.length<n){let l=frappe.model.get_value(":Currency",s,"fraction_units")||100;a.length<cstr(l).length&&(n=cstr(l).length-1)}}return i=i==null||i===""?"":i,i=format_currency(i,s,n),t&&t.only_value?i:frappe.form.formatters._right(i,t)},Check:function(i){return`<input type="checkbox" disabled
			class="disabled-${i?"selected":"deselected"}">`},Link:function(i,e,t,r){var s=e._options||e.options,n=i;let o=frappe.utils.get_link_title(s,i);if(o===i&&(o=null),i&&i.match&&i.match(/^['"].*['"]$/)&&i.replace(/^.(.*).$/,"$1"),t&&(t.for_print||t.only_value))return o||i;if(frappe.form.link_formatters[s]&&r&&s!==r.doctype&&(i=frappe.form.link_formatters[s](i,r,e)),!i)return"";if(i[0]=="'"&&i[i.length-1]=="'")return i.substring(1,i.length-1);if(e&&e.link_onclick)return repl('<a onclick="%(onclick)s" href="#">%(value)s</a>',{onclick:e.link_onclick.replace(/"/g,"&quot;")+"; return false;",value:i});if(e&&s)if(frappe.model.can_read(s)){let a=document.createElement("a");return a.href=`/app/${encodeURIComponent(frappe.router.slug(s))}/${encodeURIComponent(n)}`,a.dataset.doctype=s,a.dataset.name=n,a.dataset.value=n,a.innerText=__(t&&t.label||o||i),a.outerHTML}else return o||i;else return o||i},Date:function(i){return frappe.datetime.str_to_user?(i&&(i=frappe.datetime.str_to_user(i,!1,!0),i==="Invalid date"&&(i=null)),i||""):i},DateRange:function(i){return Array.isArray(i)?__("{0} to {1}",[frappe.datetime.str_to_user(i[0]),frappe.datetime.str_to_user(i[1])]):i||""},Datetime:function(i){return i?moment(frappe.datetime.convert_to_user_tz(i)).format(frappe.boot.sysdefaults.date_format.toUpperCase()+" "+(frappe.boot.sysdefaults.time_format||"HH:mm:ss")):""},Text:function(i,e){if(i){for(var t=["<p","<div","<br","<table"],r=!1,s=0;s<t.length;s++)if(i.match(t[s])){r=!0;break}r||(i=frappe.utils.replace_newlines(i))}return frappe.form.formatters.Data(i,e)},Time:function(i){return i&&(i=frappe.datetime.str_to_user(i,!0)),i||""},Duration:function(i,e){if(i){let t=frappe.utils.get_duration_options(e);i=frappe.utils.get_formatted_duration(i,t)}return i||"0s"},LikedBy:function(i){var e="";return $.each(JSON.parse(i||"[]"),function(t,r){r&&(e+=frappe.avatar(r))}),e},Tag:function(i){var e="";return $.each((i||"").split(","),function(t,r){r&&(e+=`
				<span
					class="data-pill btn-xs align-center ellipsis"
					style="background-color: var(--control-bg); box-shadow: none; margin-right: 4px;"
					data-field="_user_tags" data-label="${r}'">
					${r}
				</span>`)}),e},Comment:function(i){return i},Assign:function(i){var e="";return $.each(JSON.parse(i||"[]"),function(t,r){r&&(e+='<span class="label label-warning" 				style="margin-right: 7px;"				data-field="_assign">'+r+"</span>")}),e},SmallText:function(i){return frappe.form.formatters.Text(i)},TextEditor:function(i){let e=frappe.form.formatters.Text(i);try{!$(e).find(".ql-editor").length&&!$(e).hasClass("ql-editor")&&(e=`<div class="ql-editor read-mode">${e}</div>`)}catch(t){e=`<div class="ql-editor read-mode">${e}</div>`}return e},Code:function(i){return"<pre>"+(i==null?"":$("<div>").text(i).html())+"</pre>"},WorkflowState:function(i){var e=frappe.get_doc("Workflow State",i);return e?repl("<span class='label label-%(style)s' 				data-workflow-state='%(value)s'				style='padding-bottom: 4px; cursor: pointer;'>				<i class='fa fa-small fa-white fa-%(icon)s'></i> %(value)s</span>",{value:i,style:e.style.toLowerCase(),icon:e.icon}):"<span class='label'>"+i+"</span>"},Email:function(i){return $("<div></div>").text(i).html()},FileSize:function(i){return i=cint(i),i>1048576?(i/1048576).toFixed(2)+"M":i>1024?(i/1024).toFixed(2)+"K":i},TableMultiSelect:function(i,e,t){i=i||[];let s=frappe.get_meta(e.options).fields.find(o=>o.fieldtype==="Link");return i.map(o=>{let a=o[s.fieldname];return`<span class="text-nowrap">
				${frappe.format(a,s,t,o)}
			</span>`}).join(", ")},Color:i=>i?`<div>
			<div class="selected-color" style="background-color: ${i}"></div>
			<span class="color-value">${i}</span>
		</div>`:"",Icon:i=>i?`<div>
			<div class="selected-icon">${frappe.utils.icon(i,"md")}</div>
			<span class="icon-value">${i}</span>
		</div>`:"",Attach:Gl,AttachImage:Gl};function Gl(i){return i?`<a href="${i}" target="_blank">${i}</a>`:""}frappe.form.get_formatter=function(i){return i||(i="Data"),frappe.form.formatters[i.replace(/ /g,"")]||frappe.form.formatters.Data};frappe.format=function(i,e,t,r){e||(e={fieldtype:"Data"}),e.fieldname=="_user_tags"&&(e=rt(Ee({},e),{fieldtype:"Tag"}));var s=e.fieldtype||"Data";s==="Dynamic Link"&&(s="Link",e._options=r?r[e.options]:null);var n=e.formatter||frappe.form.get_formatter(s),o=n(i,e,t,r);return typeof o=="string"&&(o=frappe.dom.remove_script_and_style(o)),o};frappe.get_format_helper=function(i){var e={get_formatted:function(t){var r=frappe.meta.get_docfield(i.doctype,t);return r||console.log("fieldname not found: "+t),frappe.format(i[t],r,{inline:1},i)}};return $.extend(e,i),e};frappe.form.link_formatters.User=function(i,e,t){return e&&(e.full_name||t&&e[`${t.fieldname}_full_name`])||i};frappe.provide("frappe.dom");frappe.dom={id_count:0,freeze_count:0,by_id:function(i){return document.getElementById(i)},get_unique_id:function(){let i="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,i},set_unique_id:function(i){var e=$(i);if(e.attr("id"))return e.attr("id");var t="unique-"+frappe.dom.id_count;return e.attr("id",t),frappe.dom.id_count++,t},eval:function(i){if(!!i){var e=document.createElement("script");e.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(e)}},remove_script_and_style:function(i){let e=["script","style","noscript","title","meta","base","head"],t=["link"];if(!this.unsafe_tags_regex){let l=e.concat(t).map(c=>`<([\\s]*)${c}`).join("|");this.unsafe_tags_regex=new RegExp(l,"im")}if(!i||!this.unsafe_tags_regex.test(i))return i;let s=new DOMParser().parseFromString(i,"text/html"),n=s.body,o=!!s.head.innerHTML;for(let a of e)for(let l of n.getElementsByTagName(a))o=!0,l.parentNode.removeChild(l);for(let a of n.getElementsByTagName("link")){let l=a.getAttribute("rel");l&&l.toLowerCase().trim()==="stylesheet"&&(o=!0,a.parentNode.removeChild(a))}return o?n.innerHTML:i},is_element_in_viewport:function(i,e=0){typeof jQuery=="function"&&i instanceof jQuery&&(i=i[0]);var t=i.getBoundingClientRect();return t.top+e>=0&&t.left+e>=0&&t.bottom-e<=$(window).height()&&t.right-e<=$(window).width()},is_element_in_modal(i){return Boolean($(i).parents(".modal").length)},set_style:function(i,e){if(!!i){var t=document.createElement("style");if(t.type="text/css",e){var r=document.getElementById(e);r&&r.parentNode.removeChild(r),t.id=e}return t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(t),t}},add:function(i,e,t,r,s,n){i&&i.substr&&(i=frappe.dom.by_id(i));var o=document.createElement(e);return i&&i.appendChild(o),t&&(e.toLowerCase()=="img"?o.src=t:o.className=t),r&&frappe.dom.css(o,r),s&&(o.innerHTML=s),n&&(o.onclick=n),o},css:function(i,e){return i&&e&&$.extend(i.style,e),i},activate:function(i,e,t,r="active"){i.find(`.${t}.${r}`).removeClass(r),e.addClass(r)},freeze:function(i,e){if($("#freeze").length)$("#freeze").addClass("in");else{var t=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",function(){if(cur_frm&&cur_frm.cur_grid)return cur_frm.cur_grid.toggle_view(),!1}).appendTo("#body");t.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:i||""})),setTimeout(function(){t.addClass("in")},1)}e&&$("#freeze").addClass(e),frappe.dom.freeze_count++},unfreeze:function(){if(!!frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))var i=$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var i=window.getSelection();if(i.getRangeAt&&i.rangeCount){for(var e=[],t=0,r=i.rangeCount;t<r;++t)e.push(i.getRangeAt(t));return e}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(i){if(i)if(window.getSelection){var e=window.getSelection();e.removeAllRanges();for(var t=0,r=i.length;t<r;++t)e.addRange(i[t])}else document.selection&&i.select&&i.select()},is_touchscreen:function(){return"ontouchstart"in window},handle_broken_images(i){$(i).find("img").on("error",e=>{$(e.currentTarget).addClass("no-image")})},scroll_to_bottom(i){let e=$(i);e.scrollTop(e[0].scrollHeight)},file_to_base64(i){return new Promise(e=>{let t=new FileReader;t.onload=function(){e(t.result)},t.readAsDataURL(i)})},scroll_to_section(i){setTimeout(()=>{let e=$(`a:contains("${i}")`);e.length&&(e.parent().hasClass("collapsed")&&e.click(),frappe.ui.scroll(e.parent().parent()))},200)},pixel_to_inches(i){let e=$('<div id="dpi" style="height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"></div>');e.appendTo(document.body);let t=document.getElementById("dpi").offsetWidth,r=i/t;return e.remove(),r}};frappe.ellipsis=function(i,e){return e||(e=20),i=cstr(i),i.length>e&&(i=i.substr(0,e)+"..."),i};frappe.run_serially=function(i){var e=Promise.resolve();return i.forEach(t=>{t&&(e=e.then?e.then(t):Promise.resolve())}),e};frappe.load_image=(i,e,t,r=()=>{})=>{var s=new Image;s.onload=function(){e(this)},s.onerror=t,r(s),s.src=i};frappe.timeout=i=>new Promise(e=>{setTimeout(()=>e(),i*1e3)});frappe.scrub=frappe.slug=function(i,e="_"){return i.replace(/ /g,e).toLowerCase()};frappe.unscrub=function(i){return frappe.model.unscrub(i)};frappe.get_data_pill=(i,e=null,t=null,r=null,s=!1)=>{let n="",o="";s&&(n=frappe.get_palette(i)),o=`background-color: var(${n[0]}); color: var(${n[1]})`;let a=$(`
		<button class="data-pill btn" style="${o}">
			<div class="flex align-center ellipsis">
				${r||""}
				<span class="pill-label">${i} </span>
			</div>
		</button>
	`);if(t){let l=$(`
			<span class="remove-btn cursor-pointer">
				${frappe.utils.icon("close","sm","es-icon")}
			</span>
		`);typeof t=="function"&&l.click(()=>{t(e||i,a)}),a.append(l)}return a};frappe.get_modal=function(i,e){return $(`<div class="modal fade" style="overflow: auto;" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div class="fill-width flex title-section">
						<span class="indicator hidden"></span>
						<h4 class="modal-title">${i}</h4>
					</div>
					<div class="modal-actions">
						<button class="btn btn-modal-minimize btn-link hide">
							${frappe.utils.icon("collapse")}
						</button>
						<button class="btn btn-modal-close btn-link" data-dismiss="modal">
							${frappe.utils.icon("close","sm")}
						</button>
					</div>
				</div>
				<div class="modal-body ui-front">${e}</div>
				<div class="modal-footer hide">
					<div class="custom-actions"></div>
					<div class="standard-actions">
						<button type="button" class="btn btn-secondary btn-sm hide btn-modal-secondary">
						</button>
						<button type="button" class="btn btn-primary btn-sm hide btn-modal-primary">
							${__("Confirm")}
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>`)};frappe.is_online=function(){return frappe.boot.developer_mode==1?!0:"onLine"in navigator?navigator.onLine:!0};frappe.create_shadow_element=function(i,e,t,r){let s="custom-block-"+frappe.utils.get_random(5).toLowerCase();class n extends HTMLElement{constructor(){var p,m,w,x;super();let a=document.createElement("div");a.innerHTML=frappe.dom.remove_script_and_style(e);let l=document.createElement("link");l.rel="stylesheet",l.href=frappe.assets.bundled_asset("desk.bundle.css");let c=document.createElement("style");c.textContent=t;let u=document.createElement("script");u.textContent=`
				(function() {
					let cname = ${JSON.stringify(s)};
					let root_element = document.querySelector(cname).shadowRoot;
					${r}
				})();
			`,this.attachShadow({mode:"open"}),(p=this.shadowRoot)==null||p.appendChild(l),(m=this.shadowRoot)==null||m.appendChild(a),(w=this.shadowRoot)==null||w.appendChild(c),(x=this.shadowRoot)==null||x.appendChild(u)}}customElements.get(s)||customElements.define(s,n),i.innerHTML=`<${s}></${s}>`};$(window).on("online",function(){document.hidden||frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})});$(window).on("offline",function(){document.hidden||frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})});var Rr=class{constructor(e,t,r,s){this.layout=s,this.card_layout=r,this.parent=e,this.df=t||{},this.columns=[],this.fields_list=[],this.fields_dict={},this.make(),this.df.label&&this.df.collapsible&&localStorage.getItem(t.css_class+"-closed")&&this.collapse(),this.row={wrapper:this.wrapper},this.refresh()}make(){let e=this.card_layout;this.wrapper=$(`<div class=
				"${this.df.is_dashboard_section?"form-dashboard-section":"form-section"}
				${e?"card-section":""}" data-fieldname="${this.df.fieldname}">
			`).appendTo(this.parent),this.df&&(this.df.label&&!this.df.hide_label&&this.make_head(),this.df.description&&(this.description_wrapper=$(`<div class="col-sm-12 form-section-description">
						${__(this.df.description)}
					</div>`),this.wrapper.append(this.description_wrapper)),this.df.css_class&&this.wrapper.addClass(this.df.css_class),this.df.hide_border&&this.wrapper.toggleClass("hide-border",!0)),this.body=$('<div class="section-body">').appendTo(this.wrapper),this.df.body_html&&this.body.append(this.df.body_html)}make_head(){this.head=$(`
			<div class="section-head">
				${__(this.df.label,null,this.df.parent)}
				<span class="ml-2 collapse-indicator mb-1"></span>
			</div>
		`),this.head.appendTo(this.wrapper),this.indicator=this.head.find(".collapse-indicator"),this.indicator.hide(),this.df.collapsible&&(this.head.addClass("collapsible"),this.collapse_link=this.head.on("click",()=>{this.collapse()}),this.set_icon(),this.indicator.show())}replace_field(e,t){var r;if((r=this.fields_dict[e])!=null&&r.df){let s=this.fields_dict[e],n=this.fields_list.findIndex(o=>o==s);this.fields_list.splice(n,1,t),this.fields_dict[e]=t,t.section=this}}add_field(e){this.fields_list.push(e),this.fields_dict[e.df.fieldname]=e,e.section=this}refresh(e){!this.df||(e=e||this.df.hidden||this.df.hidden_due_to_dependency,this.wrapper.toggleClass("hide-control",!!e))}collapse(e){!(this.head&&this.body)||(e===void 0&&(e=!this.body.hasClass("hide")),this.body.toggleClass("hide",e),this.head&&this.head.toggleClass("collapsed",e),this.set_icon(e),this.fields_list.forEach(t=>t.on_section_collapse&&t.on_section_collapse(e)),this.df.css_class&&localStorage.setItem(this.df.css_class+"-closed",e?"1":""))}set_icon(e){let t=e?"es-line-down":"es-line-up";this.indicator&&this.indicator.html(frappe.utils.icon(t,"sm","mb-1"))}is_collapsed(){return this.body.hasClass("hide")}has_missing_mandatory(){let e=!1;for(let t=0,r=this.fields_list.length;t<r;t++){let s=this.fields_list[t].df;if(s.reqd&&this.layout.doc[s.fieldname]==null){e=!0;break}}return e}hide(){this.on_section_toggle(!1)}show(){this.on_section_toggle(!0)}on_section_toggle(e){this.wrapper.toggleClass("hide-control",!e)}};var Dr=class{constructor(e,t,r,s,n){var o,a;this.layout=e,this.df=t||{},this.frm=r,this.doctype=(a=(o=this.frm)==null?void 0:o.doctype)!=null?a:this.df.parent,this.label=this.df&&this.df.label,this.tab_link_container=s,this.tabs_content=n,this.make(),this.setup_listeners(),this.refresh()}make(){let e=`${frappe.scrub(this.doctype,"-")}-${this.df.fieldname}`;this.tab_link=$(`
			<li class="nav-item">
				<a class="nav-link ${this.df.active?"active":""}" id="${e}-tab"
					data-toggle="tab"
					data-fieldname="${this.df.fieldname}"
					href="#${e}"
					role="tab"
					aria-controls="${e}">
						${__(this.label,null,this.doctype)}
				</a>
			</li>
		`).appendTo(this.tab_link_container),this.wrapper=$(`<div class="tab-pane fade show ${this.df.active?"active":""}"
			id="${e}" role="tabpanel" aria-labelledby="${e}-tab">`).appendTo(this.tabs_content)}refresh(){if(!this.df)return;let e=this.df.hidden||this.df.hidden_due_to_dependency;!e&&this.frm&&!this.frm.get_perm(this.df.permlevel||0,"read")&&(e=!0),e||(e=!0,this.wrapper.find(".form-section:not(.hide-control, .empty-section), .form-dashboard-section:not(.hide-control, .empty-section)").length&&(e=!1)),this.toggle(!e)}toggle(e){this.tab_link.toggleClass("hide",!e),this.wrapper.toggleClass("hide",!e),this.tab_link.toggleClass("show",e),this.wrapper.toggleClass("show",e),this.hidden=!e}show(){this.tab_link.show()}hide(){this.tab_link.hide()}add_field(e){e.tab=this}replace_field(e){e.tab=this}set_active(){var e,t;this.tab_link.find(".nav-link").tab("show"),this.wrapper.addClass("show"),(t=(e=this.frm)==null?void 0:e.set_active_tab)==null||t.call(e,this)}is_active(){return this.wrapper.hasClass("active")}is_hidden(){return this.wrapper.hasClass("hide")&&this.tab_link.hasClass("hide")}setup_listeners(){this.tab_link.find(".nav-link").on("shown.bs.tab",()=>{var e,t;(t=(e=this.frm)==null?void 0:e.set_active_tab)==null||t.call(e,this)})}};var Pr=class{constructor(e,t){t||(t={}),this.df=t,this.section=e,this.section.columns.push(this),this.make(),this.resize_all_columns()}make(){this.wrapper=$(`
			<div class="form-column" data-fieldname="${this.df.fieldname}">
				<form>
				</form>
			</div>
		`).appendTo(this.section.body),this.form=this.wrapper.find("form").on("submit",()=>!1),this.df.description&&$(`
				<p class="col-sm-12 form-column-description">
					${__(this.df.description)}
				</p>
			`).prependTo(this.wrapper),this.df.label&&$(`
				<label class="column-label">
					${__(this.df.label,null,this.df.parent)}
				</label>
			`).prependTo(this.wrapper)}resize_all_columns(){let e=this.section.wrapper.find(".form-column").length,t=cint(12/e);e==5&&(t=20),this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+t)}add_field(){}refresh(){this.section.refresh()}};frappe.ui.form.Layout=class{constructor(e){this.views={},this.pages=[],this.tabs=[],this.sections=[],this.page_breaks=[],this.sections_dict={},this.fields_list=[],this.fields_dict={},this.section_count=0,this.column_count=0,$.extend(this,e)}make(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message-container hidden"></div>').appendTo(this.wrapper),this.page=$('<div class="form-page"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.is_tabbed_layout()&&this.setup_tabbed_layout(),this.setup_tab_events(),this.frm&&this.setup_tooltip_events(),this.render()}setup_tabbed_layout(){$(`
			<div class="form-tabs-list">
				<ul class="nav form-tabs" id="form-tabs" role="tablist"></ul>
			</div>
		`).appendTo(this.page),this.tab_link_container=this.page.find(".form-tabs"),this.tabs_content=$('<div class="form-tab-content tab-content"></div>').appendTo(this.page),this.setup_events()}get_doctype_fields(){let e=[this.get_new_name_field()];return this.doctype_layout?e=e.concat(this.get_fields_from_layout()):e=e.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype])),e}get_new_name_field(){return{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(e){return e.frm&&e.frm.is_new()&&e.frm.meta.autoname&&["prompt","name"].includes(e.frm.meta.autoname.toLowerCase())?"Write":"None"}}}get_fields_from_layout(){let e=[];for(let t of this.doctype_layout.fields){let r=copy_dict(frappe.meta.docfield_map[this.doctype][t.fieldname]);r.label=t.label,e.push(r)}return e}show_message(e,t,r=!1){if(!e){this.message.empty().addClass("hidden");return}let s;frappe.utils.is_html(e)?s=$("<div class='form-message border-bottom'>").html(e):s=$("<div class='form-message border-bottom'></div>").text(e);let n=$(`<div class="close-message">${frappe.utils.icon("close")}</div>`);r||(n.appendTo(s),n.on("click",()=>s.remove()));let o=t&&["yellow","blue","red","green","orange"].includes(t)?t:"blue";s.addClass(o).appendTo(this.message),this.message.removeClass("hidden")}render(e){let t=e||this.fields;if(this.section=null,this.column=null,this.no_opening_section()&&!this.is_tabbed_layout()&&this.fields.unshift({fieldtype:"Section Break"}),this.is_tabbed_layout()){let r={label:__("Details"),fieldtype:"Tab Break",fieldname:"__details"},s=this.fields.find(o=>o.hidden==!1);if(!((s==null?void 0:s.fieldtype)==="Tab Break"?s:null))this.fields.splice(0,0,r);else{let o=this.fields.find(a=>a.fieldname==="__newname");o&&o.get_status(this)==="Write"&&(this.fields.splice(0,1),this.fields.splice(1,0,o))}}t.forEach(r=>{switch(r.fieldtype){case"Fold":this.make_page(r);break;case"Page Break":this.make_page_break(),this.make_section(r);break;case"Section Break":this.make_section(r);break;case"Column Break":this.make_column(r);break;case"Tab Break":this.make_tab(r);break;default:this.make_field(r)}})}no_opening_section(){return this.fields[0]&&this.fields[0].fieldtype!="Section Break"||!this.fields.length}no_opening_tab(){return this.fields[1]&&this.fields[1].fieldtype!="Tab Break"||!this.fields.length}is_tabbed_layout(){return this.fields.find(e=>e.fieldtype==="Tab Break")}replace_field(e,t,r){var s;if(t.fieldname=e,this.fields_dict[e]&&this.fields_dict[e].df){let n=this.fields_dict[e],o=this.init_field(t,n.parent,r);n.$wrapper.replaceWith(o.$wrapper);let a=this.fields_list.findIndex(l=>l==n);this.fields_list.splice(a,1,o),this.fields_dict[e]=o,this.sections.forEach(l=>l.replace_field(e,o)),(s=n.tab)==null||s.replace_field(o),this.refresh_fields([t])}}make_field(e,t,r){!this.section&&this.make_section(),!this.column&&this.make_column();let s=this.column.form.get(0),n=this.init_field(e,s,r);!n||(this.fields_list.push(n),this.fields_dict[e.fieldname]=n,this.section.add_field(n),this.column.add_field(n),this.current_tab&&this.current_tab.add_field(n))}init_field(e,t,r=!1){let s=frappe.ui.form.make_control({df:e,doctype:this.doctype,parent:t,frm:this.frm,render_input:r,doc:this.doc,layout:this});return s&&(s.layout=this),s}make_page_break(){this.page=$('<div class="form-page page-break"></div>').appendTo(this.wrapper)}make_page(e){let t=this,r=$(`
			<div class="form-clickable-section text-center">
				<a class="btn-fold h6 text-muted">
					${__("Show more details")}
				</a>
			</div>
		`).appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=r.find(".btn-fold").on("click",function(){let s=$(this).parent().next();s.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),s.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),t.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),s.addClass("hide"),t.folded=!0)}),this.section=null,this.folded=!0}unfold(){this.fold_btn.trigger("click")}make_section(e={}){this.section_count++,e.fieldname||(e.fieldname=`__section_${this.section_count}`,e.fieldtype="Section Break"),this.section=new Rr(this.current_tab?this.current_tab.wrapper:this.page,e,this.card_layout,this),this.sections.push(this.section),this.sections_dict[e.fieldname]=this.section,e&&(this.fields_dict[e.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null}make_column(e={}){this.column_count++,e.fieldname||(e.fieldname=`__column_${this.section_count}`,e.fieldtype="Column Break"),this.column=new Pr(this.section,e),e&&e.fieldname&&this.fields_list.push(this.column)}make_tab(e){this.section=null;let t=new Dr(this,e,this.frm,this.tab_link_container,this.tabs_content);return this.current_tab=t,this.make_section({fieldtype:"Section Break"}),this.tabs.push(t),t}refresh(e){e&&(this.doc=e),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse(),document.activeElement&&document.activeElement.tagName=="INPUT"&&this.is_numeric_field_active()&&document.activeElement.select()}is_numeric_field_active(){let t=($(document.activeElement).closest(".frappe-control").data()||{}).fieldtype;return frappe.model.numeric_fieldtypes.includes(t)}refresh_sections(){this.wrapper.find(".form-section:not(.hide-control)").each(function(){let e=$(this).removeClass("empty-section visible-section");e.find(".frappe-control:not(.hide-control)").length?e.addClass("visible-section"):(e.parent().hasClass("tab-pane")||e.parent().hasClass("form-page"))&&e.addClass("empty-section")}),this.is_tabbed_layout()&&this.refresh_tabs()}refresh_tabs(){for(let t of this.tabs)t.refresh();let e=this.tabs.filter(t=>!t.hidden);e&&e.length==1&&e[0].tab_link.toggleClass("hide show"),this.set_tab_as_active()}select_tab(e){var t;for(let r of this.tabs)if(r.label.toLowerCase()===e.toLowerCase()||((t=r.df.fieldname)==null?void 0:t.toLowerCase())===e.toLowerCase()){r.set_active();return}}set_tab_as_active(){var s,n;let e=window.location.hash.replace("#",""),t=this.tabs.find(o=>o.df.fieldname===e);if(t){t.set_active();return}let r=(n=(s=this.frm)==null?void 0:s.get_active_tab)==null?void 0:n.call(s);if(r)r.set_active();else if(this.tabs.length){let o=this.tabs.find(a=>!a.is_hidden());o&&o.set_active()}}refresh_fields(e){let t=e.map(r=>{if(r.fieldname)return r.fieldname});this.fields_list.map(r=>{t.includes(r.df.fieldname)&&(r.refresh(),r.df.default&&r.set_input(r.df.default))})}add_fields(e){this.render(e),this.refresh_fields(e)}refresh_section_collapse(){if(!!(this.sections&&this.sections.length))for(let e=0;e<this.sections.length;e++){let t=this.sections[e],r=t.df;if(r&&r.collapsible){let s=!0;r.collapsible_depends_on&&(s=!this.evaluate_depends_on_value(r.collapsible_depends_on)),s&&t.has_missing_mandatory()&&(s=!1),t.collapse(s)}}}attach_doc_and_docfields(e){let t=this;for(let r=0,s=this.fields_list.length;r<s;r++){let n=this.fields_list[r];t.doc&&(n.doc=t.doc,n.doctype=t.doc.doctype,n.docname=t.doc.name,n.df=frappe.meta.get_docfield(t.doc.doctype,n.df.fieldname,t.doc.name)||n.df),e&&n.df&&n.refresh&&n.refresh()}}refresh_section_count(){this.wrapper.find(".section-count-label:visible").each(function(e){$(this).html(e+1)})}setup_events(){let e=0,t=$(".form-tabs-list"),r=this.tabs_content[0];!t.length||($(".main-section").scroll(frappe.utils.throttle(()=>{let s=document.documentElement.scrollTop;s>0&&e<=s?(t.removeClass("form-tabs-sticky-down"),t.addClass("form-tabs-sticky-up")):(t.removeClass("form-tabs-sticky-up"),t.addClass("form-tabs-sticky-down")),e=s},500)),this.tab_link_container.off("click").on("click",".nav-link",s=>{s.preventDefault(),s.stopImmediatePropagation(),$(s.currentTarget).tab("show"),r.getBoundingClientRect().top<100&&(r.scrollIntoView(),setTimeout(()=>{$(".page-head").css("top","-15px"),$(".form-tabs-list").removeClass("form-tabs-sticky-down"),$(".form-tabs-list").addClass("form-tabs-sticky-up")},3))}))}setup_tab_events(){this.wrapper.on("keydown",e=>{if(e.which==9){let t=$(e.target),r=t.attr("data-doctype"),s=t.attr("data-fieldname");if(r)return this.handle_tab(r,s,e.shiftKey)}})}setup_tooltip_events(){$(document).on("keydown",e=>{e.altKey&&this.wrapper.addClass("show-tooltip")}),$(document).on("keyup",e=>{e.altKey||this.wrapper.removeClass("show-tooltip")}),this.frm.page&&frappe.ui.keys.add_shortcut({shortcut:"alt+hover",page:this.frm.page,description:__("Show Fieldname (click to copy on clipboard)")})}handle_tab(e,t,r){let s=null,n=null,o=this.fields_list,a=!1;if(e!=this.doctype){if(s=this.get_open_grid_row(),!s||!s.layout)return;o=s.layout.fields_list}for(let l=0,c=o.length;l<c;l++){if(o[l].df.fieldname==t){if(r){n?this.set_focus(n):$(this.primary_button).focus();break}if(l<c-1&&(a=this.focus_on_next_field(l,o)),a)break}this.is_visible(o[l])&&(n=o[l])}return a||(s?s.doc.idx==s.grid.grid_rows.length?s.toggle_view(!1,function(){s.grid.frm.layout.handle_tab(s.grid.df.parent,s.grid.df.fieldname)}):s.grid.grid_rows[s.doc.idx].toggle_view(!0):r||$(this.primary_button).focus()),!1}focus_on_next_field(e,t){for(let r=e+1,s=t.length;r<s;r++){let n=t[r];if(this.is_visible(n)){if(n.df.fieldtype==="Table")return n.grid.grid_rows&&n.grid.grid_rows.length||n.grid.add_new_row(),n.grid.grid_rows[0].show_form(),!0;if(n.df.fieldtype==="Table MultiSelect"||!frappe.model.no_value_type.includes(n.df.fieldtype))return this.set_focus(n),!0}}}is_visible(e){return e.disp_status==="Write"&&e.df&&"hidden"in e.df&&!e.df.hidden}set_focus(e){e.tab&&e.tab.set_active(),e.df.fieldtype=="Table"?e.grid.grid_rows.length?e.grid.grid_rows[0].toggle_view(!0):e.grid.add_new_row(1):e.editor?e.editor.set_focus():e.$input&&e.$input.focus()}get_open_grid_row(){return $(".grid-row-open").data("grid_row")}refresh_dependency(){let e=!1,t=this.fields_list.concat(this.tabs);for(let r in t){let s=t[r];if(s.df.depends_on||s.df.mandatory_depends_on||s.df.read_only_depends_on){e=!0;break}}if(!!e){for(let r=t.length-1;r>=0;r--){let s=t[r];s.guardian_has_value=!0,s.df.depends_on&&(s.guardian_has_value=this.evaluate_depends_on_value(s.df.depends_on),s.guardian_has_value?s.df.hidden_due_to_dependency&&(s.df.hidden_due_to_dependency=!1,s.refresh()):s.df.hidden_due_to_dependency||(s.df.hidden_due_to_dependency=!0,s.refresh())),s.df.mandatory_depends_on&&this.set_dependant_property(s.df.mandatory_depends_on,s.df.fieldname,"reqd"),s.df.read_only_depends_on&&this.set_dependant_property(s.df.read_only_depends_on,s.df.fieldname,"read_only")}this.refresh_section_count()}}set_dependant_property(e,t,r){let n=this.evaluate_depends_on_value(e)?1:0,o;this.frm?o=this.frm:(this.is_dialog||this.doctype==="Web Form")&&(o=this),o&&(this.doc&&this.doc.parent&&this.doc.parentfield?(o.setting_dependency=!0,o.set_df_property(this.doc.parentfield,r,n,this.doc.parent,t,this.doc.name),o.setting_dependency=!1,this.fields_dict[t]&&this.fields_dict[t].refresh()):o.set_df_property(t,r,n))}evaluate_depends_on_value(e){let t=null,r=this.doc;if(!r&&this.get_values&&(r=this.get_values(!0)),!r)return;let s=this.frm?this.frm.doc:this.doc||null;if(typeof e=="boolean")t=e;else if(typeof e=="function")t=e(r);else if(e.substr(0,5)=="eval:")try{t=frappe.utils.eval(e.substr(5),{doc:r,parent:s}),s&&s.istable&&e.includes("is_submittable")&&(t=!0)}catch(o){frappe.throw(__('Invalid "depends_on" expression'))}else if(e.substr(0,3)=="fn:"&&this.frm)t=this.frm.script_manager.trigger(e.substr(3),this.doctype,this.docname);else{var n=r[e];$.isArray(n)?t=!!n.length:t=!!n}return t}};frappe.provide("frappe.ui");frappe.ui.FieldGroup=class extends frappe.ui.form.Layout{constructor(e){super(e),this.dirty=!1,this.fetch_dict={},$.each(this.fields||[],function(t,r){!r.fieldname&&r.label&&(r.fieldname=r.label.replace(/ /g,"_").toLowerCase())}),this.values&&this.set_values(this.values)}make(){let e=this;this.fields&&(super.make(),this.refresh(),$.each(this.fields_list,function(t,r){if(r.df.default){let s=r.df.default;s=="Today"&&r.df.fieldtype=="Date"&&(s=frappe.datetime.get_today()),r.set_input(s),e.refresh_dependency()}}),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.wrapper).find("input, select").on("change awesomplete-selectcomplete",()=>{this.dirty=!0,frappe.run_serially([()=>frappe.timeout(.1),()=>e.refresh_dependency()])}))}focus_on_first_input(){this.no_focus||$.each(this.fields_list,function(e,t){if(!["Date","Datetime","Time","Check"].includes(t.df.fieldtype)&&t.set_focus)return t.set_focus(),!1})}catch_enter_as_submit(){let e=this;$(this.body).find('input[type="text"], input[type="password"], select').keypress(function(t){t.which==13&&e.has_primary_action&&(t.preventDefault(),e.get_primary_btn().trigger("click"))})}get_input(e){let t=this.fields_dict[e];return t?$(t.txt?t.txt:t.input):""}get_field(e){return this.fields_dict[e]}get_values(e,t){let r={},s=[],n=[];for(let o in this.fields_dict){let a=this.fields_dict[o];if(a.get_value){let l=a.get_value();a.df.reqd&&is_null(typeof l=="string"?strip_html(l):l)&&s.push(__(a.df.label)),a.df.reqd&&a.df.fieldtype==="Text Editor"&&is_null(strip_html(cstr(l)))&&s.push(__(a.df.label)),is_null(l)||(r[a.df.fieldname]=l)}this.is_dialog&&a.df.reqd&&!a.value&&a.refresh_input(),a.df.invalid&&n.push(__(a.df.label))}return s.length&&!e?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+s.join("<li>")+"</ul>",indicator:"orange"}),null):n.length&&t?(frappe.msgprint({title:__("Invalid Values"),message:__("Following fields have invalid values:")+"<br><br><ul><li>"+n.join("<li>")+"</ul>",indicator:"orange"}),null):r}get_value(e){let t=this.fields_dict[e];return t&&(t.get_value?t.get_value():null)}set_value(e,t){return new Promise(r=>{let s=this.fields_dict[e];s?s.set_value(t).then(()=>{var n;(n=s.set_input)==null||n.call(s,t),this.refresh_dependency(),r()}):r()})}has_field(e){return!!this.fields_dict[e]}set_input(e,t){return this.set_value(e,t)}set_values(e){let t=[];for(let r in e)this.fields_dict[r]&&t.push(this.set_value(r,e[r]));return Promise.all(t)}clear(){for(let e in this.fields_dict){let t=this.fields_dict[e];t&&t.set_input&&t.set_input(t.df.default||"")}}set_df_property(e,t,r){if(!e)return;let s=this.get_field(e);s.df[t]=r,s.refresh()}set_query(e,t,r){r?this.fields_dict[t]&&(this.fields_dict[t].grid.get_field(e).get_query=r):this.fields_dict[e]&&(this.fields_dict[e].get_query=t)}add_fetch(e,t,r,s){s||(s="*"),this.fetch_dict.setDefault(s,{}).setDefault(e,{})[r]=t}is_new(){return this.doc.__islocal}};frappe.provide("frappe.ui");window.cur_dialog=null;frappe.ui.open_dialogs=[];frappe.ui.Dialog=class extends frappe.ui.FieldGroup{constructor(e){super(),this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null,auto_make:!0},e),this.auto_make&&this.make()}make(){this.$wrapper=frappe.get_modal("",""),this.static&&(this.$wrapper.modal({backdrop:"static",keyboard:!1}),this.get_close_btn().hide()),this.size||this.set_modal_size(),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),this.size=="small"?$(this.wrapper).addClass("modal-sm"):this.size=="large"?$(this.wrapper).addClass("modal-lg"):this.size=="extra-large"&&$(this.wrapper).addClass("modal-xl"),this.make_head(),this.modal_body=this.$wrapper.find(".modal-body"),this.$body=$("<div></div>").appendTo(this.modal_body),this.body=this.$body.get(0),this.$message=$('<div class="hide modal-message"></div>').appendTo(this.modal_body),this.header=this.$wrapper.find(".modal-header"),this.footer=this.$wrapper.find(".modal-footer"),this.standard_actions=this.footer.find(".standard-actions"),this.custom_actions=this.footer.find(".custom-actions"),this.set_indicator(),super.make(),this.refresh_section_collapse(),this.action=this.action||{primary:{},secondary:{}},(this.primary_action||this.action.primary&&this.action.primary.onsubmit)&&this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit",null,"Primary action in dialog"),this.primary_action||this.action.primary.onsubmit),this.secondary_action&&this.set_secondary_action(this.secondary_action),(this.secondary_action_label||this.action.secondary&&this.action.secondary.label)&&this.set_secondary_action_label(this.secondary_action_label||this.action.secondary.label),this.minimizable&&(this.header.find(".title-section").click(()=>this.is_minimized&&this.toggle_minimize()),this.get_minimize_btn().removeClass("hide").on("click",()=>this.toggle_minimize()));var e=this;this.$wrapper.on("hide.bs.modal",function(){var t,r,s;e.display=!1,e.is_minimized=!1,e.hide_scrollbar(!1),(s=(r=(t=frappe.ui.form).get_open_grid_form)==null?void 0:r.call(t))==null||s.hide_form(),frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===e&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),e.onhide&&e.onhide(),e.on_hide&&e.on_hide()}).on("shown.bs.modal",function(){e.display=!0,window.cur_dialog=e,frappe.ui.open_dialogs.push(e),e.focus_on_first_input(),e.hide_scrollbar(!0),e.on_page_show&&e.on_page_show(),$(document).trigger("frappe.ui.Dialog:shown"),$(document).off("focusin.modal")}).on("scroll",function(){var t=$("input:focus");t.length&&["Date","Datetime","Time"].includes(t.attr("data-fieldtype"))&&t.blur()})}set_modal_size(){if(!this.fields){this.size="";return}let e=0,t=0;this.fields.forEach(r=>{r.fieldtype=="Column Break"?(t++,t>e&&(e=t)):r.fieldtype=="Section Break"&&(t=0)}),this.size=e>=4?"extra-large":e>=2?"large":""}get_primary_btn(){return this.standard_actions.find(".btn-primary")}get_minimize_btn(){return this.$wrapper.find(".modal-header .btn-modal-minimize")}set_alert(e,t="info"){this.clear_alert(),this.$alert=$(`<div class="alert alert-${t}">${e}</div>`).prependTo(this.body),this.$message.text(e)}clear_alert(){this.$alert&&this.$alert.remove()}set_message(e){this.$message.removeClass("hide"),this.$body.addClass("hide"),this.$message.text(e)}clear_message(){this.$message.addClass("hide"),this.$body.removeClass("hide")}clear(){super.clear(),this.clear_message()}set_primary_action(e,t){this.footer.removeClass("hide"),this.has_primary_action=!0;var r=this;let s=this.get_primary_btn().removeClass("hide").html(e);return typeof t=="function"&&s.off("click").on("click",function(){r.primary_action_fulfilled=!0;var n=r.get_values();!n||t&&t.apply(r,[n])}),s}set_secondary_action(e){return this.footer.removeClass("hide"),this.get_secondary_btn().removeClass("hide").off("click").on("click",e)}set_secondary_action_label(e){this.get_secondary_btn().removeClass("hide").html(e)}disable_primary_action(){this.get_primary_btn().addClass("disabled")}enable_primary_action(){this.get_primary_btn().removeClass("disabled")}make_head(){this.set_title(this.title)}set_title(e){this.$wrapper.find(".modal-title").html(e)}set_indicator(){this.indicator&&this.header.find(".indicator").removeClass().addClass("indicator "+this.indicator)}show(){return this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.$wrapper.removeClass("modal-minimize"),this.minimizable&&this.is_minimized&&($(".modal-backdrop").toggle(),this.is_minimized=!1),this.clear_message(),this.primary_action_fulfilled=!1,this.is_visible=!0,this}hide(){this.$wrapper.modal("hide"),this.is_visible=!1}get_close_btn(){return this.$wrapper.find(".btn-modal-close")}get_secondary_btn(){return this.standard_actions.find(".btn-modal-secondary")}no_cancel(){this.get_close_btn().toggle(!1)}cancel(){this.get_close_btn().trigger("click")}toggle_minimize(){$(".modal-backdrop").toggle();let e=this.$wrapper.closest(".modal").toggleClass("modal-minimize");e.attr("tabindex")?e.removeAttr("tabindex"):e.attr("tabindex",-1),this.is_minimized=!this.is_minimized;let t=this.is_minimized?"expand":"collapse";this.get_minimize_btn().html(frappe.utils.icon(t)),this.on_minimize_toggle&&this.on_minimize_toggle(this.is_minimized),this.header.find(".modal-title").toggleClass("cursor-pointer"),this.hide_scrollbar(!this.is_minimized)}hide_scrollbar(e){$("body").css("overflow",e?"hidden":"auto")}add_custom_action(e,t,r=null){this.footer.removeClass("hide");let s=$(`
			<button class="btn btn-secondary btn-sm ${r||""}">
				${e}
			</button>
		`);this.custom_actions.append(s),t&&s.click(t)}add_custom_button(){}};frappe.ui.hide_open_dialog=()=>{window.cur_dialog&&(cur_dialog.minimizable?cur_dialog.is_minimized||cur_dialog.toggle_minimize():cur_dialog.hide())};frappe.provide("frappe.messages");frappe.messages.waiting=function(i,e){return $(frappe.messages.get_waiting_message(e)).appendTo(i)};frappe.messages.get_waiting_message=function(i){return repl('<div class="msg-box" style="width: 63%; margin: 30px auto;">		<p class="text-center">%(msg)s</p></div>',{msg:i})};frappe.throw=function(i){throw typeof i=="string"&&(i={message:i,title:__("Error")}),i.indicator||(i.indicator="red"),frappe.msgprint(i),new Error(i.message)};frappe.confirm=function(i,e,t){var r=new frappe.ui.Dialog({title:__("Confirm",null,"Title of confirmation dialog"),primary_action_label:__("Yes",null,"Approve confirmation dialog"),primary_action:()=>{e&&e(),r.hide()},secondary_action_label:__("No",null,"Dismiss confirmation dialog"),secondary_action:()=>r.hide()});return r.$body.append(`<p class="frappe-confirm-message">${i}</p>`),r.show(),r.confirm_dialog=!0,t&&(r.onhide=()=>{r.primary_action_fulfilled||t()}),r};frappe.warn=function(i,e,t,r,s){let n=new frappe.ui.Dialog({title:i,indicator:"red",primary_action_label:r,primary_action:()=>{t&&t(),n.hide()},secondary_action_label:__("Cancel",null,"Secondary button in warning dialog"),secondary_action:()=>n.hide(),minimizable:s});return n.$body.append(`<div class="frappe-confirm-message">${e}</div>`),n.standard_actions.find(".btn-primary").removeClass("btn-primary").addClass("btn-danger"),n.show(),n};frappe.prompt=function(i,e,t,r){typeof i=="string"&&(i=[{label:i,fieldname:"value",fieldtype:"Data",reqd:1}]),$.isArray(i)||(i=[i]);var s=new frappe.ui.Dialog({fields:i,title:t||__("Enter Value",null,"Title of prompt dialog")});return s.set_primary_action(r||__("Submit",null,"Primary action of prompt dialog"),function(){var n=s.get_values();!n||(s.hide(),e(n))}),s.show(),s};frappe.msgprint=function(i,e,t,r){if(!i)return;let s;if($.isPlainObject(i)?s=i:typeof i=="string"&&i.substr(0,1)==="{"?s=JSON.parse(i):s={message:i,title:e,re_route:r},s.indicator||(s.indicator="blue"),s.as_list){let o=s.message.map(a=>`<li>${a}</li>`).join("");s.message=`<ul style="padding-left: 20px">${o}</ul>`}if(s.as_table){let o=s.message.map(a=>`<tr>${a.map(c=>`<td>${c}</td>`).join("")}</tr>`).join("");s.message=`<table class="table table-bordered" style="margin: 0;">${o}</table>`}if(s.message instanceof Array){let o=s.message,a=o.map(l=>typeof l=="string"?JSON.parse(l):l).filter(l=>l.raise_exception);a.length&&(o=a),o.forEach(function(l){frappe.msgprint(l)});return}if(s.alert||s.toast){frappe.show_alert(s);return}if(frappe.msg_dialog&&s.re_route&&(frappe.msg_dialog.custom_onhide=function(){frappe.route_flags.replace_route=!0;let o=frappe.get_prev_route();o.length==0&&frappe.set_route(""),frappe.set_route(o)}),frappe.msg_dialog||(frappe.msg_dialog=new frappe.ui.Dialog({title:__("Message"),onhide:function(){frappe.msg_dialog.custom_onhide&&frappe.msg_dialog.custom_onhide(),frappe.msg_dialog.msg_area.empty()},minimizable:s.is_minimizable||t}),frappe.msg_dialog.msg_area=$('<div class="msgprint">').appendTo(frappe.msg_dialog.body),frappe.msg_dialog.clear=function(){frappe.msg_dialog.msg_area.empty()},frappe.msg_dialog.indicator=frappe.msg_dialog.header.find(".indicator")),s.primary_action){if(s.primary_action.server_action&&typeof s.primary_action.server_action=="string"&&(s.primary_action.action=()=>{frappe.call({method:s.primary_action.server_action,args:s.primary_action.args,callback(){s.primary_action.hide_on_success&&frappe.hide_msgprint()}})}),s.primary_action.client_action&&typeof s.primary_action.client_action=="string"){let o=s.primary_action.client_action.split("."),a=window;for(let l of o)a=a[l];s.primary_action.action=()=>{typeof a=="function"&&a(s.primary_action.args)}}frappe.msg_dialog.set_primary_action(__(s.primary_action.label)||__(s.primary_action_label)||__("Done"),s.primary_action.action)}else frappe.msg_dialog.has_primary_action&&(frappe.msg_dialog.get_primary_btn().addClass("hide"),frappe.msg_dialog.has_primary_action=!1);s.secondary_action&&(frappe.msg_dialog.set_secondary_action(s.secondary_action.action),frappe.msg_dialog.set_secondary_action_label(__(s.secondary_action.label)||__("Close"))),s.message==null&&(s.message=""),s.message.search(/<br>|<p>|<li>/)==-1&&(i=frappe.utils.replace_newlines(s.message));var n=!1;return s.clear?frappe.msg_dialog.msg_area.empty():n=frappe.msg_dialog.msg_area.html(),(s.title||!n)&&frappe.msg_dialog.set_title(s.title||__("Message",null,"Default title of the message dialog")),s.indicator?frappe.msg_dialog.indicator.removeClass().addClass("indicator "+s.indicator):frappe.msg_dialog.indicator.removeClass().addClass("hidden"),s.wide?frappe.msg_dialog.wrapper.classList.contains("msgprint-dialog")&&frappe.msg_dialog.wrapper.classList.remove("msgprint-dialog"):frappe.msg_dialog.wrapper.classList.add("msgprint-dialog"),n&&frappe.msg_dialog.msg_area.append("<hr>"),frappe.msg_dialog.msg_area.append(s.message),frappe.msg_dialog.$wrapper.css("z-index",2e3),frappe.msg_dialog.show(),frappe.msg_dialog};window.msgprint=frappe.msgprint;frappe.hide_msgprint=function(i){frappe.msg_dialog&&frappe.msg_dialog.msg_area&&frappe.msg_dialog.msg_area.empty(),frappe.msg_dialog&&frappe.msg_dialog.$wrapper.is(":visible")&&(i&&frappe.msg_dialog.$wrapper.removeClass("fade"),frappe.msg_dialog.hide(),i&&frappe.msg_dialog.$wrapper.addClass("fade"))};frappe.update_msgprint=function(i){!frappe.msg_dialog||frappe.msg_dialog&&!frappe.msg_dialog.$wrapper.is(":visible")?frappe.msgprint(i):frappe.msg_dialog.msg_area.html(i)};frappe.verify_password=function(i){frappe.prompt({fieldname:"password",label:__("Enter your password"),fieldtype:"Password",reqd:1},function(e){frappe.call({method:"frappe.core.doctype.user.user.verify_password",args:{password:e.password},callback:function(t){t.exc||i()}})},__("Verify Password"),__("Verify"))};frappe.show_progress=(i,e,t=100,r,s=!1)=>{let n;return frappe.cur_progress&&frappe.cur_progress.title===i&&frappe.cur_progress.is_visible?n=frappe.cur_progress:(n=new frappe.ui.Dialog({title:i}),n.progress=$(`<div>
			<div class="progress">
				<div class="progress-bar"></div>
			</div>
			<p class="description text-muted small"></p>
		</div`).appendTo(n.body),n.progress_bar=n.progress.css({"margin-top":"10px"}).find(".progress-bar"),n.$wrapper.removeClass("fade"),n.show(),frappe.cur_progress=n),r&&n.progress.find(".description").text(r),n.percent=cint(flt(e)*100/t),n.progress_bar.css({width:n.percent+"%"}),s&&n.percent===100&&setTimeout(frappe.hide_progress,500),frappe.cur_progress.$wrapper.css("z-index",2e3),n};frappe.hide_progress=function(){frappe.cur_progress&&(frappe.cur_progress.hide(),frappe.cur_progress=null)};frappe.show_alert=frappe.toast=function(i,e=7,t={}){let r={orange:"solid-warning",yellow:"solid-warning",blue:"solid-info",green:"solid-success",red:"solid-error"};typeof i=="string"&&(i={message:i}),$("#dialog-container").length||$('<div id="dialog-container"><div id="alert-container"></div></div>').appendTo("body");let s;i.indicator?s=r[i.indicator.toLowerCase()]||"solid-"+i.indicator:s="solid-info";let n=i.indicator||"blue",o=$(`
		<div class="alert desk-alert ${n}" role="alert">
			<div class="alert-message-container">
				<div class="alert-title-container">
					<div>${frappe.utils.icon(s,"lg")}</div>
					<div class="alert-message">${i.message}</div>
				</div>
				<div class="alert-subtitle">${i.subtitle||""}</div>
			</div>
			<div class="alert-body" style="display: none"></div>
			<a class="close">${frappe.utils.icon("close-alt")}</a>
		</div>
	`);return o.hide().appendTo("#alert-container").show(),i.body&&o.find(".alert-body").show().html(i.body),o.find(".close, button").click(function(){return o.addClass("out"),setTimeout(()=>o.remove(),800),!1}),Object.keys(t).map(a=>{o.find(`[data-action=${a}]`).on("click",t[a])}),e>2&&(e=e-.8),setTimeout(()=>(o.addClass("out"),setTimeout(()=>o.remove(),800),!1),e*1e3),o};frappe.provide("frappe.ui.keys");var dn=new WeakMap,Xl=[];frappe.ui.keys.shortcut_groups=dn;frappe.ui.keys.get_shortcut_group=i=>(dn.has(i)||dn.set(i,new frappe.ui.keys.AltShortcutGroup),dn.get(i));var Kl=!1,ht=null,bo=$(document.body);frappe.ui.keys.bind_shortcut_group_event=()=>{if(Kl)return;Kl=!0;function i(){ht?(ht.addClass("alt-pressed"),bo.removeClass("alt-pressed")):(bo.addClass("alt-pressed"),ht&&ht.removeClass("alt-pressed"))}function e(){ht&&ht.removeClass("alt-pressed"),bo.removeClass("alt-pressed")}$(document).on("keydown",t=>{let r=(frappe.ui.keys.key_map[t.which]||"").toLowerCase();if(r==="alt"&&i(),!(t.shiftKey||t.ctrlKey||t.metaKey)&&r&&t.altKey){let s=F_(r);s&&(t.preventDefault(),s.$target[0].click()),i()}}),$(document).on("keyup",t=>{t.key==="Alt"&&e()}),$(document).on("mousemove",()=>{e()})};function F_(i){let e=Xl.filter(r=>i in r.shortcuts_dict).map(r=>r.shortcuts_dict[i]).filter(r=>r.$target.is(":visible")),t=null;return ht&&ht.is(".open")&&(t=e.find(r=>$.contains(ht[0],r.$target[0]))),t||(t=e.find(r=>$.contains(window.cur_page.page.page.wrapper[0],r.$target[0])),t)}frappe.ui.keys.AltShortcutGroup=class{constructor(){this.shortcuts_dict={},ht=null,this.bind_events(),frappe.ui.keys.bind_shortcut_group_event(),Xl.push(this)}bind_events(){$(document).on("show.bs.dropdown",e=>{ht&&ht.removeClass("alt-pressed");let t=$(e.target);t.is(".dropdown, .btn-group")&&(ht=t)}),$(document).on("hide.bs.dropdown",()=>{ht&&ht.removeClass("alt-pressed"),ht=null})}add(e,t){t||(t=e);let r=t.text().trim(),n=r.split("").find(a=>{a=a.toLowerCase();let l=a>="a"&&a<="z";return!this.is_taken(a)&&l});if(!n){t.attr("data-label",encodeURIComponent(r));return}for(let a in this.shortcuts_dict){let l=this.shortcuts_dict[a];if(l.text===r){l.$target=e,l.$text_el=t,this.underline_text(l);return}}let o={$target:e,$text_el:t,letter:n,text:r};this.shortcuts_dict[n.toLowerCase()]=o,this.underline_text(o)}underline_text(e){if(frappe.boot.lang==="eo")return;e.$text_el.attr("data-label",encodeURIComponent(e.text));let t=!1,r=e.text.split("").map(n=>(n===e.letter&&!t&&(n=`<span class="alt-underline">${n}</span>`,t=!0),n)).join("");r=`<span>${r}</span>`,r=e.$text_el.html().replace(e.text.trim(),r.trim()),e.$text_el.html(r)}is_taken(e){let t=frappe.ui.keys.standard_shortcuts.filter(r=>!r.page).some(r=>r.shortcut===`alt+${e}`);return e in this.shortcuts_dict||t}};frappe.provide("frappe.ui.keys.handlers");frappe.ui.keys.setup=function(){$(window).on("keydown",function(i){var e=frappe.ui.keys.get_key(i);if(frappe.ui.keys.handlers[e]){for(var t=null,r=0,s=frappe.ui.keys.handlers[e].length;r<s;r++){var n=frappe.ui.keys.handlers[e][r],o=n.apply(this,[i]);o===!1&&(t=o)}return t}})};var Ti=[];frappe.ui.keys.standard_shortcuts=Ti;frappe.ui.keys.add_shortcut=({shortcut:i,action:e,description:t,page:r,target:s,condition:n,ignore_inputs:o=!1}={})=>{if(s instanceof jQuery){let u=s;e=()=>{u[0].click()}}n||(n=()=>!0);let a=u=>{if(!($(document.activeElement).is("input, select, textarea, [contenteditable=true]")&&!o)&&!!n()&&e&&(!r||r.wrapper.is(":visible"))){let w=e(u);(w||w===void 0)&&u.preventDefault()}};a.page=r,frappe.ui.keys.off(i,r),frappe.ui.keys.on(i,a);let l=Ti.findIndex(u=>u.shortcut===i),c={shortcut:i,action:e,description:t,page:r,condition:n};l===-1?Ti.push(c):Ti[l]=c};frappe.ui.keys.show_keyboard_shortcut_dialog=()=>{if(frappe.ui.keys.is_dialog_shown)return;let i=Ti.filter(l=>!l.page),e=Ti.filter(l=>l.page&&l.page===window.cur_page.page.page),t=Ti.filter(l=>l.page&&l.page===window.cur_page.page.frm);function r(l,c){if(!l.length)return"";let u=l.filter(p=>p.condition?p.condition():!0).filter(p=>!!p.description).map(p=>{let m=p.shortcut.split("+").map(frappe.utils.to_title_case).join("+");return frappe.utils.is_mac()&&(m=m.replace("Ctrl","\u2318").replace("Alt","\u2325")),m=m.replace("Shift","\u21E7"),`<tr>
					<td width="40%"><kbd>${m}</kbd></td>
					<td width="60%">${p.description||""}</td>
				</tr>`}).join("");return u?(u=`<h5 style="margin: 0;">${c}</h5>
			<table style="margin-top: 10px;" class="table table-bordered">
				${u}
			</table>`,u):""}let s=r(i,__("Global Shortcuts")),n=r(e,__("Page Shortcuts")),o=r(t,__("Grid Shortcuts")),a=new frappe.ui.Dialog({title:__("Keyboard Shortcuts"),on_hide(){frappe.ui.keys.is_dialog_shown=!1}});a.$body.append(s),a.$body.append(n),a.$body.append(o),a.$body.append(`
		<div class="text-muted">
			${__("Press Alt Key to trigger additional shortcuts in Menu and Sidebar")}
		</div>
	`),a.show(),frappe.ui.keys.is_dialog_shown=!0};frappe.ui.keys.get_key=function(i){var e=i.keyCode||i.which,t=frappe.ui.keys.key_map[e]||String.fromCharCode(e);return(i.ctrlKey||i.metaKey)&&(t="ctrl+"+t),i.shiftKey&&(t="shift+"+t),i.altKey&&(t="alt+"+t),i.altKey&&i.ctrlKey,t.toLowerCase()};frappe.ui.keys.on=function(i,e){frappe.ui.keys.handlers[i]||(frappe.ui.keys.handlers[i]=[]),frappe.ui.keys.handlers[i].push(e)};frappe.ui.keys.off=function(i,e){let t=frappe.ui.keys.handlers[i];!t||t.length===0||(frappe.ui.keys.handlers[i]=t.filter(r=>e?r.page!==e:!1))};frappe.ui.keys.add_shortcut({shortcut:"ctrl+s",action:function(i){var e;return(e=document.activeElement)==null||e.blur(),frappe.app.trigger_primary_action(),i.preventDefault(),!1},description:__("Trigger Primary Action"),ignore_inputs:!0});frappe.ui.keys.add_shortcut({shortcut:"ctrl+g",action:function(i){return $("#navbar-search").focus(),i.preventDefault(),!1},description:__("Open Awesomebar")});frappe.ui.keys.add_shortcut({shortcut:"ctrl+k",action:function(i){return $("#navbar-search").focus(),i.preventDefault(),!1},description:__("Open Awesomebar")});frappe.ui.keys.add_shortcut({shortcut:"alt+s",action:function(i){i.preventDefault(),$(".dropdown-navbar-user button").eq(0).click()},description:__("Open Settings")});frappe.ui.keys.add_shortcut({shortcut:"shift+/",action:function(){frappe.ui.keys.show_keyboard_shortcut_dialog()},description:__("Show Keyboard Shortcuts")});frappe.ui.keys.add_shortcut({shortcut:"alt+h",action:function(i){i.preventDefault(),$(".dropdown-help button").eq(0).click()},description:__("Open Help")});frappe.ui.keys.on("escape",function(i){Jl()});frappe.ui.keys.on("esc",function(i){Jl()});frappe.ui.keys.on("enter",function(i){window.cur_dialog&&cur_dialog.confirm_dialog&&cur_dialog.get_primary_btn().trigger("click")});frappe.ui.keys.on("ctrl+down",function(i){let e=frappe.ui.form.get_open_grid_form();e!=null&&e.has_next()?e.toggle_view(!1,function(){e.open_next()}):i.preventDefault()});frappe.ui.keys.on("ctrl+up",function(i){let e=frappe.ui.form.get_open_grid_form();e!=null&&e.has_prev()?e.toggle_view(!1,function(){e.open_prev()}):i.preventDefault()});frappe.ui.keys.add_shortcut({shortcut:"shift+ctrl+r",action:function(){frappe.ui.toolbar.clear_cache()},description:__("Clear Cache and Reload")});frappe.ui.keys.key_map={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",91:"meta",18:"alt",27:"escape",37:"left",39:"right",38:"up",40:"down",32:"space",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",191:"/",188:"<",190:">"};"abcdefghijklmnopqrstuvwxyz".split("").forEach((i,e)=>{frappe.ui.keys.key_map[65+e]=i});frappe.ui.keyCode={ESCAPE:27,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,TAB:9,SPACE:32,BACKSPACE:8};function Jl(){var i;H_(),(i=document.activeElement)==null||i.blur()}function H_(){var i=$(".grid-row-open");if(i.length){var e=i.data("grid_row");return e.toggle_view(!1),!1}if(cur_dialog&&!cur_dialog.no_cancel_flag&&!cur_dialog.static)return cur_dialog.cancel(),!1}frappe.provide("frappe.ui");frappe.ui.color={get:function(i,e){return i&&e?this.get_color_shade(i,e):i?this.get_color_shade(i,"default"):frappe.ui.color_map},get_color:function(i){let e=Object.keys(frappe.ui.color_map);if(e.includes(i))return frappe.ui.color_map[i];console.warn(`'color_name' can be one of ${e} and not ${i}`)},get_color_map(){let i=["red","green","blue","dark-green","yellow","gray","purple","pink","orange"],e=["100","300","500","700"],t=getComputedStyle(document.body),r={};return i.forEach(s=>{r[s]=e.map(n=>t.getPropertyValue(`--${s}-${n}`).trim())}),r},get_color_shade:function(i,e){let t={default:2,light:1,"extra-light":0,dark:3};if(Object.keys(t).includes(e)){let r=this.get_color(i);return r?r[t[e]]:i}else console.warn(`'shade' can be one of ${Object.keys(t)} and not ${e}`)},all:function(){return Object.values(frappe.ui.color_map).reduce((i,e)=>i.concat(e),[])},names:function(){return Object.keys(frappe.ui.color_map)},is_standard:function(i){return i?i.startsWith("#")?this.all().includes(i):this.names().includes(i):!1},get_color_name:function(i){for(let e in frappe.ui.color_map)if(frappe.ui.color_map[e].includes(i))return e},get_contrast_color:function(i){if(!this.validate_hex(i))return;if(!this.is_standard(i))return this.brightness(i)<128?this.lighten(i,.5):this.lighten(i,-.5);let e=this.get_color_name(i);return this.get_color(e).indexOf(i)<=1?this.get(e,"dark"):this.get(e,"extra-light")},validate_hex:function(i){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(i)},lighten(i,e){var t=parseInt(i.slice(1),16),r=e<0?0:255,s=e<0?e*-1:e,n=t>>16,o=t>>8&255,a=t&255;return"#"+(16777216+(Math.round((r-n)*s)+n)*65536+(Math.round((r-o)*s)+o)*256+(Math.round((r-a)*s)+a)).toString(16).slice(1)},hex_to_rgb(i){i.startsWith("#")&&(i=i.substring(1));let e=parseInt(i.substring(0,2),16),t=parseInt(i.substring(2,4),16),r=parseInt(i.substring(4,6),16);return{r:e,g:t,b:r}},brightness(i){let e=this.hex_to_rgb(i);return(e.r*299+e.g*587+e.b*114)/1e3}};frappe.ui.color_map=frappe.ui.color.get_color_map();frappe.templates.sidebar=`<div class="body-sidebar-container">
	<div class="body-sidebar-placeholder"></div>
		<div class="body-sidebar">
			<div class="body-sidebar-top">
				<div class="sidebar-items">
				</div>
			</div>
			<div class="body-sidebar-bottom">
				<a class="collapse-sidebar-link">
					<svg class="icon" style="margin-top: -2px">
						<use href="#icon-arrow-right-to-line"></use></svg> {%= __("Collapse") %}</a>
			</div>
		</div>
		<div class="overlay" style="z-index: 1021;"></div>
	</div>
</div>
`;frappe.ui.Sidebar=class{constructor(){this.items={},this.child_items=[],this.sidebar_expanded=!1,frappe.boot.setup_complete&&(this.set_all_pages(),this.make_dom(),this.sidebar_items={public:{},private:{}},this.indicator_colors=["green","cyan","blue","orange","yellow","gray","grey","red","pink","darkgrey","purple","light-blue"],this.setup_pages(),this.apps_switcher.populate_apps_menu())}make_dom(){this.set_default_app(),this.wrapper=$(frappe.render_template("sidebar")).prependTo("body"),this.app_switcher_dropdown=$(frappe.render_template("apps_switcher",{app_logo_url:frappe.boot.app_data[0].app_logo_url,app_title:__(frappe.boot.app_data[0].app_title)})).prependTo(this.wrapper.find(".body-sidebar")),this.$sidebar=this.wrapper.find(".sidebar-items"),this.wrapper.find(".body-sidebar .collapse-sidebar-link").on("click",()=>{frappe.is_mobile()&&this.apps_switcher.app_switcher_menu.toggleClass("hidden"),this.toggle_sidebar()}),this.wrapper.find(".overlay").on("click",()=>{this.close_sidebar()}),this.apps_switcher=new frappe.ui.AppsSwitcher(this),this.apps_switcher.create_app_data_map()}set_hover(){$(".standard-sidebar-item > .item-anchor").on("mouseover",function(e){$(this).parent().hasClass("active-sidebar")||$(this).parent().addClass("hover")}),$(".standard-sidebar-item > .item-anchor").on("mouseleave",function(){$(this).parent().removeClass("hover")})}set_all_pages(){this.sidebar_pages=frappe.boot.sidebar_pages,this.all_pages=this.sidebar_pages.pages,this.has_access=this.sidebar_pages.has_access,this.has_create_access=this.sidebar_pages.has_create_access}set_default_app(){frappe.boot.app_data.sort((e,t)=>e.workspaces.length<t.workspaces.length?1:-1),frappe.current_app=frappe.boot.app_data[0].app_name}set_active_workspace_item(){if(!frappe.get_route())return;let e=frappe.get_route(),t=frappe.get_route_str(),r;if(e[0]=="Workspaces")r=e[1];else if(frappe.breadcrumbs){if(Object.keys(frappe.breadcrumbs.all).length==0)return;frappe.breadcrumbs.all[t]&&(r=frappe.breadcrumbs.all[t].workspace||frappe.breadcrumbs.all[t].module)}if(this.is_route_in_sidebar(r)&&this.active_item.addClass("active-sidebar"),this.active_item&&this.is_nested_item(this.active_item.parent())){let s=this.active_item.parent();this.expand_parent_item(s)}this.sidebar_expanded||this.close_children_item()}expand_parent_item(e){let t=e.attr("item-parent");if(!t)return;let r=this.get_sidebar_item(t);if(r){let n=$(r).find(".drop-icon").find("use").attr("href")==="#es-line-down";$($(r).children()[1]).hasClass("hidden")&&($(r).find(".drop-icon")[0].click(),this.is_nested_item($(r))&&this.expand_parent_item($(r)))}}is_nested_item(e){return!!e.attr("item-parent")}get_sidebar_item(e){let t="";return $(".sidebar-item-container").each(function(){$(this).attr("item-name")==e&&(t=this)}),t}is_route_in_sidebar(e){let t=!1,r=this;return $(".item-anchor").each(function(){if($(this).attr("title")==e)return t=!0,r.active_item&&r.active_item.removeClass("active-sidebar"),r.active_item=$(this).parent(),!1}),t}setup_pages(){if(this.set_all_pages(),this.all_pages.forEach(e=>{e.is_editable=!e.public||this.has_access,typeof e.content=="string"&&(e.content=JSON.parse(e.content))}),this.all_pages){frappe.workspaces={},frappe.workspace_list=[],frappe.workspace_map={};for(let e of this.all_pages)frappe.workspaces[frappe.router.slug(e.name)]={name:e.name,public:e.public},!e.app&&e.module&&(e.app=frappe.boot.module_app[frappe.slug(e.module)]),frappe.workspace_map[e.name]=e,frappe.workspace_list.push(e);this.make_sidebar()}this.set_hover(),this.set_sidebar_state(),this.sidebar_expanded||this.close_children_item()}set_sidebar_state(){this.sidebar_expanded=!0,localStorage.getItem("sidebar-expanded")!==null&&(this.sidebar_expanded=JSON.parse(localStorage.getItem("sidebar-expanded"))),frappe.is_mobile()&&(this.sidebar_expanded=!1),this.expand_sidebar()}make_sidebar(){this.wrapper.find(".standard-sidebar-section")[0]&&this.wrapper.find(".standard-sidebar-section").remove();let e=frappe.boot.app_data_map[frappe.current_app||"frappe"].workspaces,t=this.all_pages.filter(r=>!r.parent_page).uniqBy(r=>r.name);frappe.current_app==="private"?t=t.filter(r=>!r.public):t=t.filter(r=>r.public&&e.includes(r.name)),this.build_sidebar_section("All",t),this.wrapper.find(".selected").length&&!frappe.dom.is_element_in_viewport(this.wrapper.find(".selected"))&&this.wrapper.find(".selected")[0].scrollIntoView(),this.setup_sorting(),this.set_active_workspace_item(),this.set_hover()}build_sidebar_section(e,t){let r=$(`<div class="standard-sidebar-section nested-container" data-title="${e}"></div>`);this.prepare_sidebar(t,r,this.wrapper.find(".sidebar-items")),Object.keys(t).length===0&&r.addClass("hidden"),$(".item-anchor").on("click",()=>{$(".list-sidebar.hidden-xs.hidden-sm").removeClass("opened"),$("body").css("overflow","auto"),frappe.is_mobile()&&this.close_sidebar()}),r.find(".sidebar-item-container").length&&r.find("> [item-is-hidden='0']").length==0&&r.addClass("hidden show-in-edit-mode")}prepare_sidebar(e,t,r){let s=null;for(let n of e)n.public&&s&&!s.public&&$('<div class="divider"></div>').appendTo(t),n.visibility!==0&&this.append_item(n,t),s=n;t.appendTo(r)}toggle_sidebar(){this.sidebar_expanded?this.close_sidebar():this.open_sidebar()}expand_sidebar(){let e;this.sidebar_expanded?(this.wrapper.addClass("expanded"),e="left"):(this.wrapper.removeClass("expanded"),e="right"),localStorage.setItem("sidebar-expanded",this.sidebar_expanded),this.wrapper.find(".body-sidebar .collapse-sidebar-link").find("use").attr("href",`#icon-arrow-${e}-to-line`)}append_item(e,t){let r=!1;e.selected=r,r&&(this.current_page={name:e.name,public:e.public});let s=this.sidebar_item_container(e),n=s.find(".sidebar-item-control"),o=this.all_pages.filter(a=>a.parent_page==e.name||a.parent_page==e.title);if(o.length>0){let a=s.find(".sidebar-child-item");a.addClass("hidden"),this.prepare_sidebar(o,a,s),this.child_items.push(a)}s.appendTo(t),this.sidebar_items[e.public?"public":"private"][e.name]=s,s.parent().hasClass("hidden")&&r&&s.parent().toggleClass("hidden"),this.add_toggle_children(e,n,s),o.length>0&&s.find(".drop-icon").first().addClass("show-in-edit-mode")}sidebar_item_container(e){e.indicator_color=e.indicator_color||this.indicator_colors[Math.floor(Math.random()*12)];let t;return e.type==="Link"?e.link_type==="Report"?t=frappe.utils.generate_route({type:e.link_type,name:e.link_to,is_query_report:e.report.report_type==="Query Report",report_ref_doctype:e.report.ref_doctype}):t=frappe.utils.generate_route({type:e.link_type,name:e.link_to}):e.type==="URL"?t=e.external_link:e.public?t="/app/"+frappe.router.slug(e.name):t="/app/private/"+frappe.router.slug(e.name.split("-")[0]),$(`
			<div
				class="sidebar-item-container ${e.is_editable?"is-draggable":""}"
				item-parent="${e.parent_page}"
				item-name="${e.name}"
				item-title="${e.title}"
				item-public="${e.public||0}"
				item-is-hidden="${e.is_hidden||0}"
			>
				<div class="standard-sidebar-item ${e.selected?"selected":""}">
					<a
						href="${t}"
						target="${e.type==="URL"?"_blank":""}"
						class="item-anchor ${e.is_editable?"":"block-click"}" title="${__(e.title)}"
					>
						<span class="sidebar-item-icon" item-icon=${e.icon||"folder-normal"}>
							${e.public||e.icon?frappe.utils.icon(e.icon||"folder-normal","md"):`<span class="indicator ${e.indicator_color}"></span>`}
						</span>
						<span class="sidebar-item-label">${__(e.title)}<span>
					</a>
					<div class="sidebar-item-control"></div>
				</div>
				<div class="sidebar-child-item nested-container"></div>
			</div>
		`)}add_toggle_children(e,t,r){let s="es-line-down";this.current_page&&r.find(`[item-name="${this.current_page.name}"]`).length&&(s="small-up");let n=r.find(".sidebar-child-item"),o=$('<button class="btn-reset drop-icon hidden">').html(frappe.utils.icon(s,"sm")).appendTo(t);this.all_pages.some(a=>(a.parent_page==e.title||a.parent_page==e.name)&&(a.is_hidden==0||!this.is_read_only))&&o.removeClass("hidden"),o.on("click",()=>{o.find("use").attr("href")==="#es-line-down"?o.attr("data-state","opened").find("use").attr("href","#es-line-up"):o.attr("data-state","closed").find("use").attr("href","#es-line-down"),n.toggleClass("hidden")})}toggle_sorting(){this.sorting_items.forEach(e=>{var t=e.option("disabled");e.option("disabled",!t)})}setup_sorting(){if(!!this.has_access){this.sorting_items=[];for(let e of this.$sidebar.find(".nested-container"))this.sorting_items[this.sorting_items.length]=Sortable.create(e,{group:"sidebar-items",disabled:!0,onEnd:()=>{let t=[];for(let r of this.$sidebar.find(".nested-container"))for(let s of $(r).children()){let n="";$(s).parent().hasClass("sidebar-child-item")&&(n=$(s).parent().closest(".sidebar-item-container").attr("item-name")),t.push({name:s.getAttribute("item-name"),parent:n})}frappe.xcall("frappe.desk.doctype.workspace_settings.workspace_settings.set_sequence",{sidebar_items:t})}})}}close_sidebar(){this.sidebar_expanded=!1,this.expand_sidebar(),this.close_children_item()}open_sidebar(){this.sidebar_expanded=!0,this.expand_sidebar(),this.set_active_workspace_item()}close_children_item(){this.child_items.forEach(e=>{e.addClass("hidden")})}reload(){return frappe.workspace.get_pages().then(e=>{frappe.boot.sidebar_pages=e,this.setup_pages()})}set_height(){$(".body-sidebar").css("height",window.innerHeight+"px"),$(".overlay").css("height",window.innerHeight+"px"),document.body.style.overflow="hidden"}};frappe.ui.AppsSwitcher=class{constructor(e){this.drop_down_state=!1,this.sidebar_wrapper=e.wrapper,this.sidebar=e,this.app_switcher=$(e.app_switcher_dropdown[0]),this.setup_app_switcher(),this.set_hover()}setup_app_switcher(){this.app_switcher_menu=$(".app-switcher-menu"),$(".app-switcher-dropdown").on("click",()=>{this.toggle_active(),this.app_switcher_menu.toggleClass("hidden")})}create_app_data_map(){var t;frappe.boot.app_data_map={};for(var e of frappe.boot.app_data)frappe.boot.app_data_map[e.app_name]=e,(t=e.workspaces)!=null&&t.length&&this.add_app_item(e)}populate_apps_menu(){this.add_private_app(),this.add_website_select(),this.add_settings_select(),this.setup_select_app()}add_app_item(e){$(`<div class="app-item" data-app-name="${e.app_name}"
			data-app-route="${e.app_route}">
			<a>
				<div class="sidebar-item-icon">
					<img
						class="app-logo"
						src="${e.app_logo_url}"
						alt="${__("App Logo")}"
					>
				</div>
				<span class="app-item-title">${e.app_title}</span>
			</a>
		</div>`).appendTo(this.app_switcher_menu)}add_private_app(){let e=this.sidebar.all_pages.filter(r=>r.public===0);if(e.length===0)return;let t={app_name:"private",app_title:__("My Workspaces"),app_route:"/app/private",app_logo_url:"/assets/frappe/images/frappe-framework-logo.svg",workspaces:e};frappe.boot.app_data_map.private=t,$('<div class="divider"></div>').prependTo(this.app_switcher_menu),$(`<div class="app-item" data-app-name="${t.app_name}"
			data-app-route="${t.app_route}">
			<a>
				<div class="sidebar-item-icon">
					<img
						class="app-logo"
						src="${t.app_logo_url}"
						alt="${__("App Logo")}"
					>
				</div>
				<span class="app-item-title">${t.app_title}</span>
			</a>
		</div>`).prependTo(this.app_switcher_menu)}setup_select_app(){this.app_switcher_menu.find(".app-item").on("click",e=>{let t=$(e.delegateTarget),r=t.attr("data-app-route");if(this.app_switcher_menu.toggleClass("hidden"),this.toggle_active(),t.attr("data-app-name")=="settings"){frappe.quick_edit("Workspace Settings");return}if(r.startsWith("/app/private")){this.set_current_app("private");let s=Object.values(frappe.workspace_map).find(n=>n.public===0);r+="/"+frappe.router.slug(s.title),frappe.set_route(r)}else r.startsWith("/app")?(frappe.set_route(r),this.set_current_app(t.attr("data-app-name"))):window.open(r)})}add_website_select(){$('<div class="divider"></div>').appendTo(this.app_switcher_menu),this.add_app_item({app_name:"website",app_title:__("Website"),app_route:"/",app_logo_url:"/assets/frappe/images/web.svg"},this.app_switcher_menu)}add_settings_select(){$('<div class="divider"></div>').appendTo(this.app_switcher_menu),this.add_app_item({app_name:"settings",app_title:__("Settings"),app_logo_url:"/assets/frappe/images/settings-gear.svg"});let e=this.app_switcher_menu.children().last()}set_current_app(e){if(!e){console.warn("set_current_app: app not defined");return}let t=frappe.boot.app_data_map[e]||frappe.boot.app_data_map.frappe;this.sidebar_wrapper.find(".app-switcher-dropdown .sidebar-item-icon img").attr("src",t.app_logo_url),this.sidebar_wrapper.find(".app-switcher-dropdown .sidebar-item-label").html(t.app_title),$(".navbar-brand .app-logo").attr("src",t.app_logo_url),frappe.current_app!==e&&(frappe.current_app=e,frappe.app.sidebar.make_sidebar())}set_hover(){let e=this;this.app_switcher.on("mouseover",function(){$(this).hasClass("active-sidebar")||($(this).addClass("hover"),e.sidebar.sidebar_expanded||$(this).removeClass("hover"))}),this.app_switcher.on("mouseleave",function(){$(this).removeClass("hover")})}toggle_active(){this.app_switcher.toggleClass("active-sidebar"),this.sidebar.sidebar_expanded||this.app_switcher.removeClass("active-sidebar")}};frappe.templates.apps_switcher=`<a class="app-switcher-dropdown" style="text-decoration: none;">
    <div class="standard-sidebar-item">
        <div class="d-flex">
            <div class="sidebar-item-icon app-logo-container">
                <img class="app-logo"
                    src="{%= app_logo_url %}" alt="{%= ("App Logo") %}">
            </div>
            <div class="sidebar-item-label app-title" style="margin-left: 10px; margin-top: 1px">
                {%= app_title %}
            </div>
        </div>
        <div class="sidebar-item-control">
            <button class="btn-reset drop-icon show-in-edit-mode">
                <svg class="es-icon es-line  icon-sm" style="display: block;margin:auto;" aria-hidden="true">
                    <use class="" href="#es-line-down"></use>
                </svg>
            </button>
        </div>
    </div>
</a>

<div class="app-switcher-menu hidden" role="menu">
</div>`;frappe.ui.LinkPreview=class{constructor(){this.popovers_list=[],this.LINK_CLASSES='a[data-doctype], input[data-fieldtype="Link"], .popover',this.popover_timeout=null,this.setup_events()}setup_events(){$(document.body).on("mouseover",this.LINK_CLASSES,i=>{this.link_hovered=!0,this.element=$(i.currentTarget),this.is_link=this.element.get(0).tagName.toLowerCase()==="a",this.element.parents().find(".popover").length||(this.identify_doc(),this.popover=this.element.data("bs.popover"),this.name&&this.doctype&&this.setup_popover_control(i))}),this.handle_popover_hide()}identify_doc(){this.is_link?(this.doctype=this.element.attr("data-doctype"),this.name=frappe.utils.unescape_html(this.element.attr("data-name")),this.href=this.element.attr("href")):(this.href=this.element.parents(".control-input-wrapper").find(".control-value a").attr("href"),this.doctype=this.element.attr("data-target"),this.name=this.element.val())}setup_popover_control(i){!(frappe.boot.link_preview_doctypes||[]).includes(this.doctype)||(this.element.on("change",()=>{this.new_popover=!0}),!this.popover||this.new_popover?this.data_timeout=setTimeout(()=>{this.create_popover(i)},100):this.popover_timeout=setTimeout(()=>{this.element.is(":focus")||this.show_popover(i)},1e3))}create_popover(i){this.new_popover=!1,!this.element.is(":focus")&&this.get_preview_data().then(e=>{e&&(this.popover_timeout&&clearTimeout(this.popover_timeout),this.popover_timeout=setTimeout(()=>{if(this.popover&&this.popover.config){let t=this.get_popover_html(e);this.popover.config.content=t}else this.init_preview_popover(e);this.show_popover(i)},1e3))})}show_popover(i){if(this.default_timeout=setTimeout(()=>{this.clear_all_popovers()},1e4),this.is_link)this.element.popover("show");else{var e=i.pageX;this.element.popover("show");var t=$(".popover").width();$(".control-field-popover").css("left",e-t/2+"px")}}handle_popover_hide(){$(document).on("mouseout",this.LINK_CLASSES,()=>{$(".popover:hover").length||(this.link_hovered=!1),this.link_hovered||(this.data_timeout&&clearTimeout(this.data_timeout),this.popover_timeout&&clearTimeout(this.popover_timeout),this.default_timeout&&clearTimeout(this.default_timeout),this.clear_all_popovers())}),frappe.router.on("change",()=>{this.clear_all_popovers()})}clear_all_popovers(){this.popovers_list.forEach(i=>i.hide())}get_preview_data(){return frappe.xcall("frappe.desk.link_preview.get_preview_data",{doctype:this.doctype,docname:this.name},"GET",{cache:!0})}init_preview_popover(i){let e=this.get_popover_html(i);this.element.popover({container:"body",template:`
				<div class="link-preview-popover popover">
					<div class="arrow"></div>
					<div class="popover-body popover-content">
					</div>
				</div>
			`,html:!0,sanitizeFn:r=>r,content:e,trigger:"manual",placement:"top"}),$(this.element.data("bs.popover").tip).toggleClass("control-field-popover",this.is_link),this.popovers_list.push(this.element.data("bs.popover"))}get_popover_html(i){this.href||(this.href=window.location.href),this.href&&this.href.includes(" ")&&(this.href=this.href.replace(new RegExp(" ","g"),"%20"));let e=document.createElement("div");e.innerHTML=`
			<div class="preview-popover-header">
				<div class="preview-header">
					${this.get_image_html(i)}
					<div class="preview-name">
						<a></a>
					</div>
					<div class="text-muted preview-title">${this.get_id_html(i)}</div>
				</div>
			</div>
			<hr>
			<div class="popover-body">
				${this.get_content_html(i)}
			</div>
		`;let t=e.querySelector(".preview-name > a");return t.href=this.href,t.innerText=__(i.preview_title),e.innerHTML}get_id_html(i){if(i.preview_title!==i.name){let e=document.createElement("a");return e.href=this.href,e.className="text-muted",e.innerText=i.name,e.outerHTML}return""}get_image_html(i){return`<div class="preview-image">
			${frappe.get_avatar("avatar-medium",i.preview_title,i.preview_image)}
		</div>`}get_content_html(i){let e="";return Object.keys(i).forEach(t=>{if(!["preview_image","preview_title","name"].includes(t)){let r=frappe.ellipsis(i[t],280),s=t;e+=`
					<div class="preview-field">
						<div class="preview-label text-muted">${__(s)}</div>
						<div class="preview-value">${r}</div>
					</div>
				`}}),`<div class="preview-table">${e}</div>`}};frappe.provide("frappe.request");frappe.provide("frappe.request.error_handlers");frappe.request.url="/";frappe.request.ajax_count=0;frappe.request.waiting_for_ajax=[];frappe.request.logs={};frappe.xcall=function(i,e,t,r={}){return new Promise((s,n)=>{frappe.call(Ee({method:i,args:e,type:t||"POST",callback:o=>{s(o.message)},error:o=>{n(o==null?void 0:o.message)}},r))})};frappe.call=function(i){if(!frappe.is_online())return frappe.show_alert({indicator:"orange",message:__("Connection Lost"),subtitle:__("You are not connected to Internet. Retry after sometime.")},3),i.always&&i.always(),$.ajax();typeof arguments[0]=="string"&&(i={method:arguments[0],args:arguments[1],callback:arguments[2],headers:arguments[3]}),i.quiet&&(i.no_spinner=!0);var e=$.extend({},i.args);e.freeze&&(i.freeze=i.freeze||e.freeze,i.freeze_message=i.freeze_message||e.freeze_message),i.module&&i.page?e.cmd=i.module+".page."+i.page+"."+i.page+"."+i.method:i.doc?$.extend(e,{cmd:"run_doc_method",docs:frappe.get_doc(i.doc.doctype,i.doc.name),method:i.method,args:i.args}):i.method&&(e.cmd=i.method);var t=function(s,n){if(s.task_id)frappe.realtime.subscribe(s.task_id,i),i.queued&&i.queued(s);else if(i.callback)return i.callback(s,n)};let r=i.url;if(!r){let s="/api/method/";if(i.api_version&&(s=`/api/${i.api_version}/method/`),r=s+e.cmd,window.cordova){let n=frappe.request.url;n=n.slice(0,n.length-1),r=n+r}delete e.cmd}return i.debounce&&frappe.request.is_fresh(e,i.debounce)?Promise.resolve():frappe.request.call({type:i.type||"POST",args:e,success:t,error:i.error,always:i.always,btn:i.btn,freeze:i.freeze,freeze_message:i.freeze_message,headers:i.headers||{},error_handlers:i.error_handlers||{},async:i.async,silent:i.silent,api_version:i.api_version,url:r,cache:i.cache})};frappe.request.call=function(i){frappe.request.prepare(i);var e={200:function(s,n){i.success_callback&&i.success_callback(s,n.responseText)},401:function(s){frappe.app.session_expired_dialog&&frappe.app.session_expired_dialog.display?frappe.app.redirect_to_login():frappe.app.handle_session_expired(),i.error_callback&&i.error_callback()},404:function(s){frappe.msgprint({title:__("Not found"),indicator:"red",message:__("The resource you are looking for is not available")}),i.error_callback&&i.error_callback()},403:function(s){if(frappe.session.user==="Guest"&&frappe.session.logged_in_user!=="Guest")frappe.app.handle_session_expired();else if(s.responseJSON&&s.responseJSON._error_message)frappe.msgprint({title:__("Not permitted"),indicator:"red",message:s.responseJSON._error_message,re_route:!0}),s.responseJSON._server_messages=null;else if(s.responseJSON&&s.responseJSON._server_messages){var n=JSON.parse(s.responseJSON._server_messages);if(n.indexOf(__("Not permitted"))!==-1)return}else frappe.msgprint({title:__("Not permitted"),indicator:"red",message:__("You do not have enough permissions to access this resource. Please contact your manager to get access.")});i.error_callback&&i.error_callback()},508:function(s){frappe.utils.play_sound("error"),frappe.msgprint({title:__("Please try again"),indicator:"red",message:__("Another transaction is blocking this one. Please try again in a few seconds.")}),i.error_callback&&i.error_callback()},413:function(s,n){frappe.msgprint({indicator:"red",title:__("File too big"),message:__("File size exceeded the maximum allowed size of {0} MB",[(frappe.boot.max_file_size||5242880)/1048576])}),i.error_callback&&i.error_callback()},417:function(s){var n=s.responseJSON;if(!n)try{n=JSON.parse(s.responseText)}catch(o){n=s.responseText}i.error_callback&&i.error_callback(n)},501:function(s,n){typeof s=="string"&&(s=JSON.parse(s)),i.error_callback&&i.error_callback(s,n.responseText)},500:function(s){frappe.utils.play_sound("error");try{i.error_callback&&i.error_callback(),frappe.request.report_error(s,i)}catch(n){frappe.request.report_error(s,i)}},504:function(s){frappe.msgprint(__("Request Timed Out")),i.error_callback&&i.error_callback()},502:function(s){frappe.msgprint(__("Internal Server Error")),i.error_callback&&i.error_callback()}},t={QueryTimeoutError:function(){frappe.utils.play_sound("error"),frappe.msgprint({title:__("Request Timeout"),indicator:"red",message:__("Server was too busy to process this request. Please try again.")})},QueryDeadlockError:function(){frappe.utils.play_sound("error"),frappe.msgprint({title:__("Deadlock Occurred"),indicator:"red",message:__("Server failed to process this request because of a concurrent conflicting request. Please try again.")})}},r={url:i.url||frappe.request.url,data:i.args,type:i.type,dataType:i.dataType||"json",async:i.async,headers:Object.assign({"X-Frappe-CSRF-Token":frappe.csrf_token,Accept:"application/json","X-Frappe-CMD":i.args&&i.args.cmd||""||""},i.headers),cache:window.dev_server?!1:i.cache||!1};return i.args&&i.args.doctype&&(r.headers["X-Frappe-Doctype"]=encodeURIComponent(i.args.doctype)),frappe.last_request=r.data,$.ajax(r).done(function(s,n,o){try{typeof s=="string"&&(s=JSON.parse(s)),(s.docs||s.docinfo)&&frappe.model.sync(s),s.__messages&&$.extend(frappe._messages,s.__messages),s._link_titles&&(frappe._link_titles||(frappe._link_titles={}),$.extend(frappe._link_titles,s._link_titles));var a=e[o.statusCode().status];a&&a(s,o)}catch(l){console.log("Unable to handle success response",s),console.error(l)}}).always(function(s,n,o){try{if(typeof s=="string"&&(s=JSON.parse(s)),s.responseText){var o=s;s=JSON.parse(s.responseText)}}catch(a){s=null}frappe.request.cleanup(i,s),i.always&&i.always(s)}).fail(function(s,n){try{if(s.getResponseHeader("content-type")=="application/json"&&s.responseText){var o;try{o=JSON.parse(s.responseText)}catch(u){console.log("Unable to parse reponse text"),console.log(s.responseText),console.log(u)}if(o&&o.exception){var a=o.exception.split(".").at(-1).split(":").at(0),l=t[a];if(l){l(o);return}}}var c=e[s.statusCode().status];if(c){c(s);return}i.error_callback&&i.error_callback(s)}catch(u){console.log("Unable to handle failed response"),console.error(u)}})};frappe.request.is_fresh=function(i,e){frappe.request.logs[i.cmd]||(frappe.request.logs[i.cmd]=[]);for(let t of frappe.request.logs[i.cmd])if(new Date-t.timestamp<e&&frappe.utils.deep_equal(i,t.args))return console.log("throttled"),!0;return frappe.request.logs[i.cmd].push({args:i,timestamp:new Date}),!1};frappe.request.prepare=function(i){$("body").attr("data-ajax-state","triggered"),i.btn&&$(i.btn).prop("disabled",!0),i.freeze&&frappe.dom.freeze(i.freeze_message);for(var e in i.args)i.args[e]&&($.isPlainObject(i.args[e])||$.isArray(i.args[e]))&&(i.args[e]=JSON.stringify(i.args[e]));if(!i.args.cmd&&!i.url)throw console.log(i),"Incomplete Request";i.success_callback=i.success,i.error_callback=i.error,delete i.success,delete i.error};frappe.request.cleanup=function(i,e){if(i.btn&&$(i.btn).prop("disabled",!1),$("body").attr("data-ajax-state","complete"),i.freeze&&frappe.dom.unfreeze(),e){if(e.session_expired||frappe.session.user==="Guest"&&frappe.session.logged_in_user!=="Guest"){frappe.app.handle_session_expired();return}let t=frappe.request.error_handlers[e.exc_type]||[],r=i.error_handlers?i.error_handlers[e.exc_type]:null,s=[].concat(t,r).filter(Boolean);e.exc_type&&s.forEach(o=>{o(e)});let n;i.api_version=="v2"?n=e.messages:e._server_messages&&(n=JSON.parse(e._server_messages)),n&&!i.silent&&s.length===0&&(frappe.hide_msgprint(),frappe.msgprint(n)),e.exc&&(e.exc=JSON.parse(e.exc),e.exc instanceof Array?e.exc.forEach(o=>{o&&console.error(o)}):console.error(e.exc)),e._debug_messages&&(i.args&&(console.log("======== arguments ========"),console.log(i.args)),console.log("======== debug messages ========"),$.each(JSON.parse(e._debug_messages),function(o,a){console.log(a)}),console.log("======== response ========"),delete e._debug_messages,console.log(e),console.log("========"))}frappe.last_response=e};frappe.after_server_call=()=>frappe.request.ajax_count?new Promise(i=>{frappe.request.waiting_for_ajax.push(()=>{i()})}):null;frappe.after_ajax=function(i){return new Promise(e=>{if(frappe.request.ajax_count)frappe.request.waiting_for_ajax.push(()=>{if(i)return e(i());e()});else{if(i)return e(i());e()}})};frappe.request.report_error=function(i,e){var t=JSON.parse(i.responseText),r;if(t.exc){try{r=(JSON.parse(t.exc)||[]).join(`
`)}catch(a){r=t.exc}delete t.exc}else r="";let s=()=>{let a=u=>"```\n"+u+"\n```",l=Object.assign({},e);l.request_id=i.getResponseHeader("X-Frappe-Request-Id");let c=["### App Versions",a(JSON.stringify(frappe.boot.versions,null,"	")),"### Route",a(frappe.get_route_str()),"### Traceback",a(r),"### Request Data",a(JSON.stringify(l,null,"	")),"### Response Data",a(JSON.stringify(t,null,"	"))].join(`
`);frappe.utils.copy_to_clipboard(c)};var n=function(){var a=["<h5>Please type some additional information that could help us reproduce this issue:</h5>",'<div style="min-height: 100px; border: 1px solid #bbb; 				border-radius: 5px; padding: 15px; margin-bottom: 15px;"></div>',"<hr>","<h5>App Versions</h5>","<pre>"+JSON.stringify(frappe.boot.versions,null,"	")+"</pre>","<h5>Route</h5>","<pre>"+frappe.get_route_str()+"</pre>","<hr>","<h5>Error Report</h5>","<pre>"+r+"</pre>","<hr>","<h5>Request Data</h5>","<pre>"+JSON.stringify(e,null,"	")+"</pre>","<hr>","<h5>Response JSON</h5>","<pre>"+JSON.stringify(t,null,"	")+"</pre>"].join(`
`),l=new frappe.views.CommunicationComposer({subject:"Error Report ["+frappe.datetime.nowdate()+"]",recipients:o,message:a,doc:{doctype:"User",name:frappe.session.user}});l.dialog.$wrapper.css("z-index",cint(frappe.msg_dialog.$wrapper.css("z-index"))+1)};if(r){var o=frappe.boot.error_report_email;e=frappe.request.cleanup_request_opts(e),frappe.error_dialog||(frappe.error_dialog=new frappe.ui.Dialog({title:__("Server Error")}),o?frappe.error_dialog.set_primary_action(__("Report"),()=>{n(),frappe.error_dialog.hide()}):frappe.error_dialog.set_primary_action(__("Copy error to clipboard"),()=>{s(),frappe.error_dialog.hide()}),frappe.error_dialog.wrapper.classList.add("msgprint-dialog"));let a=strip(r).split(`
`),l=a[a.length-1];t._exc_source&&(l+="<br>",l+=`Possible source of error: ${t._exc_source.bold()} `),frappe.error_dialog.$body.html(l),frappe.error_dialog.show()}};frappe.request.cleanup_request_opts=function(i){var e=(i.args||{}).doc;return e&&(e=JSON.parse(e),$.each(Object.keys(e),function(t,r){r.indexOf("password")!==-1&&e[r]&&(e[r]="*****")}),i.args.doc=JSON.stringify(e)),i};frappe.request.on_error=function(i,e){frappe.request.error_handlers[i]=frappe.request.error_handlers[i]||[],frappe.request.error_handlers[i].push(e)};$(document).ajaxSend(function(){frappe.request.ajax_count++});$(document).ajaxComplete(function(){frappe.request.ajax_count--,frappe.request.ajax_count||($.each(frappe.request.waiting_for_ajax||[],function(i,e){e()}),frappe.request.waiting_for_ajax=[])});var Bt=Object.create(null);Bt.open="0";Bt.close="1";Bt.ping="2";Bt.pong="3";Bt.message="4";Bt.upgrade="5";Bt.noop="6";var jr=Object.create(null);Object.keys(Bt).forEach(i=>{jr[Bt[i]]=i});var zr={type:"error",data:"parser error"};var ec=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",tc=typeof ArrayBuffer=="function",ic=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,Fr=({type:i,data:e},t,r)=>ec&&e instanceof Blob?t?r(e):Zl(e,r):tc&&(e instanceof ArrayBuffer||ic(e))?t?r(e):Zl(new Blob([e]),r):r(Bt[i]+(e||"")),Zl=(i,e)=>{let t=new FileReader;return t.onload=function(){let r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(i)};function Ql(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}var vo;function rc(i,e){if(ec&&i.data instanceof Blob)return i.data.arrayBuffer().then(Ql).then(e);if(tc&&(i.data instanceof ArrayBuffer||ic(i.data)))return e(Ql(i.data));Fr(i,!1,t=>{vo||(vo=new TextEncoder),e(vo.encode(t))})}var sc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hr=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let i=0;i<sc.length;i++)Hr[sc.charCodeAt(i)]=i;var nc=i=>{let e=i.length*.75,t=i.length,r,s=0,n,o,a,l;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);let c=new ArrayBuffer(e),u=new Uint8Array(c);for(r=0;r<t;r+=4)n=Hr[i.charCodeAt(r)],o=Hr[i.charCodeAt(r+1)],a=Hr[i.charCodeAt(r+2)],l=Hr[i.charCodeAt(r+3)],u[s++]=n<<2|o>>4,u[s++]=(o&15)<<4|a>>2,u[s++]=(a&3)<<6|l&63;return c};var q_=typeof ArrayBuffer=="function",qr=(i,e)=>{if(typeof i!="string")return{type:"message",data:oc(i,e)};let t=i.charAt(0);return t==="b"?{type:"message",data:U_(i.substring(1),e)}:jr[t]?i.length>1?{type:jr[t],data:i.substring(1)}:{type:jr[t]}:zr},U_=(i,e)=>{if(q_){let t=nc(i);return oc(t,e)}else return{base64:!0,data:i}},oc=(i,e)=>{switch(e){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}};var ac=String.fromCharCode(30),lc=(i,e)=>{let t=i.length,r=new Array(t),s=0;i.forEach((n,o)=>{Fr(n,!1,a=>{r[o]=a,++s===t&&e(r.join(ac))})})},cc=(i,e)=>{let t=i.split(ac),r=[];for(let s=0;s<t.length;s++){let n=qr(t[s],e);if(r.push(n),n.type==="error")break}return r};function dc(){return new TransformStream({transform(i,e){rc(i,t=>{let r=t.length,s;if(r<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,r);else if(r<65536){s=new Uint8Array(3);let n=new DataView(s.buffer);n.setUint8(0,126),n.setUint16(1,r)}else{s=new Uint8Array(9);let n=new DataView(s.buffer);n.setUint8(0,127),n.setBigUint64(1,BigInt(r))}i.data&&typeof i.data!="string"&&(s[0]|=128),e.enqueue(s),e.enqueue(t)})}})}var yo;function un(i){return i.reduce((e,t)=>e+t.length,0)}function pn(i,e){if(i[0].length===e)return i.shift();let t=new Uint8Array(e),r=0;for(let s=0;s<e;s++)t[s]=i[0][r++],r===i[0].length&&(i.shift(),r=0);return i.length&&r<i[0].length&&(i[0]=i[0].slice(r)),t}function uc(i,e){yo||(yo=new TextDecoder);let t=[],r=0,s=-1,n=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(r===0){if(un(t)<1)break;let l=pn(t,1);n=(l[0]&128)===128,s=l[0]&127,s<126?r=3:s===126?r=1:r=2}else if(r===1){if(un(t)<2)break;let l=pn(t,2);s=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(un(t)<8)break;let l=pn(t,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,53-32)-1){a.enqueue(zr);break}s=u*Math.pow(2,32)+c.getUint32(4),r=3}else{if(un(t)<s)break;let l=pn(t,s);a.enqueue(qr(n?l:yo.decode(l),e)),r=0}if(s===0||s>i){a.enqueue(zr);break}}}})}var wo=4;function ze(i){if(i)return W_(i)}function W_(i){for(var e in ze.prototype)i[e]=ze.prototype[e];return i}ze.prototype.on=ze.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};ze.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};ze.prototype.off=ze.prototype.removeListener=ze.prototype.removeAllListeners=ze.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var r,s=0;s<t.length;s++)if(r=t[s],r===e||r.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+i],this};ze.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,s=t.length;r<s;++r)t[r].apply(this,e)}return this};ze.prototype.emitReserved=ze.prototype.emit;ze.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};ze.prototype.hasListeners=function(i){return!!this.listeners(i).length};var ft=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function hn(i,...e){return e.reduce((t,r)=>(i.hasOwnProperty(r)&&(t[r]=i[r]),t),{})}var V_=ft.setTimeout,Y_=ft.clearTimeout;function ii(i,e){e.useNativeTimers?(i.setTimeoutFn=V_.bind(ft),i.clearTimeoutFn=Y_.bind(ft)):(i.setTimeoutFn=ft.setTimeout.bind(ft),i.clearTimeoutFn=ft.clearTimeout.bind(ft))}var G_=1.33;function pc(i){return typeof i=="string"?K_(i):Math.ceil((i.byteLength||i.size)*G_)}function K_(i){let e=0,t=0;for(let r=0,s=i.length;r<s;r++)e=i.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function hc(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function fc(i){let e={},t=i.split("&");for(let r=0,s=t.length;r<s;r++){let n=t[r].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}var fn=class extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}},ri=class extends ze{constructor(e){super(),this.writable=!1,ii(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new fn(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=qr(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=hc(e);return t.length?"?"+t:""}};var bc="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ko=64,X_={},_c=0,_n=0,mc;function gc(i){let e="";do e=bc[i%ko]+e,i=Math.floor(i/ko);while(i>0);return e}function mn(){let i=gc(+new Date);return i!==mc?(_c=0,mc=i):i+"."+gc(_c++)}for(;_n<ko;_n++)X_[bc[_n]]=_n;var vc=!1;try{vc=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(i){}var yc=vc;function xo(i){let e=i.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||yc))return new XMLHttpRequest}catch(t){}if(!e)try{return new ft[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function J_(){}var Z_=function(){return new xo({xdomain:!1}).responseType!=null}(),gn=class extends ri{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){let r=location.protocol==="https:",s=location.port;s||(s=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||s!==e.port}let t=e&&e.forceBase64;this.supportsBinary=Z_&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};cc(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,lc(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=mn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Lt(this.uri(),e)}doWrite(e,t){let r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(s,n)=>{this.onError("xhr post error",s,n)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}},Lt=class extends ze{constructor(e,t){super(),ii(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;let t=hn(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;let r=this.xhr=new xo(t);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&r.setRequestHeader(s,this.opts.extraHeaders[s])}}catch(s){}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{r.setRequestHeader("Accept","*/*")}catch(s){}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var s;r.readyState===3&&((s=this.opts.cookieJar)===null||s===void 0||s.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document!="undefined"&&(this.index=Lt.requestsCount++,Lt.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=J_,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete Lt.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Lt.requestsCount=0;Lt.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",wc);else if(typeof addEventListener=="function"){let i="onpagehide"in ft?"pagehide":"unload";addEventListener(i,wc,!1)}}function wc(){for(let i in Lt.requests)Lt.requests.hasOwnProperty(i)&&Lt.requests[i].abort()}var Ei=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Ur=ft.WebSocket||ft.MozWebSocket,bn=!0,kc="arraybuffer";var xc=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",vn=class extends ri{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,r=xc?{}:hn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=bn&&!xc?t?new Ur(e,t):new Ur(e):new Ur(e,t,r)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],s=t===e.length-1;Fr(r,this.supportsBinary,n=>{let o={};bn||(r.options&&(o.compress=r.options.compress),this.opts.perMessageDeflate&&(typeof n=="string"?Buffer.byteLength(n):n.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1));try{bn?this.ws.send(n):this.ws.send(n,o)}catch(a){}s&&Ei(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=mn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!Ur}};var yn=class extends ri{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{let t=uc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),s=dc();s.readable.pipeTo(e.writable),this.writer=s.writable.getWriter();let n=()=>{r.read().then(({done:a,value:l})=>{a||(this.onPacket(l),n())}).catch(a=>{})};n();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],s=t===e.length-1;this.writer.write(r).then(()=>{s&&Ei(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}};var Co={websocket:vn,webtransport:yn,polling:gn};var Q_=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,em=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Yi(i){if(i.length>2e3)throw"URI too long";let e=i,t=i.indexOf("["),r=i.indexOf("]");t!=-1&&r!=-1&&(i=i.substring(0,t)+i.substring(t,r).replace(/:/g,";")+i.substring(r,i.length));let s=Q_.exec(i||""),n={},o=14;for(;o--;)n[em[o]]=s[o]||"";return t!=-1&&r!=-1&&(n.source=e,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=tm(n,n.path),n.queryKey=im(n,n.query),n}function tm(i,e){let t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function im(i,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,s,n){s&&(t[s]=n)}),t}var St=class extends ze{constructor(e,t={}){super(),this.binaryType=kc,this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Yi(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Yi(t.host).host),ii(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=fc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=wo,t.transport=e,this.id&&(t.sid=this.id);let r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Co[e](r)}open(){let e;if(this.opts.rememberUpgrade&&St.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;St.priorWebsocketSuccess=!1;let s=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",p=>{if(!r)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;St.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let m=new Error("probe error");m.transport=t.name,this.emitReserved("upgradeError",m)}}))};function n(){r||(r=!0,u(),t.close(),t=null)}let o=p=>{let m=new Error("probe error: "+p);m.transport=t.name,n(),this.emitReserved("upgradeError",m)};function a(){o("transport closed")}function l(){o("socket closed")}function c(p){t&&p.name!==t.name&&n()}let u=()=>{t.removeListener("open",s),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};t.once("open",s),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onOpen(){if(this.readyState="open",St.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){let s=this.writeBuffer[r].data;if(s&&(t+=pc(s)),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,s){if(typeof t=="function"&&(s=t,t=void 0),typeof r=="function"&&(s=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;let n={type:e,data:t,options:r};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),s&&this.once("flush",s),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){St.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],r=0,s=e.length;for(;r<s;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}};St.protocol=wo;var B3=St.protocol;function Cc(i,e="",t){let r=i;t=t||typeof location!="undefined"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t!="undefined"?i=t.protocol+"//"+i:i="https://"+i),r=Yi(i)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";let n=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+n+":"+r.port+e,r.href=r.protocol+"://"+n+(t&&t.port===r.port?"":":"+r.port),r}var Oo={};D_(Oo,{Decoder:()=>Yr,Encoder:()=>Eo,PacketType:()=>Ae,protocol:()=>Oc});var rm=typeof ArrayBuffer=="function",sm=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,Sc=Object.prototype.toString,nm=typeof Blob=="function"||typeof Blob!="undefined"&&Sc.call(Blob)==="[object BlobConstructor]",om=typeof File=="function"||typeof File!="undefined"&&Sc.call(File)==="[object FileConstructor]";function Vr(i){return rm&&(i instanceof ArrayBuffer||sm(i))||nm&&i instanceof Blob||om&&i instanceof File}function Wr(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,r=i.length;t<r;t++)if(Wr(i[t]))return!0;return!1}if(Vr(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return Wr(i.toJSON(),!0);for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&Wr(i[t]))return!0;return!1}function Tc(i){let e=[],t=i.data,r=i;return r.data=So(t,e),r.attachments=e.length,{packet:r,buffers:e}}function So(i,e){if(!i)return i;if(Vr(i)){let t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){let t=new Array(i.length);for(let r=0;r<i.length;r++)t[r]=So(i[r],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){let t={};for(let r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=So(i[r],e));return t}return i}function Ec(i,e){return i.data=To(i.data,e),delete i.attachments,i}function To(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=To(i[t],e);else if(typeof i=="object")for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=To(i[t],e));return i}var am=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Oc=5,Ae;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(Ae||(Ae={}));var Eo=class{constructor(e){this.replacer=e}encode(e){return(e.type===Ae.EVENT||e.type===Ae.ACK)&&Wr(e)?this.encodeAsBinary({type:e.type===Ae.EVENT?Ae.BINARY_EVENT:Ae.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Ae.BINARY_EVENT||e.type===Ae.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=Tc(e),r=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(r),s}};function $c(i){return Object.prototype.toString.call(i)==="[object Object]"}var Yr=class extends ze{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let r=t.type===Ae.BINARY_EVENT;r||t.type===Ae.BINARY_ACK?(t.type=r?Ae.EVENT:Ae.ACK,this.reconstructor=new $o(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Vr(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(Ae[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Ae.BINARY_EVENT||r.type===Ae.BINARY_ACK){let n=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(n,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){let n=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(n,t)}else r.nsp="/";let s=e.charAt(t+1);if(s!==""&&Number(s)==s){let n=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){let n=this.tryParse(e.substr(t));if(Yr.isPayloadValid(r.type,n))r.data=n;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Ae.CONNECT:return $c(t);case Ae.DISCONNECT:return t===void 0;case Ae.CONNECT_ERROR:return typeof t=="string"||$c(t);case Ae.EVENT:case Ae.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&am.indexOf(t[0])===-1);case Ae.ACK:case Ae.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},$o=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=Ec(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Tt(i,e,t){return i.on(e,t),function(){i.off(e,t)}}var lm=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Gi=class extends ze{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[Tt(e,"open",this.onopen.bind(this)),Tt(e,"packet",this.onpacket.bind(this)),Tt(e,"error",this.onerror.bind(this)),Tt(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(lm.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let r={type:Ae.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let o=this.ids++,a=t.pop();this._registerAckCallback(o,a),r.id=o}let s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;let s=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}let n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},s);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...o])}}emitWithAck(e,...t){let r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((s,n)=>{t.push((o,a)=>r?o?n(o):s(a):s(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...n)=>r!==this._queue[0]?void 0:(s!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Ae.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Ae.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ae.EVENT:case Ae.BINARY_EVENT:this.onevent(e);break;case Ae.ACK:case Ae.BINARY_ACK:this.onack(e);break;case Ae.DISCONNECT:this.ondisconnect();break;case Ae.CONNECT_ERROR:this.destroy();let r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,r=!1;return function(...s){r||(r=!0,t.packet({type:Ae.ACK,id:e,data:s}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ae.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let r of t)r.apply(this,e.data)}}};function $i(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}$i.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=(Math.floor(e*10)&1)==0?i-t:i+t}return Math.min(i,this.max)|0};$i.prototype.reset=function(){this.attempts=0};$i.prototype.setMin=function(i){this.ms=i};$i.prototype.setMax=function(i){this.max=i};$i.prototype.setJitter=function(i){this.jitter=i};var Ki=class extends ze{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,ii(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new $i({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let s=t.parser||Oo;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new St(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let s=Tt(t,"open",function(){r.onopen(),e&&e()}),n=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Tt(t,"error",n);if(this._timeout!==!1){let a=this._timeout,l=this.setTimeoutFn(()=>{s(),n(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(Tt(e,"ping",this.onping.bind(this)),Tt(e,"data",this.ondata.bind(this)),Tt(e,"error",this.onerror.bind(this)),Tt(e,"close",this.onclose.bind(this)),Tt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Ei(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Gi(this,e,t),this.nsps[e]=r),r}_destroy(e){let t=Object.keys(this.nsps);for(let r of t)if(this.nsps[r].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var Gr={};function Xi(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};let t=Cc(i,e.path||"/socket.io"),r=t.source,s=t.id,n=t.path,o=Gr[s]&&n in Gr[s].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o,l;return a?l=new Ki(r,e):(Gr[s]||(Gr[s]=new Ki(r,e)),l=Gr[s]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(Xi,{Manager:Ki,Socket:Gi,io:Xi,connect:Xi});frappe.provide("frappe.realtime");var Ao=class{constructor(){this.open_tasks={},this.open_docs=new Set}on(e,t){this.socket&&(this.connect(),this.socket.on(e,t))}off(e,t){this.socket&&this.socket.off(e,t)}connect(){this.lazy_connect&&(this.socket.connect(),this.lazy_connect=!1)}emit(e,...t){this.connect(),this.socket.emit(e,...t)}init(e=9e3,t=!1){if(frappe.boot.disable_async||this.socket)return;this.lazy_connect=t;let r=this;if(window.location.protocol=="https:"?this.socket=Xi(this.get_host(e),{secure:!0,withCredentials:!0,reconnectionAttempts:3,autoConnect:!t}):window.location.protocol=="http:"&&(this.socket=Xi(this.get_host(e),{withCredentials:!0,reconnectionAttempts:3,autoConnect:!t})),!this.socket){console.log("Unable to connect to "+this.get_host(e));return}this.socket.on("connect_error",function(s){console.error("Error connecting to socket.io:",s.message)}),this.socket.on("msgprint",function(s){frappe.msgprint(s)}),this.socket.on("progress",function(s){s.progress&&(s.percent=flt(s.progress[0])/s.progress[1]*100),s.percent&&frappe.show_progress(s.title||__("Progress"),s.percent,100,s.description,!0)}),this.setup_listeners(),$(document).on("form-load form-rename",function(s,n){!n.doc||n.is_new()||r.doc_subscribe(n.doctype,n.docname)}),$(document).on("form-refresh",function(s,n){!n.doc||n.is_new()||r.doc_open(n.doctype,n.docname)}),$(document).on("form-unload",function(s,n){!n.doc||n.is_new()||r.doc_close(n.doctype,n.docname)})}get_host(e=9e3){let t=window.location.origin;if(window.dev_server){let r=t.split(":");e=frappe.boot.socketio_port||e.toString()||"9000",r.length>2&&(t=r[0]+":"+r[1]),t=t+":"+e}return t+`/${frappe.boot.sitename}`}subscribe(e,t){this.emit("task_subscribe",e),this.emit("progress_subscribe",e),this.open_tasks[e]=t}task_subscribe(e){this.emit("task_subscribe",e)}task_unsubscribe(e){this.emit("task_unsubscribe",e)}doctype_subscribe(e){this.emit("doctype_subscribe",e)}doctype_unsubscribe(e){this.emit("doctype_unsubscribe",e)}doc_subscribe(e,t){if(frappe.flags.doc_subscribe){console.log("throttled");return}this.open_docs.has(`${e}:${t}`)||(frappe.flags.doc_subscribe=!0,setTimeout(function(){frappe.flags.doc_subscribe=!1},1e3),this.emit("doc_subscribe",e,t),this.open_docs.add(`${e}:${t}`))}doc_unsubscribe(e,t){return this.emit("doc_unsubscribe",e,t),this.open_docs.delete(`${e}:${t}`)}doc_open(e,t){this.emit("doc_open",e,t)}doc_close(e,t){this.emit("doc_close",e,t)}setup_listeners(){this.socket.on("task_status_change",function(e){this.process_response(e,e.status.toLowerCase())}),this.socket.on("task_progress",function(e){this.process_response(e,"progress")})}process_response(e,t){if(!e)return;let r=this.open_tasks[e.task_id];r[t]&&r[t](e),t==="success"&&r.callback&&r.callback(e),frappe.request.cleanup(r,e),r.always&&r.always(e),e.status_code&&e.status_code>400&&r.error&&r.error(e)}publish(e,t){this.socket&&this.emit(e,t)}};frappe.realtime=new Ao;frappe.socketio=frappe.realtime;var Lo=class{constructor(){this.channel=new BroadcastChannel("frappe"),this._event_handlers={},this.channel.onmessage=e=>{let{data:t,event:r}=e.data;if(!r)return;(this._event_handlers[r]||[]).forEach(n=>{n(t)})}}emit(e,t){this.channel.postMessage({event:e,data:t})}on(e,t){this._event_handlers[e]||(this._event_handlers[e]=[]),this._event_handlers[e].push(t)}off(e,t=null){if(t){let r=this._event_handlers[e];if(!r)return;this._event_handlers[e]=r.filter(s=>s!==t)}else this._event_handlers[e]=[]}};frappe.broadcast=new Lo;var Ih=Ut(Ic());var wn={default:[{divisor:1e12,symbol:__("T",null,"Number system")},{divisor:1e9,symbol:__("B",null,"Number system")},{divisor:1e6,symbol:__("M",null,"Number system")},{divisor:1e3,symbol:__("K",null,"Number system")}],indian:[{divisor:1e7,symbol:__("Cr",null,"Number system")},{divisor:1e5,symbol:__("L",null,"Number system")},{divisor:1e3,symbol:__("K",null,"Number system")}],nepalese:[{divisor:1e11,symbol:__("Kh",null,"Number system")},{divisor:1e9,symbol:__("Ar",null,"Number system")},{divisor:1e7,symbol:__("Cr",null,"Number system")},{divisor:1e5,symbol:__("L",null,"Number system")},{divisor:1e3,symbol:__("K",null,"Number system")}]};var Mh=Ut(Bh());frappe.provide("frappe.utils");Array.prototype.uniqBy||(Object.defineProperty(Array.prototype,"uniqBy",{value:function(i){var e={};return this.filter(function(t){var r=i(t);return r in e?!1:e[r]=!0})}}),Object.defineProperty(Array.prototype,"move",{value:function(i,e){this.splice(e,0,this.splice(i,1)[0])}}));Object.defineProperty(Object.prototype,"setDefault",{value:function(i,e){return i in this||(this[i]=e),this[i]},writable:!0});String.prototype.plural=function(i){let e={"(quiz)$":"$1zes","^(ox)$":"$1en","([m|l])ouse$":"$1ice","(matr|vert|ind)ix|ex$":"$1ices","(x|ch|ss|sh)$":"$1es","([^aeiouy]|qu)y$":"$1ies","(hive)$":"$1s","(?:([^f])fe|([lr])f)$":"$1$2ves","(shea|lea|loa|thie)f$":"$1ves",sis$:"ses","([ti])um$":"$1a","(tomat|potat|ech|her|vet)o$":"$1oes","(bu)s$":"$1ses","(alias)$":"$1es","(octop)us$":"$1i","(ax|test)is$":"$1es","(us)$":"$1es","(f)oot$":"$1eet","(g)oose$":"$1eese","(sex)$":"$1es","(child)$":"$1ren","(m)an$":"$1en","(t)ooth$":"$1eeth","(pe)rson$":"$1ople","([^s]+)$":"$1s"},t={"(quiz)zes$":"$1","(matr)ices$":"$1ix","(vert|ind)ices$":"$1ex","^(ox)en$":"$1","(alias)es$":"$1","(octop|vir)i$":"$1us","(cris|ax|test)es$":"$1is","(shoe)s$":"$1","(o)es$":"$1","(bus)es$":"$1","([m|l])ice$":"$1ouse","(x|ch|ss|sh)es$":"$1","(m)ovies$":"$1ovie","(s)eries$":"$1eries","([^aeiouy]|qu)ies$":"$1y","([lr])ves$":"$1f","(tive)s$":"$1","(hive)s$":"$1","(li|wi|kni)ves$":"$1fe","(shea|loa|lea|thie)ves$":"$1f","(^analy)ses$":"$1sis","((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$":"$1$2sis","([ti])a$":"$1um","(n)ews$":"$1ews","(h|bl)ouses$":"$1ouse","(corpse)s$":"$1","(us)es$":"$1","(f)eet$":"$1oot","(g)eese$":"$1oose","(sex)es$":"$1","(child)ren$":"$1","(m)en$":"$1an","(t)eeth$":"$1ooth","(pe)ople$":"$1rson",s$:""};if(["sheep","fish","deer","moose","series","species","money","rice","information","equipment"].indexOf(this.toLowerCase())>=0)return this;let s=i?t:e,n;for(n in s){let o=new RegExp(n,"i");if(o.test(this))return this.replace(o,s[n])}return this};Object.assign(frappe.utils,{get_random:function(i){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=0;r<i;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},get_file_link:function(i){return i=cstr(i),frappe.utils.is_url(i)?i:i.indexOf("/")===-1?"files/"+i:i},replace_newlines(i){return i?i.replace(/\n/g,"<br>"):""},is_html:function(i){return i?[...new DOMParser().parseFromString(i,"text/html").body.childNodes||[]].some(r=>r.nodeType===1):!1},is_mac:function(){return window.navigator.platform==="MacIntel"},is_xs:function(){return $(document).width()<768},is_sm:function(){return $(document).width()<991&&$(document).width()>=768},is_md:function(){return $(document).width()<1199&&$(document).width()>=991},is_json:function(i){try{JSON.parse(i)}catch(e){return!1}return!0},parse_json:function(i){let e="";try{e=JSON.parse(i)}catch(t){return i}return e},strip_whitespace:function(i){return(i||"").replace(/<p>\s*<\/p>/g,"").replace(/<br>(\s*<br>\s*)+/g,"<br><br>")},encode_tags:function(i){var e={"&":"&amp;","<":"&lt;",">":"&gt;"};function t(r){return e[r]||r}return i.replace(/[&<>]/g,t)},strip_original_content:function(i){var e=[],t=[],r=i.indexOf("<br>")===-1?`
`:"<br>";return $.each(i.split(r),function(s,n){var o=strip(n);o&&(o.substr(0,1)===">"||o.substr(0,4)==="&gt;")?t.push(n):(e=e.concat(t),e.push(n),t=[])}),e.join(r)},escape_html:function(i){if(!i)return"";let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#x60;","=":"&#x3D;"};return String(i).replace(/[&<>"'`=]/g,t=>e[t]||t)},unescape_html:function(i){let e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x60;":"`","&#x3D;":"="};return String(i).replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&#x60;|&#x3D;/g,t=>e[t]||t)},html2text:function(i){return new DOMParser().parseFromString(i,"text/html").body.textContent},is_url:function(i){return i.toLowerCase().substr(0,7)=="http://"||i.toLowerCase().substr(0,8)=="https://"},to_title_case:function(i,e=!1){let t=i.toLowerCase().replace(/(?:^|[\s-/])\w/g,function(s){return s.toUpperCase()}),r=e?" ":"";return t.replace(/-|_/g,r)},toggle_blockquote:function(i){if(!i)return i;var e=$("<div></div>").html(i);return e.find("blockquote").parent("blockquote").addClass("hidden").before('<p><a class="text-muted btn btn-default toggle-blockquote" style="padding: 2px 7px 0px; line-height: 1;"> 					\u2022 \u2022 \u2022 				</a></p>'),e.html()},scroll_page_to_top(){$(".main-section").scrollTop(0)},scroll_to:function(i,e=!0,t,r,s,n=!1){if(frappe.flags.disable_auto_scroll)return;r=r||$("html, body");let o=0;i&&(o=typeof i=="number"?i-cint(t):this.get_scroll_position(i,t)),o<0&&(o=0);let a=()=>{n&&($(i).addClass("highlight"),document.addEventListener("click",function(){$(i).removeClass("highlight")},{once:!0}))};if(o==r.scrollTop())return a();e?r.animate({scrollTop:o}).promise().then(()=>{a(),s&&s()}):r.scrollTop(o)},get_scroll_position:function(i,e){let t=$(".navbar").height()+$(".page-head:visible").height()||$(".navbar").height();return $(i).offset().top-t-cint(e)},filter_dict:function(i,e){var t=[];return typeof e=="string"?[i[e]]:($.each(i,function(r,s){for(var n in e)if($.isArray(e[n])){if(e[n][0]=="in"){if(e[n][1].indexOf(s[n])==-1)return}else if(e[n][0]=="not in"){if(e[n][1].indexOf(s[n])!=-1)return}else if(e[n][0]=="<"){if(!(s[n]<e[n]))return}else if(e[n][0]=="<="){if(!(s[n]<=e[n]))return}else if(e[n][0]==">"){if(!(s[n]>e[n]))return}else if(e[n][0]==">="&&!(s[n]>=e[n]))return}else if(s[n]!=e[n])return;t.push(s)}),t)},comma_or:function(i){return frappe.utils.comma_sep(i," "+__("or")+" ")},comma_and:function(i){return frappe.utils.comma_sep(i," "+__("and")+" ")},comma_sep:function(i,e){return i instanceof Array?i.length==0?"":i.length==1?i[0]:i.slice(0,i.length-1).join(", ")+e+i.slice(-1)[0]:i},set_footnote:function(i,e,t){return i||(i=$('<div class="text-muted footnote-area level">').appendTo(e)),t?i.html(t):(i.remove(),i=null),i},get_args_dict_from_url:function(i){var e={};return $.each(decodeURIComponent(i).split("&"),function(t,r){r=r.split("="),e[r[0]]=r[1]}),e},get_url_from_dict:function(i){return $.map(i,function(e,t){return e!==null?encodeURIComponent(t)+"="+encodeURIComponent(e):null}).join("&")||""},validate_type:function(i,e){var t;switch(e){case"phone":t=/^([0-9 +_\-,.*#()]){1,20}$/;break;case"name":t=/^[\w][\w'-]*([ \w][\w'-]+)*$/;break;case"number":t=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":t=/^\d+$/;break;case"alphanum":t=/^\w+$/;break;case"email":t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;break;case"url":t=/^((([A-Za-z0-9.+-]+:(?:\/\/)?)(?:[-;:&=\+\,\w]@)?[A-Za-z0-9.-]+(:[0-9]+)?|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)$/i;break;case"dateIso":t=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;default:return!1}return i!==""?t.test(i):!1},guess_style:function(i,e,t){var r=e||"default",s="gray";return i&&(i=cstr(i),has_words(["Pending","Review","Medium","Not Approved"],i)?(r="warning",s="orange"):has_words(["Open","Urgent","High","Failed","Rejected","Error"],i)?(r="danger",s="red"):has_words(["Closed","Finished","Converted","Completed","Complete","Confirmed","Approved","Yes","Active","Available","Paid","Success"],i)?(r="success",s="green"):has_words(["Submitted"],i)&&(r="info",s="blue")),t?s:r},guess_colour:function(i){return frappe.utils.guess_style(i,null,!0)},get_indicator_color:function(i){return frappe.db.get_list("Workflow State",{filters:{name:i},fields:["name","style"]}).then(e=>{let t=e[0];if(!t.style)return frappe.utils.guess_colour(t.name);let r=t.style;return{Success:"green",Warning:"orange",Danger:"red",Primary:"blue"}[r]})},sort:function(i,e,t,r){if(!i||i.length<2)return i||[];var s={string:function(n,o){return cstr(n[e]).localeCompare(cstr(o[e]))},number:function(n,o){return flt(n[e])-flt(o[e])}};return t||(t=typeof i[0][e]=="string"?"string":"number"),i.sort(s[t]),r&&i.reverse(),i},unique:function(i){for(var e={},t=[],r=0,s=i.length;r<s;r++)i[r]in e||(e[i[r]]=null,t.push(i[r]));return t},remove_nulls:function(i){for(var e=[],t=0,r=i.length;t<r;t++)is_null(i[t])||e.push(i[t]);return e},all:function(i){for(var e=0,t=i.length;e<t;e++)if(!i[e])return!1;return!0},dict:function(i,e){var t=[];return $.each(e,function(r,s){var n={};$.each(i,function(o,a){n[a]=s[o]}),t.push(n)}),t},sum:function(i){return i.reduce(function(e,t){return flt(e)+flt(t)},0)},arrays_equal:function(i,e){if(!i||!e||i.length!=e.length)return!1;for(var t=0;t<i.length;t++)if($.isArray(i[t])){if(!frappe.utils.arrays_equal(i[t],e[t]))return!1}else if(i[t]!==e[t])return!1;return!0},intersection:function(i,e){var t=0,r=0,s=new Array;for(i=[].concat(i).sort(),e=[].concat(e).sort();t<i.length&&r<e.length;)i[t]<e[r]?t++:(i[t]>e[r]||(s.push(i[t]),t++),r++);return s},resize_image:function(i,e,t,r){var s=new Image;t||(t=600),r||(r=400),s.src=i.result,s.onload=function(){var n=s.width,o=s.height;n>o?n>t&&(o*=t/n,n=t):o>r&&(n*=r/o,o=r);var a=document.createElement("canvas");a.width=n,a.height=o;var l=a.getContext("2d");l.drawImage(this,0,0,n,o);var c=a.toDataURL("image/jpeg");setTimeout(function(){e(c)},10)}},csv_to_array:function(i,e){e=e||",";for(var t=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),r=[[]],s=null;s=t.exec(i);){var n=s[1];n.length&&n!==e&&r.push([]);var o;s[2]?o=s[2].replace(new RegExp('""',"g"),'"'):o=s[3],r[r.length-1].push(o)}return r},warn_page_name_change:function(){frappe.msgprint(__("Note: Changing the Page Name will break previous URL to this page."))},set_title:function(i){frappe._original_title=i,frappe._title_prefix&&(i=frappe._title_prefix+" "+i.replace(/<[^>]*>/g,"")),document.title=i;let e=frappe.router.get_sub_path();frappe.route_titles[e]=i},set_title_prefix:function(i){frappe._title_prefix=i,frappe.utils.set_title(frappe._original_title)},is_image_file:function(i){return i?(i=i.split("?")[0],/\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(i)):!1},is_video_file:function(i){return i?(i=i.split("?")[0],/\.(mov|mp4|mkv|webm)$/i.test(i)):!1},play_sound:function(i){try{if(frappe.boot.user.mute_sounds)return;var e=$("#sound-"+i)[0];e.volume=e.getAttribute("volume"),e.play()}catch(t){console.log("Cannot play sound",i,t)}},split_emails:function(i){var e=[];return i&&i.split(/[,\n](?=(?:[^"]|"[^"]*")*$)/g).forEach(function(t){t=t.trim(),t&&e.push(t)}),e},supportsES6:function(){try{return new Function("(a = 0) => a"),!0}catch(i){return!1}}(),throttle:function(i,e,t){var r,s,n,o=null,a=0;t||(t={});let l=function(){a=t.leading===!1?0:Date.now(),o=null,n=i.apply(r,s),o||(r=s=null)};return function(){var c=Date.now();!a&&t.leading===!1&&(a=c);let u=e-(c-a);return r=this,s=arguments,u<=0||u>e?(o&&(clearTimeout(o),o=null),a=c,n=i.apply(r,s),o||(r=s=null)):!o&&t.trailing!==!1&&(o=setTimeout(l,u)),n}},debounce:function(i,e,t){var r;return function(){var s=this,n=arguments,o=function(){r=null,t||i.apply(s,n)},a=t&&!r;clearTimeout(r),r=setTimeout(o,e),a&&i.apply(s,n)}},get_form_link:function(i,e,t=!1,r=null,s=null){r=r||e,e=encodeURIComponent(e);let n=`/app/${encodeURIComponent(i.toLowerCase().replace(/ /g,"-"))}/${e}`;return s&&(n+=frappe.utils.make_query_string(s)),t?`<a href="${n}">${r}</a>`:n},get_route_label(i){let e=i.split("/");return e[2]==="Report"||e[0]==="query-report"?(__(e[3])||__(e[1])).bold()+" "+__("Report"):e[0]==="List"?__(e[1]).bold()+" "+__("List"):e[0]==="modules"?__(e[1]).bold()+" "+__("Module"):e[0]==="Workspaces"?__(e[1]).bold()+" "+__("Workspace"):e[0]==="dashboard"?__(e[1]).bold()+" "+__("Dashboard"):__(frappe.utils.to_title_case(__(e[0]),!0))},report_column_total:function(i,e,t){return e.column.disable_total?"":i.length>0?e.column.fieldtype=="Percent"||t==="mean"?i.reduce((r,s)=>flt(r)+flt(s))/i.length:e.column.fieldtype=="Int"?i.reduce((r,s)=>cint(r)+cint(s)):frappe.model.is_numeric_field(e.column.fieldtype)?i.reduce((r,s)=>flt(r)+flt(s)):null:null},setup_search(i,e,t,r){let s=i.find('[data-element="search"]').show();s.focus().val("");let n=i.find(e).show();s.off("keyup").on("keyup",()=>{let o=s.val().toLowerCase();o=o.replace(/^\s+|\s+$/g,"");for(let a=0;a<n.length;a++){let l=n.eq(a).find(t),c=l.text().toLowerCase(),u="";r&&l.attr(r)&&(u=l.attr(r).toLowerCase()),c.includes(o)||u.includes(o)?n.eq(a).css("display",""):n.eq(a).css("display","none")}})},setup_timer(i,e,t){let r=e>i,s=i,n=setInterval(()=>{if(r?s++:s--,r?s>e:s<e){clearInterval(n);return}t.text(s)},1e3)},deep_equal(i,e){return(0,Ih.default)(i,e)},deep_clone(i,e){return(0,Mh.default)(i,e)},file_name_ellipsis(i,e){let t=e*2/3,r=e-t,s=i.split("."),n=s.pop(),o=s.join(""),a=o.slice(0,t),l=o.slice(-r);return o.length>e?`${a}...${l}.${n}`:i},get_decoded_string(i){let t=i.split(",")[1],r=atob(t);try{let s=escape(r);r=decodeURIComponent(s)}catch(s){}return r},copy_to_clipboard(i){let e=()=>{frappe.show_alert({indicator:"green",message:__("Copied to clipboard.")})};if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(i).then(e);else{let t=$("<textarea>");$("body").append(t),t.val(i).select(),document.execCommand("copy"),e(),t.remove()}},is_rtl(i=null){return["ar","he","fa","ps"].includes(i||frappe.boot.lang)},bind_actions_with_object(i,e){return $(i).off("click.class_actions"),$(i).on("click.class_actions","[data-action]",t=>{let r=$(t.currentTarget),s=r.data("action");e[s]&&e[s](t,r)}),i},eval(i,e={}){let t=Object.keys(e),r=Object.values(e);i=`let out = ${i}; return out`;try{return new Function(...t,i)(...r)}catch(s){throw console.log("Error evaluating the following expression:"),console.error(i),s}},get_browser(){let i=navigator.userAgent,e,t=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(t[1])?(e=/\brv[ :]+(\d+)/g.exec(i)||[],{name:"IE",version:e[1]||""}):t[1]==="Chrome"&&(e=i.match(/\bOPR|Edge\/(\d+)/),e!=null)?{name:"Opera",version:e[1]}:(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],(e=i.match(/version\/(\d+)/i))!=null&&t.splice(1,1,e[1]),{name:t[0],version:t[1]})},get_formatted_duration(i,e=null){let t="";if(e||(e={hide_days:0,hide_seconds:0}),i){let r=frappe.utils.seconds_to_duration(i,e);r.days&&(t+=r.days+__("d",null,"Days (Field: Duration)")),r.hours&&(t+=t.length?" ":"",t+=r.hours+__("h",null,"Hours (Field: Duration)")),r.minutes&&(t+=t.length?" ":"",t+=r.minutes+__("m",null,"Minutes (Field: Duration)")),r.seconds&&(t+=t.length?" ":"",t+=r.seconds+__("s",null,"Seconds (Field: Duration)"))}return t},seconds_to_duration(i,e){let t=i>0?Math.floor:Math.ceil,r={days:t(i/86400),hours:t(i%86400/3600),minutes:t(i%3600/60),seconds:t(i%60)};return e&&e.hide_days&&(r.hours=t(i/3600),r.days=0),r},duration_to_seconds(i=0,e=0,t=0,r=0){let s=0;return i&&(s+=i*24*60*60),e&&(s+=e*60*60),t&&(s+=t*60),r&&(s+=r),s},get_duration_options:function(i){return{hide_days:i.hide_days,hide_seconds:i.hide_seconds}},get_number_system:function(i){return["Bangladesh","India","Myanmar","Pakistan"].includes(i)?wn.indian:i=="Nepal"?wn.nepalese:wn.default},map_defaults:{center:[19.08,72.8961],zoom:13,tiles:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'},image_path:"/assets/frappe/images/leaflet/"},icon(i,e="sm",t="",r="",s=""){let n="",o=i.startsWith("es-");return i=o?`${"#"+i}`:`${"#icon-"+i}`,typeof e=="object"?r+=` width: ${e.width}; height: ${e.height}`:n=`icon-${e}`,`<svg class="${o?i.startsWith("es-solid")?"es-icon es-solid":"es-icon es-line":"icon"} ${s} ${n}" style="${r}" aria-hidden="true">
			<use class="${t}" href="${i}"></use>
		</svg>`},flag(i){return`<img loading="lazy" src="https://flagcdn.com/${i}.svg" width="20" height="15">`},make_chart(i,e={}){let t={type:"bar",colors:["light-blue"],axisOptions:{xIsSeries:1,shortenYAxisNumbers:1,xAxisMode:"tick",numberFormatter:frappe.utils.format_chart_axis_number}};for(let r in e)typeof t[r]=="object"&&typeof e[r]=="object"?t[r]=Object.assign(t[r],e[r]):t[r]=e[r];return frappe.utils.set_space_label_ratio(t),new frappe.Chart(i,t)},format_chart_axis_number(i,e){let t=frappe.sys_defaults.country;return frappe.utils.shorten_number(i,e||t,3)},set_space_label_ratio(i){i.data.labels.length>10&&(i.axisOptions.seriesLabelSpaceRatio=.9)},generate_route(i){let e=i.type.toLowerCase();e==="doctype"&&(i.doctype=i.name);let t="";if(i.route)t=i.route;else if(i.link)t=strip(i.link,"#");else if(e==="doctype"){let r=frappe.router.slug(i.doctype);if(frappe.model.is_single(i.doctype))t=r;else switch(i.doc_view){case"List":i.filters&&(frappe.route_options=i.filters),t=`${r}/view/list`;break;case"Tree":t=`${r}/view/tree`;break;case"Report Builder":t=`${r}/view/report`;break;case"Dashboard":t=`${r}/view/dashboard`;break;case"New":t=`${r}/new`;break;case"Calendar":t=`${r}/view/calendar/default`;break;case"Kanban":t=`${r}/view/kanban`,i.kanban_board&&(t+=`/${i.kanban_board}`);break;case"Image":t=`${r}/view/image`;break;default:t=r}}else e==="report"?i.is_query_report?t="query-report/"+i.name:!i.is_query_report&&i.report_ref_doctype?t=frappe.router.slug(i.report_ref_doctype)+"/view/report/"+i.name:t="report/"+i.name:e==="page"?t=i.name:e==="dashboard"&&(t=`dashboard-view/${i.name}`);return i.route_options&&(t+="?"+$.map(i.route_options,function(r,s){return encodeURIComponent(s)+"="+encodeURIComponent(r)}).join("&")),`/app/${t}`},shorten_number:function(i,e,t=4,r=2){if(String(i).match(/\d/g).length<t)return i.toString();let n=this.get_number_system(e),o=Math.abs(Math.round(i)),a=o.toString();if(a.length<t)return a;for(let l of n)if(o>=l.divisor){let c=i/l.divisor;return c=this.get_number_of_decimals(c)>r?c.toFixed(r):c,c+" "+l.symbol}return i.toFixed(r)},get_number_of_decimals:function(i){return Math.floor(i)===i?0:i.toString().split(".")[1].length||0},build_summary_item(i){if(i.type=="separator")return $(`<div class="summary-separator">
				<div class="summary-value ${i.color?i.color.toLowerCase():"text-muted"}">${i.value}</div>
			</div>`);let e={fieldtype:i.datatype},t=null;i.datatype=="Currency"&&(e.options="currency",t={currency:i.currency});let r=frappe.format(i.value,e,{only_value:!0},t),s=i.indicator?i.indicator.toLowerCase():i.color?i.color.toLowerCase():"";return $(`<div class="summary-item">
			<span class="summary-label">${__(i.label)}</span>
			<div class="summary-value ${s}">${r}</div>
		</div>`)},print(i,e,t,r,s){if(!window.open(frappe.urllib.get_full_url("/printview?doctype="+encodeURIComponent(i)+"&name="+encodeURIComponent(e)+"&trigger_print=1&format="+encodeURIComponent(t)+"&no_letterhead="+(r?"0":"1")+"&letterhead="+encodeURIComponent(r)+(s?"&_lang="+s:"")))){frappe.msgprint(__("Please enable pop-ups"));return}},get_clipboard_data(i){let e=i;return(e.clipboardData||window.clipboardData||e.originalEvent.clipboardData).getData("Text")},add_custom_button(i,e,t="",r="",s,n,o){s||(s="btn-secondary");let a=$(`<button class="btn ${s} btn-xs ${t}" title="${r}">${i}</button>`);a.click(l=>{l.stopPropagation(),e&&e(l)}),!o&&a.appendTo(n),o&&n.prepend(a)},add_select_group_button(i,e,t,r="",s){let n=e[0],o=$(`
			<div class="btn-group select-group-btn">
				<button type="button" class="btn ${t} btn-sm selected-button">
					<span class="left-icon">${r&&frappe.utils.icon(r,"xs")}</span>
					<span class="label">${n.label}</span>
				</button>

				<button type="button" class="btn ${t} btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown">
					${frappe.utils.icon("down","xs")}
				</button>

				<ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
			</div>
		`);return e.forEach(a=>{$(`<li>
				<a class="dropdown-item flex">
					<div class="tick-icon mr-2">${frappe.utils.icon("check","xs")}</div>
					<div>
						<div class="item-label">${a.label}</div>
						<div class="item-description text-muted small">${a.description||""}</div>
					</div>
				</a>
			</li>`).appendTo(o.find(".dropdown-menu")).click(l=>{n=a,o.find(".selected-button .label").text(a.label),$(l.currentTarget).find(".tick-icon").addClass("selected"),$(l.currentTarget).siblings().find(".tick-icon").removeClass("selected")})}),o.find(".dropdown-menu li:first-child .tick-icon").addClass("selected"),o.find(".selected-button").click(a=>{a.stopPropagation(),n.action&&n.action(a)}),!s&&o.appendTo(i),s&&i.prepend(o),o},sleep(i){return new Promise(e=>setTimeout(e,i))},parse_array(i){if(i&&i.length!==0)return i},range(i,e){e||(e=i,i=0);let t=[];for(let r=i;r<e;r++)t.push(r);return t},get_link_title(i,e){if(!(!i||!e||!frappe._link_titles))return frappe._link_titles[i+"::"+e]},add_link_title(i,e,t){!i||!e||(frappe._link_titles||(frappe._link_titles={}),frappe._link_titles[i+"::"+e]=t)},fetch_link_title(i,e){if(!(!i||!e))try{return frappe.xcall("frappe.desk.search.get_link_title",{doctype:i,docname:e}).then(t=>(frappe.utils.add_link_title(i,e,t),t))}catch(t){return console.log("Error while fetching link title."),console.log(t),Promise.resolve(e)}},only_allow_num_decimal(i){i.on("input",e=>{let t=$(e.target);t.val(t.val().replace(/[^0-9.\-]/g,"")),(e.which!=46||t.val().indexOf(".")!=-1)&&(e.which<48||e.which>57)&&e.preventDefault()})},string_to_boolean(i){switch(i.toLowerCase().trim()){case"t":case"true":case"y":case"yes":case"1":return!0;case"f":case"false":case"n":case"no":case"0":case null:return!1;default:return i}},get_filter_as_json(i){let e=null;return i.length&&(e={},i.forEach(t=>{e[t[1]]=[t[2],t[3]]}),e=JSON.stringify(e)),e},process_filter_expression(i){return new Function(`return ${i}`)()},get_filter_from_json(i,e){if(i){if(!i.length)return[];let t=this.process_filter_expression(i);if(!e){if(Array.isArray(t)){let r={};return t.forEach(s=>{r[s[1]]=[s[2],s[3]]}),r||[]}return t||[]}return Array.isArray(t)?t:Object.keys(t).map(r=>{let s=t[r];return[e,r,s[0],s[1],!1]})}},load_video_player(){return frappe.require("video_player.bundle.js")},is_current_user(i){return i===frappe.session.user},debug:{watch_property(i,e,t=console.trace){if(!frappe.boot.developer_mode)return;console.warn("Adding property watcher, make sure to remove it after debugging.");let r="$_"+e+"_$";i[r]=i[e],Object.defineProperty(i,e,{get:function(){return i[r]},set:function(s){t(),i[r]=s}})}},generate_tracking_url(){frappe.prompt([{fieldname:"url",label:__("Web Page URL"),fieldtype:"Data",options:"URL",reqd:1,default:localStorage.getItem("tracker_url:url")},{fieldname:"source",label:__("Source"),fieldtype:"Link",reqd:1,options:"UTM Source",description:"The referrer (e.g. google, newsletter)",default:localStorage.getItem("tracker_url:source")},{fieldname:"campaign",label:__("Campaign"),fieldtype:"Link",ignore_link_validation:1,options:"UTM Campaign",default:localStorage.getItem("tracker_url:campaign")},{fieldname:"medium",label:__("Medium"),fieldtype:"Link",options:"UTM Medium",description:"Marketing medium (e.g. cpc, banner, email)",default:localStorage.getItem("tracker_url:medium")},{fieldname:"content",label:__("Content"),fieldtype:"Data",description:"Use to differentiate ad variants (e.g. A/B testing)",default:localStorage.getItem("tracker_url:content")}],async function(i){let e=i.url;localStorage.setItem("tracker_url:url",i.url);let{message:t}=await frappe.db.get_value("UTM Source",i.source,"slug");if(e+="?utm_source="+encodeURIComponent(t.slug||i.source),localStorage.setItem("tracker_url:source",i.source),i.campaign){let{message:r}=await frappe.db.get_value("UTM Campaign",i.campaign,"slug");e+="&utm_campaign="+encodeURIComponent(r.slug||i.campaign),localStorage.setItem("tracker_url:campaign",i.campaign)}if(i.medium){let{message:r}=await frappe.db.get_value("UTM Medium",i.medium,"slug");e+="&utm_medium="+encodeURIComponent(r.slug||i.medium),localStorage.setItem("tracker_url:medium",i.medium)}i.content&&(e+="&utm_content="+encodeURIComponent(i.content),localStorage.setItem("tracker_url:content",i.content)),frappe.utils.copy_to_clipboard(e),frappe.msgprint(__("Tracking URL generated and copied to clipboard")+`: <br><a href="${e}">${e.bold()}</a>`,__("Here's your tracking URL"))},__("Generate Tracking URL"))},is_empty(i){return!i&&i!==0?!0:typeof i=="object"?(Array.isArray(i)?i:Object.keys(i)).length===0:!1}});frappe.provide("frappe.utils");var M0={init(){this.jq=jQuery({})},trigger(i,e){!this.jq&&this.init(),this.jq.trigger(i,e)},once(i,e){!this.jq&&this.init(),this.jq.one(i,(t,r)=>e(r))},on(i,e){!this.jq&&this.init(),this.jq.bind(i,(t,r)=>e(r))},off(i,e){!this.jq&&this.init(),this.jq.unbind(i,(t,r)=>e(r))}};frappe.utils.make_event_emitter=function(i){return Object.assign(i,M0),i};frappe.provide("frappe.views");frappe.re_route={"#login":""};frappe.route_titles={};frappe.route_flags={};frappe.route_history=[];frappe.view_factory={};frappe.view_factories=[];frappe.route_options=null;frappe.open_in_new_tab=!1;frappe.route_hooks={};window.addEventListener("popstate",i=>(frappe.router.route(),i.preventDefault(),!1));$("body").on("click","a",function(i){let e=i.currentTarget,t=e.getAttribute("href"),r=e.hostname===window.location.hostname;if(e.getAttribute("target")==="_blank")return;let s=n=>(i.preventDefault(),frappe.set_route(n),!1);if(!(!r||e.getAttribute("onclick")||i.ctrlKey||i.metaKey||t==="#")&&frappe.router.is_app_route(e.pathname)){if(e.search){frappe.route_options={};let n=new URLSearchParams(e.search);for(let[o,a]of n)frappe.route_options[o]=a}return e.hash&&(frappe.route_hash=e.hash),s(e.pathname)}});frappe.router={current_route:null,routes:{},factory_views:["form","list","report","tree","print","dashboard"],list_views:["list","kanban","report","calendar","tree","gantt","dashboard","image","inbox","map"],list_views_route:{list:"List",kanban:"Kanban",report:"Report",calendar:"Calendar",tree:"Tree",gantt:"Gantt",dashboard:"Dashboard",image:"Image",inbox:"Inbox",file:"Home",map:"Map"},layout_mapped:{},is_app_route(i){if(!!i&&(i.substr(0,1)==="/"&&(i=i.substr(1)),i=i.split("/"),i[0]))return i[0]==="app"},setup(){for(let i of frappe.boot.user.can_read)this.routes[this.slug(i)]={doctype:i};if(frappe.boot.doctype_layouts)for(let i of frappe.boot.doctype_layouts)this.routes[this.slug(i.name)]={doctype:i.document_type,doctype_layout:i.name}},async route(){if(!frappe.app)return;let i=this.get_sub_path();frappe.boot.setup_complete?!frappe.re_route["setup-wizard"]&&(frappe.re_route["setup-wizard"]="app"):i.startsWith("setup-wizard")||(frappe.re_route["setup-wizard"]&&delete frappe.re_route["setup-wizard"],frappe.set_route(["setup-wizard"])),!this.re_route(i)&&(this.current_sub_path=i,this.current_route=await this.parse(),this.set_history(i),this.set_active_sidebar_item(),this.render(),this.set_title(i),this.trigger("change"))},async parse(i){return i=this.get_sub_path_string(i).split("/"),i?(i=$.map(i,this.decode_component),this.set_route_options_from_url(),await this.convert_to_standard_route(i)):[]},async convert_to_standard_route(i){if(frappe.workspaces[i[0]])i=["Workspaces",frappe.workspaces[i[0]].name];else if(i[0]=="private"){let e=i[1]&&`${i[1]}-${frappe.user.name.toLowerCase()}`;if(!frappe.workspaces[e])return frappe.msgprint(__("Workspace <b>{0}</b> does not exist",[i[1]])),["Workspaces"];i=["Workspaces","private",frappe.workspaces[e].name]}else this.routes[i[0]]&&(i=await this.set_doctype_route(i));return i},doctype_route_exist(i){return i=this.get_sub_path_string(i).split("/"),this.routes[i[0]]},set_doctype_route(i){let e=this.routes[i[0]];return frappe.model.with_doctype(e.doctype).then(()=>{let t=frappe.get_meta(e.doctype);if(i[1]&&i[1]==="view"&&i[2])i=this.get_standard_route_for_list(i,e,t.force_re_route_to_default_view&&t.default_view?t.default_view:null);else if(i[1]&&i[1]!=="view"){let r=i[1];i.length>2&&(r=i.slice(1).join("/")),i=["Form",e.doctype,r]}else frappe.model.is_single(e.doctype)?i=["Form",e.doctype,e.doctype]:t.default_view?t.default_view==="Tree"?i=["Tree",e.doctype]:i=["List",e.doctype,this.list_views_route[t.default_view.toLowerCase()]]:i=["List",e.doctype,"List"];return this.doctype_layout=e.doctype_layout,i})},get_standard_route_for_list(i,e,t){let r,s=t||i[2]||"";if(s.toLowerCase()==="tree")r=["Tree",e.doctype];else{let n=this.list_views_route[s.toLowerCase()];i[2].toLowerCase()!==(n==null?void 0:n.toLowerCase())&&(frappe.route_flags.replace_route=!0,i[2]=s.toLowerCase(),this.set_route(i)),r=["List",e.doctype,this.list_views_route[s.toLowerCase()]],i[3]&&r.push(...i.slice(3,i.length))}return r},set_history(){frappe.route_history.push(this.current_route),frappe.ui.hide_open_dialog()},async set_active_sidebar_item(){frappe.app.sidebar.set_active_workspace_item()},render(){this.current_route[0]?this.render_page():frappe.views.pageview.show("")},render_page(){let i=this.current_route,e=frappe.utils.to_title_case(i[0]);if(i[1]&&frappe.views[e+"Factory"])i[0]=e,frappe.view_factory[e]||(frappe.view_factory[e]=new frappe.views[e+"Factory"]),frappe.view_factory[e].show();else{let t=frappe.utils.xss_sanitise(i[0]);frappe.views.pageview&&frappe.views.pageview.show(t)}},re_route(i){if(frappe.re_route[i]!==void 0){let e=this.get_sub_path(frappe.re_route[i]);return e===this.current_sub_path?window.history.back():frappe.set_route(e),!0}},set_title(i){frappe.route_titles[i]&&frappe.utils.set_title(frappe.route_titles[i])},set_route(){let i=Array.from(arguments);return new Promise(e=>{i=this.get_route_from_arguments(i),i=this.convert_from_standard_route(i);let t=this.make_url(i);if(t+=frappe.route_hash||"",frappe.route_hash=null,frappe.open_in_new_tab)localStorage.route_options=JSON.stringify(frappe.route_options),window.open(t,"_blank"),frappe.open_in_new_tab=!1;else try{let r=frappe.route_options||{},s=Object.entries(r).map(([n,o])=>`${n}=`+encodeURIComponent(JSON.stringify(o))).join("&");this.push_state(t,s?`?${s}`:"")}catch(r){this.push_state(t)}setTimeout(()=>{frappe.after_ajax&&frappe.after_ajax(()=>{e()})},100)}).finally(()=>frappe.route_flags={})},get_route_from_arguments(i){return i.length===1&&$.isArray(i[0])&&(i=i[0]),i.length===1&&i[0]&&i[0].includes("/")&&(i=$.map(i[0].split("/"),this.decode_component)),i&&i[0]==""&&i.shift(),i&&["desk","app"].includes(i[0])&&i.shift(),i},convert_from_standard_route(i){let e=i[0]?i[0].toLowerCase():"",t=i;return e==="list"?i[2]&&i[2]!=="list"&&!$.isPlainObject(i[2])?(t=[this.slug(i[1]),"view",i[2].toLowerCase()],i[3]&&t.push(...i.slice(3,i.length))):($.isPlainObject(i[2])&&(frappe.route_options=i[2]),t=[this.slug(i[1])]):e==="form"?(t=[this.slug(i[1])],i[2]&&t.push(i[2])):e==="tree"&&(t=[this.slug(i[1]),"view","tree"]),t},slug_parts(i){return i[0]&&this.factory_views.includes(i[0].toLowerCase())&&(i[0]=i[0].toLowerCase(),i[1]=this.slug(i[1])),i},make_url(i){var n;let e=$.map(i,function(o){return $.isPlainObject(o)?(frappe.route_options=o,null):encodeURIComponent(String(o))}).join("/");if(e)return"/app/"+e;let t=`home-${frappe.user.name.toLowerCase()}`,r=frappe.router.slug(((n=frappe.boot.user.default_workspace)==null?void 0:n.name)||""),s=frappe.workspaces[r]||frappe.workspaces[t]||frappe.workspaces.home||Object.values(frappe.workspace_map).find(o=>o.app===frappe.current_app)||Object.values(frappe.workspaces)[0];return s?"/app/"+(s.public?"":"private/")+frappe.router.slug(s.name):"/app"},push_state(i,e=""){if(window.location.pathname!==i||window.location.search!==e){let t=frappe.route_flags.replace_route?"replaceState":"pushState";history[t](null,null,i),this.route()}},get_sub_path_string(i){return i||(i=window.location.pathname),this.strip_prefix(i)},strip_prefix(i){return i.substr(0,1)=="/"&&(i=i.substr(1)),i=="app"&&(i=i.substr(4)),i.startsWith("app/")&&(i=i.substr(4)),i.substr(0,1)=="/"&&(i=i.substr(1)),i.substr(0,1)=="#"&&(i=i.substr(1)),i.substr(0,1)=="!"&&(i=i.substr(1)),i},get_sub_path(i){var e=this.get_sub_path_string(i);return i=$.map(e.split("/"),this.decode_component).join("/"),i},set_route_options_from_url(){let i=window.location.search;frappe.route_options||(frappe.route_options={}),localStorage.getItem("route_options")&&(frappe.route_options=JSON.parse(localStorage.getItem("route_options")),localStorage.removeItem("route_options"));let e=new URLSearchParams(i);for(let[t,r]of e)frappe.route_options[t]=r},decode_component(i){try{return decodeURIComponent(i)}catch(e){if(e instanceof URIError)return i;throw e}},slug(i){return i.toLowerCase().replace(/ /g,"-")}};frappe.get_route=()=>frappe.router.current_route;frappe.get_route_str=()=>frappe.router.current_route.join("/");frappe.set_route=function(){return frappe.router.set_route.apply(frappe.router,arguments)};frappe.get_prev_route=function(){return frappe.route_history&&frappe.route_history.length>1?frappe.route_history[frappe.route_history.length-2]:[]};frappe.set_re_route=function(){var i=frappe.router.get_sub_path();frappe.set_route.apply(null,arguments),frappe.re_route[i]=frappe.router.get_sub_path()};frappe.has_route_options=function(){return Boolean(Object.keys(frappe.route_options||{}).length)};frappe.utils.make_event_emitter(frappe.router);frappe.route_history_queue=[];var N0=["Form","social","setup-wizard","recorder"],R0=frappe.utils.debounce(()=>{if(frappe.session.user==="Guest")return;let i=frappe.route_history_queue;!i.length||(frappe.route_history_queue=[],frappe.xcall("frappe.desk.doctype.route_history.route_history.deferred_insert",{routes:i}).catch(()=>{frappe.route_history_queue.concat(i)}))},1e4);frappe.router.on("change",()=>{let i=frappe.get_route();D0(i)&&(frappe.route_history_queue.push({creation:frappe.datetime.now_datetime(),route:frappe.get_route_str()}),R0())});function D0(i){return i[1]?!(i[0]==="List"&&!i[2]||N0.includes(i[0])):!1}frappe.defaults={get_user_default:function(i){let e=frappe.boot.user.defaults,t=e[i];if(!t&&frappe.defaults.is_a_user_permission_key(i)){t=e[frappe.model.scrub(i)];let r=this.get_user_permission_default(i,e);r&&(t=r)}if($.isArray(t)&&(t=t[0]),!!frappe.defaults.in_user_permission(i,t))return t},get_user_permission_default:function(i,e){let t=this.get_user_permissions(),r=null;return t[i]&&(t[i].forEach(s=>{e[i]==s.doc&&(r=s.doc)}),t[i].forEach(s=>{s.is_default&&(r=s.doc)})),r},get_user_defaults:function(i){var e=frappe.boot.user.defaults,t=e[i];return frappe.defaults.is_a_user_permission_key(i)&&(t&&$.isArray(t)&&t.length===1?t=t[0]:t=e[i]||e[frappe.model.scrub(i)]),$.isArray(t)||(t=[t]),t.filter(r=>{if(frappe.defaults.in_user_permission(i,r))return r}),t},get_global_default:function(i){var e=frappe.sys_defaults[i];return $.isArray(e)&&(e=e[0]),e},get_global_defaults:function(i){var e=frappe.sys_defaults[i];return $.isArray(e)||(e=[e]),e},set_user_default_local:function(i,e){frappe.boot.user.defaults[i]=e},get_default:function(i){var e=frappe.boot.user.defaults,t=e[i];if(frappe.defaults.is_a_user_permission_key(i)&&(t&&$.isArray(t)&&t.length===1?t=t[0]:t=e[frappe.model.scrub(i)]),!!frappe.defaults.in_user_permission(i,t)&&t)try{return JSON.parse(t)}catch(r){return t}},is_a_user_permission_key:function(i){return i.indexOf(":")===-1&&i!==frappe.model.scrub(i)},in_user_permission:function(i,e){let t=this.get_user_permissions()[frappe.model.unscrub(i)];return t&&t.length?t.some(r=>r.doc===e):!0},get_user_permissions:function(){return this._user_permissions||{}},update_user_permissions:function(){let i="frappe.core.doctype.user_permission.user_permission.get_user_permissions";frappe.call(i).then(e=>{e.message&&(this._user_permissions=Object.assign({},e.message))})},load_user_permission_from_boot:function(){frappe.boot.user.user_permissions?this._user_permissions=Object.assign({},frappe.boot.user.user_permissions):frappe.defaults.update_user_permissions()}};frappe.RoleEditor=class{constructor(i,e,t){this.frm=e,this.wrapper=i,this.disable=t;let r=this.frm.doc.roles?this.frm.doc.roles.map(n=>n.role):[];this.multicheck=frappe.ui.form.make_control({parent:i,df:{fieldname:"roles",fieldtype:"MultiCheck",select_all:!0,columns:"15rem",get_data:()=>frappe.xcall("frappe.core.doctype.user.user.get_all_roles").then(n=>n.map(o=>({label:__(o),value:o,checked:r.includes(o)}))),on_change:()=>{this.set_roles_in_table(),this.frm.dirty()}},render_input:!0});let s=this.multicheck.make_checkboxes;this.multicheck.make_checkboxes=()=>{s.call(this.multicheck),this.multicheck.$wrapper.find(".label-area").click(n=>{let o=$(n.target).data("unit");o&&this.show_permissions(o),n.preventDefault()}),this.set_enable_disable()}}set_enable_disable(){$(this.wrapper).find('input[type="checkbox"]').attr("disabled",!!this.disable)}show_permissions(i){return this.perm_dialog||this.make_perm_dialog(),$(this.perm_dialog.body).empty(),frappe.xcall("frappe.core.doctype.user.user.get_perm_info",{role:i}).then(e=>{let t=$(this.perm_dialog.body);e.length?(t.append(`
						<table class="user-perm">
							<thead>
								<tr>
									<th> ${__("Document Type")} </th>
									<th> ${__("Level")} </th>
									<th> ${__("If Owner")} </th>
									${frappe.perm.rights.map(r=>`<th> ${__(frappe.unscrub(r))}</th>`).join("")}
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					`),e.forEach(r=>{t.find("tbody").append(`
							<tr>
								<td>${__(r.parent)}</td>
								<td>${r.permlevel}</td>
								<td>${r.if_owner?frappe.utils.icon("check","xs"):"-"}</td>
								${frappe.perm.rights.map(s=>`<td class="text-muted bold">${r[s]?frappe.utils.icon("check","xs"):"-"}</td>`).join("")}
							</tr>
						`)})):t.append(`<div class="text-muted text-center padding">
						${__("{0} role does not have permission on any doctype",[__(i)])}
					</div>`),this.perm_dialog.set_title(__(i)),this.perm_dialog.show()})}make_perm_dialog(){this.perm_dialog=new frappe.ui.Dialog({title:__("Role Permissions")}),this.perm_dialog.$wrapper.find(".modal-dialog").css("width","auto").css("max-width","1200px"),this.perm_dialog.$wrapper.find(".modal-body").css("overflow","overlay")}show(){this.reset(),this.set_enable_disable()}reset(){let i=(this.frm.doc.roles||[]).map(e=>e.role);this.multicheck.selected_options=i,this.multicheck.refresh_input()}set_roles_in_table(){let i=this.frm.doc.roles||[],e=this.multicheck.get_checked_options();i.map(t=>{e.includes(t.role)||frappe.model.clear_doc(t.doctype,t.name)}),e.map(t=>{if(!i.find(r=>r.role===t)){let r=frappe.model.add_child(this.frm.doc,"Has Role","roles");r.role=t}})}get_roles(){return{checked_roles:this.multicheck.get_checked_options(),unchecked_roles:this.multicheck.get_unchecked_options()}}};frappe.ModuleEditor=class{constructor(e,t){this.frm=e,this.wrapper=t;let r=this.frm.doc.block_modules.map(s=>s.module);this.multicheck=frappe.ui.form.make_control({parent:t,df:{fieldname:"block_modules",fieldtype:"MultiCheck",select_all:!0,columns:"15rem",get_data:()=>this.frm.doc.__onload.all_modules.map(s=>({label:__(s),value:s,checked:!r.includes(s)})),on_change:()=>{this.set_modules_in_table(),this.frm.dirty()}},render_input:!0})}show(){let e=this.frm.doc.block_modules.map(r=>r.module),t=this.frm.doc.__onload.all_modules;this.multicheck.selected_options=t.filter(r=>!e.includes(r)),this.multicheck.refresh_input()}set_modules_in_table(){let e=this.frm.doc.block_modules||[],t=this.multicheck.get_unchecked_options();e.map(r=>{t.includes(r.module)||frappe.model.clear_doc(r.doctype,r.name)}),t.map(r=>{if(!e.find(s=>s.module===r)){let s=frappe.model.add_child(this.frm.doc,"Block Module","block_modules");s.module=r}})}};frappe.template={compiled:{},debug:{}};frappe.template.compile=function(i,e){var t=e||i;if(!frappe.template.compiled[t]){let n=function(o,a,l,c,u){var p=frappe.utils.get_random(3),m=frappe.utils.get_random(3);return"{% for (var "+p+"=0, "+m+"="+l+".length; "+p+"<"+m+"; "+p+"++) { var "+a+" = "+l+"["+p+"]; "+a+"._index = "+p+"; %}"};var s=n;i.indexOf("'")!==-1&&i.replace(/'/g,"\\'"),i=i.replace(/{{/g,"{%=").replace(/}}/g,"%}"),i=i.replace(/{%\s?if\s?\s?not\s?([^\(][^%{]+)\s?%}/g,"{% if (! $1) { %}"),i=i.replace(/{%\s?if\s?([^\(][^%{]+)\s?%}/g,"{% if ($1) { %}"),i=i.replace(/{%\s?for\s([a-z._]+)\sin\s([a-z._]+)\s?%}/g,n),i=i.replace(/{%\s?endif\s?%}/g,"{% }; %}"),i=i.replace(/{%\s?else\s?%}/g,"{% } else { %}"),i=i.replace(/{%\s?endfor\s?%}/g,"{% }; %}");var r=`var _p=[],print=function(){_p.push.apply(_p,arguments)};with(obj){
_p.push('`+i.replace(/[\r\t\n]/g," ").split("{%").join("	").replace(/((^|%})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%}/g,"',$1,'").split("	").join(`');
`).split("%}").join(`
_p.push('`).split("\r").join("\\'")+"');}return _p.join('');";frappe.template.debug[e]=r;try{frappe.template.compiled[t]=new Function("obj",r)}catch(o){console.log("Error in Template:"),console.log(r),o.lineNumber&&(console.log("Error in Line "+o.lineNumber+", Col "+o.columnNumber+":"),console.log(r.split(`
`)[o.lineNumber-1]))}}return frappe.template.compiled[t]};frappe.render=function(i,e,t){return frappe.template.compile(i,t)(e)};frappe.render_template=function(i,e){let t;return i.indexOf(" ")!==-1?t=i:t=frappe.templates[i],e===void 0&&(e={}),t||frappe.throw(`Template <b>${i}</b> not found.`),frappe.render(t,e,i)};frappe.render_grid=function(i){i.grid&&(i.columns=i.grid.getColumns(),i.data=i.grid.getData().getItems()),i.print_settings&&i.print_settings.orientation&&i.print_settings.orientation.toLowerCase()==="landscape"&&(i.landscape=!0),i.landscape==null&&(i.columns&&i.columns.length>10?i.landscape=!0:i.landscape=!1),i.content||(i.content=frappe.render_template(i.template||"print_grid",i)),i.base_url=frappe.urllib.get_base_url(),i.print_css=frappe.boot.print_css,i.lang=i.lang||frappe.boot.lang,i.layout_direction=i.layout_direction||frappe.utils.is_rtl()?"rtl":"ltr";var e=frappe.render_template("print_template",i),t=window.open();t||frappe.msgprint(__("Please enable pop-ups in your browser")),t.document.write(e),t.document.close()},frappe.render_tree=function(i){i.base_url=frappe.urllib.get_base_url(),i.landscape=!1,i.print_css=frappe.boot.print_css,i.print_format_css_path=frappe.assets.bundled_asset("print_format.bundle.css");var e=frappe.render_template("print_tree",i),t=window.open();t||frappe.msgprint(__("Please enable pop-ups in your browser")),t.document.write(e),t.document.close()};frappe.render_pdf=function(i,e={}){var t=new FormData;t.append("html",i),e.orientation&&t.append("orientation",e.orientation);var r=new Blob([],{type:"text/xml"});t.append("blob",r);var s=new XMLHttpRequest;s.open("POST","/api/method/frappe.utils.print_format.report_to_pdf"),s.setRequestHeader("X-Frappe-CSRF-Token",frappe.csrf_token),s.responseType="arraybuffer",s.onload=function(n){if(this.status===200){var o=new Blob([n.currentTarget.response],{type:"application/pdf"}),a=URL.createObjectURL(o);let l=document.createElement("a");document.body.appendChild(l),l.style="display: none",l.href=a,l.download=e.report_name||"report.pdf",l.click(),window.URL.revokeObjectURL(a)}},s.send(t)};frappe.templates.page=`<div class="page-head flex">
	<div class="container">
		<div class="row flex-nowrap align-center page-head-content justify-between">
			<div class="col-md-4 col-sm-6 col-xs-7 page-title">
				<!-- <div class="title-image hide hidden-md hidden-lg"></div> -->
				<!-- title -->
				<button class="btn-reset sidebar-toggle-btn">
					<svg class="es-icon icon-md sidebar-toggle-placeholder">
						<use href="#es-line-align-justify"></use>
					</svg>
					<span class="sidebar-toggle-icon">
						<svg class="es-icon icon-md">
							<use href="#es-line-sidebar-collapse">
							</use>
						</svg>
					</span>
				</button>
				<div class="flex fill-width title-area">
					<div>
						<div class="flex">
							<h3 class="ellipsis title-text"></h3>
							<span class="indicator-pill whitespace-nowrap"></span>
						</div>
						<div class="ellipsis sub-heading hide text-muted"></div>
					</div>
					<button class="btn btn-default more-button hide">
						<svg class="icon icon-sm">
							<use href="#icon-dot-horizontal">
							</use>
						</svg>
					</button>
				</div>
			</div>
			<div class="flex col page-actions justify-content-end">
				<!-- buttons -->
				<div class="filters flex"></div>
				<div class="custom-actions hide hidden-xs hidden-md"></div>
				<div class="standard-actions flex">
					<span class="page-icon-group hide hidden-xs hidden-sm"></span>
					<div class="menu-btn-group hide">
						<button type="button" class="btn btn-default icon-btn" data-toggle="dropdown" aria-expanded="false" aria-label="{{ __("Menu") }}">
							<span>
								<span class="menu-btn-group-label">
									<svg class="icon icon-sm">
										<use href="#icon-dot-horizontal">
										</use>
									</svg>
								</span>
							</span>
						</button>
						<ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
					</div>
					<button class="btn btn-secondary btn-default btn-sm hide"></button>
					<div class="actions-btn-group hide">
						<button type="button" class="btn btn-primary btn-sm" data-toggle="dropdown" aria-expanded="false">
							<span>
								<span class="hidden-xs actions-btn-group-label">{%= __("Actions") %}</span>
								<svg class="icon icon-xs">
									<use href="#icon-select">
									</use>
								</svg>
							</span>
						</button>
						<ul class="dropdown-menu dropdown-menu-right" role="menu">
						</ul>
					</div>
					<button class="btn btn-primary btn-sm hide primary-action"></button>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="container page-body">
	<div class="page-toolbar hide">
		<div class="container">
		</div>
	</div>
	<div class="page-wrapper">
		<div class="page-content">
			<div class="workflow-button-area btn-group pull-right hide"></div>
			<div class="clearfix"></div>
		</div>
	</div>
</div>
`;frappe.ui.make_app_page=function(i){return i.parent.page=new frappe.ui.Page(i),i.parent.page};frappe.ui.pages={};frappe.ui.Page=class{constructor(e){$.extend(this,e),this.set_document_title=!0,this.buttons={},this.fields_dict={},this.views={},this.make(),frappe.ui.pages[frappe.get_route_str()]=this}make(){this.wrapper=$(this.parent),this.add_main_section(),this.setup_scroll_handler(),this.setup_sidebar_toggle()}setup_scroll_handler(){let e=0;$(".main-section").scroll(frappe.utils.throttle(()=>{$(".page-head").toggleClass("drop-shadow",!!document.documentElement.scrollTop);let t=document.documentElement.scrollTop;t>0&&e<=t?$(".page-head").css("top","-15px"):$(".page-head").css("top","var(--navbar-height)"),e=t},500))}get_empty_state(e,t,r){return $(`<div class="page-card-container">
  			<div class="page-card">
  				<div class="page-card-head">
  					<span class="indicator blue">
  						${e}</span>
  				</div>
  				<p>${t}</p>
  				<div>
  					<button class="btn btn-primary btn-sm">${r}</button>
  				</div>
  			</div>
  		</div>`)}load_lib(e){frappe.require(this.required_libs,e)}add_main_section(){$(frappe.render_template("page",{})).appendTo(this.wrapper),this.single_column?this.add_view("main",'<div class="layout-main">					<div class="layout-main-section-wrapper">						<div class="layout-main-section"></div>						<div class="layout-footer hide"></div>					</div>				</div>'):(this.add_view("main",`
				<div class="layout-main layout-two-column">
					<div class="layout-side-section"></div>
					<div class="layout-main-section-wrapper">
						<div class="layout-main-section"></div>
						<div class="layout-footer hide"></div>
					</div>
				</div>
			`),this.sidebar_position==="Right"&&(this.wrapper.find(".layout-main-section-wrapper").insertBefore(this.wrapper.find(".layout-side-section")),this.wrapper.find(".layout-side-section").addClass("right"))),this.setup_page()}setup_page(){this.$title_area=this.wrapper.find(".title-area"),this.$sub_title_area=this.wrapper.find("h6"),this.title&&this.set_title(this.title),this.icon&&this.get_main_icon(this.icon),this.body=this.main=this.wrapper.find(".layout-main-section"),this.container=this.wrapper.find(".page-body"),this.sidebar=this.wrapper.find(".layout-side-section"),this.footer=this.wrapper.find(".layout-footer"),this.indicator=this.wrapper.find(".indicator-pill"),this.page_actions=this.wrapper.find(".page-actions"),this.filters=this.wrapper.find(".filters"),this.btn_primary=this.page_actions.find(".primary-action"),this.btn_secondary=this.page_actions.find(".btn-secondary"),this.menu=this.page_actions.find(".menu-btn-group .dropdown-menu"),this.menu_btn_group=this.page_actions.find(".menu-btn-group"),this.actions=this.page_actions.find(".actions-btn-group .dropdown-menu"),this.actions_btn_group=this.page_actions.find(".actions-btn-group"),this.standard_actions=this.page_actions.find(".standard-actions"),this.custom_actions=this.page_actions.find(".custom-actions"),this.page_form=$('<div class="page-form row hide"></div>').prependTo(this.main),this.inner_toolbar=this.custom_actions,this.icon_group=this.page_actions.find(".page-icon-group"),this.make_page&&this.make_page();let e=this.menu_btn_group.find("button");e.attr("title",__("Menu")).tooltip({delay:{show:600,hide:100}}),frappe.ui.keys.get_shortcut_group(this.page_actions[0]).add(e,e.find(".menu-btn-group-label"));let t=this.actions_btn_group.find("button");frappe.ui.keys.get_shortcut_group(this.page_actions[0]).add(t,t.find(".actions-btn-group-label")),this.skip_link_to_main=$("<button>").addClass("sr-only sr-only-focusable btn btn-primary-light my-2").text(__("Navigate to main content")).attr({tabindex:0,role:"link"}).on("click",r=>{r.preventDefault();let s=this.main.get(0);s.setAttribute("tabindex",-1),s.focus(),s.addEventListener("blur",()=>{s.removeAttribute("tabindex")},{once:!0})}).appendTo(this.sidebar)}setup_sidebar_toggle(){let e=$(".page-head").find(".sidebar-toggle-btn"),t=this.wrapper.find(".layout-side-section");this.disable_sidebar_toggle||!t.length?(e.last().remove(),this.wrapper.addClass("no-list-sidebar")):(frappe.is_mobile()||e.attr("title",__("Toggle Sidebar")),e.attr("aria-label",__("Toggle Sidebar")),e.tooltip({delay:{show:600,hide:100},trigger:"hover"}),e.click(()=>{frappe.utils.is_xs()||frappe.utils.is_sm()?this.setup_overlay_sidebar():t.toggle(),$(document.body).trigger("toggleSidebar"),this.update_sidebar_icon()}))}setup_overlay_sidebar(){this.sidebar.find(".close-sidebar").remove();let e=this.sidebar.find(".overlay-sidebar").addClass("opened");$('<div class="close-sidebar">').hide().appendTo(this.sidebar).fadeIn();let t=$("html").css("overflow-y","hidden");this.sidebar.find(".close-sidebar").on("click",r=>this.close_sidebar(r)),this.sidebar.on("click","button:not(.dropdown-toggle)",r=>this.close_sidebar(r)),this.close_sidebar=()=>{t.css("overflow-y",""),this.sidebar.find("div.close-sidebar").fadeOut(()=>{e.removeClass("opened").find(".dropdown-toggle").removeClass("text-muted")})}}update_sidebar_icon(){let t=$(".page-head").find(".sidebar-toggle-btn").find(".sidebar-toggle-icon"),r=this.wrapper.find(".layout-side-section"),s=$(r).is(":visible");t.html(frappe.utils.icon(s?"es-line-sidebar-collapse":"es-line-sidebar-expand","md"))}set_indicator(e,t){this.clear_indicator().removeClass("hide").html(`<span>${e}</span>`).addClass(t)}add_action_icon(e,t,r="",s){let n=$(`
			<button class="text-muted btn btn-default ${r} icon-btn">
				${frappe.utils.icon(e)}
			</button>
		`);return s||(e.startsWith("es-")&&(e=e.replace("es-line-",""),e=e.replace("es-solid-",""),e=e.replace("es-small-","")),s=frappe.unscrub(e)),n.appendTo(this.icon_group.removeClass("hide")),n.click(t),n.attr("title",__(s)).tooltip({delay:{show:600,hide:100},trigger:"hover"}),n}clear_indicator(){return this.indicator.removeClass().addClass("indicator-pill no-indicator-dot whitespace-nowrap hide")}get_icon_label(e,t){let r=e,s="xs";return typeof e=="object"&&(r=e.icon,s=e.size||"xs"),`${e?frappe.utils.icon(r,s):""} <span class="hidden-xs"> ${__(t)} </span>`}set_action(e,t){let r=this;t.icon&&(t.iconHTML=this.get_icon_label(t.icon,t.label)),this.clear_action_of(e),e.removeClass("hide").prop("disabled",!1).html(t.iconHTML||t.label).attr("data-label",t.label).on("click",function(){let n=t.click.apply(this,[e]);r.btn_disable_enable(e,n)}),t.working_label&&e.attr("data-working-label",t.working_label);let s=e.find("span");frappe.ui.keys.get_shortcut_group(this).add(e,s.length?s:e)}set_primary_action(e,t,r,s){return this.set_action(this.btn_primary,{label:e,click:t,icon:r,working_label:s}),this.btn_primary}set_secondary_action(e,t,r,s){return this.set_action(this.btn_secondary,{label:e,click:t,icon:r,working_label:s}),this.btn_secondary}clear_action_of(e){e.addClass("hide").unbind("click").removeAttr("data-working-label")}clear_primary_action(){this.clear_action_of(this.btn_primary)}clear_secondary_action(){this.clear_action_of(this.btn_secondary)}clear_actions(){this.clear_primary_action(),this.clear_secondary_action()}clear_custom_actions(){this.custom_actions.addClass("hide").empty()}clear_icons(){this.icon_group.addClass("hide").empty()}add_menu_item(e,t,r,s,n){return this.add_dropdown_item({label:e,click:t,standard:r,parent:this.menu,shortcut:s,show_parent:n})}add_custom_menu_item(e,t,r,s,n,o=null){return this.add_dropdown_item({label:t,click:r,standard:s,parent:e,shortcut:n,icon:o})}clear_menu(){this.clear_btn_group(this.menu)}show_menu(){this.menu_btn_group.removeClass("hide")}hide_menu(){this.menu_btn_group.addClass("hide")}show_icon_group(){this.icon_group.removeClass("hide")}hide_icon_group(){this.icon_group.addClass("hide")}show_actions_menu(){this.actions_btn_group.removeClass("hide")}hide_actions_menu(){this.actions_btn_group.addClass("hide")}add_action_item(e,t,r){return this.add_dropdown_item({label:e,click:t,standard:r,parent:this.actions})}add_actions_menu_item(e,t,r,s){return this.add_dropdown_item({label:e,click:t,standard:r,shortcut:s,parent:this.actions,show_parent:!1})}clear_actions_menu(){this.clear_btn_group(this.actions)}add_dropdown_item({label:e,click:t,standard:r,parent:s,shortcut:n,show_parent:o=!0,icon:a=null}){o&&s.parent().removeClass("hide hidden-xl");let l=this.is_in_group_button_dropdown(s,"li > a.grey-link > span",e);if(l)return l;let c,u="";if(a&&(u=`<span class="menu-item-icon">${frappe.utils.icon(a)}</span>`),n){let p=this.prepare_shortcut_obj(n,t,e);c=$(`
				<li>
					<a class="grey-link dropdown-item" href="#" onClick="return false;">
						${u}
						<span class="menu-item-label">${e}</span>
						<kbd class="pull-right">
							<span>${p.shortcut_label}</span>
						</kbd>
					</a>
				</li>
			`),frappe.ui.keys.add_shortcut(p)}else c=$(`
				<li>
					<a class="grey-link dropdown-item" href="#" onClick="return false;">
						${u}
						<span class="menu-item-label">${e}</span>
					</a>
				</li>
			`);return l=c.find("a").on("click",p=>((p.ctrlKey||p.metaKey)&&(frappe.open_in_new_tab=!0),t())),r?c.appendTo(s):(this.divider=s.find(".dropdown-divider.user-action"),this.divider.length||(this.divider=$('<li class="dropdown-divider user-action visible-xs"></li>').prependTo(s)),c.addClass("user-action").insertBefore(this.divider)),frappe.ui.keys.get_shortcut_group(s.get(0)).add(l,l.find(".menu-item-label")),l}prepare_shortcut_obj(e,t,r){let s;return typeof e=="string"?s={shortcut:e}:s=e,frappe.utils.is_mac()?s.shortcut_label=s.shortcut.replace("Ctrl","\u2318").replace("Alt","\u2325"):s.shortcut_label=s.shortcut,s.shortcut_label=s.shortcut_label.replace("Shift","\u21E7"),s.shortcut=s.shortcut.toLowerCase(),s.action||(s.action=t),s.description||(s.description=r),s.page=this,s}is_in_group_button_dropdown(e,t,r){if(t||(t="li"),!r||!e)return!1;let s=`${t}[data-label="${encodeURIComponent(r)}"]`,n=$(e).find(s);return(n==null?void 0:n.length)>0&&n}clear_btn_group(e){e.empty(),e.parent().addClass("hide")}add_divider(){return $('<li class="dropdown-divider"></li>').appendTo(this.menu)}get_or_add_inner_group_button(e,t){var r=this.inner_toolbar.find(`.inner-group-button[data-label="${encodeURIComponent(e)}"]`);return r.length||(r=$(`<div class="inner-group-button" data-label="${encodeURIComponent(e)}">
					<button type="button" class="btn btn-default ellipsis" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						${e}
						${frappe.utils.icon("select","xs")}
					</button>
					<div role="menu" class="dropdown-menu ${t?"dropdown-menu-right":""}"></div>
				</div>`).appendTo(this.inner_toolbar)),r}get_inner_group_button(e){return this.inner_toolbar.find(`.inner-group-button[data-label="${encodeURIComponent(e)}"]`)}set_inner_btn_group_as_primary(e){this.get_or_add_inner_group_button(e).find("button").removeClass("btn-default").addClass("btn-primary")}btn_disable_enable(e,t){t&&t.then?(e.prop("disabled",!0),t.then(()=>{e.prop("disabled",!1)})):t&&t.always&&(e.prop("disabled",!0),t.always(()=>{e.prop("disabled",!1)}))}add_divider_to_button_group(e){var t=this.get_or_add_inner_group_button(e);$('<li class="dropdown-divider"></li>').appendTo(t.find(".dropdown-menu"))}add_inner_button(e,t,r,s="default",n=!1){var o=this;let a=function(){let p=$(this),m=t();o.btn_disable_enable(p,m)},l=r?`${r} > ${e}`:e;if(this.add_menu_item(l,a,!1,!1,!1).parent().addClass("hidden-xl"),this.menu_btn_group.hasClass("hide")&&this.menu_btn_group.removeClass("hide").addClass("hidden-xl"),r){var u=this.get_or_add_inner_group_button(r,n);if($(this.inner_toolbar).removeClass("hide"),!this.is_in_group_button_dropdown(u.find(".dropdown-menu"),"a",e))return $(`<a class="dropdown-item" href="#" onclick="return false;" data-label="${encodeURIComponent(e)}">${e}</a>`).on("click",a).appendTo(u.find(".dropdown-menu"))}else{let p=this.inner_toolbar.find(`button[data-label="${encodeURIComponent(e)}"]`);return p.length==0&&(p=$(`<button data-label="${encodeURIComponent(e)}" class="btn btn-${s} ellipsis">
					${__(e)}
				</button>`),p.on("click",a),p.appendTo(this.inner_toolbar.removeClass("hide"))),p}}remove_inner_button(e,t){if(typeof e=="string"&&(e=[e]),e=e.map(s=>__(s)),t){var r=this.get_inner_group_button(__(t));r.length&&r.find(`.dropdown-item[data-label="${encodeURIComponent(e)}"]`).remove(),r.find(".dropdown-item").length===0&&r.remove()}else this.inner_toolbar.find(`button[data-label="${encodeURIComponent(e)}"]`).remove()}change_inner_button_type(e,t,r){let s;if(t){var n=this.get_inner_group_button(__(t));n.length&&(s=n.find(`.dropdown-item[data-label="${encodeURIComponent(e)}"]`))}else s=this.inner_toolbar.find(`button[data-label="${encodeURIComponent(e)}"]`);s&&s.removeClass().addClass(`btn btn-${r} ellipsis`)}add_inner_message(e){let t=$(`<span class='inner-page-message text-muted small'>${e}</div>`);return this.inner_toolbar.find(".inner-page-message").remove(),this.inner_toolbar.removeClass("hide").prepend(t),t}clear_inner_toolbar(){this.inner_toolbar.empty().addClass("hide")}clear_user_actions(){this.menu.find(".user-action").remove()}get_title_area(){return this.$title_area}set_title(e,t=null,r=!0,s="",n=""){e||(e=""),r&&(e=strip_html(e)),this.title=e,frappe.utils.set_title(s||e),t&&(e=`${frappe.utils.icon(t)} ${e}`);let o=this.$title_area.find(".title-text");o.html(e),o.attr("title",__(n)||this.title),n&&o.tooltip({delay:{show:600,hide:100},trigger:"hover"})}set_title_sub(e){this.$sub_title_area.html(e).toggleClass("hide",!e)}get_main_icon(e){return this.$title_area.find(".title-icon").html('<i class="'+e+' fa-fw"></i> ').toggle(!0)}add_help_button(e){}add_button(e,t,r){r||(r={});let s=$(`<button
			class="btn ${r.btn_class||"btn-default"} ${r.btn_size||"btn-sm"} ellipsis">
				${r.icon?frappe.utils.icon(r.icon):""}
				${e}
		</button>`);return this.add_menu_item(e,t,!1).parent().addClass("hidden-xl"),s.appendTo(this.custom_actions),s.on("click",t),this.custom_actions.removeClass("hide"),s}add_custom_button_group(e,t,r){let s=`<span class="hidden-xs">
			<span class="custom-btn-group-label">${__(e)}</span>
			${frappe.utils.icon("select","xs")}
		</span>`;t&&(s=`<span class="hidden-xs">
				${frappe.utils.icon(t)}
				<span class="custom-btn-group-label">${__(e)}</span>
				${frappe.utils.icon("select","xs")}
			</span>
			<span class="visible-xs">
				${frappe.utils.icon(t)}
			</span>`);let n=$(`
			<div class="custom-btn-group">
				<button type="button" class="btn btn-default btn-sm ellipsis" data-toggle="dropdown" aria-expanded="false">
					${s}
				</button>
				<ul class="dropdown-menu" role="menu"></ul>
			</div>
		`);return r||(r=this.custom_actions),r.removeClass("hide").append(n),n.find(".dropdown-menu")}add_dropdown_button(e,t,r,s){frappe.ui.toolbar.add_dropdown_button(e,t,r,s)}add_label(e){return this.show_form(),$("<label class='col-md-1 page-only-label'>"+e+" </label>").appendTo(this.page_form)}add_select(e,t){var r=this.add_field({label:e,fieldtype:"Select"});return r.$wrapper.find("select").empty().add_options(t)}add_data(e){var t=this.add_field({label:e,fieldtype:"Data"});return t.$wrapper.find("input").attr("placeholder",e)}add_date(e,t){var r=this.add_field({label:e,fieldtype:"Date",default:t});return r.$wrapper.find("input").attr("placeholder",e)}add_check(e){return $("<div class='checkbox'><label><input type='checkbox'>"+e+"</label></div>").appendTo(this.page_form).find("input")}add_break(){this.page_form.append('<div class="clearfix invisible-xs"></div>')}add_field(e,t){this.show_form(),e.placeholder||(e.placeholder=e.label),e.input_class="input-xs";var r=frappe.ui.form.make_control({df:e,parent:t||this.page_form,only_input:e.fieldtype!="Check"});if(r.refresh(),$(r.wrapper).addClass("col-md-2").attr("title",__(e.label,null,e.parent)).tooltip({delay:{show:600,hide:100},trigger:"hover"}),t==this.filters&&this.restyle_field(r),e.fieldtype!="HTML")return r.$input||r.make_input(),r.$input.attr("placeholder",__(e.label,null,e.parent)),e.fieldtype==="Check"&&$(r.wrapper).find(":first-child").removeClass("col-md-offset-4 col-md-8"),e.fieldtype=="Button"&&($(r.wrapper).find(".page-control-label").html("&nbsp;"),r.$input.addClass("btn-xs").css({width:"100%","margin-top":"-1px"})),e.default&&r.set_input(e.default),this.fields_dict[e.fieldname||e.label]=r,r}restyle_field(e){$(e.wrapper).removeClass("col-md-2").css("margin","0px"),$(e.wrapper).find("select").css("width","140px"),$(e.wrapper).find(".select-icon").css("top","2px")}clear_fields(){this.page_form.empty()}show_form(){this.page_form.removeClass("hide")}hide_form(){this.page_form.addClass("hide")}get_form_values(){var e={};for(let t in this.fields_dict){let r=this.fields_dict[t];e[t]=r.get_value()}return e}add_view(e,t){let r=t;return typeof t=="string"&&(r=$(t)),this.views[e]=r.appendTo($(this.wrapper).find(".page-content")),this.current_view?this.views[e].toggle(!1):this.current_view=this.views[e],this.views[e]}set_view(e){this.current_view_name!==e&&(this.current_view&&this.current_view.toggle(!1),this.current_view=this.views[e],this.previous_view_name=this.current_view_name,this.current_view_name=e,this.views[e].toggle(!0),this.wrapper.trigger("view-change"))}};frappe.provide("frappe.ui");frappe.ui.Slide=class{constructor(e=null){$.extend(this,e),this.setup()}setup(){this.$wrapper=$('<div class="slide-wrapper hidden"></div>').attr({"data-slide-id":this.id,"data-slide-name":this.name}).appendTo(this.parent)}make(){this.before_load&&this.before_load(this),this.$body=$(`<div class="slide-body">
			<div class="content text-center">
				<h1 class="title slide-title">${__(this.title)}</h1>
			</div>
			<div class="form-wrapper">
				<div class="form"></div>
				<div class="add-more text-center" style="margin-top: 5px;">
					<button class="form-more-btn hide btn btn-default btn-xs">
						<span>Add More</span>
					</button>
				</div>
			</div>
		</div>`).appendTo(this.$wrapper),this.$content=this.$body.find(".content"),this.$form=this.$body.find(".form"),this.$primary_btn=this.slides_footer.find(".primary"),this.$form_wrapper=this.$body.find(".form-wrapper"),this.image_src&&this.$content.append($(`<img src="${this.image_src}" style="margin: 20px;">`)),this.help&&this.$content.append($(`<p class="slide-help">${__(this.help)}</p>`)),this.reqd_fields=[],this.refresh(),this.made=!0}refresh(){this.render_parent_dots(),this.done?this.setup_done_state():this.setup_form()}setup_form(){this.form=new frappe.ui.FieldGroup({fields:this.get_atomic_fields(),body:this.$form[0],no_submit_on_enter:!0}),this.form.make(),this.add_more&&this.bind_more_button(),this.set_reqd_fields(),this.onload&&this.onload(this),this.set_reqd_fields()}setup_done_state(){}get_atomic_fields(){var e=JSON.parse(JSON.stringify(this.fields));return this.add_more&&(this.count=1,e=e.map((t,r)=>(t.fieldname&&(t.fieldname+="_1"),r===1&&this.mandatory_entry&&(t.reqd=1),t.static||t.label&&t.label,t))),e}set_reqd_fields(){var e=this.form.fields_dict;this.reqd_fields=[],Object.keys(e).map(t=>{e[t].df.reqd&&this.reqd_fields.push(e[t])})}set_values(e){return this.values=this.form.get_values(e,!0),!(this.values===null||this.validate&&!this.validate())}bind_more_button(){this.$more=this.$body.find(".form-more-btn"),this.$more.removeClass("hide").on("click",()=>{this.count++;var e=JSON.parse(JSON.stringify(this.fields));this.form.add_fields(e.map(t=>(t.fieldname&&(t.fieldname+="_"+this.count),t.static||t.label&&t.label,t.reqd=0,t))),this.count===this.max_count&&this.$more.addClass("hide")})}resetup_primary_button(){this.unbind_primary_action(),this.bind_fields_to_action_btn(),this.reset_action_button_state(),this.bind_primary_action()}bind_fields_to_action_btn(){var e=this;this.reqd_fields.map(t=>{t.$wrapper.on("change input click",()=>{e.reset_action_button_state()}),t.$wrapper.on("keydown","input",r=>{r.key=="Enter"&&e.reset_action_button_state()})})}reset_action_button_state(){var e=this.reqd_fields.filter(t=>!t.get_value());e.length?this.slides_footer.find(".action").addClass("disabled"):this.slides_footer.find(".action").removeClass("disabled")}unbind_primary_action(){this.slides_footer.find(".primary").off()}bind_primary_action(){this.slides_footer.find(".primary").on("click.primary_action",()=>{this.primary_action()})}is_last_slide(){return this.id===this.parent[0].children.length-1}before_show(){}show_slide(){this.$wrapper.removeClass("hidden"),this.before_show(),this.resetup_primary_button(),this.done?this.$primary_btn.hide():(this.$body.find(".form-control").first().focus(),this.$primary_btn.show())}hide_slide(){this.$wrapper.addClass("hidden")}get_input(e){return this.form.get_input(e)}get_field(e){return this.form.get_field(e)}get_value(e){return this.form.get_value(e)}destroy(){this.$body.remove()}primary_action(){}};frappe.ui.Slides=class{constructor({parent:e=null,slides:t=[],slide_class:r=null,unidirectional:s=0,done_state:n=0,before_load:o=null,on_update:a=null}){this.parent=e,this.slides=t,this.slide_class=r,this.unidirectional=s,this.done_state=n,this.before_load=o,this.on_update=a,this.page_name="setup-wizard",this.slide_dict={},this.made_slide_ids=[],this.values={},this.make()}make(){this.$slide_progress=$("<div>").addClass("slides-progress text-center text-extra-muted").appendTo(this.parent),this.container=$("<div>").addClass("slides-wrapper").attr({tabindex:-1}).appendTo(this.parent),this.$body=$("<div>").addClass("slide-container").appendTo(this.container),this.$footer=$("<div>").addClass("slide-footer").appendTo(this.container),this.render_progress_dots(),this.make_prev_next_complete_buttons(),this.before_load&&this.before_load(this.$footer),this.setup(),this.show_slide(0)}setup(){this.slides.map((e,t)=>{this.slide_dict[t]?this.made_slide_ids.includes(t+"")&&(this.slide_dict[t].done=!1,this.slide_dict[t].destroy(),this.slide_dict[t].make()):(this.slide_dict[t]=new this.slide_class($.extend(this.slides[t],{parent:this.$body,slides_footer:this.$footer,render_parent_dots:this.render_progress_dots.bind(this),id:t})),this.unidirectional||this.slide_dict[t].make())})}refresh(e){this.render_progress_dots(),this.make_prev_next_complete_buttons(),this.show_hide_prev_next(e),this.$body.find(".form-control").first().focus()}render_progress_dots(){this.$slide_progress.empty(),!(this.slides.length<=1)&&(this.slides.map((e,t)=>{let r=$(`<div class="slide-step">
				<div class="slide-step-indicator"></div>
				<div class="slide-step-complete">${frappe.utils.icon("tick","xs")}</div>
			</div>`).attr({"data-step-id":t});this.done_state&&(this.slide_dict[t]&&this.slide_dict[t].done||e.done)&&r.addClass("step-success"),this.unidirectional&&t===this.current_id&&r.addClass("active"),this.$slide_progress.append(r)}),this.completed=0,this.slides.map((e,t)=>{this.slide_dict[t]?this.slide_dict[t].done&&this.completed++:e.done&&this.completed++}),this.on_update&&this.on_update(this.completed,this.slides.length),this.unidirectional||this.bind_progress_dots())}make_prev_next_complete_buttons(){this.$footer.empty(),$(`<div class="row">
			<div class="col-sm-4 text-left prev-div">
				<button class="prev-btn btn btn-secondary btn-sm" tabindex="0">${__("Previous",null,"Go to previous slide")}</button>
			</div>
			<div class="col-sm-8 text-right next-div">
				<button class="complete-btn btn btn-sm primary">${__("Complete Setup",null,"Finish the setup wizard")}</button>
				<button class="next-btn btn btn-default btn-sm" tabindex="0">${__("Next",null,"Go to next slide")}</button>
			</div>
		</div>`).appendTo(this.$footer),this.$prev_btn=this.$footer.find(".prev-btn").attr("tabIndex",0).on("click",()=>this.show_slide(this.current_id-1)),this.$next_btn=this.$footer.find(".next-btn").attr("tabIndex",0).on("click",()=>{this.done_state&&(this.slide&&(this.slide.done=!0),this.current_slide&&(this.current_slide.done=!0)),(!this.unidirectional||this.unidirectional&&this.current_slide.set_values())&&this.show_slide(this.current_id+1)}),this.$complete_btn=this.$footer.find(".complete-btn").attr("tabIndex",0)}bind_progress_dots(){var e=this;this.$slide_progress.find(".fa-circle").addClass("link").on("click",function(){let t=$(this).attr("data-step-id");e.show_slide(t)})}before_show_slide(){return!0}show_slide(e){e=cint(e),!(!this.before_show_slide()||this.current_slide&&this.current_id===e)&&(this.update_values(),this.current_slide&&this.current_slide.hide_slide(),this.unidirectional&&!this.slide_dict[e].made&&this.slide_dict[e].make(),this.current_id=e,this.current_slide=this.slide_dict[e],this.current_slide.show_slide(),this.refresh(e))}destroy_slide(e){this.slide_dict[e]&&this.slide_dict[e].destroy(),this.slide_dict[e]=null}on_update(e,t){}show_hide_prev_next(e){e===0?this.$prev_btn.hide():this.$prev_btn.show(),e+1===this.slides.length?this.$next_btn.hide():this.$next_btn.show()}get_values(){var e={};return $.each(this.slide_dict,function(t,r){r.values&&$.extend(e,r.values)}),e}update_values(){this.values=$.extend(this.values,this.get_values())}};frappe.find={page_primary_action:()=>$(".page-actions:visible .btn-primary"),field:(i,e)=>new Promise(t=>{let r=$(`[data-fieldname="${i}"] :input`);e?(r.val(e).trigger("change"),frappe.after_ajax(()=>{t(r)})):t(r)})};frappe.ui.IconBar=class{constructor(e,t){this.parent=e,this.buttons={},this.make(t)}make(e){this.$wrapper=$('<div class="iconbar-wrapper hide"></div>').appendTo(this.parent);for(var t=0;t<e;t++)this.get_group(t+1)}get_group(e){var t=this.$wrapper.find(".iconbar-"+e+" ul");return t.length||(t=$('<div class="iconbar iconbar-'+e+' hide"><ul></ul></div>').appendTo(this.$wrapper).find("ul")),t}add_btn(e,t,r,s){var n=this.get_group(e),o=$('<li><i class="'+t+'"></i></li>').appendTo(n).on("click",function(){return s.apply(this),!1});return o.find("i").attr("title",r).tooltip({delay:{show:600,hide:100},trigger:"hover"}),this.$wrapper.find(".iconbar-"+e).removeClass("hide"),this.show(),o}hide(e){e?(this.$wrapper.find(".iconbar-"+e).addClass("hide"),this.check_if_all_hidden()):this.$wrapper.addClass("hide").trigger("hidden")}show(e){e?(this.$wrapper.find(".iconbar-"+e).removeClass("hide"),this.show()):this.$wrapper.hasClass("hide")&&this.$wrapper.removeClass("hide").trigger("shown")}clear(e){var t=this;this.$wrapper.find(".iconbar-"+e).addClass("hide").find("ul").empty(),this.check_if_all_hidden()}check_if_all_hidden(){this.$wrapper.find(".iconbar:visible").length||this.hide()}};frappe.ui.form.LinkSelector=class{constructor(e){$.extend(this,e);var t=this;this.doctype!="[Select]"?frappe.model.with_doctype(this.doctype,function(r){t.make()}):this.make()}make(){var e=this;this.start=0,this.page_length=10,this.dialog=new frappe.ui.Dialog({title:__("Select {0}",[this.doctype=="[Select]"?__("value"):__(this.doctype)]),fields:[{fieldtype:"Data",fieldname:"txt",label:__("Beginning with"),description:__("You can use wildcard %")},{fieldtype:"HTML",fieldname:"results"},{fieldtype:"Button",fieldname:"more",label:__("More"),click:()=>{e.start+=e.page_length,e.search()}}],primary_action_label:__("Search"),primary_action:function(){e.start=0,e.search()}}),this.txt&&this.dialog.fields_dict.txt.set_input(this.txt),this.dialog.get_input("txt").on("keypress",function(t){t.which===13&&(e.start=0,e.search())}),this.dialog.show(),this.search()}search(){var e={txt:this.dialog.fields_dict.txt.get_value(),searchfield:"name",start:this.start,page_length:this.page_length},t=this;this.target.set_custom_query&&this.target.set_custom_query(e),this.target.is_grid&&this.target.fieldinfo[this.fieldname]&&this.target.fieldinfo[this.fieldname].get_query&&$.extend(e,this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc)),frappe.link_search(this.doctype,e,function(r){var s=t.dialog.fields_dict.results.$wrapper;if(e.start===0&&s.empty(),r.length)for(let a of r){var n=$(repl('<div class="row link-select-row">						<div class="col-xs-4 ellipsis">							<b><a href="#">%(name)s</a></b></div>						<div class="col-xs-8">							<span class="text-muted">%(values)s</span></div>						</div>',{name:a[0],values:a.splice(1).join(", ")})).appendTo(s);n.find("a").attr("data-value",a[0]).click(function(){var l=$(this).attr("data-value");return t.target.is_grid?t.set_in_grid(l).then(()=>t.search()):(t.target.doctype?t.target.parse_validate_and_set_in_model(l):(t.target.set_input(l),t.target.$input.trigger("change")),t.dialog.hide()),!1})}else $('<p><br><span class="text-muted">'+__("No Results")+"</span>"+(frappe.model.can_create(t.doctype)?'<br><br><a class="new-doc btn btn-default btn-sm">'+__("Create a new {0}",[__(t.doctype)])+"</a>":"")+"</p>").appendTo(s).find(".new-doc").click(function(){frappe.new_doc(t.doctype)});var o=t.dialog.fields_dict.more.$wrapper;r.length<t.page_length?o.hide():o.show()},this.dialog.get_primary_btn())}set_in_grid(e){return new Promise(t=>{if(this.qty_fieldname)frappe.prompt({fieldname:"qty",fieldtype:"Float",label:"Qty",default:1,reqd:1},r=>{if(!(this.target.frm.doc[this.target.df.fieldname]||[]).some(n=>{if(n[this.fieldname]===e)return frappe.model.set_value(n.doctype,n.name,this.qty_fieldname,r.qty).then(()=>{frappe.show_alert(__("Added {0} ({1})",[e,n[this.qty_fieldname]])),t()}),!0})){let n=null;frappe.run_serially([()=>n=this.target.add_new_row(),()=>frappe.timeout(.1),()=>{let o={};return o[this.fieldname]=e,o[this.qty_fieldname]=r.qty,frappe.model.set_value(n.doctype,n.name,o)},()=>frappe.show_alert(__("Added {0} ({1})",[e,r.qty])),()=>t()])}},__("Set Quantity"),__("Set Quantity"));else if(this.dynamic_link_field){let r=this.target.add_new_row();frappe.model.set_value(r.doctype,r.name,this.dynamic_link_field,this.dynamic_link_reference),frappe.model.set_value(r.doctype,r.name,this.fieldname,e).then(()=>{frappe.show_alert(__("{0} {1} added",[this.dynamic_link_reference,e])),t()})}else{let r=this.target.add_new_row();frappe.model.set_value(r.doctype,r.name,this.fieldname,e).then(()=>{frappe.show_alert(__("{0} added",[e])),t()})}})}};frappe.link_search=function(i,e,t,r){e||(e={txt:""}),e.doctype=i,e.searchfield||(e.searchfield="name"),frappe.call({method:"frappe.desk.search.search_widget",type:"GET",args:e,callback:function(s){t&&t(s.message)},btn:r})};frappe.ui.form.MultiSelectDialog=class{constructor(e){Object.assign(this,e),this.for_select=this.doctype=="[Select]",this.for_select?this.init():frappe.model.with_doctype(this.doctype,()=>this.init())}init(){this.page_length=20,this.child_page_length=20,this.fields=this.get_fields(),this.make(),this.selected_fields=new Set}get_fields(){let e=this.get_primary_filters(),t=this.get_result_fields(),r=this.get_data_fields(),s=this.get_child_selection_fields();return[...e,...t,...r,...s]}get_result_fields(){let e=()=>{this.page_length+=20,this.get_results()};return[{fieldtype:"HTML",fieldname:"results_area"},{fieldtype:"Button",fieldname:"more_btn",label:__("More"),click:e.bind(this)}]}get_data_fields(){return this.data_fields&&this.data_fields.length?[{fieldtype:"Section Break"},...this.data_fields]:[]}get_child_selection_fields(){let e=[];if(this.allow_child_item_selection&&this.child_fieldname){let t=()=>{this.child_page_length+=20,this.show_child_results()};e.push({fieldtype:"HTML",fieldname:"child_selection_area"}),e.push({fieldtype:"Button",fieldname:"more_child_btn",hidden:1,label:__("More"),click:t.bind(this)})}return e}make(){let e=__("Select {0}",[this.for_select?__("value"):__(this.doctype)]);this.dialog=new frappe.ui.Dialog({title:e,fields:this.fields,size:this.size,primary_action_label:this.primary_action_label||__("Get Items"),secondary_action_label:__("Make {0}",[__(this.doctype)]),primary_action:()=>{let t=this.get_custom_filters(),r=cur_dialog.get_values(),s=this.get_selected_child_names(),n=[...this.get_checked_values(),...this.get_parent_name_of_selected_children()];this.action(n,rt(Ee(Ee(Ee({},this.args),r),t),{filtered_children:s}))},secondary_action:this.make_new_document.bind(this)}),this.add_filters_group&&this.make_filter_area(),this.args={},this.setup_results(),this.bind_events(),this.get_results(),this.dialog.show()}make_new_document(e){e&&(this.set_route_options(),frappe.new_doc(this.doctype,!0))}set_route_options(){if(frappe.route_options={},Array.isArray(this.setters))for(let e of this.setters)frappe.route_options[e.fieldname]=this.dialog.fields_dict[e.fieldname].get_value()||void 0;else Object.keys(this.setters).forEach(e=>{frappe.route_options[e]=this.dialog.fields_dict[e].get_value()||void 0})}setup_results(){this.$parent=$(this.dialog.body),this.$wrapper=this.dialog.fields_dict.results_area.$wrapper.append(`<div class="results my-3"
			style="border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;"></div>`),this.$results=this.$wrapper.find(".results"),this.$results.append(this.make_list_row())}show_child_results(){this.get_child_result().then(e=>{this.child_results=e.message||[],this.render_child_datatable(),this.$wrapper.addClass("hidden"),this.$child_wrapper.removeClass("hidden"),this.dialog.fields_dict.more_btn.$wrapper.hide()})}is_child_selection_enabled(){var e;return(e=this.dialog.fields_dict.allow_child_item_selection)==null?void 0:e.get_value()}toggle_child_selection(){this.is_child_selection_enabled()?this.show_child_results():(this.child_results=[],this.get_results(),this.$wrapper.removeClass("hidden"),this.$child_wrapper.addClass("hidden"))}render_child_datatable(){this.child_datatable?setTimeout(()=>{this.child_datatable.rowmanager.checkMap=[],this.child_datatable.refresh(this.get_child_datatable_rows()),this.$child_wrapper.find(".dt-scrollable").css("height","300px"),this.$child_wrapper.find(".dt-scrollable").css("overflow-y","scroll")},500):this.setup_child_datatable()}get_child_datatable_columns(){return[this.doctype,...this.child_columns].map(t=>({name:frappe.unscrub(t),editable:!1}))}get_child_datatable_rows(){return this.child_results.length>this.child_page_length?this.dialog.fields_dict.more_child_btn.toggle(!0):this.dialog.fields_dict.more_child_btn.toggle(!1),this.child_results.slice(0,this.child_page_length).map(e=>Object.values(e).slice(1))}setup_child_datatable(){let e=this.get_child_datatable_columns(),t=this.get_child_datatable_rows();this.$child_wrapper=this.dialog.fields_dict.child_selection_area.$wrapper,this.$child_wrapper.addClass("my-3"),this.child_datatable=new frappe.DataTable(this.$child_wrapper.get(0),{columns:e,data:t,layout:"fluid",inlineFilters:!0,serialNoColumn:!1,checkboxColumn:!0,cellHeight:35,noDataMessage:__("No Data"),disableReorderColumn:!0}),this.$child_wrapper.find(".dt-scrollable").css("height","300px")}get_primary_filters(){let e=[],t=new Array(3);return t[0]=[{fieldtype:"Data",label:__("Name"),fieldname:"search_term"}],t[1]=[],t[2]=[],$.isArray(this.setters)?this.setters.forEach((r,s)=>{t[(s+1)%3].push(r)}):Object.keys(this.setters).forEach((r,s)=>{let n=frappe.meta.docfield_map[this.doctype][r];t[(s+1)%3].push({fieldtype:n.fieldtype,label:n.label,fieldname:r,options:n.options,read_only:(this==null?void 0:this.read_only_setters)&&this.read_only_setters.includes(r)||0,default:this.setters[r]})}),Object.seal&&Object.seal(t),this.allow_child_item_selection&&(this.child_doctype=frappe.meta.get_docfield(this.doctype,this.child_fieldname).options,t[0].push({fieldtype:"Check",label:__("Select {0}",[__(this.child_doctype)]),fieldname:"allow_child_item_selection",onchange:this.toggle_child_selection.bind(this)})),e=[...t[0],{fieldtype:"Column Break"},...t[1],{fieldtype:"Column Break"},...t[2],{fieldtype:"Section Break",fieldname:"primary_filters_sb"}],this.add_filters_group&&e.push({fieldtype:"HTML",fieldname:"filter_area"}),e}make_filter_area(){this.filter_group=new frappe.ui.FilterGroup({parent:this.dialog.get_field("filter_area").$wrapper,doctype:this.doctype,on_change:()=>{this.is_child_selection_enabled()?this.show_child_results():this.get_results()}}),this.filter_group.wrapper.find(".apply-filters").hide()}get_custom_filters(){return this.add_filters_group&&this.filter_group?this.filter_group.get_filters().reduce((e,t)=>Object.assign(e,{[t[1]]:[t[2],t[3]]}),{}):{}}bind_events(){let e=this;this.$results.on("click",".list-item-container",function(t){!$(t.target).is(":checkbox")&&!$(t.target).is("a")&&$(this).find(":checkbox").trigger("click");let r=$(this).attr("data-item-name").trim();$(this).find(":checkbox").is(":checked")?e.selected_fields.add(r):e.selected_fields.delete(r)}),this.$results.on("click",".list-item--head :checkbox",t=>{let r=$(t.target).is(":checked");this.$results.find(".list-item-container .list-row-check").each(function(){$(this).prop("checked",r);let s=$(this).closest(".list-item-container").attr("data-item-name").trim();r?e.selected_fields.add(s):e.selected_fields.delete(s)})}),this.$parent.find(".input-with-feedback").on("change",()=>{frappe.flags.auto_scroll=!1,this.is_child_selection_enabled()?this.show_child_results():this.get_results()}),this.$parent.find('[data-fieldtype="Data"]').on("input",()=>{var t=$(this);clearTimeout(t.data("timeout")),t.data("timeout",setTimeout(function(){frappe.flags.auto_scroll=!1,e.is_child_selection_enabled()?e.show_child_results():(e.empty_list(),e.get_results())},300))})}get_parent_name_of_selected_children(){return!this.child_datatable||!this.child_datatable.datamanager.rows.length?[]:this.child_datatable.rowmanager.checkMap.reduce((t,r,s)=>{if(r==1){let n=this.child_results[s].parent;t.includes(n)||t.push(n)}return t},[])}get_selected_child_names(){return!this.child_datatable||!this.child_datatable.datamanager.rows.length?[]:this.child_datatable.rowmanager.checkMap.reduce((t,r,s)=>{if(r==1){let n=this.child_results[s].name;t.push(n)}return t},[])}get_checked_values(){return this.$results.find(".list-item-container").map(function(){if($(this).find(".list-row-check:checkbox:checked").length>0)return $(this).attr("data-item-name")}).get()}get_checked_items(){let e=this.get_checked_values();return this.results.filter(t=>e.includes(t.name))}get_datatable_columns(){return this.get_query&&this.get_query().query&&this.columns?this.columns:Array.isArray(this.setters)?["name",...this.setters.map(e=>e.fieldname)]:["name",...Object.keys(this.setters)]}make_list_row(e={}){var t=this;let r=Object.keys(e).length===0,s="";this.get_datatable_columns().forEach(function(o){s+=`<div class="list-item__content ellipsis">
				${r?`<span class="ellipsis text-muted" title="${__(frappe.model.unscrub(o))}">${__(frappe.model.unscrub(o))}</span>`:o!=="name"?`<span class="ellipsis result-row" title="${__(e[o]||"")}">${__(e[o]||"")}</span>`:`<a href="${"/app/"+frappe.router.slug(t.doctype)+"/"+e[o]||""}" class="list-id ellipsis" title="${__(e[o]||"")}">
							${__(e[o]||"")}</a>`}
			</div>`});let n=$(`<div class="list-item">
			<div class="list-item__content" style="flex: 0 0 10px;">
				<input type="checkbox" class="list-row-check" data-item-name="${e.name}" ${e.checked?"checked":""}>
			</div>
			${s}
		</div>`);return r?n.addClass("list-item--head"):n=$(`<div class="list-item-container" data-item-name="${e.name}"></div>`).append(n),n}render_result_list(e,t=0,r=!0){var s=this,n=s.dialog.fields_dict.more_btn.$wrapper;if(!frappe.flags.auto_scroll&&r&&this.empty_list(),n.hide(),$(".modal-dialog .list-item--head").css("z-index",1),e.length===0)return;t&&n.show();let o=this.get_checked_values();e.filter(a=>!o.includes(a.name)).forEach(a=>{s.$results.append(s.make_list_row(a))}),this.$results.find(".list-item--head").css("z-index",1),frappe.flags.auto_scroll&&this.$results.animate({scrollTop:s.$results.prop("scrollHeight")},500)}empty_list(){let e=this.results.filter(t=>this.selected_fields.has(t.name)).map(t=>rt(Ee({},t),{checked:!0}));this.$results.find(".list-item-container").remove(),this.render_result_list(e,0,!1)}get_filters_from_setters(){let e=this,t=(this.get_query?this.get_query().filters:{})||{},r=[];if($.isArray(this.setters))for(let s of this.setters)t[s.fieldname]=e.dialog.fields_dict[s.fieldname].get_value()||void 0,e.args[s.fieldname]=t[s.fieldname],r.push(s.fieldname);else Object.keys(this.setters).forEach(function(s){var n=e.dialog.fields_dict[s].get_value();e.dialog.fields_dict[s].df.fieldtype=="Data"&&n?t[s]=["like","%"+n+"%"]:(t[s]=n||void 0,e.args[s]=t[s],r.push(s))});return[t,r]}get_args_for_search(){let[e,t]=this.get_filters_from_setters(),r=this.get_custom_filters();return Object.assign(e,r),{doctype:this.doctype,txt:this.dialog.fields_dict.search_term.get_value(),filters:e,filter_fields:t,page_length:this.page_length+5,query:this.get_query?this.get_query().query:"",as_dict:1}}async perform_search(e){let t=await frappe.call({type:"GET",method:"frappe.desk.search.search_widget",no_spinner:!0,args:e}),r=t.message.length&&t.message.length>this.page_length?1:0;return[t.message,r]}async get_results(){let e=this.get_args_for_search(),[t,r]=await this.perform_search(e);r&&(t=t.splice(0,this.page_length)),this.results=[],t.length&&t.forEach(s=>{s.checked=0,this.results.push(s)}),this.render_result_list(this.results,r)}async get_filtered_parents_for_child_search(){let e=this.get_args_for_search();e.filter_fields=["name"];let[t,r]=await this.perform_search(e),s=[];return t.length&&(s=t.map(n=>n.name)),s}async add_parent_filters(e){let t=await this.get_filtered_parents_for_child_search();t.length&&e.push(["parent","in",t])}add_custom_child_filters(e){this.add_filters_group&&this.filter_group&&this.filter_group.get_filters().forEach(t=>{t[0]==this.child_doctype&&e.push([t[1],t[2],t[3]])})}async get_child_result(){let e=[["parentfield","=",this.child_fieldname]];return await this.add_parent_filters(e),this.add_custom_child_filters(e),frappe.call({method:"frappe.client.get_list",args:{doctype:this.child_doctype,filters:e,fields:["name","parent",...this.child_columns],parent:this.doctype,limit_page_length:this.child_page_length+5,order_by:"parent"}})}};frappe._.get_data_uri=i=>{let e=i.videoWidth,t=i.videoHeight,r=$("<canvas/>");return r[0].width=e,r[0].height=t,r[0].getContext("2d").drawImage(i,0,0,e,t),r[0].toDataURL("image/png")};function P0(){let i=document.createElement("input");return i.setAttribute("type","file"),i.setAttribute("accept","image/*"),i.setAttribute("multiple",""),i.classList.add("visually-hidden"),document.body.appendChild(i),i}function j0(i){return new Promise((e,t)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=t,r.readAsDataURL(i)})}frappe.ui.Capture=class{constructor(i={}){this.options=frappe.ui.Capture.OPTIONS,this.set_options(i),this.facing_mode="environment",this.images=[]}set_options(i){return this.options=Ee(Ee({},frappe.ui.Capture.OPTIONS),i),this}show(){this.build_dialog(),cint(frappe.boot.sysdefaults.force_web_capture_mode_for_uploads)?this.show_for_desktop():frappe.is_mobile()?this.show_for_mobile():this.show_for_desktop()}build_dialog(){let i=this;i.dialog=new frappe.ui.Dialog({title:this.options.title,animate:this.options.animate,fields:[{fieldtype:"HTML",fieldname:"capture"},{fieldtype:"HTML",fieldname:"total_count"}],on_hide:()=>{this.stop_media_stream()}}),i.$template=$(frappe.ui.Capture.TEMPLATE);let e=i.dialog.get_field("capture");$(e.wrapper).html(i.$template),i.update_count(),i.dialog.get_close_btn().on("click",()=>{i.hide()})}show_for_mobile(){let i=this;i.input||(i.input=P0()),i.input.onchange=async()=>{for(let e of i.input.files){let t=await j0(e);i.images.push(t)}i.input.remove(),i.input=null,i.render_preview(),i.dialog.show()},i.input.click()}show_for_desktop(){let i=this;this.render_stream().then(()=>{i.dialog.show()}).catch(e=>{throw i.options.error&&frappe.show_alert(frappe.ui.Capture.ERR_MESSAGE,3),e})}render_stream(){let i=this,e={video:{facingMode:this.facing_mode}};return navigator.mediaDevices.getUserMedia(e).then(t=>{i.stream=t,i.dialog.custom_actions.empty(),i.dialog.get_primary_btn().off("click"),i.setup_take_photo_action(),i.setup_preview_action(),i.setup_toggle_camera(),i.$template.find(".fc-stream-container").show(),i.$template.find(".fc-preview-container").hide(),i.video=i.$template.find("video")[0],i.video.srcObject=i.stream,i.video.load(),i.video.play()})}render_preview(){this.stop_media_stream(),this.$template.find(".fc-stream-container").hide(),this.$template.find(".fc-preview-container").show(),this.dialog.get_primary_btn().off("click");let i="";this.images.forEach((e,t)=>{i+=`
				<div class="mt-1 p-1 rounded col-md-3 col-sm-4 col-xs-4" data-idx="${t}">
					<span class="capture-remove-btn" data-idx="${t}">
						${frappe.utils.icon("close","lg")}
					</span>
					<img class="rounded" src="${e}" data-idx="${t}">
				</div>
			`}),this.$template.find(".fc-preview-container").empty(),$(this.$template.find(".fc-preview-container")).html(`<div class="row">
				${i}
			</div>`),this.setup_capture_action(),this.setup_submit_action(),this.setup_remove_action(),this.update_count(),this.dialog.custom_actions.empty()}setup_take_photo_action(){let i=this;this.dialog.set_primary_action(__("Take Photo"),()=>{let e=frappe._.get_data_uri(i.video);i.images.push(e),i.setup_preview_action(),i.update_count()})}setup_preview_action(){let i=this;!this.images.length||(this.dialog.set_secondary_action_label(__("Preview")),this.dialog.set_secondary_action(()=>{i.dialog.get_primary_btn().off("click"),i.render_preview()}))}setup_remove_action(){let i=this;Array.from(this.$template[0].getElementsByClassName("capture-remove-btn")).forEach(t=>{t.onclick=()=>{let r=parseInt(t.getAttribute("data-idx"));i.images.splice(r,1),i.render_preview()}})}update_count(){let i=this.dialog.get_field("total_count"),e=`${__("Total Images")}: <b>${this.images.length}`;this.images.length===0&&(e=__("No Images")),$(i.wrapper).html(`
			<div class="row mt-2">
				<div class="offset-4 col-4 d-flex justify-content-center">${e}</b></div>
			</div>
		`)}setup_toggle_camera(){let i=this;this.dialog.add_custom_action(__("Switch Camera"),()=>{i.facing_mode=i.facing_mode=="environment"?"user":"environment",frappe.show_alert({message:__("Switching Camera")}),i.stop_media_stream(),i.render_stream()},"btn-switch")}setup_capture_action(){let i=this;this.dialog.set_secondary_action_label(__("Capture")),this.dialog.set_secondary_action(()=>{frappe.is_mobile()?i.show_for_mobile():i.render_stream()})}setup_submit_action(){let i=this;this.dialog.set_primary_action(__("Submit"),()=>{i.hide(),i.callback&&i.callback(i.images)})}hide(){this.dialog&&this.dialog.hide(),this.stop_media_stream()}stop_media_stream(){this.stream&&this.stream.getTracks().forEach(i=>{i.stop()})}submit(i){this.callback=i}};frappe.ui.Capture.OPTIONS={title:__("Camera"),animate:!1,error:!1};frappe.ui.Capture.ERR_MESSAGE=__("Unable to load camera.");frappe.ui.Capture.TEMPLATE=`
<div class="frappe-capture">
	<div class="embed-responsive embed-responsive-16by9 fc-stream-container">
		<video class="fc-stream embed-responsive-item">${frappe.ui.Capture.ERR_MESSAGE}</video>
	</div>
	<div class="fc-preview-container px-2" style="display: none;">

	</div>
</div>
`;frappe.provide("frappe.ui");frappe.ui.app_icon={get_html:function(i,e){var t=i.icon,r=i.color;t&&t.match(/([\uE000-\uF8FF]|\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDDFF])/g)&&(i.emoji=i.icon);var s="";return i.reverse&&(s="color: #36414C;"),r||(r="#4aa3df"),!t||i.emoji?t='<span class="inner" '+(i.reverse?'style="'+s+'"':"")+">"+(i.emoji||i._label[0].toUpperCase())+"</span>":t.split(".").slice(-1)[0]==="svg"?($.ajax({url:frappe.urllib.get_full_url(t),dataType:"text",async:!1,success:function(n){t=n}}),t='<object class="app-icon-svg">'+t+"</object>"):t='<i class="'+t+'" title="'+i._label+'" style="'+s+'"></i>','<div class="app-icon'+(e?" app-icon-small":"")+'" style="background-color: '+r+'" title="'+i._label+'">'+t+"</div>"}};frappe.provide("frappe.ui");frappe.ui.ThemeSwitcher=class{constructor(){this.setup_dialog(),this.refresh()}setup_dialog(){this.dialog=new frappe.ui.Dialog({title:__("Switch Theme")}),this.body=$('<div class="theme-grid"></div>').appendTo(this.dialog.$body),this.bind_events()}bind_events(){this.dialog.$wrapper.on("keydown",e=>{if(!this.themes)return;let t=frappe.ui.keys.get_key(e),r;if(t==="right")r=1;else if(t==="left")r=-1;else if(e.keyCode===13)this.hide();else return;let s=this.themes.findIndex(o=>o.name===this.current_theme),n=this.themes[s+r];if(!!n)return n.$html.click(),!1})}refresh(){this.current_theme=document.documentElement.getAttribute("data-theme-mode")||"light",this.fetch_themes().then(()=>{this.render()})}fetch_themes(){return new Promise(e=>{this.themes=[{name:"light",label:__("Frappe Light"),info:__("Light Theme")},{name:"dark",label:__("Timeless Night"),info:__("Dark Theme")},{name:"automatic",label:__("Automatic"),info:__("Uses system's theme to switch between light and dark mode")}],e(this.themes)})}render(){this.themes.forEach(e=>{let t=this.get_preview_html(e);t.appendTo(this.body),e.$html=t})}get_preview_html(e){let t=e.name==="automatic",r=$(`<div class="${this.current_theme==e.name?"selected":""}">
			<div data-theme=${t?"light":e.name}
				data-is-auto-theme="${t}" title="${e.info}">
				<div class="background">
					<div>
						<div class="preview-check" data-theme=${t?"dark":e.name}>
							${frappe.utils.icon("tick","xs")}
						</div>
					</div>
					<div class="navbar"></div>
					<div class="p-2">
						<div class="toolbar">
							<span class="text"></span>
							<span class="primary"></span>
						</div>
						<div class="foreground"></div>
						<div class="foreground"></div>
					</div>
				</div>
			</div>
			<div class="mt-3 text-center">
				<h5 class="theme-title">${e.label}</h5>
			</div>
		</div>`);return r.on("click",()=>{this.current_theme!==e.name&&(this.themes.forEach(s=>{s.$html.removeClass("selected")}),r.addClass("selected"),this.toggle_theme(e.name))}),r}toggle_theme(e){this.current_theme=e.toLowerCase(),document.documentElement.setAttribute("data-theme-mode",this.current_theme),frappe.show_alert(__("Theme Changed"),3),frappe.xcall("frappe.core.doctype.user.user.switch_theme",{theme:toTitle(e)})}show(){this.dialog.show()}hide(){this.dialog.hide()}};frappe.ui.add_system_theme_switch_listener=()=>{frappe.ui.dark_theme_media_query.addEventListener("change",()=>{frappe.ui.set_theme()})};frappe.ui.dark_theme_media_query=window.matchMedia("(prefers-color-scheme: dark)");frappe.ui.set_theme=i=>{let e=document.documentElement,t=e.getAttribute("data-theme-mode");i||t==="automatic"&&(i=frappe.ui.dark_theme_media_query.matches?"dark":"light"),e.setAttribute("data-theme",i||t)};frappe.provide("frappe.model");$.extend(frappe.model,{all_fieldtypes:["Autocomplete","Attach","Attach Image","Barcode","Button","Check","Code","Color","Currency","Data","Date","Datetime","Duration","Dynamic Link","Float","Geolocation","Heading","HTML","HTML Editor","Icon","Image","Int","JSON","Link","Long Text","Markdown Editor","Password","Percent","Phone","Read Only","Rating","Select","Signature","Small Text","Table","Table MultiSelect","Text","Text Editor","Time"],no_value_type:["Section Break","Column Break","Tab Break","HTML","Table","Table MultiSelect","Button","Image","Fold","Heading"],layout_fields:["Section Break","Column Break","Tab Break","Fold"],std_fields_list:["name","owner","creation","modified","modified_by","_user_tags","_comments","_assign","_liked_by","docstatus","idx"],child_table_field_list:["parent","parenttype","parentfield"],core_doctypes_list:["DocType","DocField","DocPerm","User","Role","Has Role","Page","Module Def","Print Format","Report","Customize Form","Customize Form Field","Property Setter","Custom Field","Client Script"],restricted_fields:["name","parent","creation","modified","modified_by","parentfield","parenttype","file_list","flags","docstatus"],html_fieldtypes:["Text Editor","Text","Small Text","Long Text","HTML Editor","Markdown Editor","Code"],std_fields:[{fieldname:"name",fieldtype:"Link",label:__("ID")},{fieldname:"owner",fieldtype:"Link",label:__("Created By"),options:"User"},{fieldname:"idx",fieldtype:"Int",label:__("Index")},{fieldname:"creation",fieldtype:"Datetime",label:__("Created On")},{fieldname:"modified",fieldtype:"Datetime",label:__("Last Updated On")},{fieldname:"modified_by",fieldtype:"Link",label:__("Last Updated By"),options:"User"},{fieldname:"_user_tags",fieldtype:"Data",label:__("Tags")},{fieldname:"_liked_by",fieldtype:"Data",label:__("Liked By")},{fieldname:"_comments",fieldtype:"Text",label:__("Comments")},{fieldname:"_assign",fieldtype:"Text",label:__("Assigned To")},{fieldname:"docstatus",fieldtype:"Int",label:__("Document Status")}],numeric_fieldtypes:["Int","Float","Currency","Percent","Duration"],std_fields_table:[{fieldname:"parent",fieldtype:"Data",label:__("Parent")}],table_fields:["Table","Table MultiSelect"],new_names:{},events:{},user_settings:{},init:function(){frappe.realtime.on("doc_update",function(i){var e=locals[i.doctype]&&locals[i.doctype][i.name];e&&(frappe.get_route()[0]==="Form"&&cur_frm.doc.doctype===e.doctype&&cur_frm.doc.name===e.name?i.modified!==cur_frm.doc.modified&&!frappe.ui.form.is_saving&&(cur_frm.is_dirty()?(e.__needs_refresh=!0,cur_frm.show_conflict_message()):cur_frm.debounced_reload_doc()):e.__unsaved?e.__needs_refresh=!0:frappe.model.remove_from_locals(e.doctype,e.name))})},is_value_type:function(i){return typeof i=="object"&&(i=i.fieldtype),frappe.model.no_value_type.indexOf(i)===-1},is_non_std_field:function(i){return![...frappe.model.std_fields_list,...frappe.model.child_table_field_list].includes(i)},get_std_field:function(i,e=!1){var t=$.map([].concat(frappe.model.std_fields).concat(frappe.model.std_fields_table),function(r){if(r.fieldname==i)return r});if(!t.length){if(e)return{fieldname:i};frappe.msgprint(__("Unknown Column: {0}",[i]))}return t[0]},get_from_localstorage:function(i){if(localStorage["_doctype:"+i])return JSON.parse(localStorage["_doctype:"+i])},set_in_localstorage:function(i,e){try{localStorage["_doctype:"+i]=JSON.stringify(e)}catch(t){console.warn("localStorage quota exceeded, clearing doctype cache"),frappe.model.clear_local_storage(),localStorage["_doctype:"+i]=JSON.stringify(e)}},clear_local_storage:function(){for(var i in localStorage)i.startsWith("_doctype:")&&localStorage.removeItem(i)},with_doctype:function(i,e,t){if(locals.DocType[i])return e&&e(),Promise.resolve();{let r=null,s=null,n=frappe.model.get_from_localstorage(i);return n&&(s=n.filter(o=>o.name===i)[0],s&&(r=s.modified)),frappe.call({method:"frappe.desk.form.load.getdoctype",type:"GET",args:{doctype:i,with_parent:1,cached_timestamp:r},async:t,callback:function(o){if(o.exc)throw frappe.msgprint(__("Unable to load: {0}",[__(i)])),"No doctype";o.message=="use_cache"?frappe.model.sync(s):(frappe.model.set_in_localstorage(i,o.docs),s=o.docs[0]),frappe.model.init_doctype(s),o.user_settings&&(frappe.model.user_settings[i]=JSON.parse(o.user_settings),frappe.model.user_settings[i].updated_on=moment().toString()),e&&e(o)}})}},init_doctype:function(i){i.name==="DocType"&&(frappe.meta.__doctype_meta=JSON.parse(JSON.stringify(i)));for(let e of["__list_js","__custom_list_js","__calendar_js","__map_js","__tree_js"])i[e]&&new Function(i[e])();i.__templates&&$.extend(frappe.templates,i.__templates)},with_doc:function(i,e,t){return new Promise(r=>{if(e||(e=i),locals[i]&&locals[i][e]&&frappe.model.get_docinfo(i,e))t&&t(e),r(frappe.get_doc(i,e));else return frappe.call({method:"frappe.desk.form.load.getdoc",type:"GET",args:{doctype:i,name:e},callback:function(s){t&&t(e,s),r(frappe.get_doc(i,e))}})})},get_docinfo:function(i,e){return frappe.model.docinfo[i]&&frappe.model.docinfo[i][e]||null},set_docinfo:function(i,e,t,r){frappe.model.docinfo[i]&&frappe.model.docinfo[i][e]&&(frappe.model.docinfo[i][e][t]=r)},get_shared:function(i,e){return frappe.model.get_docinfo(i,e).shared},get_server_module_name:function(i){var e=frappe.model.scrub(i),t=frappe.model.scrub(locals.DocType[i].module),r=frappe.boot.module_app[t];return r+"."+t+".doctype."+e+"."+e},scrub:function(i){return i.replace(/ /g,"_").toLowerCase()},unscrub:function(i){return(i||"").replace(/-|_/g," ").replace(/\w*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},can_create:function(i){return frappe.boot.user.can_create.indexOf(i)!==-1},can_select:function(i){if(frappe.boot.user)return frappe.boot.user.can_select.indexOf(i)!==-1},can_read:function(i){if(frappe.boot.user)return frappe.boot.user.can_read.indexOf(i)!==-1},can_write:function(i){return frappe.boot.user.can_write.indexOf(i)!==-1},can_get_report:function(i){return frappe.boot.user.can_get_report.indexOf(i)!==-1},can_delete:function(i){return i?frappe.boot.user.can_delete.indexOf(i)!==-1:!1},can_submit:function(i){return i?frappe.boot.user.can_submit.indexOf(i)!==-1:!1},can_cancel:function(i){return i?frappe.boot.user.can_cancel.indexOf(i)!==-1:!1},has_workflow:function(i){return frappe.get_list("Workflow",{document_type:i,is_active:1}).length},is_submittable:function(i){return i?locals.DocType[i]&&locals.DocType[i].is_submittable:!1},is_table:function(i){return i?locals.DocType[i]&&locals.DocType[i].istable:!1},is_single:function(i){return i?frappe.boot.single_types.indexOf(i)!=-1:!1},is_tree:function(i){return i?locals.DocType[i]&&locals.DocType[i].is_tree:!1},is_fresh(i){return i&&i.__last_sync_on&&new Date-i.__last_sync_on<5e3},can_import:function(i,e,t=null){return t&&!t.allow_import?!1:frappe.user_roles.includes("System Manager")?!0:e?e.perm[0].import===1:frappe.boot.user.can_import.indexOf(i)!==-1},can_export:function(i,e){return frappe.user_roles.includes("System Manager")?!0:e?e.perm[0].export===1:frappe.boot.user.can_export.indexOf(i)!==-1},can_print:function(i,e){return e?e.perm[0].print===1:frappe.boot.user.can_print.indexOf(i)!==-1},can_email:function(i,e){return e?e.perm[0].email===1:frappe.boot.user.can_email.indexOf(i)!==-1},can_share:function(i,e){return cint(frappe.sys_defaults.disable_document_sharing)&&frappe.session.user!=="Administrator"?!1:e?e.perm[0].share===1:frappe.boot.user.can_share.indexOf(i)!==-1},has_value:function(i,e,t){var r=locals[i]&&locals[i][e]&&locals[i][e][t],s=frappe.meta.get_docfield(i,t,e);let n;return frappe.model.table_fields.includes(s.fieldtype)?(n=!1,$.each(locals[s.options]||{},function(o,a){if(a.parent==e&&a.parenttype==i&&a.parentfield==s.fieldname)return n=!0,!1})):n=!is_null(r),!!n},get_list:function(i,e){var t=locals[i]||locals[":"+i]||{};return $.isEmptyObject(t)?[]:frappe.utils.filter_dict(t,e)},get_value:function(i,e,t,r){if(r)frappe.call({method:"frappe.client.get_value",args:{doctype:i,fieldname:t,filters:e},callback:function(n){n.exc||r(n.message)}});else{if(["number","string"].includes(typeof e)&&locals[i]&&locals[i][e])return locals[i][e][t];var s=frappe.get_list(i,e);return s.length&&s[0]?s[0][t]:null}},set_value:function(i,e,t,r,s,n=!1){var o;$.isPlainObject(i)?(o=i,t=e,r=t):o=locals[i]&&locals[i][e];let a=t,l=[];return $.isPlainObject(a)||(a={},a[t]=r),$.each(a,(c,u)=>{o&&o[c]!==u?(o.__unedited&&!(!o[c]&&!u)&&(o.__unedited=!1),o[c]=u,l.push(()=>frappe.model.trigger(c,u,o,n))):["Link","Dynamic Link"].includes(s)&&o&&l.push(()=>frappe.model.trigger(c,u,o,n))}),frappe.run_serially(l)},on:function(i,e,t){frappe.provide("frappe.model.events."+i),frappe.model.events[i][e]||(frappe.model.events[i][e]=[]),frappe.model.events[i][e].push(t)},trigger:function(i,e,t,r=!1){let s=[];function n(o){if(!!o)for(let a of o)!a||s.push(()=>{let l=a(i,e,t,r);return l&&l.then?l:frappe.after_server_call()})}return frappe.model.events[t.doctype]&&(n(frappe.model.events[t.doctype][i]),n(frappe.model.events[t.doctype]["*"])),frappe.run_serially(s)},get_doc:function(i,e){if(e||(e=i),$.isPlainObject(e)){var t=frappe.get_list(i,e);return t&&t.length?t[0]:null}return locals[i]?locals[i][e]:null},get_children:function(i,e,t,r){let s;$.isPlainObject(i)?(s=i,r=t,t=e):s=frappe.get_doc(i,e);var n=s[t]||[];return r?frappe.utils.filter_dict(n,r):n},get_doc_title(i){if(typeof i.name=="string"&&i.name.startsWith("new-"+i.doctype.toLowerCase().replace(/ /g,"-")))return __("New {0}",[__(i.doctype)]);let e=frappe.get_meta(i.doctype);return e.title_field?i[e.title_field]:String(i.name)},clear_table:function(i,e){for(let t of i[e]||[])delete locals[t.doctype][t.name];i[e]=[]},remove_from_locals:function(i,e){this.clear_doc(i,e),frappe.views.formview[i]&&delete frappe.views.formview[i].frm.opendocs[e]},clear_doc:function(i,e){var t=locals[i]&&locals[i][e];if(!!t){var r=null;if(t.parenttype){r=t.parent;var s=t.parenttype,n=t.parentfield}if(delete locals[i][e],r){var o=locals[s][r],a=[],l=1;$.each(o[n],function(c,u){u.name!=e&&(a.push(u),u.idx=l,l++),o[n]=a})}}},get_no_copy_list:function(i){for(var e=["name","amended_from","amendment_date","cancel_reason"],t=frappe.get_meta(i).fields||[],r=0,s=t.length;r<s;r++){var n=t[r];cint(n.no_copy)&&e.push(n.fieldname)}return e},delete_doc:function(i,e,t){let r=e.toString(),s=frappe.get_meta(i).title_field;if(s){let n=frappe.model.get_value(i,e,s);n&&(r=`${n} (${e})`)}frappe.confirm(__("Permanently delete {0}?",[r.bold()]),function(){return frappe.call({method:"frappe.client.delete",args:{doctype:i,name:e},freeze:!0,freeze_message:__("Deleting {0}...",[r]),callback:function(n,o){n.exc||(frappe.utils.play_sound("delete"),frappe.model.clear_doc(i,e),t&&t(n,o))}})})},rename_doc:function(i,e,t){let r=__("Merge with existing"),s=__("This cannot be undone"),n=r+" <b>("+s+")</b>";var o=new frappe.ui.Dialog({title:__("Rename {0}",[__(e)]),fields:[{label:__("New Name"),fieldname:"new_name",fieldtype:"Data",reqd:1,default:e},{label:n,fieldtype:"Check",fieldname:"merge"}]});o.set_primary_action(__("Rename"),function(){o.hide();var a=o.get_values();if(!!a)return frappe.call({method:"frappe.rename_doc",freeze:!0,freeze_message:"Updating related fields...",args:{doctype:i,old:e,new:a.new_name,merge:a.merge},btn:o.get_primary_btn(),callback:function(l,c){l.exc||($(document).trigger("rename",[i,e,l.message||a.new_name]),locals[i]&&locals[i][e]&&delete locals[i][e],o.hide(),t&&t(l.message))}})}),o.show()},round_floats_in:function(i,e){if(!!i){e||(e=frappe.meta.get_fieldnames(i.doctype,i.parent,{fieldtype:["in",["Currency","Float"]]}));for(var t=0,r=e.length;t<r;t++){var s=e[t];i[s]=flt(i[s],precision(s,i))}}},validate_missing:function(i,e){i[e]||frappe.throw(__("Please specify")+": "+__(frappe.meta.get_label(i.doctype,e,i.parent||i.name)))},get_all_docs:function(i){var e=[i];for(var t in i)if($.isArray(i[t])&&!t.startsWith("_"))for(var r=i[t],s=0,n=r.length;s<n;s++)e.push(r[s]);return e},get_full_column_name:function(i,e){return i.includes("`tab")?i:"`tab"+e+"`.`"+i+"`"},is_numeric_field:function(i){if(!!i)return typeof i=="object"&&(i=i.fieldtype),frappe.model.numeric_fieldtypes.includes(i)},set_default_views_for_doctype(i,e){frappe.model.with_doctype(i,()=>{var s,n,o;let t=frappe.get_meta(i),r=["List","Report","Dashboard","Kanban"];if(t.is_calendar_and_gantt&&frappe.views.calendar[i]){let a=["Calendar","Gantt"];r.push(...a)}t.is_tree&&r.push("Tree"),e.doc.image_field&&r.push("Image"),i==="Communication"&&frappe.boot.email_accounts.length&&r.push("Inbox"),(((s=e.doc.fields)==null?void 0:s.find(a=>a.fieldname==="latitude"))&&((n=e.doc.fields)==null?void 0:n.find(a=>a.fieldname==="longitude"))||((o=e.doc.fields)==null?void 0:o.find(a=>a.fieldname==="location"&&a.fieldtype=="Geolocation")))&&r.push("Map"),e.set_df_property("default_view","options",r)})}});frappe.get_doc=frappe.model.get_doc;frappe.get_children=frappe.model.get_children;frappe.get_list=frappe.model.get_list;frappe.db={get_list:function(i,e){return e||(e={}),e.doctype=i,e.fields||(e.fields=["name"]),"limit"in e||(e.limit=20),new Promise(t=>{frappe.call({method:"frappe.desk.reportview.get_list",args:e,type:"GET",callback:function(r){t(r.message)}})})},exists:function(i,e){return new Promise(t=>{let r;typeof e=="string"?frappe.db.get_value(i,{name:e},"name").then(s=>{s.message&&s.message.name?t(!0):t(!1)}):typeof e=="object"&&frappe.db.count(i,{filters:e,limit:1}).then(s=>{t(s>0)})})},get_value:function(i,e,t,r,s){return frappe.call({method:"frappe.client.get_value",type:"GET",args:{doctype:i,fieldname:t,filters:e,parent:s},callback:function(n){r&&r(n.message)}})},get_single_value:(i,e)=>new Promise(t=>{frappe.call({method:"frappe.client.get_single_value",args:{doctype:i,field:e},type:"GET"}).then(r=>t(r?r.message:null))}),set_value:function(i,e,t,r,s){return frappe.call({method:"frappe.client.set_value",args:{doctype:i,name:e,fieldname:t,value:r},callback:function(n){s&&s(n.message)}})},get_doc:function(i,e,t){return new Promise((r,s)=>{frappe.call({method:"frappe.client.get",type:"GET",args:{doctype:i,name:e,filters:t},callback:n=>{frappe.model.sync(n.message),r(n.message)}}).fail(s)})},insert:function(i){return frappe.xcall("frappe.client.insert",{doc:i})},delete_doc:function(i,e){return new Promise(t=>{frappe.call("frappe.client.delete",{doctype:i,name:e},r=>t(r.message))})},count:function(i,e={},t=!1){let r=e.filters||{},s=e.limit,n=Array.isArray(r)&&r.some(a=>a[0]!==i),o=[];return frappe.xcall("frappe.desk.reportview.get_count",{doctype:i,filters:r,fields:o,distinct:n,limit:s},t?"GET":"POST",{cache:t})},get_link_options(i,e="",t={}){return new Promise(r=>{frappe.call({type:"GET",method:"frappe.desk.search.search_link",args:{doctype:i,txt:e,filters:t},callback(s){r(s.message)}})})}};frappe.provide("frappe.meta.docfield_map");frappe.provide("frappe.meta.docfield_copy");frappe.provide("frappe.meta.docfield_list");frappe.provide("frappe.meta.doctypes");frappe.provide("frappe.meta.precision_map");frappe.get_meta=function(i){return i==="DocType"&&frappe.meta.__doctype_meta?frappe.meta.__doctype_meta:locals.DocType?locals.DocType[i]:null};$.extend(frappe.meta,{sync:function(i){var e,t;$.each(i.fields,function(r,s){frappe.meta.add_field(s)}),(e=i.__print_formats)!=null&&e.length&&frappe.model.sync(i.__print_formats),(t=i.__workflow_docs)!=null&&t.length&&frappe.model.sync(i.__workflow_docs)},add_field:function(i){frappe.provide("frappe.meta.docfield_map."+i.parent),frappe.meta.docfield_map[i.parent][i.fieldname||i.label]=i,frappe.meta.docfield_list[i.parent]||(frappe.meta.docfield_list[i.parent]=[]);for(var e in frappe.meta.docfield_list[i.parent]){var t=frappe.meta.docfield_list[i.parent][e];if(i.fieldname==t.fieldname)return}frappe.meta.docfield_list[i.parent].push(i)},make_docfield_copy_for:function(i,e,t=null){var r=frappe.meta.docfield_copy;r[i]||(r[i]={}),r[i][e]||(r[i][e]={}),t=t||frappe.meta.docfield_list[i]||[];for(var s=0,n=t.length;s<n;s++){var o=t[s];r[i][e][o.fieldname||o.label]=copy_dict(o)}},get_field:function(i,e,t){var r=frappe.meta.get_docfield(i,e,t);return r||frappe.model.std_fields.every(function(s){return s.fieldname===e?(r=s,!1):!0}),r},get_docfield:function(i,e,t){var r=frappe.meta.get_docfield_copy(i,t);return r?r[e]:null},set_formatter:function(i,e,t,r){frappe.meta.get_docfield(i,e,t).formatter=r},set_indicator_formatter:function(i,e,t,r,s){frappe.meta.get_docfield(i,e,t).formatter=function(n,o,a,l){return repl('<span class="indicator %(color)s">%(name)s</span>',{color:s(),name:r()})}},get_docfields:function(i,e,t){var r=frappe.meta.get_docfield_copy(i,e),s=frappe.meta.sort_docfields(r);return t&&(s=frappe.utils.filter_dict(s,t)),s},get_linked_fields:function(i){return $.map(frappe.get_meta(i).fields,function(e){return e.fieldtype=="Link"?e.options:null})},get_fields_to_check_permissions:function(i){var e=$.map(frappe.meta.get_docfields(i,name),function(t){return t.fieldtype==="Link"&&t.ignore_user_permissions!==1?t:null});return e=e.concat({label:"ID",fieldname:name,options:i}),e},sort_docfields:function(i){return $.map(i,function(e){return e}).sort(function(e,t){return e.idx-t.idx})},get_docfield_copy:function(i,e){return e?(frappe.meta.docfield_copy[i]&&frappe.meta.docfield_copy[i][e]||frappe.meta.make_docfield_copy_for(i,e),frappe.meta.docfield_copy[i][e]):frappe.meta.docfield_map[i]},get_fieldnames:function(i,e,t){return $.map(frappe.utils.filter_dict(frappe.meta.docfield_map[i],t),function(r){return r.fieldname})},has_field:function(i,e){let t=frappe.meta.docfield_map[i];return t&&t[e]},get_table_fields:function(i){return $.map(frappe.meta.docfield_list[i],function(e){return frappe.model.table_fields.includes(e.fieldtype)?e:null})},get_doctype_for_field:function(i,e){var t=null;return frappe.model.std_fields_list.includes(e)||frappe.meta.has_field(i,e)?t=i:(frappe.meta.get_table_fields(i).every(function(r){return frappe.meta.has_field(r.options,e)||frappe.model.child_table_field_list.includes(e)?(t=r.options,!1):!0}),t||console.log(__("Warning: Unable to find {0} in any table related to {1}",[e,__(i)]))),t},get_parentfield:function(i,e){var t=(frappe.get_meta(i).fields||[]).filter(r=>frappe.model.table_fields.includes(r.fieldtype)&&r.options===e);if(!t.length)throw"parentfield not found for "+i+", "+e;return t[0].fieldname},get_label:function(i,e,t){var r={name:__("ID"),creation:__("Created On"),docstatus:__("Document Status"),idx:__("Index"),modified:__("Last Updated On"),modified_by:__("Last Updated By"),owner:__("Created By"),_user_tags:__("Tags"),_liked_by:__("Liked By"),_comments:__("Comments"),_assign:__("Assigned To")};if(r[e])return r[e];var s=this.get_docfield(i,e,t);return(s?s.label:"")||e},get_print_sizes:function(){return["A0","A1","A2","A3","A4","A5","A6","A7","A8","A9","B0","B1","B2","B3","B4","B5","B6","B7","B8","B9","B10","C5E","Comm10E","DLE","Executive","Folio","Ledger","Legal","Letter","Tabloid","Custom"]},get_print_formats:function(i){var e=["Standard"],t=locals.DocType[i].default_print_format;let r=frappe.model.get_doc(":Print Settings","Print Settings").enable_raw_printing;var s=frappe.get_list("Print Format",{doc_type:i}).sort(function(o,a){return o>a?1:-1});if($.each(s,function(o,a){!e.includes(a.name)&&a.print_format_type!=="JS"&&(cint(r)||!a.raw_printing)&&e.push(a.name)}),t&&t!="Standard"){var n=e.indexOf(t);e.splice(n,1).sort(),e.unshift(t)}return e},get_field_currency:function(i,e){var t=frappe.boot.sysdefaults.currency||"USD";if(!e&&cur_frm&&(e=cur_frm.doc),i&&i.options)if(i.options.indexOf(":")!=-1){var r=i.options.split(":");if(r.length==3){let s=null;e?(s=e[r[1]],!s&&cur_frm&&(s=cur_frm.doc[r[1]])):s=frappe.defaults.get_user_default(r[1]),t=frappe.model.get_value(r[0],s,r[2])||frappe.model.get_value(":"+r[0],s,r[2])||t}}else e&&e[i.options]?t=e[i.options]:cur_frm&&cur_frm.doc[i.options]&&(t=cur_frm.doc[i.options]);return t},get_field_precision:function(i,e){var t=null;if(i&&i.precision)t=cint(i.precision);else if(i&&i.fieldtype==="Currency"){if(t=cint(frappe.defaults.get_default("currency_precision")),!t){var r=get_number_format(),s=get_number_format_info(r);t=s.precision}}else t=cint(frappe.defaults.get_default("float_precision"))||3;return t}});Object.assign(frappe.model,{docinfo:{},sync:function(i){var e;if(!i.docs&&!i.docinfo&&(i={docs:i}),e=$.isPlainObject(i.docs),e&&(i.docs=[i.docs]),i.docs)for(var t=0,r=i.docs.length;t<r;t++){var s=i.docs[t];locals[s.doctype]&&locals[s.doctype][s.name]?frappe.model.update_in_locals(s):frappe.model.add_to_locals(s),s.__last_sync_on=new Date,s.doctype==="DocType"&&frappe.meta.sync(s),s.localname&&frappe.model.rename_after_save(s,t)}return frappe.model.sync_docinfo(i),i.docs},rename_after_save:(i,e)=>{frappe.model.new_names[i.localname]=i.name,$(document).trigger("rename",[i.doctype,i.localname,i.name]),delete locals[i.doctype][i.localname],e===0&&(frappe.model.docinfo[i.doctype][i.name]=frappe.model.docinfo[i.doctype][i.localname],frappe.model.docinfo[i.doctype][i.localname]=void 0)},sync_docinfo:i=>{if(i.docinfo){let{doctype:e,name:t}=i.docinfo;frappe.model.docinfo[e]||(frappe.model.docinfo[e]={}),frappe.model.docinfo[e][t]=i.docinfo,Object.assign(frappe.boot.user_info,i.docinfo.user_info)}return i.docs},add_to_locals:function(i){locals[i.doctype]||(locals[i.doctype]={}),!i.name&&i.__islocal&&(i.parentfield||frappe.model.clear_doc(i),i.name=frappe.model.get_new_name(i.doctype),i.parentfield||frappe.provide("frappe.model.docinfo."+i.doctype+"."+i.name)),locals[i.doctype][i.name]=i;let e=frappe.get_meta(i.doctype);if(!(e?e.istable:i.parentfield))for(var r in i){var s=i[r];if($.isArray(s))for(var n=0,o=s.length;n<o;n++){var a=s[n];typeof a=="object"&&!a.parent&&(a.parent=i.name),frappe.model.add_to_locals(a)}}},update_in_locals:function(i){let e=locals[i.doctype][i.name],t=function(r,s){Object.keys(s).map(n=>{r[n]==null&&delete s[n]})};for(let r in i){let s=frappe.meta.get_field(i.doctype,r);if(s&&frappe.model.table_fields.includes(s.fieldtype)){i[r]instanceof Array||(i[r]=[]),e[r]instanceof Array||(e[r]=[]);for(let n=0;n<i[r].length;n++){let o=i[r][n],a=e[r][n];a?(locals[o.doctype]||(locals[o.doctype]={}),o.name||(o.name=frappe.model.get_new_name(i.doctype)),locals[o.doctype][o.name]||(delete locals[o.doctype][a.name],locals[o.doctype][o.name]=a),Object.assign(a,o),t(o,a)):(e[r].push(o),o.parent||(o.parent=i.name),frappe.model.add_to_locals(o))}if(e[r].length>i[r].length){for(let n=i[r].length;n<e[r].length;n++){let o=e[r][n];locals[o.doctype]&&locals[o.doctype][o.name]&&delete locals[o.doctype][o.name]}e[r].length=i[r].length}}else e[r]=i[r]}t(i,e)}});frappe.provide("frappe.model");$.extend(frappe.model,{new_names:{},get_new_doc:function(i,e,t,r){frappe.provide("locals."+i);var s={docstatus:0,doctype:i,name:frappe.model.get_new_name(i),__islocal:1,__unsaved:1,owner:frappe.session.user};if(frappe.model.set_default_values(s,e),e?($.extend(s,{parent:e.name,parentfield:t,parenttype:e.doctype}),e[t]||(e[t]=[]),s.idx=e[t].length+1,e[t].push(s)):frappe.provide("frappe.model.docinfo."+i+"."+s.name),frappe.model.add_to_locals(s),r&&frappe.model.create_mandatory_children(s),e||(s.__run_link_triggers=1),frappe.route_options&&frappe.route_options.name_field){var n=frappe.get_meta(i);n.autoname&&n.autoname.indexOf("field:")!==-1?s[n.autoname.substr(6)]=frappe.route_options.name_field:n.autoname&&n.autoname==="prompt"?s.__newname=frappe.route_options.name_field:n.title_field&&(s[n.title_field]=frappe.route_options.name_field),delete frappe.route_options.name_field}return frappe.route_options&&!s.parent&&($.each(frappe.route_options,function(o,a){var l=frappe.meta.has_field(i,o);l&&!l.no_copy&&(s[o]=a)}),frappe.route_options=null),s},make_new_doc_and_get_name:function(i,e){return frappe.model.get_new_doc(i,null,null,e).name},get_new_name:function(i){return frappe.router.slug(`new-${i}-${frappe.utils.get_random(10)}`)},set_default_values:function(i,e){let t=i.doctype,r=frappe.meta.get_docfields(t),s=[],n=frappe.model.no_value_type.filter(o=>!frappe.model.table_fields.includes(o));return r.forEach(o=>{if(n.includes(o.fieldtype)||i[o.fieldname]!=null||o.no_default)return;let a=frappe.model.get_default_value(o,i,e);a?(["Int","Check"].includes(o.fieldtype)?a=cint(a):["Currency","Float"].includes(o.fieldtype)&&(a=flt(a)),i[o.fieldname]=a,s.push(o.fieldname)):o.fieldtype=="Select"&&o.options&&typeof o.options=="string"&&!["[Select]","Loading..."].includes(o.options)&&(i[o.fieldname]=o.options.split(`
`)[0])}),s},create_mandatory_children:function(i){var e=frappe.get_meta(i.doctype);e&&e.istable||frappe.meta.get_docfields(i.doctype).forEach(function(t){t.fieldtype==="Table"&&t.reqd&&frappe.model.add_child(i,t.fieldname)})},get_default_value:function(i,e,t){var r="",s=frappe.defaults.get_user_permissions();let n=[],o=null,a=null;s&&({allowed_records:n,default_doc:o}=frappe.perm.filter_allowed_docs_for_doctype(s[i.options],e.doctype));var l=frappe.get_meta(e.doctype),c=i.fieldtype==="Link"&&!$.isEmptyObject(s)&&i.ignore_user_permissions!=1&&n.length;if(i.fieldtype==="Link"&&i.options!=="User")if(c&&o)a=o;else{if(!i.ignore_user_permissions){var u=frappe.defaults.get_user_defaults(i.options);u&&u.length===1&&(r=u[0])}r||(r=frappe.defaults.get_user_default(i.fieldname)),!r&&i.remember_last_selected_value&&frappe.boot.user.last_selected_values&&(r=frappe.boot.user.last_selected_values[i.options]);var p=r&&(!c||n.includes(r));p&&(a=r)}if(!a||i.default){let A=String(i.default);if(A=="__user"||A.toLowerCase()=="user")a=frappe.session.user;else if(A=="user_fullname")a=frappe.session.user_fullname;else if(A=="Today")a=frappe.datetime.get_today();else if((A||"").toLowerCase()==="now")i.fieldtype=="Time"?a=frappe.datetime.now_time():a=frappe.datetime.system_datetime();else if(A[0]===":"){var m=frappe.model.get_default_from_boot_docs(i,e,t),w=!c||n.includes(m);w&&(a=m)}else if(i.fieldname===l.title_field)a="";else{var x=!c||n.includes(i.default);(i.fieldtype!=="Link"||i.options==="User"||x)&&(a=i.default)}}else i.fieldtype=="Time"&&(a=frappe.datetime.now_time());return frappe.model.table_fields.includes(i.fieldtype)&&(a=[]),i.__default_value=a,a},get_default_from_boot_docs:function(i,e,t){if(frappe.get_list(i.default).length>0){var r=i.default.slice(1).toLowerCase().replace(" ","_"),s=t?t[r]:frappe.defaults.get_user_default(r),n=s?frappe.get_doc(i.default,s):null;if(n&&n[i.fieldname])return n[i.fieldname]}},add_child:function(i,e,t,r){arguments.length===2&&(t=e,e=frappe.meta.get_field(i.doctype,t).options),r=r?r-.1:(i[t]||[]).length+1;var s=frappe.model.get_new_doc(e,i,t);if(s.idx=r,r!==cint(r))for(var n=i[t].sort(function(c,u){return c.idx-u.idx}),o=0,a=n.length;o<a;o++){var l=n[o];l.idx=o+1}return cur_frm&&cur_frm.doc==i&&cur_frm.dirty(),s},copy_doc:function(i,e,t,r){let s=["name","amended_from","amendment_date","cancel_reason"],n=frappe.model.get_new_doc(i.doctype,t,r);for(let a in i){let l=frappe.meta.get_docfield(i.doctype,a),c=a.substring(0,2)==="__",u=s.includes(a),p=!e&&l&&cint(l.no_copy)==1,m=l&&l.fieldtype==="Password";if(l&&!c&&!u&&!p&&!m){let w=i[a]||[];if(frappe.model.table_fields.includes(l.fieldtype))for(let x=0,A=w.length;x<A;x++){let D=w[x];frappe.model.copy_doc(D,e,n,l.fieldname)}else n[a]=i[a]}}let o=frappe.session.user;return n.__islocal=1,n.docstatus=0,n.owner=o,n.creation="",n.modified_by=o,n.modified="",n.lft=null,n.rgt=null,e&&t&&(n._amended_from=i.name),n},open_mapped_doc:function(i){return i.frm&&i.frm.doc.__unsaved?frappe.throw(__("You have unsaved changes in this form. Please save before you continue.")):!i.source_name&&i.frm?i.source_name=i.frm.doc.name:!i.frm&&!i.source_name&&(i.source_name=null),frappe.call({type:"POST",method:"frappe.model.mapper.make_mapped_doc",args:{method:i.method,source_name:i.source_name,args:i.args||null,selected_children:i.frm?i.frm.get_selected():null},freeze:!0,freeze_message:i.freeze_message||"",callback:function(e){e.exc||(frappe.model.sync(e.message),i.run_link_triggers&&(frappe.get_doc(e.message.doctype,e.message.name).__run_link_triggers=!0),frappe.set_route("Form",e.message.doctype,e.message.name))}})}});frappe.create_routes={};frappe.new_doc=function(i,e,t){if(i==="File"){new frappe.ui.FileUploader({folder:e?e.folder:"Home"});return}return new Promise(r=>{e&&$.isPlainObject(e)&&(frappe.route_options=e),frappe.model.with_doctype(i,function(){frappe.create_routes[i]?frappe.set_route(frappe.create_routes[i]).then(()=>r()):frappe.ui.form.make_quick_entry(i,null,t).then(()=>r())})})};frappe.provide("frappe.perm");Object.assign(window,{READ:"read",WRITE:"write",CREATE:"create",DELETE:"delete",SUBMIT:"submit",CANCEL:"cancel",AMEND:"amend"});$.extend(frappe.perm,{rights:["select","read","write","create","delete","submit","cancel","amend","report","import","export","print","email","share"],doctype_perm:{},has_perm:(i,e=0,t="read",r)=>{var n;let s=frappe.perm.get_perm(i,r);return!!((n=s==null?void 0:s[e])!=null&&n[t])},get_perm:(i,e)=>{var t,r;return e&&!e.__islocal?frappe.perm._get_perm(i,e):(r=(t=frappe.perm.doctype_perm)[i])!=null?r:t[i]=frappe.perm._get_perm(i)},_get_perm:(i,e)=>{let t=[{read:0,permlevel:0}],r=frappe.get_meta(i),s=frappe.session.user;if((s==="Administrator"||frappe.user_roles.includes("Administrator"))&&(t[0].read=1),!r)return t;t=frappe.perm.get_role_permissions(r);let n=t[0];if(e){let o=frappe.model.get_docinfo(i,e.name);if(o&&o.permissions&&Object.keys(o.permissions).forEach(a=>{n[a]=o.permissions[a]}),e.owner!==s)for(let a of frappe.perm.rights)n[a]&&!n.rights_without_if_owner.has(a)&&(n[a]=0);if(o&&o.shared){for(let a of o.shared)if(a.user===s){for(let l of["read","write","submit","share"])n[l]||(n[l]=a[l]);a.read&&(n.email=frappe.boot.user.can_email.indexOf(i)!==-1?1:0,n.print=frappe.boot.user.can_print.indexOf(i)!==-1?1:0)}}}return!n.read&&frappe.model.can_read(i)&&(n.read=1),t},get_role_permissions:i=>{let e=[{read:0,permlevel:0}];return(i.permissions||[]).forEach(t=>{var n,o;let r=cint(t.permlevel),s=(n=e[r])!=null?n:e[r]={permlevel:r};r===0&&((o=s.rights_without_if_owner)!=null||(s.rights_without_if_owner=new Set)),frappe.user_roles.includes(t.role)&&frappe.perm.rights.forEach(a=>{!t[a]||(s[a]=1,r===0&&!t.if_owner&&s.rights_without_if_owner.add(a))})}),e=e.map(t=>t||{}),e},get_match_rules:(i,e)=>{let t=[];e||(e="read");let r=frappe.perm.get_perm(i),s=frappe.defaults.get_user_permissions();if(s&&!$.isEmptyObject(s)){let o={},a=frappe.meta.get_fields_to_check_permissions(i);$.each(a,(l,c)=>{let u=s[c.options]||[],p=frappe.perm.get_allowed_docs_for_doctype(u,i);p.length&&(o[c.label]=p)}),$.isEmptyObject(o)||t.push(o)}let n=r[0];return n.read&&!n.rights_without_if_owner.has("read")&&t.push({Owner:frappe.session.user}),t},get_field_display_status:(i,e,t,r)=>{if(!t&&e&&(t=frappe.perm.get_perm(e.doctype,e)),!t){let a=i&&(cint(i.hidden)||cint(i.hidden_due_to_dependency)),l=i&&(cint(i.read_only)||cint(i.is_virtual));return a?"None":l?"Read":"Write"}i.permlevel||(i.permlevel=0);let s=t[i.permlevel],n="None";if(s&&(s.write&&!i.disabled&&!i.is_virtual?n="Write":s.read&&(n="Read")),r&&console.log("By Permission:"+n),cint(i.hidden)&&(n="None"),r&&console.log("By Hidden:"+n),cint(i.hidden_due_to_dependency)&&(n="None"),r&&console.log("By Hidden Due To Dependency:"+n),!e)return n;n==="Write"&&cint(e.docstatus)>0&&(n="Read"),r&&console.log("By Submit:"+n);let o=cint(i.allow_on_submit);return n==="Read"&&o&&cint(e.docstatus)===1&&s.write&&(n="Write"),r&&console.log("By Allow on Submit:"+n),n==="Read"&&cur_frm&&cur_frm.state_fieldname&&(cint(cur_frm.read_only)||cur_frm.states.update_fields.includes(i.fieldname)||i.fieldname==cur_frm.state_fieldname)&&(n="Read"),r&&console.log("By Workflow:"+n),n==="Write"&&(cint(i.read_only)||i.fieldtype==="Read Only")&&(n="Read"),r&&console.log("By Read Only:"+n),n==="Write"&&i.set_only_once&&!e.__islocal&&(n="Read"),r&&console.log("By Set Only Once:"+n),n},is_visible:(i,e,t)=>(typeof i=="string"&&(i=frappe.meta.get_docfield(e.doctype,i,e.parent||e.name)),frappe.perm.get_field_display_status(i,e,t)!=="None"),get_allowed_docs_for_doctype:(i,e)=>frappe.perm.filter_allowed_docs_for_doctype(i,e,!1),filter_allowed_docs_for_doctype:(i,e,t=!0)=>{let r=(i||[]).filter(n=>n.applicable_for===e||!n.applicable_for),s=r.map(n=>n.doc);if(t){let n=r.filter(o=>o.is_default).map(o=>o.doc);return{allowed_records:s,default_doc:n[0]}}else return s}});frappe.provide("frappe.workflow");frappe.workflow={state_fields:{},workflows:{},avoid_status_override:{},setup:function(i){var e=frappe.get_list("Workflow",{document_type:i});e.length?(frappe.workflow.workflows[i]=e[0],frappe.workflow.state_fields[i]=e[0].workflow_state_field,frappe.workflow.avoid_status_override[i]=e[0].states.filter(t=>t.avoid_status_override).map(t=>t.state)):frappe.workflow.state_fields[i]=null},get_state_fieldname:function(i){return frappe.workflow.state_fields[i]===void 0&&frappe.workflow.setup(i),frappe.workflow.state_fields[i]},get_default_state:function(i,e){frappe.workflow.setup(i);var t=null;return $.each(frappe.workflow.workflows[i].states,function(r,s){if(cint(s.doc_status)===cint(e))return t=s.state,!1}),t},get_transitions:function(i){return frappe.workflow.setup(i.doctype),frappe.xcall("frappe.model.workflow.get_transitions",{doc:i})},get_document_state_roles:function(i,e){return frappe.workflow.setup(i),(frappe.get_children(frappe.workflow.workflows[i],"states",{state:e})||[]).map(r=>r.allow_edit)},is_self_approval_enabled:function(i){return frappe.workflow.workflows[i].allow_self_approval},is_read_only:function(i,e){var t=frappe.workflow.get_state_fieldname(i);if(t){var r=locals[i][e];if(!r||r.__islocal)return!1;var s=r[t]||frappe.workflow.get_default_state(i,r.docstatus);if(!s)return!1;let n=frappe.workflow.get_document_state_roles(i,s);return!frappe.user_roles.some(a=>n.includes(a))}return!1},get_update_fields:function(i){var e=$.unique($.map(frappe.workflow.workflows[i].states||[],function(t){return t.update_field}));return e},get_state(i){let e=this.get_state_fieldname(i.doctype),t=i[e];return t||(t=this.get_default_state(i.doctype,i.docstatus)),t},get_all_transitions(i){return frappe.workflow.workflows[i].transitions||[]},get_all_transition_actions(i){return this.get_all_transitions(i).map(t=>t.action)}};frappe.provide("frappe.model.user_settings");$.extend(frappe.model.user_settings,{get:function(i){return frappe.call("frappe.model.utils.user_settings.get",{doctype:i}).then(e=>JSON.parse(e.message||"{}"))},save:function(i,e,t){if(frappe.session.user==="Guest")return Promise.resolve();let r=frappe.model.user_settings[i]||{},s=$.extend(!0,{},r);$.isPlainObject(t)?(s[e]=s[e]||{},$.extend(s[e],t)):s[e]=t;let n=JSON.stringify(r),o=JSON.stringify(s);return n!==o?this.update(i,s):Promise.resolve(s)},remove:function(i,e){var t=frappe.model.user_settings[i]||{};return delete t[e],this.update(i,t)},update:function(i,e){return frappe.session.user==="Guest"?Promise.resolve():frappe.call({method:"frappe.model.utils.user_settings.save",args:{doctype:i,user_settings:e},callback:function(t){frappe.model.user_settings[i]=t.message}})}});frappe.get_user_settings=function(i,e){var t=frappe.model.user_settings[i]||{};return e&&(t=t[e]||{}),t};frappe.user_info=function(i){i||(i=frappe.session.user);let e;return frappe.boot.user_info&&frappe.boot.user_info[i]?e=frappe.boot.user_info[i]:e={fullname:i||"Unknown"},e.abbr=frappe.get_abbr(e.fullname),e.color=frappe.get_palette(e.fullname),e};frappe.update_user_info=function(i){for(let e in i)frappe.boot.user_info[e]?Object.assign(frappe.boot.user_info[e],i[e]):frappe.boot.user_info[e]=i[e]};frappe.provide("frappe.user");$.extend(frappe.user,{name:"Guest",full_name:function(i){return i===frappe.session.user?__("You",null,"Name of the current user. For example: You edited this 5 hours ago."):frappe.user_info(i).fullname},image:function(i){return frappe.user_info(i).image},abbr:function(i){return frappe.user_info(i).abbr},has_role:function(i){typeof i=="string"&&(i=[i]);for(var e in i)if((frappe.boot?frappe.boot.user.roles:["Guest"]).indexOf(i[e])!=-1)return!0},get_desktop_items:function(){var i=$.map(frappe.boot.allowed_modules,function(e){var t=e.module_name,r=frappe.modules[t]&&frappe.modules[t].type;if(frappe.boot.user.allow_modules.indexOf(t)===-1)return null;var s=null;return r==="module"?(frappe.boot.user.allow_modules.indexOf(t)!=-1||frappe.modules[t].is_help)&&(s=t):r==="page"?frappe.boot.allowed_pages.indexOf(frappe.modules[t].link)!=-1&&(s=t):r==="list"?frappe.model.can_read(frappe.modules[t]._doctype)&&(s=t):r==="view"?s=t:r==="setup"?(frappe.user.has_role("System Manager")||frappe.user.has_role("Administrator"))&&(s=t):s=t,s});return i},is_report_manager:function(){return frappe.user.has_role(["Administrator","System Manager","Report Manager"])},get_formatted_email:function(i){var e=frappe.user.full_name(i);if(e){var t="";return e.search(/[\[\]\\()<>@,:;".]/)!==-1&&(t='"'),repl("%(quote)s%(fullname)s%(quote)s <%(email)s>",{fullname:e,email:i,quote:t})}else return i},get_emails:()=>Object.keys(frappe.boot.user_info).map(i=>frappe.boot.user_info[i].email),toString:function(){return this.name}});frappe.session_alive=!0;$(document).bind("mousemove",function(){frappe.session_alive===!1&&$(document).trigger("session_alive"),frappe.session_alive=!0,frappe.session_alive_timeout&&clearTimeout(frappe.session_alive_timeout),frappe.session_alive_timeout=setTimeout("frappe.session_alive=false;",3e4)});var ra=Ut(Hh());frappe.avatar=function(i,e,t,r=null,s=!1,n=!1){let o;if(i)o=frappe.user_info(i);else{let l=t||frappe.get_cookie("full_name");o={image:r===null?frappe.get_cookie("user_image"):r,fullname:l,abbr:frappe.get_abbr(l),color:frappe.get_palette(l)}}t||(t=o.fullname);let a="";return n&&(e+=" filterable",a=`data-filter="_assign,like,%${i}%"`),frappe.get_avatar(e,t,r||o.image,s,a)};frappe.get_avatar=function(i,e,t=null,r,s){i||(i="avatar-small");let n=document.createElement("div");if(t)n.innerHTML=`
			<span class="avatar ${i}" ${s}>
				<span class="avatar-frame" style='background-image: url("${t}")'</span>
			</span>`;else{let o=frappe.get_abbr(e),a="";if(!r){let l=frappe.get_palette(e);a=`background-color: var(${l[0]}); color: var(${l[1]})`}(i==="avatar-small"||i=="avatar-xs")&&(o=o.substr(0,1)),n.innerHTML=`<span class="avatar ${i}" ${s}>
			<div class="avatar-frame standard-image"
				style="${a}">
					${o}
			</div>
		</span>`}return n.querySelector(".avatar").setAttribute("title",e),n.querySelector(".avatar-frame").setAttribute("title",e),n.innerHTML};frappe.avatar_group=function(i,e=4,t={}){let r="",s=i.slice(0,e),n=i.slice(e),o=t.css_class||"",a=s.map(c=>frappe.avatar(c,"avatar-small "+o,null,null,!1,t.filterable)).join("");n.length===1?a+=frappe.avatar(n[0],"avatar-small "+o,null,null,!1,t.filterable):n.length>1&&(a=`
			${a}
			<span class="avatar avatar-small ${o}">
				<div class="avatar-frame standard-image avatar-extra-count"
					title="${n.map(c=>frappe.user_info(c).fullname).join(", ")}">
					+${n.length}
				</div>
			</span>
		`),t.action_icon&&(r=`
			<span class="avatar avatar-small">
				<div class="avatar-frame avatar-action">
					${frappe.utils.icon(t.action_icon,"sm")}
				</div>
			</span>
		`);let l=$(`<div class="avatar-group ${t.align||"right"} ${t.overlap!=!1?"overlap":""}">
			${a}
			${r}
		</div>`);return l.find(".avatar-action").on("click",t.action),l};frappe.ui.scroll=function(i,e,t){var r=$(".navbar").height()+$(".page-head").height(),s=$(i).offset().top-r-cint(t);e?$("html, body").animate({scrollTop:s}):$(window).scrollTop(s)};frappe.palette=[["--orange-avatar-bg","--orange-avatar-color"],["--pink-avatar-bg","--pink-avatar-color"],["--blue-avatar-bg","--blue-avatar-color"],["--green-avatar-bg","--green-avatar-color"],["--dark-green-avatar-bg","--dark-green-avatar-color"],["--red-avatar-bg","--red-avatar-color"],["--yellow-avatar-bg","--yellow-avatar-color"],["--purple-avatar-bg","--purple-avatar-color"],["--gray-avatar-bg","--gray-avatar-color0"]];frappe.get_palette=function(i){if(!i)return frappe.palette[8];var e=cint((parseInt((0,ra.default)(i).substr(4,2),16)+1)/5.33);return frappe.palette[e%8]};frappe.get_abbr=function(i,e){if(!i)return"";var t="";return $.each(i.split(" "),function(r,s){if(t.length>=(e||2))return!1;if(!s.trim().length)return!0;t+=s.trim()[0]}),t||"?"};frappe.gravatars={};frappe.get_gravatar=function(i,e=0){var t=e?"s="+e:"d=retro";return frappe.gravatars[i]||(frappe.gravatars[i]="https://secure.gravatar.com/avatar/"+(0,ra.default)(i)+"?"+t),frappe.gravatars[i]};window.repl=function(e,t){if(e==null)return"";for(var r in t)e=e.split("%("+r+")s").join(t[r]);return e};window.replace_all=function(i,e,t){return i.split(e).join(t)};window.strip_html=function(i){return cstr(i).replace(/<[^>]*>/g,"")};window.strip=function(i,e){if(i)return i=lstrip(i,e),i=rstrip(i,e),i};window.lstrip=function(e,t){t||(t=[`
`,"	"," "]);let r=e.substr(0,1);for(;t.includes(r);)e=e.substr(1),r=e.substr(0,1);return e};window.rstrip=function(i,e){e||(e=[`
`,"	"," "]);let t=i.substr(i.length-1);for(;e.includes(t);)i=i.substr(0,i.length-1),t=i.substr(i.length-1);return i};frappe.get_cookie=function(e){return frappe.get_cookies()[e]};frappe.get_cookies=function(){var e=document.cookie,t=0,r={};return document.cookie.match(/^\s*\$Version=(?:"1"|1);\s*(.*)/)&&(e=RegExp.$1,t=1),t===0?e.split(/[,;]/).map(function(s){var n=s.split(/=/,2),o=decodeURIComponent(n[0].trimLeft()),a=n.length>1?decodeURIComponent(n[1].trimRight()):null;a&&a.charAt(0)==='"'&&(a=a.substr(1,a.length-2)),r[o]=a}):e.match(/(?:^|\s+)([!#$%&'*+\-.0-9A-Z^`a-z|~]+)=([!#$%&'*+\-.0-9A-Z^`a-z|~]*|"(?:[\x20-\x7E\x80\xFF]|\\[\x00-\x7F])*")(?=\s*[,;]|$)/g).map(function(s,n){var o=s,a=n.charAt(0)==='"'?n.substr(1,-1).replace(/\\(.)/g,"$1"):n;r[o]=a}),r};frappe.is_mobile=function(){return $(document).width()<768};frappe.is_large_screen=function(){return $(document).height()>1180};frappe.utils.xss_sanitise=function(i,e){let t=i,r={strategies:["html","js"]},s={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},n=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,o=/confirm\(.*\)|alert\(.*\)|prompt\(.*\)/gi;if(e=Object.assign({},r,e),e.strategies.includes("js")&&(t=t.replace(n,""),t=t.replace(o,"")),e.strategies.includes("html"))for(let a in s){let l=s[a],c=new RegExp(a,"g");t=t.replace(c,l)}return t};frappe.utils.sanitise_redirect=i=>{let e=(()=>r=>{function s(o){let a=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:/\n?]+)/gim.exec(o);return a==null?"":a[1]}function n(o){return/^(?:[a-z]+:)?\/\//i.test(o)}return n(r)?s(location.href)!==s(r):!1})(),t=r=>{let s=/\s*(&#x.{1,7})?/,n=new RegExp(Array.from("javascript").join(s.source),"gi");return r.replace(n,"")};return i=frappe.utils.strip_url(i),e(i)?"":t(frappe.utils.xss_sanitise(i,{strategies:["js"]}))};frappe.utils.strip_url=i=>i.replace(/^[^A-Za-z0-9(//)#]+/g,"");frappe.utils.new_auto_repeat_prompt=function(i){let e=[{fieldname:"frequency",fieldtype:"Select",label:__("Frequency"),reqd:1,options:[{label:__("Daily"),value:"Daily"},{label:__("Weekly"),value:"Weekly"},{label:__("Monthly"),value:"Monthly"},{label:__("Quarterly"),value:"Quarterly"},{label:__("Half-yearly"),value:"Half-yearly"},{label:__("Yearly"),value:"Yearly"}]},{fieldname:"start_date",fieldtype:"Date",label:__("Start Date"),reqd:1,default:frappe.datetime.nowdate()},{fieldname:"end_date",fieldtype:"Date",label:__("End Date")}];frappe.prompt(e,function(t){frappe.call({method:"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat",args:{doctype:i.doc.doctype,docname:i.doc.name,frequency:t.frequency,start_date:t.start_date,end_date:t.end_date},callback:function(r){r.message&&(frappe.show_alert({message:__("Auto Repeat created for this document"),indicator:"green"}),i.reload_doc())}})},__("Auto Repeat"),__("Save"))};frappe.utils.get_page_view_count=function(i){return frappe.call("frappe.website.doctype.web_page_view.web_page_view.get_page_view_count",{path:i})};frappe.urllib={get_arg:function(i){i=i.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var e="[\\?&]"+i+"=([^&#]*)",t=new RegExp(e),r=t.exec(window.location.href);return r==null?"":decodeURIComponent(r[1])},get_dict:function(){var i={},e=window.location.href.split("?")[1];if(!e||(e.indexOf("#")!=-1&&(e=e.split("#")[0]),!e))return i;e=e.split("&");for(var t=0;t<e.length;t++){var r=e[t].split("=");i[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return i},get_base_url:function(){var i=frappe.base_url||window.location.origin;return i.substr(i.length-1,1)=="/"&&(i=i.substr(0,i.length-1)),i},get_full_url:function(i){return i.indexOf("http://")===0||i.indexOf("https://")===0?i:i.substr(0,1)==="/"?frappe.urllib.get_base_url()+i:frappe.urllib.get_base_url()+"/"+i}};window.open_url_post=function(e,t,r){if(window.cordova){let l=e+"api/method/"+t.cmd+frappe.utils.make_query_string(t,!1);window.location.href=l}else{var s=document.createElement("form");s.action=e,s.method="POST",s.style.display="none",r&&(s.target="_blank"),t.csrf_token=frappe.csrf_token;for(var n in t){var o=document.createElement("textarea");o.name=n;var a=t[n];typeof a!="string"&&(a=JSON.stringify(a)),o.value=a,s.appendChild(o)}return document.body.appendChild(s),s.submit(),s}};window.get_url_arg=frappe.urllib.get_arg;window.get_url_dict=frappe.urllib.get_dict;function sa(i,e){if(!i)return"";typeof i=="string"&&(i=frappe.datetime.convert_to_user_tz(i),i=new Date((i||"").replace(/-/g,"/").replace(/[TZ]/g," ").replace(/\.[0-9]*/,"")));let t=(new Date(frappe.datetime.now_datetime().replace(/-/g,"/")).getTime()-i.getTime())/1e3,r=Math.floor(t/86400);if(isNaN(r)||r<0)return"";if(e)if(r==0){if(t<60)return __("now");if(t<3600)return __("{0} m",[Math.floor(t/60)]);if(t<86400)return __("{0} h",[Math.floor(t/3600)])}else return r<7?__("{0} d",[r]):r<31?__("{0} w",[Math.floor(r/7)]):r<365?__("{0} M",[Math.floor(r/30)]):__("{0} y",[Math.floor(r/365)]);else if(r==0){if(t<60)return __("just now");if(t<120)return __("1 minute ago");if(t<3600)return __("{0} minutes ago",[Math.floor(t/60)]);if(t<7200)return __("1 hour ago");if(t<86400)return __("{0} hours ago",[Math.floor(t/3600)])}else return r==1?__("yesterday"):r<7?__("{0} days ago",[r]):r<14?__("1 week ago"):r<31?__("{0} weeks ago",[Math.floor(r/7)]):r<62?__("1 month ago"):r<365?__("{0} months ago",[Math.floor(r/30)]):r<730?__("1 year ago"):__("{0} years ago",[Math.floor(r/365)])}frappe.provide("frappe.datetime");window.comment_when=function(i,e){var t=frappe.datetime.str_to_user?frappe.datetime.str_to_user(i):i;return'<span class="frappe-timestamp '+(e?" mini":"")+'" data-timestamp="'+i+'" title="'+t+'">'+sa(i,e)+"</span>"};frappe.datetime.comment_when=comment_when;frappe.datetime.prettyDate=sa;frappe.datetime.refresh_when=function(){jQuery&&$(".frappe-timestamp").each(function(){$(this).html(sa($(this).attr("data-timestamp"),$(this).hasClass("mini")))})};setInterval(function(){frappe.datetime.refresh_when()},6e4);var Wh=Ut(Uh());frappe.provide("frappe.tools");frappe.tools.downloadify=function(i,e,t){if(e&&e.length&&!has_common(e,e)){frappe.msgprint(__("Export not allowed. You need {0} role to export.",[frappe.utils.comma_or(e)]));return}var r=t+".csv",s=frappe.tools.to_csv(i),n=document.createElement("a");if("download"in n){var o=new Blob([s],{type:"text/csv;charset=UTF-8"});n.href=URL.createObjectURL(o),n.download=r}else n.href="data:attachment/csv,"+encodeURIComponent(s),n.download=r,n.target="_blank";document.body.appendChild(n),n.click(),document.body.removeChild(n)};frappe.markdown=function(i){for(frappe.md2html||(frappe.md2html=new Wh.default.Converter({tables:!0}));i.substr(0,1)===`
`;)i=i.substr(1);for(var e=0,t=i.split(`
`)[0];[`
`,"	"].indexOf(t.substr(0,1))!==-1;)e++,t=t.substr(1);if(e&&e!=t.length){var r=[];$.each(i.split(`
`),function(s,n){r.push(n.substr(e))}),i=r.join(`
`)}return frappe.md2html.makeHtml(i)};frappe.tools.to_csv=function(i){var e=[];return $.each(i,function(t,r){r=$.map(r,function(s){return s==null&&(s=""),typeof s=="string"?'"'+$("<i>").html(s.replace(/"/g,'""')).text()+'"':s}),e.push(r.join(","))}),e.join(`
`)};frappe.provide("frappe.datetime");frappe.defaultDateFormat="YYYY-MM-DD";frappe.defaultTimeFormat="HH:mm:ss";frappe.defaultDatetimeFormat=frappe.defaultDateFormat+" "+frappe.defaultTimeFormat;moment.defaultFormat=frappe.defaultDateFormat;frappe.provide("frappe.datetime");$.extend(frappe.datetime,{convert_to_user_tz:function(i,e){let t=null;return frappe.boot.time_zone&&frappe.boot.time_zone.system&&frappe.boot.time_zone.user?t=moment.tz(i,frappe.boot.time_zone.system).clone().tz(frappe.boot.time_zone.user):t=moment(i),e===!1?t:t.format(frappe.defaultDatetimeFormat)},convert_to_system_tz:function(i,e){let t=null;return frappe.boot.time_zone&&frappe.boot.time_zone.system&&frappe.boot.time_zone.user?t=moment.tz(i,frappe.boot.time_zone.user).clone().tz(frappe.boot.time_zone.system):t=moment(i),e===!1?t:t.format(frappe.defaultDatetimeFormat)},is_system_time_zone:function(){return frappe.boot.time_zone&&frappe.boot.time_zone.system&&frappe.boot.time_zone.user?moment().tz(frappe.boot.time_zone.system).utcOffset()===moment().tz(frappe.boot.time_zone.user).utcOffset():!0},is_timezone_same:function(){return frappe.datetime.is_system_time_zone()},str_to_obj:function(i){return moment(i,frappe.defaultDatetimeFormat)._d},obj_to_str:function(i){return moment(i).locale("en").format()},obj_to_user:function(i){return moment(i).format(frappe.datetime.get_user_date_fmt().toUpperCase())},get_diff:function(i,e){return moment(i).diff(e,"days")},get_hour_diff:function(i,e){return moment(i).diff(e,"hours")},get_minute_diff:function(i,e){return moment(i).diff(e,"minutes")},get_day_diff:function(i,e){return moment(i).diff(e,"days")},add_days:function(i,e){return moment(i).add(e,"days").format()},add_months:function(i,e){return moment(i).add(e,"months").format()},week_start:function(){return moment().startOf("week").format()},week_end:function(){return moment().endOf("week").format()},month_start:function(){return moment().startOf("month").format()},month_end:function(){return moment().endOf("month").format()},quarter_start:function(){return moment().startOf("quarter").format()},quarter_end:function(){return moment().endOf("quarter").format()},year_start:function(){return moment().startOf("year").format()},year_end:function(){return moment().endOf("year").format()},get_user_time_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.time_format||"HH:mm:ss"},get_user_date_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.date_format||"yyyy-mm-dd"},get_user_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.date_format||"yyyy-mm-dd"},str_to_user:function(i,e=!1,t=!1){if(!i)return"";let r=frappe.datetime.get_user_date_fmt().toUpperCase(),s=frappe.datetime.get_user_time_fmt();return e?moment(i,frappe.defaultTimeFormat).format(s):t||typeof i=="string"&&i.indexOf(" ")===-1?moment(i,frappe.defaultDateFormat).format(r):moment.tz(i,frappe.defaultDatetimeFormat,frappe.boot.time_zone.system).clone().tz(frappe.boot.time_zone.user).format(r+" "+s)},get_datetime_as_string:function(i){var r,s;let e=((s=(r=frappe==null?void 0:frappe.boot)==null?void 0:r.sysdefaults)==null?void 0:s.time_format)||frappe.defaultTimeFormat,t=frappe.defaultDateFormat+" "+e;return moment(i).format(t)},user_to_str:function(i,e=!1){var t=frappe.datetime.get_user_time_fmt();if(e)return moment(i,t).format(frappe.defaultTimeFormat);var r=frappe.datetime.get_user_date_fmt().toUpperCase(),s="YYYY-MM-DD";return i.indexOf(" ")!==-1&&(r+=" "+t,s+=" HH:mm:ss"),moment(i,[r.replace("YYYY","YY"),r]).locale("en").format(s)},user_to_obj:function(i){return frappe.datetime.str_to_obj(frappe.datetime.user_to_str(i))},global_date_format:function(i){var e=moment(i);return e._f&&e._f.indexOf("HH")!==-1?e.format("Do MMMM YYYY, hh:mm A"):e.format("Do MMMM YYYY")},now_date:function(i=!1){return frappe.datetime._date(frappe.defaultDateFormat,i)},now_time:function(i=!1){return frappe.datetime._date(frappe.defaultTimeFormat,i)},now_datetime:function(i=!1){return frappe.datetime._date(frappe.defaultDatetimeFormat,i)},system_datetime:function(i=!1){return frappe.datetime._date(frappe.defaultDatetimeFormat,i,!0)},_date:function(i,e=!1,t=!1){var n,o;let r=((n=frappe.boot.time_zone)==null?void 0:n.system)||frappe.sys_defaults.time_zone;t||(r=((o=frappe.boot.time_zone)==null?void 0:o.user)||r);let s=moment.tz(r);return e?frappe.datetime.moment_to_date_obj(s):s.format(i)},moment_to_date_obj:function(i){let e=new Date,t=i.toArray();return e.setFullYear(t[0]),e.setMonth(t[1]),e.setDate(t[2]),e.setHours(t[3]),e.setMinutes(t[4]),e.setSeconds(t[5]),e.setMilliseconds(t[6]),e},nowdate:function(){return frappe.datetime.now_date()},get_today:function(){return frappe.datetime.now_date()},get_time:i=>moment(i).format("hh:mm A"),validate:function(i){return moment(i,[frappe.defaultDateFormat,frappe.defaultDatetimeFormat,frappe.defaultTimeFormat],!0).isValid()},get_first_day_of_the_week_index(){let i=frappe.sys_defaults.first_day_of_the_week||"Sunday";return moment.weekdays().indexOf(i)}});window.cstr=function(i){return i==null?"":i+""};window.cint=function(i,e){return i===!0?1:i===!1?0:(i=i+"",i!=="0"&&(i=lstrip(i,["0"])),i=parseInt(i),isNaN(i)&&(i=e===void 0?0:e),i)};window.toTitle=function(i){var e=i.split(" "),t=[];for(var r in e)t[r]=e[r].charAt(0).toUpperCase()+e[r].slice(1);return t.join(" ")};window.is_null=function(i){if(i==null||cstr(i).trim()==="")return!0};window.copy_dict=function(i){var e={};for(var t in i)e[t]=i[t];return e};window.validate_email=function(i){return frappe.utils.validate_type(i,"email")};window.validate_phone=function(i){return frappe.utils.validate_type(i,"phone")};window.validate_name=function(i){return frappe.utils.validate_type(i,"name")};window.validate_url=function(i){return frappe.utils.validate_type(i,"url")};window.nth=function(i){i=cint(i);var e="th";return(i+"").substr(-1)=="1"&&(e="st"),(i+"").substr(-1)=="2"&&(e="nd"),(i+"").substr(-1)=="3"&&(e="rd"),i+e};window.has_words=function(i,e){if(!e)return!0;if(!i)return!1;for(var t=0,r=i.length;t<r;t++)if(e.indexOf(i[t])!=-1)return!0;return!1};window.has_common=function(i,e){if(!i||!e)return!1;for(var t=0,r=i.length;t<r;t++)if(e.includes(i[t]))return!0;return!1};window.frappe||(window.frappe={});function Nn(i,e,t,r){if(i==null||i=="")return 0;if(typeof i!="number"){if(i=i+"",i.indexOf(" ")!=-1){var s=i.split(" ");i=isNaN(parseFloat(s[0]))?s.slice(s.length-1).join(" "):i}i=na(i,t),i=parseFloat(i),isNaN(i)&&(i=0)}return e!=null?Rn(i,e,r):i}function na(i,e){e||(e=as());var t=os(e),r=new RegExp(t.group_sep==="."?"\\.":t.group_sep,"g");if(i=i.replace(r,""),t.decimal_str!=="."&&t.decimal_str!==""){var s=new RegExp(t.decimal_str,"g");i=i.replace(s,".")}return i}function F0(i,e,t){t||(t=as());let r=os(t);e||(e="#,###.##");let s=os(e);if(e===t)return i;if(r.decimal_str=="")return na(i);let n=i.split(s.decimal_str),o=n[0],a=n[1]||"",l=new RegExp(s.group_sep==="."?"\\.":s.group_sep,"g");return o=o.replace(l,r.group_sep),i=o,a&&(i=i+r.decimal_str+a),i}frappe.number_format_info={"#,###.##":{decimal_str:".",group_sep:","},"#.###,##":{decimal_str:",",group_sep:"."},"# ###.##":{decimal_str:".",group_sep:" "},"# ###,##":{decimal_str:",",group_sep:" "},"#'###.##":{decimal_str:".",group_sep:"'"},"#, ###.##":{decimal_str:".",group_sep:", "},"#,##,###.##":{decimal_str:".",group_sep:","},"#,###.###":{decimal_str:".",group_sep:","},"#.###":{decimal_str:"",group_sep:"."},"#,###":{decimal_str:"",group_sep:","}};window.format_number=function(i,e,t){e||(e=as(),t==null&&(t=cint(frappe.defaults.get_default("float_precision"))||3));var r=os(e);t==null&&(t=r.precision),i=Nn(i,t,e);let s=!1;i<0&&(s=!0),i=Math.abs(i),i=i.toFixed(t);var n=i.split("."),o=r.group_sep?3:0;if(o){for(var a=n[0],l="",c=a.length%o,u=a.length;u>=0;u--){var p=replace_all(l,r.group_sep,"").length;e=="#,##,###.##"&&l.indexOf(",")!=-1&&(o=2,p+=1),l+=a.charAt(u),p&&!((p+1)%o)&&u!=0&&(l+=r.group_sep)}n[0]=l.split("").reverse().join("")}return n[0]+""==""&&(n[0]="0"),n[1]=n[1]&&r.decimal_str?r.decimal_str+n[1]:"",(s?"-":"")+n[0]+n[1]};function Vh(i,e,t){var o;let r=as(e),s=Yh(e),n=(o=frappe.model.get_value(":Currency",e,"symbol_on_right"))!=null?o:!1;return t===void 0&&(t=frappe.boot.sysdefaults.currency_precision||null),s?n?format_number(i,r,t)+" "+__(s):__(s)+" "+format_number(i,r,t):format_number(i,r,t)}function Yh(i){return frappe.boot?frappe.boot.sysdefaults&&frappe.boot.sysdefaults.hide_currency_symbol=="Yes"?null:(i||(i=frappe.boot.sysdefaults.currency),frappe.model.get_value(":Currency",i,"symbol")||i):frappe.currency_symbols[i]}function as(i){var t;let e=(t=frappe==null?void 0:frappe.boot)==null?void 0:t.sysdefaults;return cint(e==null?void 0:e.use_number_format_from_currency)&&i&&frappe.model.get_value(":Currency",i,"number_format")||e.number_format||"#,###.##"}function os(i){var e=frappe.number_format_info[i];return e||(e={decimal_str:".",group_sep:","}),e.precision=i.split(e.decimal_str).slice(1)[0].length,e}function Rn(i,e,t){t=t||frappe.boot.sysdefaults.rounding_method||"Banker's Rounding (legacy)";let r=i<0;if(t=="Banker's Rounding (legacy)"){var s=cint(e),n=Math.pow(10,s),o=+(s?Math.abs(i)*n:Math.abs(i)).toFixed(8),a=Math.floor(o),l=o-a,c=!e&&l==.5?a%2==0?a:a+1:Math.round(o);return c=s?c/n:c,r?-c:c}else if(t=="Banker's Rounding"){if(i==0)return 0;e=cint(e);let u=Math.pow(10,e);i=Math.abs(i)*u;let p=Math.floor(i),m=i-p,w=2**(Math.log2(Math.abs(i))-52);return Math.abs(m-.5)<w?i=p%2==0?p:p+1:i=Math.round(i),i=i/u,r?-i:i}else if(t=="Commercial Rounding"){if(i==0)return 0;let u=cint(e),p=Math.pow(10,u);i=i*p;let m=2**(Math.log2(Math.abs(i))-52);return r&&(m=-1*m),i=Math.round(i+m),i/p}else throw new Error(`Unknown rounding method ${t}`)}function H0(i,e){return Rn(i,e)}function q0(i,e){if(cur_frm){e||(e=cur_frm.doc);var t=frappe.meta.get_docfield(e.doctype,i,e.parent||e.name);return t||console.log(i+": could not find docfield in method precision()"),frappe.meta.get_field_precision(t,e)}else return frappe.boot.sysdefaults.float_precision}function U0(i,e){return i.includes(e)}function Gh(i,e,t){t=cint(t);var r=Math.pow(10,t);let s;return t?s=i*r%(e*r)/r:s=i%e,Nn(s,t)}function W0(i,e,t){var r=Nn(frappe.model.get_value(":Currency",e,"smallest_currency_fraction_value"));if(r){var s=Gh(i,r,t);s>r/2?i+=r-s:i-=s}else i=Rn(i);return i}function V0(i,e){return Vh(i,e)}Object.assign(window,{flt:Nn,cint,strip_number_groups:na,convert_old_to_new_number_format:F0,format_currency:Vh,fmt_money:V0,get_currency_symbol:Yh,get_number_format:as,get_number_format_info:os,_round:Rn,roundNumber:H0,precision:q0,remainder:Gh,round_based_on_smallest_currency_fraction:W0,in_list:U0});frappe.provide("frappe.help");frappe.help.youtube_id={};frappe.help.has_help=function(i){return frappe.help.youtube_id[i]};frappe.help.show=function(i){frappe.help.youtube_id[i]&&frappe.help.show_video(frappe.help.youtube_id[i])};frappe.help.show_video=function(i,e){if(frappe.utils.is_url(i)){let n='(?:youtube.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?&]v=)|youtu.be/)([^"&?\\s]{11})';i=i.match(n)[1]}let t=new frappe.ui.Dialog({title:e||__("Help"),size:"large"}),r=$(`<div class="video-player" data-plyr-provider="youtube" data-plyr-embed-id="${i}"></div>`);r.appendTo(t.body),t.show(),t.$wrapper.addClass("video-modal");let s;frappe.utils.load_video_player().then(()=>{s=new frappe.Plyr(r[0],{hideControls:!0,resetOnEnd:!0})}),t.onhide=()=>{s==null||s.destroy()}};$("body").on("click","a.help-link",function(){var i=$(this).attr("data-doctype");i&&frappe.help.show(i)});frappe.provide("frappe.help.help_links");frappe.help.help_links["data-import-tool"]=[{label:"Importing and Exporting Data",url:"https://docs.erpnext.com/docs/user/manual/en/data"}];frappe.help.help_links["modules/Setup"]=[{label:"Users and Permissions",url:"https://frappeframework.com/docs/user/en/basics/users-and-permissions"},{label:"System Settings",url:"https://docs.erpnext.com/docs/user/manual/en/system-settings"},{label:"Data Management",url:"https://docs.erpnext.com/docs/user/manual/en/data"},{label:"Email",url:"https://docs.erpnext.com/docs/user/manual/en/email"},{label:"Printing and Branding",url:"https://docs.erpnext.com/docs/user/manual/en/print"}];frappe.help.help_links["List/User"]=[{label:"Adding Users",url:"https://docs.erpnext.com/docs/user/manual/en/adding-users"},{label:"Rename User",url:"https://docs.erpnext.com/docs/user/manual/en/renaming-documents"}];frappe.help.help_links["permission-manager"]=[{label:"Role Permissions Manager",url:"https://frappeframework.com/docs/user/en/basics/users-and-permissions#role-permissions-manager"}];frappe.help.help_links["user-permissions"]=[{label:"User Permissions",url:"https://frappeframework.com/docs/user/en/basics/users-and-permissions#user-permissions"}];frappe.help.help_links["Form/System Settings"]=[{label:"System Settings",url:"https://docs.erpnext.com/docs/user/manual/en/system-settings"}];frappe.help.help_links["List/Email Account"]=[{label:"Email Account",url:"https://docs.erpnext.com/docs/user/manual/en/email-account"}];frappe.help.help_links["List/Notification"]=[{label:"Notification",url:"https://docs.erpnext.com/docs/user/manual/en/notifications"}];frappe.help.help_links["Form/Print Settings"]=[{label:"Print Settings",url:"https://docs.erpnext.com/docs/user/manual/en/print-settings"}];frappe.help.help_links["print-format-builder"]=[{label:"Print Format Builder",url:"https://docs.erpnext.com/docs/user/manual/en/print-format-builder"}];frappe.provide("frappe.contacts");$.extend(frappe.contacts,{clear_address_and_contact:function(i){$(i.fields_dict.address_html.wrapper).html(""),i.fields_dict.contact_html&&$(i.fields_dict.contact_html.wrapper).html("")},render_address_and_contact:function(i){i.fields_dict.address_html&&"addr_list"in i.doc.__onload&&$(i.fields_dict.address_html.wrapper).html(frappe.render_template("address_list",i.doc.__onload)).find(".btn-address").on("click",()=>Kh("Address",i)),i.fields_dict.contact_html&&"contact_list"in i.doc.__onload&&$(i.fields_dict.contact_html.wrapper).html(frappe.render_template("contact_list",i.doc.__onload)).find(".btn-contact").on("click",()=>Kh("Contact",i))},get_last_doc:function(i){let t=frappe.route_history.slice().reverse().find(n=>n[0]==="Form"&&n[1]!==i.doctype),r=t&&t[1],s=t&&t[2];return t&&t.length>3&&(s=t.slice(2).join("/")),{doctype:r,docname:s}},get_address_display:function(i,e,t){if(i.updating_party_details)return;let r=e||"address",s=t||"address_display";if(!i.doc[r]){i.set_value(s,"");return}frappe.xcall("frappe.contacts.doctype.address.address.get_address_display",{address_dict:i.doc[r]}).then(n=>i.set_value(s,n))}});function Kh(i,e){frappe.dynamic_link={doctype:e.doc.doctype,doc:e.doc,fieldname:"name"},frappe.boot.enable_address_autocompletion===1&&i==="Address"?new frappe.ui.AddressAutocompleteDialog({title:__("New Address"),link_doctype:e.doc.doctype,link_name:e.doc.name,after_insert:function(t){e.reload_doc()}}).show():frappe.new_doc(i)}frappe.preview_email=function(i,e,t,r=!1,s=!1){return frappe.call({method:"frappe.email.email_body.get_email_html",args:{subject:"Test",template:i,args:e,header:t,with_container:r}}).then(n=>{var o=n.message;if(o=o.replace(/embed=/,"src="),s)return o;var a=frappe.msgprint({message:'<iframe width="100%" height="600px" style="border: none;"></iframe>',wide:!0});setTimeout(()=>{a.$wrapper.find("iframe").contents().find("html").html(o),a.$wrapper.find(".modal-dialog").css("width","70%")},1e3)})};frappe.provide("frappe.file_manager");frappe.file_manager=function(){let i=[],e=null,t=null;function r(o,a){i=o,e=a}function s(o){return new Promise((a,l)=>{if(i.length===0||!e){n(),a();return}t=o,frappe.call({method:"frappe.core.api.file.move_file",args:{file_list:i,new_parent:t,old_parent:e},callback:c=>{n(),a(c)}}).fail(l)})}function n(){i=[],e=null,t=null}return{cut:r,paste:s,get can_paste(){return Boolean(i.length>0&&e)},get old_folder(){return e},get files_to_move(){return i}}}();frappe.provide("frappe.ui");frappe.ui.DiffView=class{constructor(e,t,r){this.dialog=null,this.handler=null,this.doctype=e,this.fieldname=t,this.docname=r,this.dialog=this.make_dialog(),this.set_empty_state(),this.dialog.show()}make_dialog(){let e=()=>({query:"frappe.utils.diff.version_query",filters:{docname:this.docname,ref_doctype:this.doctype,fieldname:this.fieldname,page_len:100}}),t=()=>this.compute_diff();return new frappe.ui.Dialog({title:__("Compare Versions"),fields:[{label:__("From version"),fieldtype:"Link",fieldname:"from_version",options:"Version",reqd:1,get_query:e,onchange:t},{fieldtype:"Column Break",fieldname:"cb"},{label:__("To version"),fieldtype:"Link",fieldname:"to_version",options:"Version",reqd:1,get_query:e,onchange:t},{fieldtype:"Section Break",fieldname:"sb"},{label:__("Diff"),fieldtype:"HTML",fieldname:"diff"}],size:"extra-large"})}compute_diff(){let e=this.dialog.get_value("from_version"),t=this.dialog.get_value("to_version"),r=this.fieldname;e&&t?frappe.xcall("frappe.utils.diff.get_version_diff",{from_version:e,to_version:t,fieldname:r}).then(s=>{this.dialog.set_value("diff",this.prettify_diff(s))}):this.set_empty_state()}prettify_diff(e){let t="";return e.forEach(r=>{let s="";r.startsWith("+")?s="insert":r.startsWith("-")&&(s="delete"),t+=`<div class="${s} text-wrap">${r}</div>`}),`<div class='diffview'>${t}</div>`}set_empty_state(){this.dialog.set_value("diff",__("Select two versions to view the diff."))}};frappe.provide("frappe.utils.datatable");frappe.utils.datatable.get_translations=function(){let i={};return i[frappe.boot.lang]={"Sort Ascending":__("Sort Ascending"),"Sort Descending":__("Sort Descending"),"Reset sorting":__("Reset sorting"),"Remove column":__("Remove column"),"No Data":__("No Data"),"{count} cells copied":{1:__("{count} cell copied"),default:__("{count} cells copied")},"{count} rows selected":{1:__("{count} row selected"),default:__("{count} rows selected")}},i};frappe.require?frappe.require("file_uploader.bundle.js"):frappe.ready(function(){frappe.require("file_uploader.bundle.js")});frappe.provide("frappe.ui");frappe.ui.Tree=class{constructor({parent:i,label:e,root_value:t,icon_set:r,toolbar:s,expandable:n,with_skeleton:o=1,args:a,method:l,get_label:c,on_render:u,on_click:p}){$.extend(this,arguments[0]),t==null&&(this.root_value=e),this.setup_treenode_class(),this.nodes={},this.wrapper=$('<div class="tree">').appendTo(this.parent),o&&this.wrapper.addClass("with-skeleton"),r||(this.icon_set={open:frappe.utils.icon("folder-open","md"),closed:frappe.utils.icon("folder-normal","md"),leaf:frappe.utils.icon("primitive-dot","xs")}),this.setup_root_node()}get_nodes(i,e){var t=Object.assign({},this.args);return t.parent=i,t.is_root=e,new Promise(r=>{frappe.call({method:this.method,args:t,callback:s=>{this.on_get_node&&this.on_get_node(s.message),r(s.message)}})})}get_all_nodes(i,e,t){var r=Object.assign({},this.args);return r.label=t||i,r.parent=i,r.is_root=e,r.tree_method=this.method,new Promise(s=>{frappe.call({method:"frappe.desk.treeview.get_all_nodes",args:r,callback:n=>{this.on_get_node&&this.on_get_node(n.message,!0),s(n.message)}})})}setup_treenode_class(){let i=this;this.TreeNode=class{constructor({parent:e,label:t,parent_label:r,expandable:s,is_root:n,data:o}){$.extend(this,arguments[0]),this.loaded=0,this.expanded=0,this.parent_label&&(this.parent_node=i.nodes[this.parent_label]),i.nodes[this.label]=this,i.make_node_element(this),i.on_render&&i.on_render(this)}}}setup_root_node(){this.root_node=new this.TreeNode({parent:this.wrapper,label:this.label,parent_label:null,expandable:!0,is_root:!0,data:{value:this.root_value}}),this.expand_node(this.root_node,!1)}refresh(){this.selected_node.parent_node&&this.load_children(this.selected_node.parent_node,!0)}make_node_element(i){i.$tree_link=$('<span class="tree-link">').attr("data-label",i.label).data("node",i).appendTo(i.parent),i.$ul=$('<ul class="tree-children">').hide().appendTo(i.parent),this.make_icon_and_label(i),this.toolbar&&(i.$toolbar=this.get_toolbar(i).insertAfter(i.$tree_link))}add_node(i,e){var t=$('<li class="tree-node">');return new this.TreeNode({parent:t.appendTo(i.$ul),parent_label:i.label,label:e.value,title:e.title,expandable:e.expandable,data:e})}reload_node(i){return this.load_children(i)}toggle(){this.get_selected_node().toggle()}get_selected_node(){return this.selected_node}set_selected_node(i){this.selected_node=i}load_children(i,e=!1){let t=i.data.value,r=i.is_root;return e?frappe.run_serially([()=>this.get_all_nodes(t,r,i.label),s=>this.render_children_of_all_nodes(s),()=>this.set_selected_node(i)]):frappe.run_serially([()=>this.get_nodes(t,r),s=>this.render_node_children(i,s),()=>this.set_selected_node(i)])}render_children_of_all_nodes(i){i.map(e=>this.render_node_children(this.nodes[e.parent],e.data))}render_node_children(i,e){i.$ul.empty(),e&&$.each(e,(t,r)=>{var s=this.add_node(i,r);s.$tree_link.data("node-data",r).data("node",s)}),i.expanded=!1,i.loaded=!0,this.expand_node(i)}on_node_click(i){this.expand_node(i),frappe.dom.activate(this.wrapper,i.$tree_link,"tree-link"),i.$toolbar&&this.show_toolbar(i)}expand_node(i,e=!0){this.set_selected_node(i),e&&this.on_click&&this.on_click(i),i.expandable&&this.toggle_node(i),this.select_link(i),i.expanded=!i.expanded,i.parent.toggleClass("opened",i.expanded)}toggle_node(i){if(i.expandable&&this.get_nodes&&!i.loaded)return this.load_children(i);i.$ul&&(i.$ul.children().length&&i.$ul.toggle(!i.expanded),this.icon_set&&(i.expanded?i.$tree_link.find(".icon").parent().addClass("node-parent").html(this.icon_set.closed):i.$tree_link.find(".icon").parent().html(this.icon_set.open)))}select_link(i){this.wrapper.find(".selected").removeClass("selected"),i.$tree_link.toggleClass("selected")}show_toolbar(i){this.cur_toolbar&&$(this.cur_toolbar).hide(),this.cur_toolbar=i.$toolbar,i.$toolbar.show()}get_node_label(i){return this.get_label?this.get_label(i):i.title&&i.title!=i.label?__(i.title)+` <span class='text-muted'>(${i.label})</span>`:__(i.title||i.label)}make_icon_and_label(i){let e="";this.icon_set&&(i.expandable?e=`<span class="node-parent">${this.icon_set.closed}</span>`:e=`<span>${this.icon_set.leaf}</span>`),$(e).appendTo(i.$tree_link),$(`<a class="tree-label" data-doctype="${this.args.doctype}" data-name="${i.label}"> ${this.get_node_label(i)}</a>`).appendTo(i.$tree_link),i.$tree_link.on("click",()=>{setTimeout(()=>{this.on_node_click(i)},100)}),i.$tree_link.hover(function(){$(this).parent().addClass("hover-active")},function(){$(this).parent().removeClass("hover-active")})}get_toolbar(i){let e=$('<span class="tree-node-toolbar btn-group"></span>').hide();return Object.keys(this.toolbar).map(t=>{let r=this.toolbar[t];if(!!r.label&&!(r.condition&&!r.condition(i))){var s=r.get_label?r.get_label():r.label,n=$("<button class='btn btn-default btn-xs'></button>").html(s).addClass("tree-toolbar-button "+(r.btnClass||"")).appendTo(e);n.on("click",()=>{r.click(i)})}}),e}};frappe.provide("frappe.pages");frappe.provide("frappe.views");window.cur_page=null;frappe.views.Container=class{constructor(){this.container=$("#body").get(0),this.page=null,this.pagewidth=$(this.container).width(),this.pagemargin=50;var e=this;$(document).on("page-change",function(){var t=frappe.get_route_str();$("body").attr("data-route",t),$("body").attr("data-sidebar",e.has_sidebar()?1:0)}),$(document).bind("rename",function(t,r,s,n){frappe.breadcrumbs.rename(r,s,n)})}add_page(e){var t=$('<div class="content page-container"></div>').attr("id","page-"+e).attr("data-page-route",e).hide().appendTo(this.container).get(0);return t.label=e,frappe.pages[e]=t,t}change_to(e){cur_page=this;let t;if(e.tagName?t=e:t=frappe.pages[e],!t){console.log(__("Page not found")+": "+e);return}return window.cur_dialog&&cur_dialog.display&&!cur_dialog.keep_open&&(cur_dialog.minimizable?cur_dialog.is_minimized||cur_dialog.toggle_minimize():cur_dialog.hide()),this.page&&this.page!=t&&($(this.page).hide(),$(this.page).trigger("hide")),(!this.page||this.page!=t)&&(this.page=t,$(this.page).show()),$(document).trigger("page-change"),this.page._route=frappe.router.get_sub_path(),$(this.page).trigger("show"),!this.page.disable_scroll_to_top&&frappe.utils.scroll_to(0),frappe.breadcrumbs.update(),this.page}has_sidebar(){var e=0,t=frappe.get_route_str();if(e=frappe.ui.pages[t]&&!frappe.ui.pages[t].single_column,!e){var r=t.split("/").slice(0,2).join("/");e=$(`.page-container[data-page-route="${r}"] .layout-side-section`).length?1:0}return e}};frappe.breadcrumbs={all:{},preferred:{File:"",Dashboard:"Customization","Dashboard Chart":"Customization","Dashboard Chart Source":"Customization"},module_map:{Core:"Settings",Email:"Settings",Custom:"Settings",Workflow:"Settings",Printing:"Settings",Setup:"Settings",Automation:"Tools"},set_doctype_module(i,e){localStorage["preferred_breadcrumbs:"+i]=e},get_doctype_module(i){return localStorage["preferred_breadcrumbs:"+i]},add(i,e,t){let r;typeof i=="object"?r=i:r={module:i,doctype:e,type:t},this.all[frappe.breadcrumbs.current_page()]=r,this.update(),frappe.app.sidebar.set_active_workspace_item()},current_page(){return frappe.get_route_str()},update(){var e,t;var i=this.all[frappe.breadcrumbs.current_page()];if(this.clear(),!i)return this.toggle(!1);if(i.type==="Custom")this.set_custom_breadcrumbs(i);else{this.set_workspace_breadcrumb(i);let r=frappe.get_route()[0];r=r?r.toLowerCase():null,i.doctype&&["print","form"].includes(r)?(this.set_list_breadcrumb(i),this.set_form_breadcrumb(i,r)):i.doctype&&r==="list"||i.doctype&&r=="dashboard-view"&&this.set_list_breadcrumb(i)}if(i.workspace&&((e=frappe.workspace_map[i.workspace])==null?void 0:e.app)&&((t=frappe.workspace_map[i.workspace])==null?void 0:t.app)!=frappe.current_app){let r=frappe.workspace_map[i.workspace].app;frappe.app.sidebar.apps_switcher.set_current_app(r)}this.toggle(!0)},set_custom_breadcrumbs(i){this.append_breadcrumb_element(i.route,i.label)},append_breadcrumb_element(i,e){let t=document.createElement("li"),r=document.createElement("a");r.href=i,r.innerText=e,t.appendChild(r),this.$breadcrumbs.append(t)},get last_route(){return frappe.route_history.slice(-2)[0]},set_workspace_breadcrumb(i){i.workspace||this.set_workspace(i),i.workspace&&(i.module_info&&(i.module_info.blocked||!frappe.visible_modules.includes(i.module_info.module))||this.append_breadcrumb_element(`/app/${frappe.router.slug(i.workspace)}`,__(i.workspace)))},set_workspace(i){var t,r,s;this.setup_modules();var e=this.get_doctype_module(i.doctype);if(e?i.module=e:this.preferred[i.doctype]!==void 0&&(i.module=this.preferred[i.doctype]),((t=this.last_route)==null?void 0:t[0])=="Workspaces"){let n=this.last_route[1];i.module&&((r=frappe.boot.module_wise_workspaces[i.module])==null?void 0:r.includes(n))&&(i.workspace=n)}else{let n=frappe.get_meta(i.doctype);(s=n==null?void 0:n.__workspaces)!=null&&s.length&&(i.workspace=n.__workspaces[0]),i.module&&(this.module_map[i.module]&&(i.module=this.module_map[i.module]),i.module_info=frappe.get_module(i.module),i.module_info&&frappe.boot.module_wise_workspaces[i.module]&&(i.workspace=frappe.boot.module_wise_workspaces[i.module][0]))}},set_list_breadcrumb(i){let e=i.doctype,t=frappe.get_meta(e);if(!(e==="User"&&!frappe.user.has_role("System Manager")||(t==null?void 0:t.issingle))){let r,s=frappe.router.slug(frappe.router.doctype_layout||e);if(t!=null&&t.is_tree){let n=frappe.model.user_settings[e].last_view||"Tree";r=`${s}/view/${n}`}else r=s;this.append_breadcrumb_element(`/app/${r}`,__(e))}},set_form_breadcrumb(i,e){let t=i.doctype,r=frappe.get_route().slice(2).join("/"),s=frappe.get_doc(t,r);if(s.__islocal||frappe.model.get_doc_title(s)==s.name)return;let o=`/app/${frappe.router.slug(t)}/${encodeURIComponent(r)}`;if(this.append_breadcrumb_element(o,s.name),e==="form"){let a=this.$breadcrumbs.find("li").last();a.addClass("disabled"),a.css("cursor","copy"),a.click(l=>{l.stopImmediatePropagation(),frappe.utils.copy_to_clipboard(a.text())})}},set_dashboard_breadcrumb(i){let e=i.doctype,t=frappe.get_route()[1],r=`/app/${frappe.router.slug(e)}/${t}`;$(`<li><a href="${r}">${__(t)}</a></li>`).appendTo(this.$breadcrumbs)},setup_modules(){frappe.visible_modules||(frappe.visible_modules=$.map(frappe.boot.allowed_workspaces,i=>i.module))},rename(i,e,t){var r=["Form",i,e].join("/"),s=["Form",i,t].join("/");this.all[s]=this.all[r],delete frappe.breadcrumbs.all[r],this.update()},clear(){this.$breadcrumbs=$("#navbar-breadcrumbs").empty()},toggle(i){i?$("body").addClass("no-breadcrumbs"):$("body").removeClass("no-breadcrumbs")}};frappe.provide("frappe.pages");frappe.provide("frappe.views");frappe.views.Factory=class{constructor(e){$.extend(this,e)}show(){this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),!(this.before_show&&this.before_show()===!1)&&(frappe.pages[this.page_name]?(frappe.container.change_to(this.page_name),this.on_show&&this.on_show()):this.route[1]?this.make(this.route):frappe.show_not_found(this.route))}make_page(e,t,r){return frappe.make_page(e,t,r)}};frappe.make_page=function(i,e,t){e||(e=frappe.get_route_str());let r=frappe.container.add_page(e);return frappe.ui.make_app_page({parent:r,single_column:!i,sidebar_position:t,disable_sidebar_toggle:!t}),frappe.container.change_to(e),r};frappe.provide("frappe.views.pageview");frappe.provide("frappe.standard_pages");frappe.views.pageview={with_page:function(i,e){if(frappe.standard_pages[i]){frappe.pages[i]||frappe.standard_pages[i](),e();return}if(locals.Page&&locals.Page[i]&&locals.Page[i].script||i==window.page_name)e();else if(localStorage["_page:"+i]&&frappe.boot.developer_mode!=1)frappe.model.sync(JSON.parse(localStorage["_page:"+i])),e();else if(i)return frappe.call({method:"frappe.desk.desk_page.getpage",args:{name:i},callback:function(t){if(!t.docs._dynamic_page)try{localStorage["_page:"+i]=JSON.stringify(t.docs)}catch(r){console.warn(r)}e()},freeze:!0})},show:function(i){i||(i=frappe.boot?frappe.boot.home_page:window.page_name),frappe.model.with_doctype("Page",function(){frappe.views.pageview.with_page(i,function(e){e&&e.exc?e[403]||frappe.show_not_found(i):frappe.pages[i]||new frappe.views.Page(i),frappe.container.change_to(i)})})}};frappe.views.Page=class{constructor(e){this.name=e;var t=this;if(e==window.page_name)this.wrapper=document.getElementById("page-"+e),this.wrapper.label=document.title||window.page_name,this.wrapper.page_name=window.page_name,frappe.pages[window.page_name]=this.wrapper;else{if(this.pagedoc=locals.Page[this.name],!this.pagedoc){frappe.show_not_found(e);return}this.wrapper=frappe.container.add_page(this.name),this.wrapper.page_name=this.pagedoc.name,this.pagedoc.content&&(this.wrapper.innerHTML=this.pagedoc.content),frappe.dom.eval(this.pagedoc.__script||this.pagedoc.script||""),frappe.dom.set_style(this.pagedoc.style||""),frappe.breadcrumbs.add(this.pagedoc.module||null)}this.trigger_page_event("on_page_load"),$(this.wrapper).on("show",function(){window.cur_frm=null,t.trigger_page_event("on_page_show"),t.trigger_page_event("refresh")})}trigger_page_event(e){var t=this;t.wrapper[e]&&t.wrapper[e](t.wrapper)}};frappe.show_not_found=function(i){frappe.show_message_page({page_name:i,message:__("Sorry! I could not find what you were looking for."),img:"/assets/frappe/images/ui/bubble-tea-sorry.svg"})};frappe.show_not_permitted=function(i){frappe.show_message_page({page_name:i,message:__("Sorry! You are not permitted to view this page."),img:"/assets/frappe/images/ui/bubble-tea-sorry.svg"})};frappe.show_message_page=function(i){i.page_name||(i.page_name=frappe.get_route_str()),i.icon?i.img=repl('<span class="%(icon)s message-page-icon"></span> ',i):i.img&&(i.img=repl('<img src="%(img)s" class="message-page-image">',i));var e=frappe.pages[i.page_name]||frappe.container.add_page(i.page_name);$(e).html(repl('<div class="page message-page">			<div class="text-center message-page-content">				%(img)s				<p class="lead">%(message)s</p>				<a class="btn btn-default btn-sm btn-home" href="/app">%(home)s</a>			</div>		</div>',{img:i.img||"",message:i.message||"",home:__("Home")})),frappe.container.change_to(i.page_name)};var LL=Ut(Xh());frappe.provide("frappe.search");frappe.ui.Notifications=class{constructor(){this.tabs={},this.notification_settings=frappe.boot.notification_settings,this.make()}make(){this.dropdown=$(".navbar").find(".dropdown-notifications").removeClass("hidden"),this.dropdown_list=this.dropdown.find(".notifications-list"),this.header_items=this.dropdown_list.find(".header-items"),this.header_actions=this.dropdown_list.find(".header-actions"),this.body=this.dropdown_list.find(".notification-list-body"),this.panel_events=this.dropdown_list.find(".panel-events"),this.panel_notifications=this.dropdown_list.find(".panel-notifications"),this.panel_changelog_feed=this.dropdown_list.find(".panel-changelog-feed"),this.user=frappe.session.user,this.setup_headers(),this.setup_dropdown_events()}setup_headers(){$(`<span class="notification-settings pull-right" data-action="go_to_settings">
			${frappe.utils.icon("setting-gear")}
		</span>`).on("click",r=>{r.stopImmediatePropagation(),this.dropdown.dropdown("hide"),frappe.set_route("Form","Notification Settings",frappe.session.user)}).appendTo(this.header_actions).attr("title",__("Notification Settings")).tooltip({delay:{show:600,hide:100},trigger:"hover"}),$(`<span class="mark-all-read pull-right" data-action="mark_all_as_read">
			${frappe.utils.icon("mark-as-read")}
		</span>`).on("click",r=>this.mark_all_as_read(r)).appendTo(this.header_actions).attr("title",__("Mark all as read")).tooltip({delay:{show:600,hide:100},trigger:"hover"}),this.categories=[{label:__("Notifications"),id:"notifications",view:oa,el:this.panel_notifications},{label:__("Events"),id:"todays_events",view:aa,el:this.panel_events},{label:__("What's New"),id:"changelog_feed",view:la,el:this.panel_changelog_feed}];let e=r=>`<li class="notifications-category ${r.id=="notifications"?"active":""}"
   					id="${r.id}"
   					data-toggle="collapse"
   				>${r.label}</li>`,t=$('<ul class="notification-item-tabs nav nav-tabs" role="tablist"></ul>');this.categories=this.categories.map(r=>(r.$tab=$(e(r)),r.$tab.on("click",s=>{s.stopImmediatePropagation(),this.switch_tab(r)}),t.append(r.$tab),r)),t.appendTo(this.header_items),this.categories.forEach(r=>{this.make_tab_view(r)}),this.switch_tab(this.categories[0])}switch_tab(e){this.categories.forEach(t=>{t.$tab.removeClass("active")}),e.$tab.addClass("active"),Object.keys(this.tabs).forEach(t=>this.tabs[t].hide()),this.tabs[e.id].show()}make_tab_view(e){let t=new e.view(e.el,this.dropdown,this.notification_settings);this.tabs[e.id]=t}mark_all_as_read(e){e.stopImmediatePropagation(),this.dropdown_list.find(".unread").removeClass("unread"),frappe.call("frappe.desk.doctype.notification_log.notification_log.mark_all_as_read")}setup_dropdown_events(){this.dropdown.on("hide.bs.dropdown",e=>{let t=$(e.currentTarget).data("closable");return $(e.currentTarget).data("closable",!0),t}),this.dropdown.on("click",e=>{$(e.currentTarget).data("closable",!0)})}};frappe.ui.notifications={get_notification_config(){return frappe.xcall("frappe.desk.notifications.get_notification_info").then(i=>(frappe.ui.notifications.config=i,i))},show_open_count_list(i){frappe.ui.notifications.config?this.route_to_list_with_filters(i):this.get_notification_config().then(()=>{this.route_to_list_with_filters(i)})},route_to_list_with_filters(i){let e=frappe.ui.notifications.config.conditions[i];e&&$.isPlainObject(e)&&(frappe.route_options||(frappe.route_options={}),$.extend(frappe.route_options,e)),frappe.set_route("List",i)}};var ls=class{constructor(e,t,r){this.wrapper=e,this.parent=t,this.settings=r,this.max_length=20,this.container=$("<div></div>").appendTo(this.wrapper),this.make()}show(){this.container.show()}hide(){this.container.hide()}},oa=class extends ls{make(){this.notifications_icon=this.parent.find(".notifications-icon"),this.notifications_icon.attr("title",__("Notifications")).tooltip({delay:{show:600,hide:100},trigger:"hover"}),this.setup_notification_listeners(),this.get_notifications_list(this.max_length).then(e=>{!e.message||(this.dropdown_items=e.message.notification_logs,frappe.update_user_info(e.message.user_info),this.render_notifications_dropdown(),this.settings.seen==0&&this.dropdown_items.length>0&&this.toggle_notification_icon(!1))})}update_dropdown(){this.get_notifications_list(1).then(e=>{if(!e.message)return;let t=e.message.notification_logs[0];frappe.update_user_info(e.message.user_info),this.dropdown_items.unshift(t),this.dropdown_items.length>this.max_length&&(this.container.find(".recent-notification").last().remove(),this.dropdown_items.pop()),this.insert_into_dropdown()})}change_activity_status(){this.container.find(".activity-status")&&this.container.find(".activity-status").replaceWith(`<a class="recent-item text-center text-muted"
					href="/app/List/Notification Log">
					<div class="full-log-btn">${__("View Full Log")}</div>
				</a>`)}mark_as_read(e,t){frappe.call("frappe.desk.doctype.notification_log.notification_log.mark_as_read",{docname:e}).then(()=>{t.removeClass("unread")})}insert_into_dropdown(){let e=this.dropdown_items[0],t=this.get_dropdown_item_html(e);$(t).prependTo(this.container),this.change_activity_status()}get_dropdown_item_html(e){let t=this.get_item_link(e),r=e.read?"":"unread",s=e.subject,n=s.match(/<b class="subject-title">(.*?)<\/b>/);s=n?s.replace(n[1],frappe.ellipsis(strip_html(n[1]),100)):s;let o=frappe.datetime.comment_when(e.creation),a=`<div class="message">
			<div>${s}</div>
			<div class="notification-timestamp text-muted">
				${o}
			</div>
		</div>`,l=e.from_user,c=frappe.avatar(l,"avatar-medium user-avatar"),u=$(`<a class="recent-item notification-item ${r}"
				href="${t}"
				data-name="${e.name}"
			>
				<div class="notification-body">
					${c}
					${a}
				</div>
				<div class="mark-as-read" title="${__("Mark as Read")}">
				</div>
			</a>`);if(!e.read){let p=u.find(".mark-as-read");p.tooltip({delay:{show:600,hide:100},trigger:"hover"}),p.on("click",m=>{m.preventDefault(),m.stopImmediatePropagation(),this.mark_as_read(e.name,u)})}return u.on("click",()=>{!e.read&&this.mark_as_read(e.name,u),this.notifications_icon.trigger("click")}),u}render_notifications_dropdown(){this.settings&&!this.settings.enabled?this.container.html(`<li class="recent-item notification-item">
				<span class="text-muted">
					${__("Notifications Disabled")}
				</span></li>`):this.dropdown_items.length?(this.container.empty(),this.dropdown_items.forEach(e=>{this.container.append(this.get_dropdown_item_html(e))}),this.container.append(`<a class="list-footer"
					href="/app/List/Notification Log">
						<div class="full-log-btn">${__("See all Activity")}</div>
					</a>`)):this.container.append($(`<div class="notification-null-state">
					<div class="text-center">
						<img src="/assets/frappe/images/ui-states/notification-empty-state.svg" alt="Generic Empty State" class="null-state">
						<div class="title">${__("No New notifications")}</div>
						<div class="subtitle">
							${__("Looks like you haven\u2019t received any notifications.")}
					</div></div></div>`))}get_notifications_list(e){return frappe.call({method:"frappe.desk.doctype.notification_log.notification_log.get_notification_logs",args:{limit:e},type:"GET",cache:!0})}get_item_link(e){if(e.link)return e.link;let t=e.document_type?e.document_type:"Notification Log",r=e.document_name?e.document_name:e.name;return frappe.utils.get_form_link(t,r)}toggle_notification_icon(e){this.notifications_icon.find(".notifications-seen").toggle(e),this.notifications_icon.find(".notifications-unseen").toggle(!e)}toggle_seen(e){frappe.call("frappe.desk.doctype.notification_settings.notification_settings.set_seen_value",{value:cint(e),user:frappe.session.user})}setup_notification_listeners(){frappe.realtime.on("notification",()=>{this.toggle_notification_icon(!1),this.update_dropdown()}),frappe.realtime.on("indicator_hide",()=>{this.toggle_notification_icon(!0)}),this.parent.on("show.bs.dropdown",()=>{this.toggle_seen(!0),this.notifications_icon.find(".notifications-unseen").is(":visible")&&(this.toggle_notification_icon(!0),frappe.call("frappe.desk.doctype.notification_log.notification_log.trigger_indicator_hide"))})}},aa=class extends ls{make(){let e=frappe.datetime.get_today();frappe.xcall("frappe.desk.doctype.event.event.get_events",{start:e,end:e},"GET",{cache:!0}).then(t=>{this.render_events_html(t)})}render_events_html(e){let t="";if(e.length){let r=s=>{let n=__("All Day");if(!s.all_day){let l=frappe.datetime.get_time(s.starts_on),c=frappe.datetime.get_day_diff(s.ends_on,s.starts_on),u=frappe.datetime.get_time(s.ends_on);c>1&&(u=__("Rest of the day")),n=`${l} - ${u}`}let o="";s.particpants&&(o=frappe.avatar_group(s.particpants,3));let a="";return s.location&&(a=`, ${s.location}`),`<a class="recent-item event" href="/app/event/${s.name}">
					<div class="event-border" style="border-color: ${s.color}"></div>
					<div class="event-item">
						<div class="event-subject">${s.subject}</div>
						<div class="event-time">${n}${a}</div>
						${o}
					</div>
				</a>`};t=e.map(r).join("")}else t=`
				<div class="notification-null-state">
					<div class="text-center">
					<img src="/assets/frappe/images/ui-states/event-empty-state.svg" alt="Generic Empty State" class="null-state">
					<div class="title">${__("No Upcoming Events")}</div>
					<div class="subtitle">
						${__("There are no upcoming events for you.")}
				</div></div></div>
			`;this.container.html(t)}},la=class extends ls{make(){this.render_changelog_feed_html(frappe.boot.changelog_feed||[])}render_changelog_feed_html(e){let t="";if(e.length){this.container.empty();let r=s=>{let n=frappe.datetime.prettyDate(s.posting_timestamp),o=`<div class="message">
							<div>${s.title}</div>
							<div class="notification-timestamp text-muted">
							${s.app_title} | ${n}
							</div>
						</div>`;return`<a class="recent-item notification-item"
								href="${s.link}"
								data-name="${s.title}"
								target="_blank" rel="noopener noreferrer"
							>
							<div class="notification-body">
								${o}
							</div>
							</div>
						</a>`};t=e.map(r).join("")}else t=`<div class="notification-null-state">
						<div class="text-center">
							<img src="/assets/frappe/images/ui-states/notification-empty-state.svg" alt="Generic Empty State" class="null-state">
							<div class="title">${__("Nothing New")}</div>
							<div class="subtitle">
								${__("There is nothing new to show you right now.")}
							</div>
						</div>
					</div>
					`;this.container.html(t)}};frappe.provide("frappe.search");frappe.search.SearchDialog=class{constructor(i){$.extend(this,i),this.make()}make(){this.search_dialog=new frappe.ui.Dialog({minimizable:!0,size:"large"}),this.set_header(),this.$wrapper=$(this.search_dialog.$wrapper).addClass("search-dialog"),this.$body=$(this.search_dialog.body),this.$input=this.$wrapper.find(".search-input"),this.setup()}set_header(){this.search_dialog.header.addClass("search-header").find(".title-section").html(`<div class="input-group text-muted">
					<input type="text" class="form-control search-input">
				</div>
				<span class="search-icon">
					${frappe.utils.icon("search")}
				</span>`)}setup(){this.modal_state=0,this.current_keyword="",this.more_count=20,this.full_lists={},this.nav_lists={},this.init_search_objects(),this.bind_input(),this.bind_events()}init_search_objects(){this.searches={global_search:{input_placeholder:__("Search"),empty_state_text:__("Search for anything"),no_results_status:()=>__("No Results found"),get_results:(i,e)=>{let t=0,r=100,s=frappe.search.utils.get_nav_results(i);frappe.search.utils.get_global_results(i,t,r).then(n=>{s=s.concat(n),e(s,i)},n=>{console.error(n)})}},tags:{input_placeholder:__("Search"),empty_state_text:__("Search for anything"),no_results_status:i=>"<div>"+__("No documents found tagged with {0}",[i])+"</div>",get_results:(i,e)=>{var t=frappe.search.utils.get_nav_results(i);frappe.tags.utils.get_tag_results(i).then(r=>{t=t.concat(r),e(t,i)},r=>{console.error(r)})}}}}update(i){this.$wrapper.find(".loading-state").addClass("hide"),this.$body.append(i),this.$body.find(".search-results").length>1?(this.$body.find(".search-results").first().addClass("hide"),i.removeClass("hide"),this.$body.find(".search-results").first().remove()):i.removeClass("hide")}put_placeholder(i){var e=$(`<div class="row search-results hide">
			<div class="empty-state">
				<div class="text-center">
					<img src="/assets/frappe/images/ui-states/search-empty-state.svg"
						alt="Generic Empty State"
						class="null-state"
					>
					<div class="empty-state-text">${i}</div>
				</div>
			</div>
		</div>`);this.update(e)}bind_input(){this.$input.on("input",i=>{let e=$(i.currentTarget);clearTimeout(e.data("timeout")),e.data("timeout",setTimeout(()=>{if(this.$input.val()===this.current_keyword)return;let t=this.$input.val();t.length>1?this.get_results(t):(this.current_keyword="",this.put_placeholder(this.search.empty_state_text))},300))})}bind_events(){this.$body.on("click",".list-link",i=>{let e=$(i.currentTarget);this.$body.find(".search-sidebar").find(".list-link").removeClass("active selected"),e.addClass("active selected");let t=e.attr("data-category");this.$body.find(".results-area").empty().html(this.full_lists[t]),this.$body.find(".module-section-link").first().focus()}),this.$body.on("click",".section-more",i=>{let t=$(i.currentTarget).attr("data-category");this.$body.find(".search-sidebar").find('*[data-category="'+t+'"]').trigger("click")}),this.$body.on("click",".all-results-link",()=>{this.$body.find(".search-sidebar").find('*[data-category="All Results"]').trigger("click")}),this.$body.on("click",".list-more",i=>{let e=$(i.currentTarget),t=e.attr("data-category"),r=e.attr("data-search");var s=this.$body.find(".result").length;if(r==="Global")frappe.search.utils.get_global_results(this.current_keyword,s,this.more_count,t).then(n=>{n.length&&this.add_more_results(n)},n=>{console.error(n)});else{let n=this.nav_lists[t].slice(0,this.more_count);this.nav_lists[t].splice(0,this.more_count),this.add_more_results([{title:t,results:n}])}}),this.$body.on("click",".switch-to-global-search",()=>{this.search=this.searches.global_search,this.$input.attr("placeholder",this.search.input_placeholder),this.put_placeholder(this.search.empty_state_text),this.get_results(this.current_keyword)})}init_search(i,e){this.search=this.searches[e],this.$input.attr("placeholder",this.search.input_placeholder),this.put_placeholder(this.search.empty_state_text),this.get_results(i),this.search_dialog.show(),this.$input.val(i),setTimeout(()=>this.$input.select(),500)}get_results(i){this.current_keyword=i,this.$body.find(".empty-state").length>0?this.put_placeholder(__("Searching ...")):this.$wrapper.find(".loading-state").removeClass("hide"),this.current_keyword.charAt(0)==="#"?this.search=this.searches.tags:this.search=this.searches.global_search,this.search.get_results(i,this.parse_results.bind(this))}parse_results(i,e){i=i.filter(function(t){return t.results.length>0}),i.length>0?this.render_data(i):this.put_placeholder(this.search.no_results_status(e))}render_data(i){let e=$(frappe.render_template("search")).addClass("hide"),t=e.find(".search-sidebar").empty(),r='<li class="search-sidebar-item standard-sidebar-item list-link" data-category="{0}"><a><span class="ellipsis">{1}</span></a></li>';this.modal_state=0,this.full_lists={"All Results":$('<div class="results-summary"></div>')},this.nav_lists={},i.forEach(s=>{t.append($(__(r,[s.title,__(s.title)]))),this.add_section_to_summary(s.title,s.results),this.full_lists[s.title]=this.render_full_list(s.title,s.results,s.fetch_type)}),i.length>1&&t.prepend($(__(r,["All Results",__("All Results")]))),this.update(e.clone()),this.$body.find(".list-link").first().trigger("click")}render_full_list(i,e,t){let r=20,s=$(`<div class="results-summary">
			<div class="result-section full-list ${i}-section col-sm-12">
				<div class="result-title"> ${__(i)}</div>
				<div class="result-body">
				</div>
			</div>
		</div>`);return e.slice(0,r).forEach(n=>{s.find(".result-body").append(this.render_result(i,n))}),e.length>0&&(t==="Nav"&&(this.nav_lists[i]=e),e.length>r&&$(`<a class="list-more" data-search="${t}"
					data-category="${i}" data-count="${r}">
						${__("More")}
				</a>`).appendTo(s.find(".result-body"))),s}add_section_to_summary(i,e){let t=4,r="",s=o=>this.render_result(i,o);e.length>t&&(r=`<div>
				<a class="section-more" data-category="${i}">${__("More")}</a>
			</div>`),$(`<div class="col-sm-12 result-section" data-type="${i}">
			<div class="result-title">${__(i)}</div>
			<div class="result-body">
				${r}
			</div>
		</div>`).appendTo(this.full_lists["All Results"]).find(".result-body").prepend(e.slice(0,t).map(s))}get_link(i){let e="";return i.route?e=`href="${frappe.router.make_url(i.route)}"`:i.data_path&&(e=`data-path=${i.data_path}"`),e}render_result(i,e){let t="";if(e.image!==void 0){let a=frappe.get_avatar("avatar-medium",e.label,e.image);t=`<a ${this.get_link(e)}>
				<div class="result-image">
					${a}
				</div>
			</a>`}let r=`<a ${this.get_link(e)} class="result-section-link">${e.label}</a>`,n=`<div class="result-text">
			${e.description?`<b>${r}</b><div class="description"> ${e.description} </div>`:r}
		</div>`,o=$(`<div class="result ${i}-result">
			${t}
			${n}
			${e.subtypes||""}
		</div>`);return e.description||this.handle_result_click(e,o),o}handle_result_click(i,e){i.route_options&&(frappe.route_options=i.route_options),e.on("click",()=>{if(i.onclick)i.onclick(i.match);else{var t=window.location.hash;frappe.set_route(i.route),window.location.hash==t&&frappe.router.route()}})}add_more_results(i){let e=$('<div class="more-results last"></div>');if(i[0].results&&i[0].results.forEach(t=>{e.append(this.render_result(i[0].title,t))}),this.$body.find(".list-more").before(e),i[0].results.length<this.more_count){this.$body.find(".list-more").hide();let t=this.$body.find(".result").length,r=$('<div class="results-status">'+t+" results found</div>");this.$body.find(".more-results:last").append(r)}this.$body.find(".more-results.last").slideDown(200,function(){})}};frappe.provide("frappe.tags");frappe.tags.utils={get_tags:function(i){i=i.slice(1);let e=[];return frappe.tags.tags?(frappe.tags.tags.forEach(t=>{let r=frappe.search.utils.fuzzy_search(i,t,!0);r.score&&e.push({type:"Tag",label:__("#{0}",[r.marked_string]),value:__("#{0}",[__(t)]),index:1+r.score,match:t,onclick(){frappe.searchdialog.search.init_search("#".concat(t),"tags")}})}),e):(frappe.tags.utils.fetch_tags(),[])},fetch_tags(){frappe.call({method:"frappe.desk.doctype.tag.tag.get_tags_list_for_awesomebar",callback:function(i){i&&i.message&&(frappe.tags.tags=$.extend([],i.message))}})},get_tag_results:function(i){function e(t){var r=[],s,n;function o(l){return r.find(function(c){return c.title===l})}function a(l){var c=110,u=null;if(l.length>c)u=l.slice(0,c)+"...";else{var p=l.length;u=l.slice(0,p)+"..."}return u}return t.forEach(function(l){var c="";l.content&&(c=a(l.content)),s={label:l.name,value:l.name,description:c,route:["Form",l.doctype,l.name]},n=o(l.doctype),n?n.results.push(s):(n={title:l.doctype,results:[s],fetch_type:"Global"},r.push(n))}),r}return new Promise(function(t){frappe.call({method:"frappe.desk.doctype.tag.tag.get_documents_for_tag",args:{tag:i},callback:function(r){r.message?t(e(r.message)):t([])}})})}};frappe.templates.search=`<div class="search-results flex">
	<div class="col-md-3 col-sm-3 hidden-xs layout-side-section">
		<ul class="overlay-sidebar list-unstyled search-sidebar"></ul>
	</div>
	<div class="col-md-9 col-sm-9 layout-main-section results-area">

	</div>
</div>
`;function Jh(i,e){return Zh(i,e,0,0,null,[],256,0,0,10)}function Zh(i,e,t,r,s,n,o,a,l,c){let u=0;if(++l>=c)return[!1,u,n];if(t===i.length||r===e.length)return[!1,u,n];let p=!1,m=[],w=0,x=!0;for(;t<i.length&&r<e.length;){let D=i[t].normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),j=e[r].normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();if(D===j){if(a>=o)return[!1,u,n];x&&s&&(n=[...s],x=!1);let[ee,d,g]=Zh(i,e,t,r+1,n,[],o,a,l,c);ee&&((!p||d>w)&&(m=[...g],w=d),p=!0),n[a++]=r,++t}++r}let A=t===i.length;if(A){u=100;let D=-5*n[0];D=D<-15?-15:D,u+=D;let j=e.length-a;u+=-1*j;for(let ee=0;ee<a;ee++){let d=n[ee];if(ee>0){let g=n[ee-1];d==g+1&&(u+=25)}if(d>0){let g=e[d-1],_=e[d];g!==g.toUpperCase()&&_!==_.toLowerCase()&&(u+=30),(g=="_"||g==" ")&&(u+=30)}else u+=15}return p&&(!A||w>u)?(n=[...m],u=w,[!0,u,n]):A?[!0,u,n]:[!1,u,n]}return[!1,u,n]}frappe.provide("frappe.search");frappe.search.utils={setup_recent:function(){this.recent=JSON.parse(frappe.boot.user.recent||"[]")||[]},get_recent_pages:function(i){i===null&&(i="");var e=this,t=[],r=[];function s(n,o,a){n.forEach(function(l,c){var u=$.isArray(l)?l[0]:l;if(u=__(u||"").toLowerCase().replace(/-/g," "),o===u||u.indexOf(o)!==-1){var p=a(l);p&&($.isPlainObject(p)&&(p=[p]),p.forEach(function(m){m.match=l,m.recent=!0}),r=p.concat(r))}})}return e.recent.forEach(function(n,o){t.push([n[1],["Form",n[0],n[1]]])}),t=t.reverse(),frappe.route_history.forEach(function(n,o){n[0]==="Form"?t.push([n[2],n]):["List","Tree","Workspaces","query-report"].includes(n[0])||n[2]==="Report"?n[1]&&t.push([n[1],n]):n[0]&&t.push([frappe.route_titles[n.join("/")]||n[0],n])}),s(t,i,function(n){let o=n[1],a={route:o};if(o[0]==="Form"){let l=o[1];if(o.length>2&&l!==o[2]){let c=o[2];a.label=__(l)+" "+c.bold(),a.value=__(l)+" "+c}else a.label=__(l).bold(),a.value=__(l)}else if(["List","Tree","Workspaces","query-report"].includes(o[0])&&o.length>1){let l=o[0],c=o[1];switch(l){case"List":a.label=__("{0} List",[__(c).bold()]),a.value=__("{0} List",[__(c)]);break;case"Tree":a.label=__("{0} Tree",[__(c).bold()]),a.value=__("{0} Tree",[__(c)]);break;case"Workspaces":a.label=__("{0} Workspace",[__(c).bold()]),a.value=__("{0} Workspace",[__(c)]);break;case"query-report":a.label=__("{0} Report",[__(c).bold()]),a.value=__("{0} Report",[__(c)]);break}}else n[0]?(a.label=frappe.utils.escape_html(n[0]).bold(),a.value=n[0]):console.log("Illegal match",n);return a.index=80,a}),r},get_frequent_links(){let i=[];return frappe.boot.frequently_visited_links.forEach(e=>{let t=frappe.utils.get_route_label(e.route);i.push({route:e.route,label:t,value:t,index:e.count})}),i.length?i:this.get_recent_pages("")},get_search_in_list:function(i){var e=this,t=[];if(i.split(" ").includes("in")&&i.slice(-2)!=="in"){var r=i.split(" in ");frappe.boot.user.can_read.forEach(function(s){if(frappe.boot.user.can_search.includes(s)){let n=e.fuzzy_search(r[1],s,!0);n.score&&t.push({type:"In List",label:__("Find {0} in {1}",[__(r[0]),n.marked_string]),value:__("Find {0} in {1}",[__(r[0]),__(s)]),route_options:{name:["like","%"+r[0]+"%"]},index:1+n.score,route:["List",s]})}})}return t},get_creatables:function(i){var e=this,t=[],r=i.split(" ")[0];return r.toLowerCase()===__("new")&&frappe.boot.user.can_create.forEach(function(s){let n=e.fuzzy_search(i.substr(4),s,!0);var o=n.score;o&&t.push({type:"New",label:__("New {0}",[n.marked_string||__(s)]),value:__("New {0}",[__(s)]),index:1+o,match:s,onclick:function(){frappe.new_doc(s,!0)}})}),t},get_doctypes:function(i){var e=this,t=[],r,s,n,o=function(a,l,c){let u=a==="List"&&n.endsWith("List");if(u)var p=s||__(n);else p=__(`{0} ${u?"":a}`,[s||__(n)]);return{type:a,label:p,value:__(`{0} ${a}`,[n]),index:r+c,match:n,route:l}};return frappe.boot.user.can_read.forEach(function(a){let l=e.fuzzy_search(i,a,!0);if({score:r,marked_string:s}=l,r){if(n=a,frappe.boot.single_types.includes(a))t.push(o("",["Form",a,a],.05));else if(frappe.boot.user.can_search.includes(a)){if(frappe.boot.user.can_create.includes(a)){var c=a;t.push({type:"New",label:__("New {0}",[l.marked_string||__(a)]),value:__("New {0}",[__(a)]),index:r+.015,match:a,onclick:function(){frappe.new_doc(c,!0)}})}t.push(o("List",["List",a],.05)),frappe.model.can_get_report(a)&&t.push(o("Report",["List",a,"Report"],.04))}}}),t},get_reports:function(i){var e=this,t=[],r;return Object.keys(frappe.boot.user.all_reports).forEach(function(s){let n=e.fuzzy_search(i,s,!0);var o=n.score;if(o>0){var a=frappe.boot.user.all_reports[s];a.report_type=="Report Builder"?r=["List",a.ref_doctype,"Report",s]:r=["query-report",s],t.push({type:"Report",label:__("Report {0}",[n.marked_string||__(s)]),value:__("Report {0}",[__(s)]),index:o,route:r})}}),t},get_pages:function(i){var e=this,t=[];this.pages={},$.each(frappe.boot.page_info,function(s,n){e.pages[n.title]=n,n.name=s}),Object.keys(this.pages).forEach(function(s){if(s=="Hub"||s=="hub")return;let n=e.fuzzy_search(i,s,!0);var o=n.score;if(o){var a=e.pages[s];t.push({type:"Page",label:__("Open {0}",[n.marked_string||__(s)]),value:__("Open {0}",[__(s)]),match:s,index:o,route:[a.route||a.name]})}});var r="Calendar";return __("calendar").indexOf(i.toLowerCase())===0&&t.push({type:"Calendar",value:__("Open {0}",[__(r)]),index:e.fuzzy_search(i,"Calendar"),match:r,route:["List","Event",r]}),r="Hub",__("hub").indexOf(i.toLowerCase())===0&&t.push({type:"Hub",value:__("Open {0}",[__(r)]),index:e.fuzzy_search(i,"Hub"),match:r,route:[r,"Item"]}),__("email inbox").indexOf(i.toLowerCase())===0&&t.push({type:"Inbox",value:__("Open {0}",[__("Email Inbox")]),index:e.fuzzy_search(i,"email inbox"),match:r,route:["List","Communication","Inbox"]}),t},get_workspaces:function(i){var e=this,t=[];return frappe.boot.allowed_workspaces.forEach(function(r){let s=e.fuzzy_search(i,r.name,!0);var n=s.score;if(n>0){var o={type:"Workspace",label:__("Open {0}",[s.marked_string||__(r.name)]),value:__("Open {0}",[__(r.name)]),index:n,route:[frappe.router.slug(r.name)]};t.push(o)}}),t},get_dashboards:function(i){var e=this,t=[];return frappe.boot.dashboards.forEach(function(r){let s=e.fuzzy_search(i,r.name,!0);var n=s.score;if(n>0){var o={type:"Dashboard",label:__("{0} Dashboard",[s.marked_string||__(r.name)]),value:__("{0} Dashboard",[__(r.name)]),index:n,route:["dashboard-view",r.name]};t.push(o)}}),t},get_global_results:function(i,e,t,r=""){var s=this;function n(o){var a=[],l,c;function u(m){return a.find(function(w){return w.title===m})}function p(m,w){for(var x=m.split(" ||| "),A=300,D=120,j=[],ee=0,d="",g=0;g<x.length;g++){var _=x[g];if(_.toLowerCase().indexOf(i.toLowerCase())!==-1){let M,q;if(_.indexOf(" &&& ")!==-1?(M=_.indexOf(" &&& "),q=_.slice(M+5)):(M=_.indexOf(" : "),q=_.slice(M+3)),q.length>D){var y="",O=q.indexOf(i);y+=O<D/2?q.slice(0,O):"..."+q.slice(O-D/2,O),y+=q.slice(O,O+D/2),y+=O+D/2<q.length?"...":"",q=y}var E=_.slice(0,M),k=A-ee;ee+=E.length+q.length+2;let Y=s.fuzzy_search(i,E,!0),F=s.fuzzy_search(i,q,!0);if(ee<A)d='<span class="field-name text-muted">'+Y.marked_string+": </span> "+F.marked_string,j.indexOf(d)===-1&&w!==q&&j.push(d);else{E.length<k?(k-=E.length,d='<span class="field-name text-muted">'+Y.marked_string+": </span> ",q=q.slice(0,k),q=q.slice(0,q.lastIndexOf(" "))+" ...",d+=F.marked_string,j.push(d)):j.push("...");break}}}return j.join(", ")}return o.forEach(function(m){l={label:m.title||m.name,value:m.name,description:p(m.content,m.name),route:["Form",m.doctype,m.name]},(m.image||m.image===null)&&(l.image=m.image),c=u(m.doctype),c?c.results.push(l):(c={title:m.doctype,results:[l],fetch_type:"Global"},a.push(c))}),a}return new Promise(function(o,a){frappe.call({method:"frappe.utils.global_search.search",args:{text:i,start:e,limit:t,doctype:r},callback:function(l){l.message?o(n(l.message)):o([])}})})},get_nav_results:function(i){function e(o){var a=[],l=[];return o.forEach(function(c){if(c.route){c.route[0]==="List"&&c.route[2]&&c.route.splice(2);var u=c.route.join("/");if(a.indexOf(u)===-1)a.push(u),l.push(c);else{var p=a.indexOf(u);l[p].index>c.index&&(l[p]=c)}}else l.push(c)}),l.sort(function(c,u){return u.index-c.index})}var t=[],r=[],s=e(this.get_doctypes(i));s.forEach(function(o){o.type===""?r.push(o):t.push(o)});var n=i.split(" in ")[0];return[{title:__("Recents"),fetch_type:"Nav",results:e(this.get_recent_pages(i))},{title:__("Create a new ..."),fetch_type:"Nav",results:e(this.get_creatables(i))},{title:__("Lists"),fetch_type:"Nav",results:t},{title:__("Reports"),fetch_type:"Nav",results:e(this.get_reports(i))},{title:__("Administration"),fetch_type:"Nav",results:e(this.get_pages(i))},{title:__("Workspace"),fetch_type:"Nav",results:e(this.get_workspaces(i))},{title:__("Dashboard"),fetch_type:"Nav",results:e(this.get_dashboards(i))},{title:__("Setup"),fetch_type:"Nav",results:r},{title:__("Find '{0}' in ...",[n]),fetch_type:"Nav",results:e(this.get_search_in_list(i))}]},fuzzy_search:function(i="",e="",t=!1){let r=__(e),[,s,n]=Jh(i,r,t);if(!t)return s;if(s==0)return{score:s,marked_string:r};let o=Array(r.length).fill(0);n.forEach(u=>o[u]=1);let a="",l="",c=()=>{if(!l)return"";let u=`<mark>${l}</mark>`;return l="",u};return o.forEach((u,p)=>{u?l+=r[p]:(a+=c(),a+=r[p])}),a+=c(),{score:s,marked_string:a}},bolden_match_part:function(i,e){return this.fuzzy_search(e,i,!0).marked_string},get_executables(i){let e=[];return this.searchable_functions.forEach(t=>{let r=t.label.toLowerCase(),s=i.toLowerCase();if(s===r||r.indexOf(s)===0){let n=this.fuzzy_search(s,t.label,!0);e.push({type:"Executable",value:n.marked_string,index:n.score,match:t.label,onclick:()=>t.action.apply(this,t.args)})}}),e},make_function_searchable(i,e=null,t=null){if(typeof i!="function")throw new Error("First argument should be a function");this.searchable_functions.push({label:e||i.name,action:i,args:t})},get_marketplace_apps:function(i){var e=this,t=[];return frappe.boot.marketplace_apps.forEach(function(r){let s=e.fuzzy_search(i,r.title,!0);if(s.score>0){var n={label:__("Install {0} from Marketplace",[s.marked_string]),value:__("Install {0} from Marketplace",[__(r.title)]),index:s.score*.8,route:[`https://frappecloud.com/${r.route}?utm_source=awesomebar`,r.name]};t.push(n)}}),t},searchable_functions:[]};frappe.provide("frappe.ui.misc");frappe.ui.misc.about=function(){if(!frappe.ui.misc.about_dialog){var i=new frappe.ui.Dialog({title:__("Frappe Framework")});$(i.body).html(repl(`<div>
					<p>${__("Open Source Applications for the Web")}</p>
					<p><i class='fa fa-globe fa-fw'></i>
						${__("Website")}:
						<a href='https://frappeframework.com' target='_blank'>https://frappeframework.com</a></p>
					<p><i class='fa fa-github fa-fw'></i>
						${__("Source")}:
						<a href='https://github.com/frappe' target='_blank'>https://github.com/frappe</a></p>
					<p><i class='fa fa-graduation-cap fa-fw'></i>
						Frappe School: <a href='https://frappe.school' target='_blank'>https://frappe.school</a></p>
					<p><i class='fa fa-linkedin fa-fw'></i>
						Linkedin: <a href='https://linkedin.com/company/frappe-tech' target='_blank'>https://linkedin.com/company/frappe-tech</a></p>
					<p><i class='fa fa-twitter fa-fw'></i>
						Twitter: <a href='https://twitter.com/frappetech' target='_blank'>https://twitter.com/frappetech</a></p>
					<p><i class='fa fa-youtube fa-fw'></i>
						YouTube: <a href='https://www.youtube.com/@frappetech' target='_blank'>https://www.youtube.com/@frappetech</a></p>
					<hr>
					<h4>${__("Installed Apps")}</h4>
					<div id='about-app-versions'>${__("Loading versions...")}</div>
					<p>
						<b>
							<a href="/attribution" target="_blank" class="text-muted">
								${__("Dependencies & Licenses")}
							</a>
						</b>
					</p>
					<hr>
					<p class='text-muted'>${__("&copy; Frappe Technologies Pvt. Ltd. and contributors")} </p>
					</div>`,frappe.app)),frappe.ui.misc.about_dialog=i,frappe.ui.misc.about_dialog.on_page_show=function(){frappe.versions?e(frappe.versions):frappe.call({method:"frappe.utils.change_log.get_versions",callback:function(t){e(t.message)}})};var e=function(t){var r=$("#about-app-versions").empty();$.each(Object.keys(t).sort(),function(s,n){var o=t[n];let a;o.branch?a=$.format("<p><b>{0}:</b> v{1} ({2})<br></p>",[o.title,o.branch_version||o.version,o.branch]):a=$.format("<p><b>{0}:</b> v{1}<br></p>",[o.title,o.version]),$(a).appendTo(r)}),frappe.versions=t}}frappe.ui.misc.about_dialog.show()};frappe.templates.navbar=`<div class="sticky-top">
	<header class="navbar navbar-expand" role="navigation">
		<div class="container">
			<a class="navbar-brand navbar-home" href="/app">
				<img
					class="app-logo"
					src="{{ frappe.boot.app_data[0].app_logo_url }}"
					alt="{{ __("App Logo") }}"
				>
			</a>
			<ul class="nav navbar-nav d-none d-sm-flex" id="navbar-breadcrumbs"></ul>
			<div class="collapse navbar-collapse justify-content-end">
				<form class="form-inline fill-width justify-content-end" role="search" onsubmit="return false;">
					{% if (frappe.boot.read_only) { %}
						<span class="indicator-pill yellow no-indicator-dot read-only-banner" title="{%= __("Your site is undergoing maintenance or being updated.") %}">
							{%= __("Read Only Mode") %}
						</span>
					{% } %}
					{% if (frappe.boot.user.impersonated_by) { %}
						<span class="indicator-pill red no-indicator-dot" title="{%= __("You are impersonating as another user.") %}">
							{%= __("Impersonating {0}", [frappe.boot.user.name]) %}
						</span>
					{% } %}
					<div class="input-group search-bar text-muted hidden">
						<input
							id="navbar-search"
							type="text"
							class="form-control"
							placeholder="{%= __('Search or type a command ({0})', [frappe.utils.is_mac() ? '\u2318 + K' : 'Ctrl + K']) %}"
							aria-haspopup="true"
						>
						<span class="search-icon">
							<svg class="icon icon-sm"><use href="#icon-search"></use></svg>
						</span>
					</div>
				</form>
				<ul class="navbar-nav">
					<li class="nav-item dropdown dropdown-notifications dropdown-mobile hidden">
						<button
							class="btn-reset nav-link notifications-icon text-muted"
							data-toggle="dropdown"
							aria-haspopup="true"
							aria-expanded="false"
						>
							<span class="notifications-seen">
								<span class="sr-only">{{ __("No new notifications") }}</span>
								<svg class="es-icon icon-sm" style="stroke:none;"><use href="#es-line-notifications"></use></svg>
							</span>
							<span class="notifications-unseen">
								<span class="sr-only">{{ __("You have unseen notifications") }}</span>
								<svg class="es-icon icon-sm"><use href="#es-line-notifications-unseen"></use></svg>
							</span>
						</button>
						<div class="dropdown-menu notifications-list dropdown-menu-right" role="menu">
							<div class="notification-list-header">
								<div class="header-items"></div>
								<div class="header-actions"></div>
							</div>
							<div class="notification-list-body">
								<div class="panel-notifications"></div>
								<div class="panel-events"></div>
								<div class="panel-changelog-feed"></div>
							</div>
						</div>
					</li>
					<li class="nav-item dropdown dropdown-message dropdown-mobile hidden">
						<button
							class="btn-reset nav-link notifications-icon text-muted"
							data-toggle="dropdown"
							aria-haspopup="true"
							aria-expanded="true"
						>
							<span>
								<svg class="es-icon icon-sm"><use href="#es-line-chat-alt"></use></svg>
							</span>
						</button>
					</li>
					<li class="vertical-bar d-none d-sm-block"></li>
					<li class="nav-item dropdown dropdown-help dropdown-mobile d-none d-lg-block">
						<button
							class="btn-reset nav-link"
							data-toggle="dropdown"
							aria-controls="toolbar-help"
							aria-label="{{ __("Help Dropdown") }}"
						>
							<span>
								{{ __("Help") }}
								<svg class="es-icon icon-xs"><use href="#es-line-down"></use></svg>
							</span>
						</button>
						<div class="dropdown-menu dropdown-menu-right" id="toolbar-help" role="menu">
							<div id="help-links"></div>
							<div class="dropdown-divider documentation-links"></div>
							{% for item in navbar_settings.help_dropdown %}
								{% if (!item.hidden) { %}
									{% if (item.route) { %}
										<a class="dropdown-item" href="{{ item.route }}">
											{%= __(item.item_label) %}
										</a>
									{% } else if (item.action) { %}
										<button class="btn-reset dropdown-item" onclick="return {{ item.action }}">
											{%= __(item.item_label) %}
										</button>
									{% } else { %}
										<div class="dropdown-divider"></div>
									{% } %}
								{% } %}
							{% endfor %}
						</div>
					</li>
					<li class="nav-item dropdown dropdown-navbar-user dropdown-mobile">
						<button
							class="btn-reset nav-link"
							data-toggle="dropdown"
							aria-label="{{ __("User Menu") }}"
						>
							{{ avatar }}
						</button>
						<div class="dropdown-menu dropdown-menu-right" id="toolbar-user" role="menu">
							{% for item in navbar_settings.settings_dropdown %}
								{% var condition = item.condition ? eval(item.condition) : true %}
								{% if (condition && !item.hidden) { %}
									{% if (item.route) { %}
										<a class="dropdown-item" href="{{ item.route }}">
											{%= __(item.item_label) %}
										</a>
									{% } else if (item.action) { %}
										<button class="btn-reset dropdown-item" onclick="return {{ item.action }}">
											{%= __(item.item_label) %}
										</button>
									{% } else { %}
										<div class="dropdown-divider"></div>
									{% } %}
								{% } %}
							{% endfor %}
						</div>
					</li>
				</ul>
			</div>
		</div>
	</header>

	{% if !localStorage.getItem("dismissed_announcement_widget") && strip_html(navbar_settings.announcement_widget) != '' %}
	<div class="announcement-widget form-message p-2 m-0" style="position: relative; z-index: -1; border-radius: 0; background-color: var(--bg-blue);">
		<div class="container flex justify-between align-center mx-auto">
			{{ navbar_settings.announcement_widget }}
			<div class="close-message p-0 mr-2" style="position: relative;">
			{{ frappe.utils.icon("close") }}
			</div>
		</div>
	</div>
	{% endif %}

</div>
`;frappe.provide("frappe.ui.toolbar");frappe.provide("frappe.search");frappe.ui.toolbar.Toolbar=class{constructor(){$("header").replaceWith(frappe.render_template("navbar",{avatar:frappe.avatar(frappe.session.user,"avatar-medium"),navbar_settings:frappe.boot.navbar_settings})),$(".dropdown-toggle").dropdown(),$("#toolbar-user a[href]").click(function(){$(this).closest(".dropdown-menu").prev().dropdown("toggle")}),this.setup_awesomebar(),this.setup_notifications(),this.setup_help(),this.setup_read_only_mode(),this.setup_announcement_widget(),this.make()}make(){this.bind_events(),$(document).trigger("toolbar_setup"),$(".navbar-brand .app-logo").on("click",()=>{frappe.app.sidebar.set_height(),frappe.app.sidebar.toggle_sidebar()})}bind_events(){$(document).on("page-change",function(){$("header .navbar .custom-menu").remove()}),$("#search-modal").on("shown.bs.modal",function(){var i=$(this);setTimeout(function(){i.find("#modal-search").focus()},300)})}setup_read_only_mode(){!frappe.boot.read_only||$("header .read-only-banner").tooltip({delay:{show:600,hide:100},trigger:"hover"})}setup_announcement_widget(){let i=frappe.boot.navbar_settings.announcement_widget;if(!!i&&(i!=localStorage.getItem("announcement_widget")&&(localStorage.removeItem("dismissed_announcement_widget"),localStorage.setItem("announcement_widget",i)),!localStorage.getItem("dismissed_announcement_widget"))){let e=$(".announcement-widget");e.find(".close-message").on("click",()=>localStorage.setItem("dismissed_announcement_widget",!0)||e.addClass("hidden"))}}setup_help(){if(!frappe.boot.desk_settings.notifications){$(".navbar .vertical-bar").removeClass("d-sm-block"),$(".dropdown-help").removeClass("d-lg-block");return}frappe.provide("frappe.help"),frappe.help.show_results=e,this.search=new frappe.search.SearchDialog,frappe.provide("frappe.searchdialog"),frappe.searchdialog.search=this.search,$(".dropdown-help .dropdown-toggle").on("click",function(){$(".dropdown-help input").focus()}),$(".dropdown-help .dropdown-menu").on("click","input, button",function(t){t.stopPropagation()}),$("#input-help").on("keydown",function(t){t.which==13&&$(this).val("")}),$(document).on("page-change",function(){var t=$(".dropdown-help #help-links");t.html("");var r=frappe.get_route_str(),s=r.split("/"),n=[];for(let p=0;p<s.length;p++){var o=r.split("/",p+1),a=o.join("/"),l=frappe.help.help_links[a]||[];n=$.merge(n,l)}n.length===0?t.next().hide():t.next().show();for(let p=0;p<n.length;p++){var c=n[p],u=c.url;$("<a>",{href:u,class:"dropdown-item",text:__(c.label),target:"_blank"}).appendTo(t)}$(".dropdown-help .dropdown-menu").on("click","a",e)});var i=frappe.get_modal("","");i.addClass("help-modal"),$(document).on("click",".help-modal a",e);function e(t){var r=t.target.href;r.indexOf("blob")>0&&window.open(r,"_blank");var s=$(t.target).attr("data-path");s&&t.preventDefault()}}setup_awesomebar(){frappe.boot.desk_settings.search_bar&&(new frappe.search.AwesomeBar().setup("#navbar-search"),frappe.search.utils.make_function_searchable(frappe.utils.generate_tracking_url,__("Generate Tracking URL")),frappe.model.can_read("RQ Job")&&frappe.search.utils.make_function_searchable(function(){frappe.set_route("List","RQ Job")},__("Background Jobs")))}setup_notifications(){frappe.boot.desk_settings.notifications&&frappe.session.user!=="Guest"&&(this.notifications=new frappe.ui.Notifications)}};$.extend(frappe.ui.toolbar,{add_dropdown_button:function(i,e,t,r){var s=frappe.ui.toolbar.get_menu(i);return s.find("li:not(.custom-menu)").length&&!s.find(".divider").length&&frappe.ui.toolbar.add_menu_divider(s),$('<li class="custom-menu"><a><i class="fa-fw '+r+'"></i> '+e+"</a></li>").insertBefore(s.find(".divider")).find("a").click(function(){t.apply(this)})},get_menu:function(i){return $("#navbar-"+i.toLowerCase())},add_menu_divider:function(i){i=typeof i=="string"?frappe.ui.toolbar.get_menu(i):i,$('<li class="divider custom-menu"></li>').prependTo(i)},add_icon_link(i,e,t,r){let s=$(".navbar-right").get(0),n=$(`<li class="${r}">
			<a class="btn" href="${i}" title="${frappe.utils.to_title_case(r,!0)}" aria-haspopup="true" aria-expanded="true">
				<div>
					<i class="octicon ${e}"></i>
				</div>
			</a>
		</li>`).get(0);s.insertBefore(n,s.children[t])},toggle_full_width(){let i=JSON.parse(localStorage.container_fullwidth||"false");i=!i,localStorage.container_fullwidth=i,frappe.ui.toolbar.set_fullwidth_if_enabled(),$(document.body).trigger("toggleFullWidth")},set_fullwidth_if_enabled(){let i=JSON.parse(localStorage.container_fullwidth||"false");$(document.body).toggleClass("full-width",i)},show_shortcuts(i){return i.preventDefault(),frappe.ui.keys.show_keyboard_shortcut_dialog(),!1}});frappe.ui.toolbar.clear_cache=frappe.utils.throttle(function(){frappe.assets.clear_local_storage(),frappe.xcall("frappe.sessions.clear").then(i=>{frappe.show_alert({message:i,indicator:"info"}),location.reload(!0)})},1e4);frappe.ui.toolbar.show_about=function(){try{frappe.ui.misc.about()}catch(i){console.log(i)}return!1};frappe.ui.toolbar.route_to_user=function(){frappe.set_route("Form","User",frappe.session.user)};frappe.ui.toolbar.view_website=function(){let i=window.open();i.opener=null,i.location="/index"};frappe.ui.toolbar.setup_session_defaults=function(){let i=[];frappe.call({method:"frappe.core.doctype.session_default_settings.session_default_settings.get_session_default_values",callback:function(e){i=JSON.parse(e.message);let t=frappe.perm.get_perm("Session Default Settings");(frappe.user_roles.includes("System Manager")||t[0].read==1)&&(i[i.length]={fieldname:"settings",fieldtype:"Button",label:__("Settings"),click:()=>{frappe.set_route("Form","Session Default Settings","Session Default Settings")}}),frappe.prompt(i,function(r){i.forEach(function(s){r[s.fieldname]||(r[s.fieldname]="")}),frappe.call({method:"frappe.core.doctype.session_default_settings.session_default_settings.set_session_default_values",args:{default_values:r},callback:function(s){s.message=="success"?(frappe.show_alert({message:__("Session Defaults Saved"),indicator:"green"}),frappe.ui.toolbar.clear_cache()):frappe.show_alert({message:__("An error occurred while setting Session Defaults"),indicator:"red"})}})},__("Session Defaults"),__("Save"))}})};var Dn=Ut(ef());frappe.last_edited_communication={};var tf="<div>---</div>";frappe.views.CommunicationComposer=class{constructor(i){$.extend(this,i),this.doc||(this.doc=this.frm&&this.frm.doc||{}),this.make()}make(){let i=this;this.dialog=new frappe.ui.Dialog({title:this.title||this.subject||__("New Email"),no_submit_on_enter:!0,fields:this.get_fields(),primary_action_label:__("Send",null,"Send Email"),primary_action(){i.send_action()},secondary_action_label:__("Discard",null,"Discard Email"),secondary_action(){i.dialog.hide(),i.clear_cache()},size:"large",minimizable:!0}),$(this.dialog.$wrapper.find(".form-section").get(0)).addClass("to_section"),this.prepare(),this.dialog.show(),this.frm&&$(document).trigger("form-typing",[this.frm])}get_fields(){let i=this,e=[{label:__("To",null,"Email Recipients"),fieldtype:"MultiSelect",reqd:0,fieldname:"recipients",default:this.get_default_recipients("recipients"),onchange:function(){i.sanitize_emails(this)}},{fieldtype:"Button",label:frappe.utils.icon("down","xs"),fieldname:"option_toggle_button",click:()=>{this.toggle_more_options()}},{fieldtype:"Section Break",hidden:1,fieldname:"more_options"},{label:__("CC",null,"Email Recipients"),fieldtype:"MultiSelect",fieldname:"cc",default:this.get_default_recipients("cc"),onchange:function(){i.sanitize_emails(this)}},{label:__("BCC",null,"Email Recipients"),fieldtype:"MultiSelect",fieldname:"bcc",default:this.get_default_recipients("bcc"),onchange:function(){i.sanitize_emails(this)}},{label:__("Schedule Send At"),fieldtype:"Datetime",fieldname:"send_after"},{fieldtype:"Section Break",fieldname:"email_template_section_break",hidden:1},{label:__("Email Template"),fieldtype:"Link",options:"Email Template",fieldname:"email_template"},{fieldtype:"HTML",label:__("Clear & Add template"),fieldname:"clear_and_add_template"},{fieldtype:"Section Break"},{label:__("Subject"),fieldtype:"Data",reqd:1,fieldname:"subject",length:524288},{label:__("Message"),fieldtype:"Text Editor",fieldname:"content",onchange:frappe.utils.debounce(this.save_as_draft.bind(this),300)},{fieldtype:"Button",label:__("Add Signature"),fieldname:"add_signature",hidden:1,click:async()=>{let r=this.dialog.get_value("sender")||"";this.content_set=!1,await this.set_content(r)}},{fieldtype:"Section Break"},{label:__("Send me a copy"),fieldtype:"Check",fieldname:"send_me_a_copy",default:frappe.boot.user.send_me_a_copy},{label:__("Send Read Receipt"),fieldtype:"Check",fieldname:"send_read_receipt"},{label:__("Attach Document Print"),fieldtype:"Check",fieldname:"attach_document_print"},{label:__("Select Print Format"),fieldtype:"Select",fieldname:"select_print_format",onchange:function(){i.guess_language()}},{label:__("Print Language"),fieldtype:"Link",options:"Language",fieldname:"print_language",default:frappe.boot.lang,depends_on:"attach_document_print"},{fieldtype:"Column Break"},{label:__("Select Attachments"),fieldtype:"HTML",fieldname:"select_attachments"}],t=frappe.boot.email_accounts.filter(r=>!["All Accounts","Sent","Spam","Trash"].includes(r.email_account)&&r.enable_outgoing);return t.length&&(this.user_email_accounts=t.map(function(r){return r.email_id}),e.unshift({label:__("From",null,"Email Sender"),fieldtype:"Select",reqd:1,fieldname:"sender",options:this.user_email_accounts,onchange:()=>{this.setup_recipients_if_reply()}}),this.user_email_accounts.length==1?this.sender=this.user_email_accounts:this.user_email_accounts.includes(frappe.session.user_email)&&(this.sender=frappe.session.user_email)),e}get_default_recipients(i){var e;return(e=this.frm)!=null&&e.events.get_email_recipients?(this.frm.events.get_email_recipients(this.frm,i)||[]).join(", "):""}guess_language(){var s,n,o;let i=(n=(s=this.frm)==null?void 0:s.doc)==null?void 0:n.language,e=this.dialog.get_value("select_print_format"),t;e!="Standard"&&(t=(o=frappe.get_doc("Print Format",e))==null?void 0:o.default_print_language);let r=i||t||frappe.boot.lang;this.dialog.set_value("print_language",r)}toggle_more_options(i){i=i||this.dialog.fields_dict.more_options.df.hidden,this.dialog.set_df_property("more_options","hidden",!i),this.dialog.set_df_property("email_template_section_break","hidden",!i);let e=frappe.utils.icon(i?"up-line":"down","xs");this.dialog.get_field("option_toggle_button").set_label(e)}prepare(){this.setup_multiselect_queries(),this.setup_subject_and_recipients(),this.setup_print(),this.setup_attach(),this.setup_email(),this.setup_email_template(),this.setup_last_edited_communication(),this.setup_add_signature_button(),this.set_values()}setup_add_signature_button(){let i=this.dialog.has_field("sender");this.dialog.set_df_property("add_signature","hidden",!i)}setup_multiselect_queries(){["recipients","cc","bcc"].forEach(i=>{this.dialog.fields_dict[i].get_data=()=>{var s;let r={txt:this.dialog.fields_dict[i].get_value().match(/[^,\s*]*$/)[0]||""};(s=this.frm)!=null&&s.events.get_email_recipient_filters&&(r.extra_filters=this.frm.events.get_email_recipient_filters(this.frm,i)),frappe.call({method:"frappe.email.get_contact_list",args:r,callback:n=>{this.dialog.fields_dict[i].set_data(n.message)}})}})}setup_recipients_if_reply(){if(!this.is_a_reply||!this.last_email)return;let i=this.dialog.get_value("sender");if(!i)return;let e={recipients:this.dialog.fields_dict.recipients,cc:this.dialog.fields_dict.cc,bcc:this.dialog.fields_dict.bcc};if(this.last_email.sender==i)e.recipients.set_value(this.last_email.recipients),this.reply_all&&(e.cc.set_value(this.last_email.cc),e.bcc.set_value(this.last_email.bcc));else if(e.recipients.set_value(this.last_email.sender),this.reply_all){let t=this.last_email.recipients.split(",").map(s=>s.trim());this.cc||(this.cc="");let r=this.cc.split(",").map(s=>s.trim());this.cc&&!this.cc.endsWith(", ")&&(this.cc+=", "),this.cc+=t.filter(s=>!r.includes(s)&&s!=i).join(", "),this.cc=this.cc.replace(i+", ",""),e.cc.set_value(this.cc)}}setup_subject_and_recipients(){if(this.subject=this.subject||"",!this.forward&&!this.recipients&&this.last_email&&(this.recipients=this.last_email.sender,this.last_email.sender==this.sender&&(this.recipients=this.last_email.recipients),this.cc=this.last_email.cc,this.bcc=this.last_email.bcc),!this.forward&&!this.recipients&&(this.recipients=this.frm&&this.frm.timeline.get_recipient()),!this.subject&&this.frm){let i=this.frm.timeline.get_last_email();i&&(this.subject=i.subject,this.recipients||(this.recipients=i.sender),strip(this.subject.toLowerCase().split(":")[0])!="re"&&(this.subject=__("Re: {0}",[this.subject]))),this.subject||(this.subject=this.frm.doc.name,this.frm.meta.subject_field&&this.frm.doc[this.frm.meta.subject_field]?this.subject=this.frm.doc[this.frm.meta.subject_field]:this.frm.meta.title_field&&this.frm.doc[this.frm.meta.title_field]&&(this.subject=this.frm.doc[this.frm.meta.title_field]));let e=`#${this.frm.doc.name}`;cstr(this.subject).includes(e)||(this.subject=`${this.subject} (${e})`)}this.frm&&!this.recipients&&(this.recipients=this.frm.doc[this.frm.email_field])}setup_email_template(){let i=this,e=this.dialog.fields_dict,t=$(e.clear_and_add_template.wrapper);function r(){let n=i.dialog.fields_dict.email_template.get_value();if(!n)return;function o(a){let l=i.dialog.fields_dict.content,c=i.dialog.fields_dict.subject,u=l.get_value()||"";l.set_value(`${a.message}<br>${u}`),c.set_value(a.subject)}frappe.call({method:"frappe.email.doctype.email_template.email_template.get_email_template",args:{template_name:n,doc:i.doc},callback(a){o(a.message)}})}let s=[{label:__("Add Template"),description:__("Prepend the template to the email message"),action:()=>r()},{label:__("Clear & Add Template"),description:__("Clear the email message and add the template"),action:()=>{i.dialog.fields_dict.content.set_value(""),r()}}];frappe.utils.add_select_group_button(t,s)}setup_last_edited_communication(){this.frm?(this.doctype=this.frm.doctype,this.key=this.frm.docname):this.doctype=this.key="Inbox",this.last_email&&(this.key=this.key+":"+this.last_email.name),this.subject&&(this.key=this.key+":"+this.subject),this.dialog.on_hide=()=>{$.extend(this.get_last_edited_communication(!0),this.dialog.get_values(!0)),this.frm&&$(document).trigger("form-stopped-typing",[this.frm])}}get_last_edited_communication(i){return frappe.last_edited_communication[this.doctype]||(frappe.last_edited_communication[this.doctype]={}),(i||!frappe.last_edited_communication[this.doctype][this.key])&&(frappe.last_edited_communication[this.doctype][this.key]={}),frappe.last_edited_communication[this.doctype][this.key]}async set_values(){for(let e of["recipients","cc","bcc","sender"])await this.dialog.set_value(e,this[e]||"");let i=this.subject?frappe.utils.html2text(this.subject):"";if(await this.dialog.set_value("subject",i),await this.set_values_from_last_edited_communication(),await this.set_content(),this.frm&&!this.is_a_reply&&!this.content_set){let e=this.frm.meta.default_email_template||"";await this.dialog.set_value("email_template",e)}for(let e of["email_template","cc","bcc"])if(this.dialog.get_value(e)){this.toggle_more_options(!0);break}}async set_values_from_last_edited_communication(){if(this.message)return;let i=this.get_last_edited_communication();!i.content||(i.email_template&&(await this.dialog.fields_dict.email_template.set_model_value(i.email_template),delete i.email_template),await this.dialog.set_values(i),this.content_set=!0)}selected_format(){return this.dialog.fields_dict.select_print_format.input.value||this.frm&&this.frm.meta.default_print_format||"Standard"}get_print_format(i){return i||(i=this.selected_format()),locals["Print Format"]&&locals["Print Format"][i]?locals["Print Format"][i]:{}}setup_print(){let i=this.dialog.fields_dict;if($(i.attach_document_print.input).click(function(){$(i.select_print_format.wrapper).toggle($(this).prop("checked"))}),$(i.select_print_format.wrapper).toggle(!1),this.frm){let e=frappe.meta.get_print_formats(this.frm.meta.name);$(i.select_print_format.input).empty().add_options(e).val(e[0])}else $(i.attach_document_print.wrapper).toggle(!1);this.guess_language()}setup_attach(){let i=this.dialog.fields_dict,e=$(i.select_attachments.wrapper);this.attachments||(this.attachments=[]);let t={folder:"Home/Attachments",on_success:r=>{this.attachments.push(r),this.render_attachment_rows(r)}};this.frm&&(t={doctype:this.frm.doctype,docname:this.frm.docname,folder:"Home/Attachments",on_success:r=>{this.frm.attachments.attachment_uploaded(r),this.render_attachment_rows(r)}}),$(`
			<label class="control-label">
				${__("Select Attachments")}
			</label>
			<div class='attach-list'></div>
			<p class='add-more-attachments'>
				<button class='btn btn-xs btn-default'>
					${frappe.utils.icon("small-add","xs")}&nbsp;
					${__("Add Attachment")}
				</button>
			</p>
		`).appendTo(e.empty()),e.find(".add-more-attachments button").on("click",()=>new frappe.ui.FileUploader(t)),this.render_attachment_rows()}render_attachment_rows(i){let e=this.dialog.fields_dict.select_attachments,t=$(e.wrapper).find(".attach-list");if(i)t.append(this.get_attachment_row(i,!0));else{let r=[];this.attachments&&this.attachments.length&&(r=r.concat(this.attachments)),this.frm&&(r=r.concat(this.frm.get_files())),r.length&&$.each(r,(s,n)=>{!n.file_name||t.find(`[data-file-name="${n.name}"]`).length||(n.file_url=frappe.urllib.get_full_url(n.file_url),t.append(this.get_attachment_row(n)))})}}get_attachment_row(i,e){return $(`<p class="checkbox flex">
			<label title="${i.file_name}" style="max-width: 100%">
				<input
					type="checkbox"
					data-file-name="${i.name}"
					${e?"checked":""}>
				</input>
				<span
					class="ellipsis"
					style="max-width: calc(100% - var(--checkbox-size) - var(--checkbox-right-margin) - var(--padding-xs) - 16px)"
				>
					${i.file_name}
				</span>
				<a
					href="${i.file_url}"
					target="_blank"
					class="btn-link"
					style="padding-left: var(--padding-xs)"
				>
					${frappe.utils.icon("link-url","sm")}
				</a>
			</label>
		</p>`)}setup_email(){let i=this.dialog.fields_dict;this.attach_document_print&&($(i.attach_document_print.input).click(),$(i.select_print_format.wrapper).toggle(!0)),$(i.send_me_a_copy.input).on("click",()=>{let e=i.send_me_a_copy.get_value();frappe.db.set_value("User",frappe.session.user,"send_me_a_copy",e),frappe.boot.user.send_me_a_copy=e})}send_action(){let i=this,e=i.dialog.get_primary_btn(),t=this.get_values();if(!t)return;let r=$.map($(i.dialog.wrapper).find("[data-file-name]:checked"),function(s){return $(s).attr("data-file-name")});t.attach_document_print?i.send_email(e,t,r,null,t.select_print_format||""):i.send_email(e,t,r)}get_values(){let i=this.dialog.get_values();for(let e=0,t=this.dialog.fields.length;e<t;e++){let r=this.dialog.fields[e];r.is_cc_checkbox&&(i[r.fieldname]&&(i.cc=(i.cc?i.cc+", ":"")+r.fieldname,i.bcc=(i.bcc?i.bcc+", ":"")+r.fieldname),delete i[r.fieldname])}return i}save_as_draft(){if(this.dialog&&this.frm){let i=this.dialog.get_value("content");i=i.split(tf)[0],Dn.default.setItem(this.frm.doctype+this.frm.docname,i).catch(e=>{e&&(console.log(e),console.warn("[Communication] IndexedDB is full. Cannot save message as draft"))})}}clear_cache(){this.delete_saved_draft(),this.get_last_edited_communication(!0)}delete_saved_draft(){this.dialog&&this.frm&&Dn.default.removeItem(this.frm.doctype+this.frm.docname).catch(i=>{i&&(console.log(i),console.warn("[Communication] IndexedDB is full. Cannot save message as draft"))})}send_email(i,e,t,r,s){let n=this;if(this.dialog.hide(),!e.recipients){frappe.msgprint(__("Enter Email Recipient(s)"));return}if(e.attach_document_print||(r=null,s=null),this.frm&&!frappe.model.can_email(this.doc.doctype,this.frm)){frappe.msgprint(__("You are not allowed to send emails related to this document"));return}return frappe.call({method:"frappe.core.doctype.communication.email.make",args:{recipients:e.recipients,cc:e.cc,bcc:e.bcc,subject:e.subject,content:e.content,doctype:n.doc.doctype,name:n.doc.name,send_email:1,print_html:r,send_me_a_copy:e.send_me_a_copy,print_format:s,sender:e.sender,sender_full_name:e.sender?frappe.user.full_name():void 0,email_template:e.email_template,attachments:t,read_receipt:e.send_read_receipt,print_letterhead:n.is_print_letterhead_checked(),send_after:e.send_after?e.send_after:null,print_language:e.print_language},btn:i,callback(o){if(o.exc){if(frappe.msgprint(__("There were errors while sending email. Please try again.")),n.error)try{n.error(o)}catch(a){console.log(a)}}else if(frappe.utils.play_sound("email"),o.message.emails_not_sent_to&&frappe.msgprint(__("Email not sent to {0} (unsubscribed / disabled)",[frappe.utils.escape_html(o.message.emails_not_sent_to)])),n.clear_cache(),n.frm&&n.frm.reload_doc(),n.success)try{n.success(o)}catch(a){console.log(a)}}})}is_print_letterhead_checked(){return this.frm&&$(this.frm.wrapper).find(".form-print-wrapper").is(":visible")?$(this.frm.wrapper).find(".print-letterhead").prop("checked")?1:0:(frappe.model.get_doc(":Print Settings","Print Settings")||{with_letterhead:1}).with_letterhead?1:0}async set_content(i){if(this.content_set)return;let e=this.message||"";if(!e&&this.frm){let{doctype:r,docname:s}=this.frm;e=await Dn.default.getItem(r+s)||""}e&&(this.content_set=!0);let t=await this.get_signature(i||"");(!this.content_set||!strip_html(e).includes(strip_html(t)))&&(e+=t),this.is_a_reply&&!this.reply_set&&(e+=this.get_earlier_reply()),await this.dialog.set_value("content",e)}async get_signature(i){let e=frappe.boot.user.email_signature;if(!e){let t={add_signature:1};i?t.email_id=i:t.default_outgoing=1;let r=await frappe.db.get_list("Email Account",{filters:t,fields:["signature","email_id"],limit:1}),s=null;r.length&&(e=r[0].signature,s=r[0].email_id),!i&&s&&this.user_email_accounts&&this.user_email_accounts.includes(s)&&this.dialog.set_value("sender",s)}return e?(frappe.utils.is_html(e)||(e=e.replace(/\n/g,"<br>")),"<br>"+e):""}get_earlier_reply(){this.reply_set=!1;let i=this.last_email||this.frm&&this.frm.timeline.get_last_email(!0);if(!i)return"";let e=i.original_comment||i.content;e=this.html2text(e).replace(/\n/g,"<br>"),e.length>20*1024&&(e+="<div>"+__("Message clipped")+"</div>"+e,e=e.slice(0,20*1024));let t=frappe.datetime.global_date_format(i.communication_date||i.creation);return this.reply_set=!0,`
			<div><br></div>
			${tf||""}
			<p>
			${__("On {0}, {1} wrote:",[t,i.sender])}
			</p>
			<blockquote>
			${e}
			</blockquote>
		`}html2text(i){return i=i.replace(/<\/div>/g,"<br></div>").replace(/<\/p>/g,"<br></p>").replace(/<br>/g,`
`),frappe.utils.html2text(i).replace(/\n{3,}/g,`

`)}sanitize_emails(i){let e=i.get_value();if(!e)return;let t=e.split(",").map(r=>frappe.utils.xss_sanitise(r.trim())).join(",");t!=e&&i.set_value(t)}};frappe.views.TranslationManager=class{constructor(e){Object.assign(this,e),this.make()}make(){this.data=[],this.dialog=new frappe.ui.Dialog({fields:this.get_fields(),title:__("Translate {0}",[this.df.label]),no_submit_on_enter:!0,primary_action_label:__("Update Translations"),primary_action:e=>this.update_translations(e).then(()=>{this.dialog.hide(),this.data=[],frappe.msgprint({title:__("Success"),message:__("Successfully updated translations"),indicator:"green"})})}),this.get_translations_data().then(e=>{this.data.push(...e||[]),this.dialog.refresh(),this.dialog.show()})}get_fields(){var e=[{label:__("Source Text"),fieldname:"source",fieldtype:"Data",read_only:1,bold:1,default:this.source_text},{label:__("Translations"),fieldname:"translation_data",fieldtype:"Table",fields:[{label:"Language",fieldname:"language",fieldtype:"Link",options:"Language",in_list_view:1,columns:3},{label:"Translation",fieldname:"translation",fieldtype:"Text",in_list_view:1,columns:7}],data:this.data,get_data:()=>this.data}];return e}get_translations_data(){return frappe.db.get_list("Translation",{fields:["name","language","translated_text as translation"],filters:{source_text:strip_html(this.source_text)}})}update_translations({source:e,translation_data:t=[]}){let r={};return t.map(s=>{r[s.language]=s.translation}),frappe.call({method:"frappe.translate.update_translations_for_source",btn:this.dialog.get_primary_btn(),args:{source:e,translation_dict:r}}).fail(()=>{frappe.msgprint({title:__("Something went wrong"),message:__("Please try again"),indicator:"red"})})}};var Y0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function da(){}Object.assign(da,{default:da,register:da,revert:function(){},__esModule:!0});Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(i){let e=(this.document||this.ownerDocument).querySelectorAll(i),t=e.length;for(;--t>=0&&e.item(t)!==this;);return t>-1});Element.prototype.closest||(Element.prototype.closest=function(i){let e=this;if(!document.documentElement.contains(e))return null;do{if(e.matches(i))return e;e=e.parentElement||e.parentNode}while(e!==null);return null});Element.prototype.prepend||(Element.prototype.prepend=function(i){let e=document.createDocumentFragment();Array.isArray(i)||(i=[i]),i.forEach(t=>{let r=t instanceof Node;e.appendChild(r?t:document.createTextNode(t))}),this.insertBefore(e,this.firstChild)});Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(i){i=arguments.length===0?!0:!!i;let e=this.parentNode,t=window.getComputedStyle(e,null),r=parseInt(t.getPropertyValue("border-top-width")),s=parseInt(t.getPropertyValue("border-left-width")),n=this.offsetTop-e.offsetTop<e.scrollTop,o=this.offsetTop-e.offsetTop+this.clientHeight-r>e.scrollTop+e.clientHeight,a=this.offsetLeft-e.offsetLeft<e.scrollLeft,l=this.offsetLeft-e.offsetLeft+this.clientWidth-s>e.scrollLeft+e.clientWidth,c=n&&!o;(n||o)&&i&&(e.scrollTop=this.offsetTop-e.offsetTop-e.clientHeight/2-r+this.clientHeight/2),(a||l)&&i&&(e.scrollLeft=this.offsetLeft-e.offsetLeft-e.clientWidth/2-s+this.clientWidth/2),(n||o||a||l)&&!i&&this.scrollIntoView(c)});window.requestIdleCallback=window.requestIdleCallback||function(i){let e=Date.now();return setTimeout(function(){i({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})},1)};window.cancelIdleCallback=window.cancelIdleCallback||function(i){clearTimeout(i)};var G0=(i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),""),uf=(i=>(i.VERBOSE="VERBOSE",i.INFO="INFO",i.WARN="WARN",i.ERROR="ERROR",i))(uf||{}),xe={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,LEFT:37,UP:38,DOWN:40,RIGHT:39,DELETE:46,META:91},K0={LEFT:0,WHEEL:1,RIGHT:2,BACKWARD:3,FORWARD:4};function ws(i,e,t="log",r,s="color: inherit"){if(!("console"in window)||!window.console[t])return;let n=["info","log","warn","error"].includes(t),o=[];switch(ws.logLevel){case"ERROR":if(t!=="error")return;break;case"WARN":if(!["error","warn"].includes(t))return;break;case"INFO":if(!n||i)return;break}r&&o.push(r);let a="Editor.js 2.28.2",l=`line-height: 1em;
            color: #006FEA;
            display: inline-block;
            font-size: 11px;
            line-height: 1em;
            background-color: #fff;
            padding: 4px 9px;
            border-radius: 30px;
            border: 1px solid rgba(56, 138, 229, 0.16);
            margin: 4px 5px 4px 0;`;i&&(n?(o.unshift(l,s),e=`%c${a}%c ${e}`):e=`( ${a} )${e}`);try{n?r?console[t](`${e} %o`,...o):console[t](e,...o):console[t](e)}catch(c){}}ws.logLevel="VERBOSE";function X0(i){ws.logLevel=i}var Be=ws.bind(window,!1),Mt=ws.bind(window,!0);function Mi(i){return Object.prototype.toString.call(i).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function qe(i){return Mi(i)==="function"||Mi(i)==="asyncfunction"}function lt(i){return Mi(i)==="object"}function bi(i){return Mi(i)==="string"}function J0(i){return Mi(i)==="boolean"}function rf(i){return Mi(i)==="number"}function sf(i){return Mi(i)==="undefined"}function Rt(i){return i?Object.keys(i).length===0&&i.constructor===Object:!0}function pf(i){return i>47&&i<58||i===32||i===13||i===229||i>64&&i<91||i>95&&i<112||i>185&&i<193||i>218&&i<223}async function Z0(i,e=()=>{},t=()=>{}){async function r(s,n,o){try{await s.function(s.data),await n(sf(s.data)?{}:s.data)}catch(a){o(sf(s.data)?{}:s.data)}}return i.reduce(async(s,n)=>(await s,r(n,e,t)),Promise.resolve())}function hf(i){return Array.prototype.slice.call(i)}function dr(i,e){return function(){let t=this,r=arguments;window.setTimeout(()=>i.apply(t,r),e)}}function Q0(i){return i.name.split(".").pop()}function e1(i){return/^[-\w]+\/([-+\w]+|\*)$/.test(i)}function t1(i,e,t){let r;return(...s)=>{let n=this,o=()=>{r=null,t||i.apply(n,s)},a=t&&!r;window.clearTimeout(r),r=window.setTimeout(o,e),a&&i.apply(n,s)}}function ua(i,e,t=void 0){let r,s,n,o=null,a=0;t||(t={});let l=function(){a=t.leading===!1?0:Date.now(),o=null,n=i.apply(r,s),o||(r=s=null)};return function(){let c=Date.now();!a&&t.leading===!1&&(a=c);let u=e-(c-a);return r=this,s=arguments,u<=0||u>e?(o&&(clearTimeout(o),o=null),a=c,n=i.apply(r,s),o||(r=s=null)):!o&&t.trailing!==!1&&(o=setTimeout(l,u)),n}}function i1(){let i={win:!1,mac:!1,x11:!1,linux:!1},e=Object.keys(i).find(t=>window.navigator.appVersion.toLowerCase().indexOf(t)!==-1);return e&&(i[e]=!0),i}function ur(i){return i[0].toUpperCase()+i.slice(1)}function pa(i,...e){if(!e.length)return i;let t=e.shift();if(lt(i)&&lt(t))for(let r in t)lt(t[r])?(i[r]||Object.assign(i,{[r]:{}}),pa(i[r],t[r])):Object.assign(i,{[r]:t[r]});return pa(i,...e)}function tl(i){let e=i1();return i=i.replace(/shift/gi,"\u21E7").replace(/backspace/gi,"\u232B").replace(/enter/gi,"\u23CE").replace(/up/gi,"\u2191").replace(/left/gi,"\u2192").replace(/down/gi,"\u2193").replace(/right/gi,"\u2190").replace(/escape/gi,"\u238B").replace(/insert/gi,"Ins").replace(/delete/gi,"\u2421").replace(/\+/gi," + "),e.mac?i=i.replace(/ctrl|cmd/gi,"\u2318").replace(/alt/gi,"\u2325"):i=i.replace(/cmd/gi,"Ctrl").replace(/windows/gi,"WIN"),i}function r1(i){try{return new URL(i).href}catch(e){}return i.substring(0,2)==="//"?window.location.protocol+i:window.location.origin+i}function s1(){return G0(10)}function n1(i){window.open(i,"_blank")}function o1(i=""){return`${i}${Math.floor(Math.random()*1e8).toString(16)}`}function ha(i,e,t){let r=`\xAB${e}\xBB is deprecated and will be removed in the next major release. Please use the \xAB${t}\xBB instead.`;i&&Mt(r,"warn")}function _r(i,e,t){let r=t.value?"value":"get",s=t[r],n=`#${e}Cache`;if(t[r]=function(...o){return this[n]===void 0&&(this[n]=s.apply(this,...o)),this[n]},r==="get"&&t.set){let o=t.set;t.set=function(a){delete i[n],o.apply(this,a)}}return t}var ff=650;function Li(){return window.matchMedia(`(max-width: ${ff}px)`).matches}var nf=typeof window<"u"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1);function a1(i,e){let t=Array.isArray(i)||lt(i),r=Array.isArray(e)||lt(e);return t||r?JSON.stringify(i)===JSON.stringify(e):i===e}var G=class{static isSingleTag(e){return e.tagName&&["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"].includes(e.tagName)}static isLineBreakTag(e){return e&&e.tagName&&["BR","WBR"].includes(e.tagName)}static make(e,t=null,r={}){let s=document.createElement(e);Array.isArray(t)?s.classList.add(...t):t&&s.classList.add(t);for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s}static text(e){return document.createTextNode(e)}static append(e,t){Array.isArray(t)?t.forEach(r=>e.appendChild(r)):e.appendChild(t)}static prepend(e,t){Array.isArray(t)?(t=t.reverse(),t.forEach(r=>e.prepend(r))):e.prepend(t)}static swap(e,t){let r=document.createElement("div"),s=e.parentNode;s.insertBefore(r,e),s.insertBefore(e,t),s.insertBefore(t,r),s.removeChild(r)}static find(e=document,t){return e.querySelector(t)}static get(e){return document.getElementById(e)}static findAll(e=document,t){return e.querySelectorAll(t)}static get allInputsSelector(){return"[contenteditable=true], textarea, input:not([type]), "+["text","password","email","number","search","tel","url"].map(e=>`input[type="${e}"]`).join(", ")}static findAllInputs(e){return hf(e.querySelectorAll(G.allInputsSelector)).reduce((t,r)=>G.isNativeInput(r)||G.containsOnlyInlineElements(r)?[...t,r]:[...t,...G.getDeepestBlockElements(r)],[])}static getDeepestNode(e,t=!1){let r=t?"lastChild":"firstChild",s=t?"previousSibling":"nextSibling";if(e&&e.nodeType===Node.ELEMENT_NODE&&e[r]){let n=e[r];if(G.isSingleTag(n)&&!G.isNativeInput(n)&&!G.isLineBreakTag(n))if(n[s])n=n[s];else if(n.parentNode[s])n=n.parentNode[s];else return n.parentNode;return this.getDeepestNode(n,t)}return e}static isElement(e){return rf(e)?!1:e&&e.nodeType&&e.nodeType===Node.ELEMENT_NODE}static isFragment(e){return rf(e)?!1:e&&e.nodeType&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}static isContentEditable(e){return e.contentEditable==="true"}static isNativeInput(e){let t=["INPUT","TEXTAREA"];return e&&e.tagName?t.includes(e.tagName):!1}static canSetCaret(e){let t=!0;if(G.isNativeInput(e))switch(e.type){case"file":case"checkbox":case"radio":case"hidden":case"submit":case"button":case"image":case"reset":t=!1;break}else t=G.isContentEditable(e);return t}static isNodeEmpty(e){let t;return this.isSingleTag(e)&&!this.isLineBreakTag(e)?!1:(this.isElement(e)&&this.isNativeInput(e)?t=e.value:t=e.textContent.replace("\u200B",""),t.trim().length===0)}static isLeaf(e){return e?e.childNodes.length===0:!1}static isEmpty(e){e.normalize();let t=[e];for(;t.length>0;)if(e=t.shift(),!!e){if(this.isLeaf(e)&&!this.isNodeEmpty(e))return!1;e.childNodes&&t.push(...Array.from(e.childNodes))}return!0}static isHTMLString(e){let t=G.make("div");return t.innerHTML=e,t.childElementCount>0}static getContentLength(e){return G.isNativeInput(e)?e.value.length:e.nodeType===Node.TEXT_NODE?e.length:e.textContent.length}static get blockElements(){return["address","article","aside","blockquote","canvas","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","ruby","section","table","tbody","thead","tr","tfoot","ul","video"]}static containsOnlyInlineElements(e){let t;bi(e)?(t=document.createElement("div"),t.innerHTML=e):t=e;let r=s=>!G.blockElements.includes(s.tagName.toLowerCase())&&Array.from(s.children).every(r);return Array.from(t.children).every(r)}static getDeepestBlockElements(e){return G.containsOnlyInlineElements(e)?[e]:Array.from(e.children).reduce((t,r)=>[...t,...G.getDeepestBlockElements(r)],[])}static getHolder(e){return bi(e)?document.getElementById(e):e}static isAnchor(e){return e.tagName.toLowerCase()==="a"}static offset(e){let t=e.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop,n=t.top+s,o=t.left+r;return{top:n,left:o,bottom:n+t.height,right:o+t.width}}},l1={blockTunes:{toggler:{"Click to tune":"","or drag to move":""}},inlineToolbar:{converter:{"Convert to":""}},toolbar:{toolbox:{Add:""}},popover:{Filter:"","Nothing found":""}},c1={Text:"",Link:"",Bold:"",Italic:""},d1={link:{"Add a link":""},stub:{"The block can not be displayed correctly.":""}},u1={delete:{Delete:"","Click to delete":""},moveUp:{"Move up":""},moveDown:{"Move down":""}},_f={ui:l1,toolNames:c1,tools:d1,blockTunes:u1},ar=class{static ui(i,e){return ar._t(i,e)}static t(i,e){return ar._t(i,e)}static setDictionary(i){ar.currentDictionary=i}static _t(i,e){let t=ar.getNamespace(i);return!t||!t[e]?e:t[e]}static getNamespace(i){return i.split(".").reduce((e,t)=>!e||!Object.keys(e).length?{}:e[t],ar.currentDictionary)}},kt=ar;kt.currentDictionary=_f;var zn=class extends Error{},pr=class{constructor(){this.subscribers={}}on(e,t){e in this.subscribers||(this.subscribers[e]=[]),this.subscribers[e].push(t)}once(e,t){e in this.subscribers||(this.subscribers[e]=[]);let r=s=>{let n=t(s),o=this.subscribers[e].indexOf(r);return o!==-1&&this.subscribers[e].splice(o,1),n};this.subscribers[e].push(r)}emit(e,t){Rt(this.subscribers)||!this.subscribers[e]||this.subscribers[e].reduce((r,s)=>{let n=s(r);return n!==void 0?n:r},t)}off(e,t){if(this.subscribers[e]===void 0){console.warn(`EventDispatcher .off(): there is no subscribers for event "${e.toString()}". Probably, .off() called before .on()`);return}for(let r=0;r<this.subscribers[e].length;r++)if(this.subscribers[e][r]===t){delete this.subscribers[e][r];break}}destroy(){this.subscribers={}}};function Ai(i){Object.setPrototypeOf(this,{get id(){return i.id},get name(){return i.name},get config(){return i.config},get holder(){return i.holder},get isEmpty(){return i.isEmpty},get selected(){return i.selected},set stretched(e){i.stretched=e},get stretched(){return i.stretched},call(e,t){return i.call(e,t)},save(){return i.save()},validate(e){return i.validate(e)},dispatchChange(){i.dispatchChange()}})}var ps=class{constructor(){this.allListeners=[]}on(e,t,r,s=!1){let n=o1("l"),o={id:n,element:e,eventType:t,handler:r,options:s};if(!this.findOne(e,t,r))return this.allListeners.push(o),e.addEventListener(t,r,s),n}off(e,t,r,s){let n=this.findAll(e,t,r);n.forEach((o,a)=>{let l=this.allListeners.indexOf(n[a]);l>-1&&(this.allListeners.splice(l,1),o.element.removeEventListener(o.eventType,o.handler,o.options))})}offById(e){let t=this.findById(e);t&&t.element.removeEventListener(t.eventType,t.handler,t.options)}findOne(e,t,r){let s=this.findAll(e,t,r);return s.length>0?s[0]:null}findAll(e,t,r){let s,n=e?this.findByEventTarget(e):[];return e&&t&&r?s=n.filter(o=>o.eventType===t&&o.handler===r):e&&t?s=n.filter(o=>o.eventType===t):s=n,s}removeAll(){this.allListeners.map(e=>{e.element.removeEventListener(e.eventType,e.handler,e.options)}),this.allListeners=[]}destroy(){this.removeAll()}findByEventTarget(e){return this.allListeners.filter(t=>{if(t.element===e)return t})}findByType(e){return this.allListeners.filter(t=>{if(t.eventType===e)return t})}findByHandler(e){return this.allListeners.filter(t=>{if(t.handler===e)return t})}findById(e){return this.allListeners.find(t=>t.id===e)}},Oe=class{constructor({config:e,eventsDispatcher:t}){if(this.nodes={},this.listeners=new ps,this.readOnlyMutableListeners={on:(r,s,n,o=!1)=>{this.mutableListenerIds.push(this.listeners.on(r,s,n,o))},clearAll:()=>{for(let r of this.mutableListenerIds)this.listeners.offById(r);this.mutableListenerIds=[]}},this.mutableListenerIds=[],new.target===Oe)throw new TypeError("Constructors for abstract class Module are not allowed.");this.config=e,this.eventsDispatcher=t}set state(e){this.Editor=e}removeAllNodes(){for(let e in this.nodes){let t=this.nodes[e];t instanceof HTMLElement&&t.remove()}}get isRtl(){return this.config.i18n.direction==="rtl"}},ge=class{constructor(){this.instance=null,this.selection=null,this.savedSelectionRange=null,this.isFakeBackgroundEnabled=!1,this.commandBackground="backColor",this.commandRemoveFormat="removeFormat"}static get CSS(){return{editorWrapper:"codex-editor",editorZone:"codex-editor__redactor"}}static get anchorNode(){let e=window.getSelection();return e?e.anchorNode:null}static get anchorElement(){let e=window.getSelection();if(!e)return null;let t=e.anchorNode;return t?G.isElement(t)?t:t.parentElement:null}static get anchorOffset(){let e=window.getSelection();return e?e.anchorOffset:null}static get isCollapsed(){let e=window.getSelection();return e?e.isCollapsed:null}static get isAtEditor(){return this.isSelectionAtEditor(ge.get())}static isSelectionAtEditor(e){if(!e)return!1;let t=e.anchorNode||e.focusNode;t&&t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);let r=null;return t&&t instanceof Element&&(r=t.closest(`.${ge.CSS.editorZone}`)),r?r.nodeType===Node.ELEMENT_NODE:!1}static isRangeAtEditor(e){if(!e)return;let t=e.startContainer;t&&t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);let r=null;return t&&t instanceof Element&&(r=t.closest(`.${ge.CSS.editorZone}`)),r?r.nodeType===Node.ELEMENT_NODE:!1}static get isSelectionExists(){return!!ge.get().anchorNode}static get range(){return this.getRangeFromSelection(this.get())}static getRangeFromSelection(e){return e&&e.rangeCount?e.getRangeAt(0):null}static get rect(){let e=document.selection,t,r={x:0,y:0,width:0,height:0};if(e&&e.type!=="Control")return e=e,t=e.createRange(),r.x=t.boundingLeft,r.y=t.boundingTop,r.width=t.boundingWidth,r.height=t.boundingHeight,r;if(!window.getSelection)return Be("Method window.getSelection is not supported","warn"),r;if(e=window.getSelection(),e.rangeCount===null||isNaN(e.rangeCount))return Be("Method SelectionUtils.rangeCount is not supported","warn"),r;if(e.rangeCount===0)return r;if(t=e.getRangeAt(0).cloneRange(),t.getBoundingClientRect&&(r=t.getBoundingClientRect()),r.x===0&&r.y===0){let s=document.createElement("span");if(s.getBoundingClientRect){s.appendChild(document.createTextNode("\u200B")),t.insertNode(s),r=s.getBoundingClientRect();let n=s.parentNode;n.removeChild(s),n.normalize()}}return r}static get text(){return window.getSelection?window.getSelection().toString():""}static get(){return window.getSelection()}static setCursor(e,t=0){let r=document.createRange(),s=window.getSelection();return G.isNativeInput(e)?G.canSetCaret(e)?(e.focus(),e.selectionStart=e.selectionEnd=t,e.getBoundingClientRect()):void 0:(r.setStart(e,t),r.setEnd(e,t),s.removeAllRanges(),s.addRange(r),r.getBoundingClientRect())}static isRangeInsideContainer(e){let t=ge.range;return t===null?!1:e.contains(t.startContainer)}static addFakeCursor(){let e=ge.range;if(e===null)return;let t=G.make("span","codex-editor__fake-cursor");t.dataset.mutationFree="true",e.collapse(),e.insertNode(t)}static isFakeCursorInsideContainer(e){return G.find(e,".codex-editor__fake-cursor")!==null}static removeFakeCursor(e=document.body){let t=G.find(e,".codex-editor__fake-cursor");t&&t.remove()}removeFakeBackground(){this.isFakeBackgroundEnabled&&(this.isFakeBackgroundEnabled=!1,document.execCommand(this.commandRemoveFormat))}setFakeBackground(){document.execCommand(this.commandBackground,!1,"#a8d6ff"),this.isFakeBackgroundEnabled=!0}save(){this.savedSelectionRange=ge.range}restore(){if(!this.savedSelectionRange)return;let e=window.getSelection();e.removeAllRanges(),e.addRange(this.savedSelectionRange)}clearSaved(){this.savedSelectionRange=null}collapseToEnd(){let e=window.getSelection(),t=document.createRange();t.selectNodeContents(e.focusNode),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}findParentTag(e,t,r=10){let s=window.getSelection(),n=null;return!s||!s.anchorNode||!s.focusNode?null:([s.anchorNode,s.focusNode].forEach(o=>{let a=r;for(;a>0&&o.parentNode&&!(o.tagName===e&&(n=o,t&&o.classList&&!o.classList.contains(t)&&(n=null),n));)o=o.parentNode,a--}),n)}expandToTag(e){let t=window.getSelection();t.removeAllRanges();let r=document.createRange();r.selectNodeContents(e),t.addRange(r)}};function p1(i,e){let{type:t,target:r,addedNodes:s,removedNodes:n}=i;if(r===e)return!0;if(["characterData","attributes"].includes(t)){let l=r.nodeType===Node.TEXT_NODE?r.parentNode:r;return e.contains(l)}let o=Array.from(s).some(l=>e.contains(l)),a=Array.from(n).some(l=>e.contains(l));return o||a}var fa="redactor dom changed",mf="block changed",gf="fake cursor is about to be toggled",bf="fake cursor have been set";function of(i,e){return i.mergeable&&i.name===e.name}function h1(i,e){let t=e==null?void 0:e.export;return qe(t)?t(i):bi(t)?i[t]:(t!==void 0&&Be("Conversion \xABexport\xBB property must be a string or function. String means key of saved data object to export. Function should export processed string to export."),"")}function f1(i,e){let t=e==null?void 0:e.import;return qe(t)?t(i):bi(t)?{[t]:i}:(t!==void 0&&Be("Conversion \xABimport\xBB property must be a string or function. String means key of tool data to import. Function accepts a imported string and return composed tool data."),{})}var si=(i=>(i.APPEND_CALLBACK="appendCallback",i.RENDERED="rendered",i.MOVED="moved",i.UPDATED="updated",i.REMOVED="removed",i.ON_PASTE="onPaste",i))(si||{}),Qe=class extends pr{constructor({id:e=s1(),data:t,tool:r,api:s,readOnly:n,tunesData:o},a){super(),this.cachedInputs=[],this.toolRenderedElement=null,this.tunesInstances=new Map,this.defaultTunesInstances=new Map,this.unavailableTunesData={},this.inputIndex=0,this.editorEventBus=null,this.handleFocus=()=>{this.dropInputsCache(),this.updateCurrentInput()},this.didMutated=(l=void 0)=>{let c=l===void 0,u=l instanceof InputEvent;!c&&!u&&this.detectToolRootChange(l);let p;c||u?p=!0:p=!(l.length>0&&l.every(m=>{let{addedNodes:w,removedNodes:x,target:A}=m;return[...Array.from(w),...Array.from(x),A].some(D=>G.isElement(D)?D.dataset.mutationFree==="true":!1)})),p&&(this.dropInputsCache(),this.updateCurrentInput(),this.call("updated"),this.emit("didMutated",this))},this.name=r.name,this.id=e,this.settings=r.settings,this.config=r.settings.config||{},this.api=s,this.editorEventBus=a||null,this.blockAPI=new Ai(this),this.tool=r,this.toolInstance=r.create(t,this.blockAPI,n),this.tunes=r.tunes,this.composeTunes(o),this.holder=this.compose(),window.requestIdleCallback(()=>{this.watchBlockMutations(),this.addInputEvents()})}static get CSS(){return{wrapper:"ce-block",wrapperStretched:"ce-block--stretched",content:"ce-block__content",focused:"ce-block--focused",selected:"ce-block--selected",dropTarget:"ce-block--drop-target"}}get inputs(){if(this.cachedInputs.length!==0)return this.cachedInputs;let e=G.findAllInputs(this.holder);return this.inputIndex>e.length-1&&(this.inputIndex=e.length-1),this.cachedInputs=e,e}get currentInput(){return this.inputs[this.inputIndex]}set currentInput(e){let t=this.inputs.findIndex(r=>r===e||r.contains(e));t!==-1&&(this.inputIndex=t)}get firstInput(){return this.inputs[0]}get lastInput(){let e=this.inputs;return e[e.length-1]}get nextInput(){return this.inputs[this.inputIndex+1]}get previousInput(){return this.inputs[this.inputIndex-1]}get data(){return this.save().then(e=>e&&!Rt(e.data)?e.data:{})}get sanitize(){return this.tool.sanitizeConfig}get mergeable(){return qe(this.toolInstance.merge)}get isEmpty(){let e=G.isEmpty(this.pluginsContent),t=!this.hasMedia;return e&&t}get hasMedia(){let e=["img","iframe","video","audio","source","input","textarea","twitterwidget"];return!!this.holder.querySelector(e.join(","))}set focused(e){this.holder.classList.toggle(Qe.CSS.focused,e)}get focused(){return this.holder.classList.contains(Qe.CSS.focused)}set selected(e){var t,r;this.holder.classList.toggle(Qe.CSS.selected,e);let s=e===!0&&ge.isRangeInsideContainer(this.holder),n=e===!1&&ge.isFakeCursorInsideContainer(this.holder);(s||n)&&((t=this.editorEventBus)==null||t.emit(gf,{state:e}),s?ge.addFakeCursor():ge.removeFakeCursor(this.holder),(r=this.editorEventBus)==null||r.emit(bf,{state:e}))}get selected(){return this.holder.classList.contains(Qe.CSS.selected)}set stretched(e){this.holder.classList.toggle(Qe.CSS.wrapperStretched,e)}get stretched(){return this.holder.classList.contains(Qe.CSS.wrapperStretched)}set dropTarget(e){this.holder.classList.toggle(Qe.CSS.dropTarget,e)}get pluginsContent(){return this.toolRenderedElement}call(e,t){if(qe(this.toolInstance[e])){e==="appendCallback"&&Be("`appendCallback` hook is deprecated and will be removed in the next major release. Use `rendered` hook instead","warn");try{this.toolInstance[e].call(this.toolInstance,t)}catch(r){Be(`Error during '${e}' call: ${r.message}`,"error")}}}async mergeWith(e){await this.toolInstance.merge(e)}async save(){let e=await this.toolInstance.save(this.pluginsContent),t=this.unavailableTunesData;[...this.tunesInstances.entries(),...this.defaultTunesInstances.entries()].forEach(([n,o])=>{if(qe(o.save))try{t[n]=o.save()}catch(a){Be(`Tune ${o.constructor.name} save method throws an Error %o`,"warn",a)}});let r=window.performance.now(),s;return Promise.resolve(e).then(n=>(s=window.performance.now(),{id:this.id,tool:this.name,data:n,tunes:t,time:s-r})).catch(n=>{Be(`Saving process for ${this.name} tool failed due to the ${n}`,"log","red")})}async validate(e){let t=!0;return this.toolInstance.validate instanceof Function&&(t=await this.toolInstance.validate(e)),t}getTunes(){let e=document.createElement("div"),t=[],r=typeof this.toolInstance.renderSettings=="function"?this.toolInstance.renderSettings():[],s=[...this.tunesInstances.values(),...this.defaultTunesInstances.values()].map(n=>n.render());return[r,s].flat().forEach(n=>{G.isElement(n)?e.appendChild(n):Array.isArray(n)?t.push(...n):t.push(n)}),[t,e]}updateCurrentInput(){this.currentInput=G.isNativeInput(document.activeElement)||!ge.anchorNode?document.activeElement:ge.anchorNode}dispatchChange(){this.didMutated()}destroy(){this.unwatchBlockMutations(),this.removeInputEvents(),super.destroy(),qe(this.toolInstance.destroy)&&this.toolInstance.destroy()}async getActiveToolboxEntry(){let e=this.tool.toolbox;if(e.length===1)return Promise.resolve(this.tool.toolbox[0]);let t=await this.data;return e.find(r=>Object.entries(r.data).some(([s,n])=>t[s]&&a1(t[s],n)))}async exportDataAsString(){let e=await this.data;return h1(e,this.tool.conversionConfig)}compose(){let e=G.make("div",Qe.CSS.wrapper),t=G.make("div",Qe.CSS.content),r=this.toolInstance.render();e.dataset.id=this.id,this.toolRenderedElement=r,t.appendChild(this.toolRenderedElement);let s=t;return[...this.tunesInstances.values(),...this.defaultTunesInstances.values()].forEach(n=>{if(qe(n.wrap))try{s=n.wrap(s)}catch(o){Be(`Tune ${n.constructor.name} wrap method throws an Error %o`,"warn",o)}}),e.appendChild(s),e}composeTunes(e){Array.from(this.tunes.values()).forEach(t=>{(t.isInternal?this.defaultTunesInstances:this.tunesInstances).set(t.name,t.create(e[t.name],this.blockAPI))}),Object.entries(e).forEach(([t,r])=>{this.tunesInstances.has(t)||(this.unavailableTunesData[t]=r)})}addInputEvents(){this.inputs.forEach(e=>{e.addEventListener("focus",this.handleFocus),G.isNativeInput(e)&&e.addEventListener("input",this.didMutated)})}removeInputEvents(){this.inputs.forEach(e=>{e.removeEventListener("focus",this.handleFocus),G.isNativeInput(e)&&e.removeEventListener("input",this.didMutated)})}watchBlockMutations(){var e;this.redactorDomChangedCallback=t=>{let{mutations:r}=t;r.some(s=>p1(s,this.toolRenderedElement))&&this.didMutated(r)},(e=this.editorEventBus)==null||e.on(fa,this.redactorDomChangedCallback)}unwatchBlockMutations(){var e;(e=this.editorEventBus)==null||e.off(fa,this.redactorDomChangedCallback)}detectToolRootChange(e){e.forEach(t=>{if(Array.from(t.removedNodes).includes(this.toolRenderedElement)){let r=t.addedNodes[t.addedNodes.length-1];this.toolRenderedElement=r}})}dropInputsCache(){this.cachedInputs=[]}},_a=class extends Oe{constructor(){super(...arguments),this.insert=(e=this.config.defaultBlock,t={},r={},s,n,o,a)=>{let l=this.Editor.BlockManager.insert({id:a,tool:e,data:t,index:s,needToFocus:n,replace:o});return new Ai(l)},this.composeBlockData=async e=>{let t=this.Editor.Tools.blockTools.get(e);return new Qe({tool:t,api:this.Editor.API,readOnly:!0,data:{},tunesData:{}}).data},this.update=async(e,t)=>{let{BlockManager:r}=this.Editor,s=r.getBlockById(e);if(s===void 0)throw new Error(`Block with id "${e}" not found`);let n=await r.update(s,t);return new Ai(n)},this.convert=(e,t,r)=>{var s,n;let{BlockManager:o,Tools:a}=this.Editor,l=o.getBlockById(e);if(!l)throw new Error(`Block with id "${e}" not found`);let c=a.blockTools.get(l.name),u=a.blockTools.get(t);if(!u)throw new Error(`Block Tool with type "${t}" not found`);let p=((s=c==null?void 0:c.conversionConfig)==null?void 0:s.export)!==void 0,m=((n=u.conversionConfig)==null?void 0:n.import)!==void 0;if(p&&m)o.convert(l,t,r);else{let w=[p?!1:ur(l.name),m?!1:ur(t)].filter(Boolean).join(" and ");throw new Error(`Conversion from "${l.name}" to "${t}" is not possible. ${w} tool(s) should provide a "conversionConfig"`)}},this.insertMany=(e,t=this.Editor.BlockManager.blocks.length-1)=>{this.validateIndex(t);let r=e.map(({id:s,type:n,data:o})=>this.Editor.BlockManager.composeBlock({id:s,tool:n||this.config.defaultBlock,data:o}));return this.Editor.BlockManager.insertMany(r,t),r.map(s=>new Ai(s))}}get methods(){return{clear:()=>this.clear(),render:e=>this.render(e),renderFromHTML:e=>this.renderFromHTML(e),delete:e=>this.delete(e),swap:(e,t)=>this.swap(e,t),move:(e,t)=>this.move(e,t),getBlockByIndex:e=>this.getBlockByIndex(e),getById:e=>this.getById(e),getCurrentBlockIndex:()=>this.getCurrentBlockIndex(),getBlockIndex:e=>this.getBlockIndex(e),getBlocksCount:()=>this.getBlocksCount(),stretchBlock:(e,t=!0)=>this.stretchBlock(e,t),insertNewBlock:()=>this.insertNewBlock(),insert:this.insert,insertMany:this.insertMany,update:this.update,composeBlockData:this.composeBlockData,convert:this.convert}}getBlocksCount(){return this.Editor.BlockManager.blocks.length}getCurrentBlockIndex(){return this.Editor.BlockManager.currentBlockIndex}getBlockIndex(e){let t=this.Editor.BlockManager.getBlockById(e);if(!t){Mt("There is no block with id `"+e+"`","warn");return}return this.Editor.BlockManager.getBlockIndex(t)}getBlockByIndex(e){let t=this.Editor.BlockManager.getBlockByIndex(e);if(t===void 0){Mt("There is no block at index `"+e+"`","warn");return}return new Ai(t)}getById(e){let t=this.Editor.BlockManager.getBlockById(e);return t===void 0?(Mt("There is no block with id `"+e+"`","warn"),null):new Ai(t)}swap(e,t){Be("`blocks.swap()` method is deprecated and will be removed in the next major release. Use `block.move()` method instead","info"),this.Editor.BlockManager.swap(e,t)}move(e,t){this.Editor.BlockManager.move(e,t)}delete(e=this.Editor.BlockManager.currentBlockIndex){try{let t=this.Editor.BlockManager.getBlockByIndex(e);this.Editor.BlockManager.removeBlock(t)}catch(t){Mt(t,"warn");return}this.Editor.BlockManager.blocks.length===0&&this.Editor.BlockManager.insert(),this.Editor.BlockManager.currentBlock&&this.Editor.Caret.setToBlock(this.Editor.BlockManager.currentBlock,this.Editor.Caret.positions.END),this.Editor.Toolbar.close()}async clear(){await this.Editor.BlockManager.clear(!0),this.Editor.InlineToolbar.close()}async render(e){if(e===void 0||e.blocks===void 0)throw new Error("Incorrect data passed to the render() method");this.Editor.ModificationsObserver.disable(),await this.Editor.BlockManager.clear(),await this.Editor.Renderer.render(e.blocks),this.Editor.ModificationsObserver.enable()}renderFromHTML(e){return this.Editor.BlockManager.clear(),this.Editor.Paste.processText(e,!0)}stretchBlock(e,t=!0){ha(!0,"blocks.stretchBlock()","BlockAPI");let r=this.Editor.BlockManager.getBlockByIndex(e);r&&(r.stretched=t)}insertNewBlock(){Be("Method blocks.insertNewBlock() is deprecated and it will be removed in the next major release. Use blocks.insert() instead.","warn"),this.insert()}validateIndex(e){if(typeof e!="number")throw new Error("Index should be a number");if(e<0)throw new Error("Index should be greater than or equal to 0");if(e===null)throw new Error("Index should be greater than or equal to 0")}},ma=class extends Oe{constructor(){super(...arguments),this.setToFirstBlock=(e=this.Editor.Caret.positions.DEFAULT,t=0)=>this.Editor.BlockManager.firstBlock?(this.Editor.Caret.setToBlock(this.Editor.BlockManager.firstBlock,e,t),!0):!1,this.setToLastBlock=(e=this.Editor.Caret.positions.DEFAULT,t=0)=>this.Editor.BlockManager.lastBlock?(this.Editor.Caret.setToBlock(this.Editor.BlockManager.lastBlock,e,t),!0):!1,this.setToPreviousBlock=(e=this.Editor.Caret.positions.DEFAULT,t=0)=>this.Editor.BlockManager.previousBlock?(this.Editor.Caret.setToBlock(this.Editor.BlockManager.previousBlock,e,t),!0):!1,this.setToNextBlock=(e=this.Editor.Caret.positions.DEFAULT,t=0)=>this.Editor.BlockManager.nextBlock?(this.Editor.Caret.setToBlock(this.Editor.BlockManager.nextBlock,e,t),!0):!1,this.setToBlock=(e,t=this.Editor.Caret.positions.DEFAULT,r=0)=>this.Editor.BlockManager.blocks[e]?(this.Editor.Caret.setToBlock(this.Editor.BlockManager.blocks[e],t,r),!0):!1,this.focus=(e=!1)=>e?this.setToLastBlock(this.Editor.Caret.positions.END):this.setToFirstBlock(this.Editor.Caret.positions.START)}get methods(){return{setToFirstBlock:this.setToFirstBlock,setToLastBlock:this.setToLastBlock,setToPreviousBlock:this.setToPreviousBlock,setToNextBlock:this.setToNextBlock,setToBlock:this.setToBlock,focus:this.focus}}},ga=class extends Oe{get methods(){return{emit:(e,t)=>this.emit(e,t),off:(e,t)=>this.off(e,t),on:(e,t)=>this.on(e,t)}}on(e,t){this.eventsDispatcher.on(e,t)}emit(e,t){this.eventsDispatcher.emit(e,t)}off(e,t){this.eventsDispatcher.off(e,t)}},hs=class extends Oe{static getNamespace(e){return e.isTune()?`blockTunes.${e.name}`:`tools.${e.name}`}get methods(){return{t:()=>{Mt("I18n.t() method can be accessed only from Tools","warn")}}}getMethodsForTool(e){return Object.assign(this.methods,{t:t=>kt.t(hs.getNamespace(e),t)})}},ba=class extends Oe{get methods(){return{blocks:this.Editor.BlocksAPI.methods,caret:this.Editor.CaretAPI.methods,events:this.Editor.EventsAPI.methods,listeners:this.Editor.ListenersAPI.methods,notifier:this.Editor.NotifierAPI.methods,sanitizer:this.Editor.SanitizerAPI.methods,saver:this.Editor.SaverAPI.methods,selection:this.Editor.SelectionAPI.methods,styles:this.Editor.StylesAPI.classes,toolbar:this.Editor.ToolbarAPI.methods,inlineToolbar:this.Editor.InlineToolbarAPI.methods,tooltip:this.Editor.TooltipAPI.methods,i18n:this.Editor.I18nAPI.methods,readOnly:this.Editor.ReadOnlyAPI.methods,ui:this.Editor.UiAPI.methods}}getMethodsForTool(e){return Object.assign(this.methods,{i18n:this.Editor.I18nAPI.getMethodsForTool(e)})}},va=class extends Oe{get methods(){return{close:()=>this.close(),open:()=>this.open()}}open(){this.Editor.InlineToolbar.tryToShow()}close(){this.Editor.InlineToolbar.close()}},ya=class extends Oe{get methods(){return{on:(e,t,r,s)=>this.on(e,t,r,s),off:(e,t,r,s)=>this.off(e,t,r,s),offById:e=>this.offById(e)}}on(e,t,r,s){return this.listeners.on(e,t,r,s)}off(e,t,r,s){this.listeners.off(e,t,r,s)}offById(e){this.listeners.offById(e)}},wa={},_1={get exports(){return wa},set exports(i){wa=i}};(function(i,e){(function(t,r){i.exports=r()})(window,function(){return function(t){var r={};function s(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=t,s.c=r,s.d=function(n,o,a){s.o(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:a})},s.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,o){if(1&o&&(n=s(n)),8&o||4&o&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&o&&typeof n!="string")for(var l in n)s.d(a,l,function(c){return n[c]}.bind(null,l));return a},s.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(o,"a",o),o},s.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},s.p="/",s(s.s=0)}([function(t,r,s){s(1),t.exports=function(){var n=s(6),o="cdx-notify--bounce-in",a=null;return{show:function(l){if(l.message){(function(){if(a)return!0;a=n.getWrapper(),document.body.appendChild(a)})();var c=null,u=l.time||8e3;switch(l.type){case"confirm":c=n.confirm(l);break;case"prompt":c=n.prompt(l);break;default:c=n.alert(l),window.setTimeout(function(){c.remove()},u)}a.appendChild(c),c.classList.add(o)}}}}()},function(t,r,s){var n=s(2);typeof n=="string"&&(n=[[t.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};s(4)(n,o),n.locals&&(t.exports=n.locals)},function(t,r,s){(t.exports=s(3)(!1)).push([t.i,`.cdx-notify--error{background:#fffbfb!important}.cdx-notify--error::before{background:#fb5d5d!important}.cdx-notify__input{max-width:130px;padding:5px 10px;background:#f7f7f7;border:0;border-radius:3px;font-size:13px;color:#656b7c;outline:0}.cdx-notify__input:-ms-input-placeholder{color:#656b7c}.cdx-notify__input::placeholder{color:#656b7c}.cdx-notify__input:focus:-ms-input-placeholder{color:rgba(101,107,124,.3)}.cdx-notify__input:focus::placeholder{color:rgba(101,107,124,.3)}.cdx-notify__button{border:none;border-radius:3px;font-size:13px;padding:5px 10px;cursor:pointer}.cdx-notify__button:last-child{margin-left:10px}.cdx-notify__button--cancel{background:#f2f5f7;box-shadow:0 2px 1px 0 rgba(16,19,29,0);color:#656b7c}.cdx-notify__button--cancel:hover{background:#eee}.cdx-notify__button--confirm{background:#34c992;box-shadow:0 1px 1px 0 rgba(18,49,35,.05);color:#fff}.cdx-notify__button--confirm:hover{background:#33b082}.cdx-notify__btns-wrapper{display:-ms-flexbox;display:flex;-ms-flex-flow:row nowrap;flex-flow:row nowrap;margin-top:5px}.cdx-notify__cross{position:absolute;top:5px;right:5px;width:10px;height:10px;padding:5px;opacity:.54;cursor:pointer}.cdx-notify__cross::after,.cdx-notify__cross::before{content:'';position:absolute;left:9px;top:5px;height:12px;width:2px;background:#575d67}.cdx-notify__cross::before{transform:rotate(-45deg)}.cdx-notify__cross::after{transform:rotate(45deg)}.cdx-notify__cross:hover{opacity:1}.cdx-notifies{position:fixed;z-index:2;bottom:20px;left:20px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif}.cdx-notify{position:relative;width:220px;margin-top:15px;padding:13px 16px;background:#fff;box-shadow:0 11px 17px 0 rgba(23,32,61,.13);border-radius:5px;font-size:14px;line-height:1.4em;word-wrap:break-word}.cdx-notify::before{content:'';position:absolute;display:block;top:0;left:0;width:3px;height:calc(100% - 6px);margin:3px;border-radius:5px;background:0 0}@keyframes bounceIn{0%{opacity:0;transform:scale(.3)}50%{opacity:1;transform:scale(1.05)}70%{transform:scale(.9)}100%{transform:scale(1)}}.cdx-notify--bounce-in{animation-name:bounceIn;animation-duration:.6s;animation-iteration-count:1}.cdx-notify--success{background:#fafffe!important}.cdx-notify--success::before{background:#41ffb1!important}`,""])},function(t,r){t.exports=function(s){var n=[];return n.toString=function(){return this.map(function(o){var a=function(l,c){var u=l[1]||"",p=l[3];if(!p)return u;if(c&&typeof btoa=="function"){var m=(x=p,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(x))))+" */"),w=p.sources.map(function(A){return"/*# sourceURL="+p.sourceRoot+A+" */"});return[u].concat(w).concat([m]).join(`
`)}var x;return[u].join(`
`)}(o,s);return o[2]?"@media "+o[2]+"{"+a+"}":a}).join("")},n.i=function(o,a){typeof o=="string"&&(o=[[null,o,""]]);for(var l={},c=0;c<this.length;c++){var u=this[c][0];typeof u=="number"&&(l[u]=!0)}for(c=0;c<o.length;c++){var p=o[c];typeof p[0]=="number"&&l[p[0]]||(a&&!p[2]?p[2]=a:a&&(p[2]="("+p[2]+") and ("+a+")"),n.push(p))}},n}},function(t,r,s){var n,o,a={},l=(n=function(){return window&&document&&document.all&&!window.atob},function(){return o===void 0&&(o=n.apply(this,arguments)),o}),c=function(E){var k={};return function(M){if(typeof M=="function")return M();if(k[M]===void 0){var q=function(Y){return document.querySelector(Y)}.call(this,M);if(window.HTMLIFrameElement&&q instanceof window.HTMLIFrameElement)try{q=q.contentDocument.head}catch(Y){q=null}k[M]=q}return k[M]}}(),u=null,p=0,m=[],w=s(5);function x(E,k){for(var M=0;M<E.length;M++){var q=E[M],Y=a[q.id];if(Y){Y.refs++;for(var F=0;F<Y.parts.length;F++)Y.parts[F](q.parts[F]);for(;F<q.parts.length;F++)Y.parts.push(g(q.parts[F],k))}else{var Z=[];for(F=0;F<q.parts.length;F++)Z.push(g(q.parts[F],k));a[q.id]={id:q.id,refs:1,parts:Z}}}}function A(E,k){for(var M=[],q={},Y=0;Y<E.length;Y++){var F=E[Y],Z=k.base?F[0]+k.base:F[0],B={css:F[1],media:F[2],sourceMap:F[3]};q[Z]?q[Z].parts.push(B):M.push(q[Z]={id:Z,parts:[B]})}return M}function D(E,k){var M=c(E.insertInto);if(!M)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var q=m[m.length-1];if(E.insertAt==="top")q?q.nextSibling?M.insertBefore(k,q.nextSibling):M.appendChild(k):M.insertBefore(k,M.firstChild),m.push(k);else if(E.insertAt==="bottom")M.appendChild(k);else{if(typeof E.insertAt!="object"||!E.insertAt.before)throw new Error(`[Style Loader]

 Invalid value for parameter 'insertAt' ('options.insertAt') found.
 Must be 'top', 'bottom', or Object.
 (https://github.com/webpack-contrib/style-loader#insertat)
`);var Y=c(E.insertInto+" "+E.insertAt.before);M.insertBefore(k,Y)}}function j(E){if(E.parentNode===null)return!1;E.parentNode.removeChild(E);var k=m.indexOf(E);k>=0&&m.splice(k,1)}function ee(E){var k=document.createElement("style");return E.attrs.type===void 0&&(E.attrs.type="text/css"),d(k,E.attrs),D(E,k),k}function d(E,k){Object.keys(k).forEach(function(M){E.setAttribute(M,k[M])})}function g(E,k){var M,q,Y,F;if(k.transform&&E.css){if(!(F=k.transform(E.css)))return function(){};E.css=F}if(k.singleton){var Z=p++;M=u||(u=ee(k)),q=O.bind(null,M,Z,!1),Y=O.bind(null,M,Z,!0)}else E.sourceMap&&typeof URL=="function"&&typeof URL.createObjectURL=="function"&&typeof URL.revokeObjectURL=="function"&&typeof Blob=="function"&&typeof btoa=="function"?(M=function(B){var Q=document.createElement("link");return B.attrs.type===void 0&&(B.attrs.type="text/css"),B.attrs.rel="stylesheet",d(Q,B.attrs),D(B,Q),Q}(k),q=function(B,Q,ne){var ce=ne.css,be=ne.sourceMap,pe=Q.convertToAbsoluteUrls===void 0&&be;(Q.convertToAbsoluteUrls||pe)&&(ce=w(ce)),be&&(ce+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(be))))+" */");var Ie=new Blob([ce],{type:"text/css"}),ke=B.href;B.href=URL.createObjectURL(Ie),ke&&URL.revokeObjectURL(ke)}.bind(null,M,k),Y=function(){j(M),M.href&&URL.revokeObjectURL(M.href)}):(M=ee(k),q=function(B,Q){var ne=Q.css,ce=Q.media;if(ce&&B.setAttribute("media",ce),B.styleSheet)B.styleSheet.cssText=ne;else{for(;B.firstChild;)B.removeChild(B.firstChild);B.appendChild(document.createTextNode(ne))}}.bind(null,M),Y=function(){j(M)});return q(E),function(B){if(B){if(B.css===E.css&&B.media===E.media&&B.sourceMap===E.sourceMap)return;q(E=B)}else Y()}}t.exports=function(E,k){if(typeof DEBUG<"u"&&DEBUG&&typeof document!="object")throw new Error("The style-loader cannot be used in a non-browser environment");(k=k||{}).attrs=typeof k.attrs=="object"?k.attrs:{},k.singleton||typeof k.singleton=="boolean"||(k.singleton=l()),k.insertInto||(k.insertInto="head"),k.insertAt||(k.insertAt="bottom");var M=A(E,k);return x(M,k),function(q){for(var Y=[],F=0;F<M.length;F++){var Z=M[F];(B=a[Z.id]).refs--,Y.push(B)}for(q&&x(A(q,k),k),F=0;F<Y.length;F++){var B;if((B=Y[F]).refs===0){for(var Q=0;Q<B.parts.length;Q++)B.parts[Q]();delete a[B.id]}}}};var _,y=(_=[],function(E,k){return _[E]=k,_.filter(Boolean).join(`
`)});function O(E,k,M,q){var Y=M?"":q.css;if(E.styleSheet)E.styleSheet.cssText=y(k,Y);else{var F=document.createTextNode(Y),Z=E.childNodes;Z[k]&&E.removeChild(Z[k]),Z.length?E.insertBefore(F,Z[k]):E.appendChild(F)}}},function(t,r){t.exports=function(s){var n=typeof window<"u"&&window.location;if(!n)throw new Error("fixUrls requires window.location");if(!s||typeof s!="string")return s;var o=n.protocol+"//"+n.host,a=o+n.pathname.replace(/\/[^\/]*$/,"/");return s.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(l,c){var u,p=c.trim().replace(/^"(.*)"$/,function(m,w){return w}).replace(/^'(.*)'$/,function(m,w){return w});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(p)?l:(u=p.indexOf("//")===0?p:p.indexOf("/")===0?o+p:a+p.replace(/^\.\//,""),"url("+JSON.stringify(u)+")")})}},function(t,r,s){var n,o,a,l,c,u,p,m,w;t.exports=(n="cdx-notifies",o="cdx-notify",a="cdx-notify__cross",l="cdx-notify__button--confirm",c="cdx-notify__button--cancel",u="cdx-notify__input",p="cdx-notify__button",m="cdx-notify__btns-wrapper",{alert:w=function(x){var A=document.createElement("DIV"),D=document.createElement("DIV"),j=x.message,ee=x.style;return A.classList.add(o),ee&&A.classList.add(o+"--"+ee),A.innerHTML=j,D.classList.add(a),D.addEventListener("click",A.remove.bind(A)),A.appendChild(D),A},confirm:function(x){var A=w(x),D=document.createElement("div"),j=document.createElement("button"),ee=document.createElement("button"),d=A.querySelector("."+a),g=x.cancelHandler,_=x.okHandler;return D.classList.add(m),j.innerHTML=x.okText||"Confirm",ee.innerHTML=x.cancelText||"Cancel",j.classList.add(p),ee.classList.add(p),j.classList.add(l),ee.classList.add(c),g&&typeof g=="function"&&(ee.addEventListener("click",g),d.addEventListener("click",g)),_&&typeof _=="function"&&j.addEventListener("click",_),j.addEventListener("click",A.remove.bind(A)),ee.addEventListener("click",A.remove.bind(A)),D.appendChild(j),D.appendChild(ee),A.appendChild(D),A},prompt:function(x){var A=w(x),D=document.createElement("div"),j=document.createElement("button"),ee=document.createElement("input"),d=A.querySelector("."+a),g=x.cancelHandler,_=x.okHandler;return D.classList.add(m),j.innerHTML=x.okText||"Ok",j.classList.add(p),j.classList.add(l),ee.classList.add(u),x.placeholder&&ee.setAttribute("placeholder",x.placeholder),x.default&&(ee.value=x.default),x.inputType&&(ee.type=x.inputType),g&&typeof g=="function"&&d.addEventListener("click",g),_&&typeof _=="function"&&j.addEventListener("click",function(){_(ee.value)}),j.addEventListener("click",A.remove.bind(A)),D.appendChild(ee),D.appendChild(j),A.appendChild(D),A},getWrapper:function(){var x=document.createElement("DIV");return x.classList.add(n),x}})}])})})(_1);var m1=Yn(wa),ka=class{show(e){m1.show(e)}},xa=class extends Oe{constructor({config:e,eventsDispatcher:t}){super({config:e,eventsDispatcher:t}),this.notifier=new ka}get methods(){return{show:e=>this.show(e)}}show(e){return this.notifier.show(e)}},Ca=class extends Oe{get methods(){let e=()=>this.isEnabled;return{toggle:t=>this.toggle(t),get isEnabled(){return e()}}}toggle(e){return this.Editor.ReadOnly.toggle(e)}get isEnabled(){return this.Editor.ReadOnly.isEnabled}},Sa={},g1={get exports(){return Sa},set exports(i){Sa=i}};(function(i,e){(function(t,r){i.exports=r()})(Y0,function(){function t(p){var m=p.tags,w=Object.keys(m),x=w.map(function(A){return typeof m[A]}).every(function(A){return A==="object"||A==="boolean"||A==="function"});if(!x)throw new Error("The configuration was invalid");this.config=p}var r=["P","LI","TD","TH","DIV","H1","H2","H3","H4","H5","H6","PRE"];function s(p){return r.indexOf(p.nodeName)!==-1}var n=["A","B","STRONG","I","EM","SUB","SUP","U","STRIKE"];function o(p){return n.indexOf(p.nodeName)!==-1}t.prototype.clean=function(p){let m=document.implementation.createHTMLDocument(),w=m.createElement("div");return w.innerHTML=p,this._sanitize(m,w),w.innerHTML},t.prototype._sanitize=function(p,m){var w=a(p,m),x=w.firstChild();if(x)do{if(x.nodeType===Node.TEXT_NODE)if(x.data.trim()===""&&(x.previousElementSibling&&s(x.previousElementSibling)||x.nextElementSibling&&s(x.nextElementSibling))){m.removeChild(x),this._sanitize(p,m);break}else continue;if(x.nodeType===Node.COMMENT_NODE){m.removeChild(x),this._sanitize(p,m);break}var A=o(x),D;A&&(D=Array.prototype.some.call(x.childNodes,s));var j=!!m.parentNode,ee=s(m)&&s(x)&&j,d=x.nodeName.toLowerCase(),g=l(this.config,d,x),_=A&&D;if(_||c(x,g)||!this.config.keepNestedBlockElements&&ee){if(!(x.nodeName==="SCRIPT"||x.nodeName==="STYLE"))for(;x.childNodes.length>0;)m.insertBefore(x.childNodes[0],x);m.removeChild(x),this._sanitize(p,m);break}for(var y=0;y<x.attributes.length;y+=1){var O=x.attributes[y];u(O,g,x)&&(x.removeAttribute(O.name),y=y-1)}this._sanitize(p,x)}while(x=w.nextSibling())};function a(p,m){return p.createTreeWalker(m,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,null,!1)}function l(p,m,w){return typeof p.tags[m]=="function"?p.tags[m](w):p.tags[m]}function c(p,m){return typeof m>"u"?!0:typeof m=="boolean"?!m:!1}function u(p,m,w){var x=p.name.toLowerCase();return m===!0?!1:typeof m[x]=="function"?!m[x](p.value,w):typeof m[x]>"u"||m[x]===!1?!0:typeof m[x]=="string"?m[x]!==p.value:!1}return t})})(g1);var b1=Sa;function vf(i,e){return i.map(t=>{let r=qe(e)?e(t.tool):e;return Rt(r)||(t.data=il(t.data,r)),t})}function ni(i,e={}){let t={tags:e};return new b1(t).clean(i)}function il(i,e){return Array.isArray(i)?v1(i,e):lt(i)?y1(i,e):bi(i)?w1(i,e):i}function v1(i,e){return i.map(t=>il(t,e))}function y1(i,e){let t={};for(let r in i){if(!Object.prototype.hasOwnProperty.call(i,r))continue;let s=i[r],n=k1(e[r])?e[r]:e;t[r]=il(s,n)}return t}function w1(i,e){return lt(e)?ni(i,e):e===!1?ni(i,{}):i}function k1(i){return lt(i)||J0(i)||qe(i)}var Ta=class extends Oe{get methods(){return{clean:(e,t)=>this.clean(e,t)}}clean(e,t){return ni(e,t)}},Ea=class extends Oe{get methods(){return{save:()=>this.save()}}save(){let e="Editor's content can not be saved in read-only mode";return this.Editor.ReadOnly.isEnabled?(Mt(e,"warn"),Promise.reject(new Error(e))):this.Editor.Saver.save()}},$a=class extends Oe{get methods(){return{findParentTag:(e,t)=>this.findParentTag(e,t),expandToTag:e=>this.expandToTag(e)}}findParentTag(e,t){return new ge().findParentTag(e,t)}expandToTag(e){new ge().expandToTag(e)}},Oa=class extends Oe{get classes(){return{block:"cdx-block",inlineToolButton:"ce-inline-tool",inlineToolButtonActive:"ce-inline-tool--active",input:"cdx-input",loader:"cdx-loader",button:"cdx-button",settingsButton:"cdx-settings-button",settingsButtonActive:"cdx-settings-button--active"}}},Aa=class extends Oe{get methods(){return{close:()=>this.close(),open:()=>this.open(),toggleBlockSettings:e=>this.toggleBlockSettings(e),toggleToolbox:e=>this.toggleToolbox(e)}}open(){this.Editor.Toolbar.moveAndOpen()}close(){this.Editor.Toolbar.close()}toggleBlockSettings(e){if(this.Editor.BlockManager.currentBlockIndex===-1){Mt("Could't toggle the Toolbar because there is no block selected ","warn");return}(e!=null?e:!this.Editor.BlockSettings.opened)?(this.Editor.Toolbar.moveAndOpen(),this.Editor.BlockSettings.open()):this.Editor.BlockSettings.close()}toggleToolbox(e){if(this.Editor.BlockManager.currentBlockIndex===-1){Mt("Could't toggle the Toolbox because there is no block selected ","warn");return}(e!=null?e:!this.Editor.Toolbar.toolbox.opened)?(this.Editor.Toolbar.moveAndOpen(),this.Editor.Toolbar.toolbox.open()):this.Editor.Toolbar.toolbox.close()}},La={},x1={get exports(){return La},set exports(i){La=i}};(function(i,e){(function(t,r){i.exports=r()})(window,function(){return function(t){var r={};function s(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=t,s.c=r,s.d=function(n,o,a){s.o(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:a})},s.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,o){if(1&o&&(n=s(n)),8&o||4&o&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&o&&typeof n!="string")for(var l in n)s.d(a,l,function(c){return n[c]}.bind(null,l));return a},s.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(o,"a",o),o},s.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},s.p="",s(s.s=0)}([function(t,r,s){t.exports=s(1)},function(t,r,s){s.r(r),s.d(r,"default",function(){return n});class n{constructor(){this.nodes={wrapper:null,content:null},this.showed=!1,this.offsetTop=10,this.offsetLeft=10,this.offsetRight=10,this.hidingDelay=0,this.handleWindowScroll=()=>{this.showed&&this.hide(!0)},this.loadStyles(),this.prepare(),window.addEventListener("scroll",this.handleWindowScroll,{passive:!0})}get CSS(){return{tooltip:"ct",tooltipContent:"ct__content",tooltipShown:"ct--shown",placement:{left:"ct--left",bottom:"ct--bottom",right:"ct--right",top:"ct--top"}}}show(a,l,c){this.nodes.wrapper||this.prepare(),this.hidingTimeout&&clearTimeout(this.hidingTimeout);let u=Object.assign({placement:"bottom",marginTop:0,marginLeft:0,marginRight:0,marginBottom:0,delay:70,hidingDelay:0},c);if(u.hidingDelay&&(this.hidingDelay=u.hidingDelay),this.nodes.content.innerHTML="",typeof l=="string")this.nodes.content.appendChild(document.createTextNode(l));else{if(!(l instanceof Node))throw Error("[CodeX Tooltip] Wrong type of \xABcontent\xBB passed. It should be an instance of Node or String. But "+typeof l+" given.");this.nodes.content.appendChild(l)}switch(this.nodes.wrapper.classList.remove(...Object.values(this.CSS.placement)),u.placement){case"top":this.placeTop(a,u);break;case"left":this.placeLeft(a,u);break;case"right":this.placeRight(a,u);break;case"bottom":default:this.placeBottom(a,u)}u&&u.delay?this.showingTimeout=setTimeout(()=>{this.nodes.wrapper.classList.add(this.CSS.tooltipShown),this.showed=!0},u.delay):(this.nodes.wrapper.classList.add(this.CSS.tooltipShown),this.showed=!0)}hide(a=!1){if(this.hidingDelay&&!a)return this.hidingTimeout&&clearTimeout(this.hidingTimeout),void(this.hidingTimeout=setTimeout(()=>{this.hide(!0)},this.hidingDelay));this.nodes.wrapper.classList.remove(this.CSS.tooltipShown),this.showed=!1,this.showingTimeout&&clearTimeout(this.showingTimeout)}onHover(a,l,c){a.addEventListener("mouseenter",()=>{this.show(a,l,c)}),a.addEventListener("mouseleave",()=>{this.hide()})}destroy(){this.nodes.wrapper.remove(),window.removeEventListener("scroll",this.handleWindowScroll)}prepare(){this.nodes.wrapper=this.make("div",this.CSS.tooltip),this.nodes.content=this.make("div",this.CSS.tooltipContent),this.append(this.nodes.wrapper,this.nodes.content),this.append(document.body,this.nodes.wrapper)}loadStyles(){let a="codex-tooltips-style";if(document.getElementById(a))return;let l=s(2),c=this.make("style",null,{textContent:l.toString(),id:a});this.prepend(document.head,c)}placeBottom(a,l){let c=a.getBoundingClientRect(),u=c.left+a.clientWidth/2-this.nodes.wrapper.offsetWidth/2,p=c.bottom+window.pageYOffset+this.offsetTop+l.marginTop;this.applyPlacement("bottom",u,p)}placeTop(a,l){let c=a.getBoundingClientRect(),u=c.left+a.clientWidth/2-this.nodes.wrapper.offsetWidth/2,p=c.top+window.pageYOffset-this.nodes.wrapper.clientHeight-this.offsetTop;this.applyPlacement("top",u,p)}placeLeft(a,l){let c=a.getBoundingClientRect(),u=c.left-this.nodes.wrapper.offsetWidth-this.offsetLeft-l.marginLeft,p=c.top+window.pageYOffset+a.clientHeight/2-this.nodes.wrapper.offsetHeight/2;this.applyPlacement("left",u,p)}placeRight(a,l){let c=a.getBoundingClientRect(),u=c.right+this.offsetRight+l.marginRight,p=c.top+window.pageYOffset+a.clientHeight/2-this.nodes.wrapper.offsetHeight/2;this.applyPlacement("right",u,p)}applyPlacement(a,l,c){this.nodes.wrapper.classList.add(this.CSS.placement[a]),this.nodes.wrapper.style.left=l+"px",this.nodes.wrapper.style.top=c+"px"}make(a,l=null,c={}){let u=document.createElement(a);Array.isArray(l)?u.classList.add(...l):l&&u.classList.add(l);for(let p in c)c.hasOwnProperty(p)&&(u[p]=c[p]);return u}append(a,l){Array.isArray(l)?l.forEach(c=>a.appendChild(c)):a.appendChild(l)}prepend(a,l){Array.isArray(l)?(l=l.reverse()).forEach(c=>a.prepend(c)):a.prepend(l)}}},function(t,r){t.exports=`.ct{z-index:999;opacity:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none;-webkit-transition:opacity 50ms ease-in,-webkit-transform 70ms cubic-bezier(.215,.61,.355,1);transition:opacity 50ms ease-in,-webkit-transform 70ms cubic-bezier(.215,.61,.355,1);transition:opacity 50ms ease-in,transform 70ms cubic-bezier(.215,.61,.355,1);transition:opacity 50ms ease-in,transform 70ms cubic-bezier(.215,.61,.355,1),-webkit-transform 70ms cubic-bezier(.215,.61,.355,1);will-change:opacity,top,left;-webkit-box-shadow:0 8px 12px 0 rgba(29,32,43,.17),0 4px 5px -3px rgba(5,6,12,.49);box-shadow:0 8px 12px 0 rgba(29,32,43,.17),0 4px 5px -3px rgba(5,6,12,.49);border-radius:9px}.ct,.ct:before{position:absolute;top:0;left:0}.ct:before{content:"";bottom:0;right:0;background-color:#1d202b;z-index:-1;border-radius:4px}@supports(-webkit-mask-box-image:url("")){.ct:before{border-radius:0;-webkit-mask-box-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M10.71 0h2.58c3.02 0 4.64.42 6.1 1.2a8.18 8.18 0 013.4 3.4C23.6 6.07 24 7.7 24 10.71v2.58c0 3.02-.42 4.64-1.2 6.1a8.18 8.18 0 01-3.4 3.4c-1.47.8-3.1 1.21-6.11 1.21H10.7c-3.02 0-4.64-.42-6.1-1.2a8.18 8.18 0 01-3.4-3.4C.4 17.93 0 16.3 0 13.29V10.7c0-3.02.42-4.64 1.2-6.1a8.18 8.18 0 013.4-3.4C6.07.4 7.7 0 10.71 0z"/></svg>') 48% 41% 37.9% 53.3%}}@media (--mobile){.ct{display:none}}.ct__content{padding:6px 10px;color:#cdd1e0;font-size:12px;text-align:center;letter-spacing:.02em;line-height:1em}.ct:after{content:"";width:8px;height:8px;position:absolute;background-color:#1d202b;z-index:-1}.ct--bottom{-webkit-transform:translateY(5px);transform:translateY(5px)}.ct--bottom:after{top:-3px;left:50%;-webkit-transform:translateX(-50%) rotate(-45deg);transform:translateX(-50%) rotate(-45deg)}.ct--top{-webkit-transform:translateY(-5px);transform:translateY(-5px)}.ct--top:after{top:auto;bottom:-3px;left:50%;-webkit-transform:translateX(-50%) rotate(-45deg);transform:translateX(-50%) rotate(-45deg)}.ct--left{-webkit-transform:translateX(-5px);transform:translateX(-5px)}.ct--left:after{top:50%;left:auto;right:0;-webkit-transform:translate(41.6%,-50%) rotate(-45deg);transform:translate(41.6%,-50%) rotate(-45deg)}.ct--right{-webkit-transform:translateX(5px);transform:translateX(5px)}.ct--right:after{top:50%;left:0;-webkit-transform:translate(-41.6%,-50%) rotate(-45deg);transform:translate(-41.6%,-50%) rotate(-45deg)}.ct--shown{opacity:1;-webkit-transform:none;transform:none}`}]).default})})(x1);var C1=Yn(La),fs=class{constructor(){this.lib=new C1}destroy(){this.lib.destroy()}show(e,t,r){this.lib.show(e,t,r)}hide(e=!1){this.lib.hide(e)}onHover(e,t,r){this.lib.onHover(e,t,r)}},Ba=class extends Oe{constructor({config:e,eventsDispatcher:t}){super({config:e,eventsDispatcher:t}),this.tooltip=new fs}destroy(){this.tooltip.destroy()}get methods(){return{show:(e,t,r)=>this.show(e,t,r),hide:()=>this.hide(),onHover:(e,t,r)=>this.onHover(e,t,r)}}show(e,t,r){this.tooltip.show(e,t,r)}hide(){this.tooltip.hide()}onHover(e,t,r){this.tooltip.onHover(e,t,r)}},Ia=class extends Oe{get methods(){return{nodes:this.editorNodes}}get editorNodes(){return{wrapper:this.Editor.UI.nodes.wrapper,redactor:this.Editor.UI.nodes.redactor}}};function yf(i,e){let t={};return Object.entries(i).forEach(([r,s])=>{if(lt(s)){let n=e?`${e}.${r}`:r;Object.values(s).every(o=>bi(o))?t[r]=n:t[r]=yf(s,n);return}t[r]=s}),t}var Nt=yf(_f);function S1(i,e){let t={};return Object.keys(i).forEach(r=>{let s=e[r];s!==void 0?t[s]=i[r]:t[r]=i[r]}),t}var T1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M9 12L9 7.1C9 7.04477 9.04477 7 9.1 7H10.4C11.5 7 14 7.1 14 9.5C14 9.5 14 12 11 12M9 12V16.8C9 16.9105 9.08954 17 9.2 17H12.5C14 17 15 16 15 14.5C15 11.7046 11 12 11 12M9 12H11"/></svg>',wf='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7 10L11.8586 14.8586C11.9367 14.9367 12.0633 14.9367 12.1414 14.8586L17 10"/></svg>',E1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7 15L11.8586 10.1414C11.9367 10.0633 12.0633 10.0633 12.1414 10.1414L17 15"/></svg>',$1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8 8L12 12M12 12L16 16M12 12L16 8M12 12L8 16"/></svg>',O1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/></svg>',A1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M13.34 10C12.4223 12.7337 11 17 11 17"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M14.21 7H14.2"/></svg>',af='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7.69998 12.6L7.67896 12.62C6.53993 13.7048 6.52012 15.5155 7.63516 16.625V16.625C8.72293 17.7073 10.4799 17.7102 11.5712 16.6314L13.0263 15.193C14.0703 14.1609 14.2141 12.525 13.3662 11.3266L13.22 11.12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16.22 11.12L16.3564 10.9805C17.2895 10.0265 17.3478 8.5207 16.4914 7.49733V7.49733C15.5691 6.39509 13.9269 6.25143 12.8271 7.17675L11.3901 8.38588C10.0935 9.47674 9.95706 11.4241 11.0888 12.6852L11.12 12.72"/></svg>',L1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M9.40999 7.29999H9.4"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M14.6 7.29999H14.59"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M9.30999 12H9.3"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M14.6 12H14.59"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M9.40999 16.7H9.4"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M14.6 16.7H14.59"/></svg>',B1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M12 7V12M12 17V12M17 12H12M12 12H7"/></svg>',I1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><circle cx="10.5" cy="10.5" r="5.5" stroke="currentColor" stroke-width="2"/><line x1="15.4142" x2="19" y1="15" y2="18.5858" stroke="currentColor" stroke-linecap="round" stroke-width="2"/></svg>',M1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M15.7795 11.5C15.7795 11.5 16.053 11.1962 16.5497 10.6722C17.4442 9.72856 17.4701 8.2475 16.5781 7.30145V7.30145C15.6482 6.31522 14.0873 6.29227 13.1288 7.25073L11.8796 8.49999"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8.24517 12.3883C8.24517 12.3883 7.97171 12.6922 7.47504 13.2161C6.58051 14.1598 6.55467 15.6408 7.44666 16.5869V16.5869C8.37653 17.5731 9.93744 17.5961 10.8959 16.6376L12.1452 15.3883"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M17.7802 15.1032L16.597 14.9422C16.0109 14.8624 15.4841 15.3059 15.4627 15.8969L15.4199 17.0818"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6.39064 9.03238L7.58432 9.06668C8.17551 9.08366 8.6522 8.58665 8.61056 7.99669L8.5271 6.81397"/><line x1="12.1142" x2="11.7" y1="12.2" y2="11.7858" stroke="currentColor" stroke-linecap="round" stroke-width="2"/></svg>',N1='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="14" height="14" x="5" y="5" stroke="currentColor" stroke-width="2" rx="4"/><line x1="12" x2="12" y1="9" y2="12" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M12 15.02V15.01"/></svg>',Ge=class{constructor(e){this.nodes={root:null,icon:null},this.confirmationState=null,this.removeSpecialFocusBehavior=()=>{this.nodes.root.classList.remove(Ge.CSS.noFocus)},this.removeSpecialHoverBehavior=()=>{this.nodes.root.classList.remove(Ge.CSS.noHover)},this.onErrorAnimationEnd=()=>{this.nodes.icon.classList.remove(Ge.CSS.wobbleAnimation),this.nodes.icon.removeEventListener("animationend",this.onErrorAnimationEnd)},this.params=e,this.nodes.root=this.make(e)}get isDisabled(){return this.params.isDisabled}get toggle(){return this.params.toggle}get title(){return this.params.title}get closeOnActivate(){return this.params.closeOnActivate}get isConfirmationStateEnabled(){return this.confirmationState!==null}get isFocused(){return this.nodes.root.classList.contains(Ge.CSS.focused)}static get CSS(){return{container:"ce-popover-item",title:"ce-popover-item__title",secondaryTitle:"ce-popover-item__secondary-title",icon:"ce-popover-item__icon",active:"ce-popover-item--active",disabled:"ce-popover-item--disabled",focused:"ce-popover-item--focused",hidden:"ce-popover-item--hidden",confirmationState:"ce-popover-item--confirmation",noHover:"ce-popover-item--no-hover",noFocus:"ce-popover-item--no-focus",wobbleAnimation:"wobble"}}getElement(){return this.nodes.root}handleClick(){if(this.isConfirmationStateEnabled){this.activateOrEnableConfirmationMode(this.confirmationState);return}this.activateOrEnableConfirmationMode(this.params)}toggleActive(e){this.nodes.root.classList.toggle(Ge.CSS.active,e)}toggleHidden(e){this.nodes.root.classList.toggle(Ge.CSS.hidden,e)}reset(){this.isConfirmationStateEnabled&&this.disableConfirmationMode()}onFocus(){this.disableSpecialHoverAndFocusBehavior()}make(e){let t=G.make("div",Ge.CSS.container);return e.name&&(t.dataset.itemName=e.name),this.nodes.icon=G.make("div",Ge.CSS.icon,{innerHTML:e.icon||O1}),t.appendChild(this.nodes.icon),t.appendChild(G.make("div",Ge.CSS.title,{innerHTML:e.title||""})),e.secondaryLabel&&t.appendChild(G.make("div",Ge.CSS.secondaryTitle,{textContent:e.secondaryLabel})),e.isActive&&t.classList.add(Ge.CSS.active),e.isDisabled&&t.classList.add(Ge.CSS.disabled),t}enableConfirmationMode(e){let t=rt(Ee(Ee({},this.params),e),{confirmation:e.confirmation}),r=this.make(t);this.nodes.root.innerHTML=r.innerHTML,this.nodes.root.classList.add(Ge.CSS.confirmationState),this.confirmationState=e,this.enableSpecialHoverAndFocusBehavior()}disableConfirmationMode(){let e=this.make(this.params);this.nodes.root.innerHTML=e.innerHTML,this.nodes.root.classList.remove(Ge.CSS.confirmationState),this.confirmationState=null,this.disableSpecialHoverAndFocusBehavior()}enableSpecialHoverAndFocusBehavior(){this.nodes.root.classList.add(Ge.CSS.noHover),this.nodes.root.classList.add(Ge.CSS.noFocus),this.nodes.root.addEventListener("mouseleave",this.removeSpecialHoverBehavior,{once:!0})}disableSpecialHoverAndFocusBehavior(){this.removeSpecialFocusBehavior(),this.removeSpecialHoverBehavior(),this.nodes.root.removeEventListener("mouseleave",this.removeSpecialHoverBehavior)}activateOrEnableConfirmationMode(e){if(e.confirmation===void 0)try{e.onActivate(e),this.disableConfirmationMode()}catch(t){this.animateError()}else this.enableConfirmationMode(e.confirmation)}animateError(){this.nodes.icon.classList.contains(Ge.CSS.wobbleAnimation)||(this.nodes.icon.classList.add(Ge.CSS.wobbleAnimation),this.nodes.icon.addEventListener("animationend",this.onErrorAnimationEnd))}},cs=class{constructor(i,e){this.cursor=-1,this.items=[],this.items=i||[],this.focusedCssClass=e}get currentItem(){return this.cursor===-1?null:this.items[this.cursor]}setCursor(i){i<this.items.length&&i>=-1&&(this.dropCursor(),this.cursor=i,this.items[this.cursor].classList.add(this.focusedCssClass))}setItems(i){this.items=i}next(){this.cursor=this.leafNodesAndReturnIndex(cs.directions.RIGHT)}previous(){this.cursor=this.leafNodesAndReturnIndex(cs.directions.LEFT)}dropCursor(){this.cursor!==-1&&(this.items[this.cursor].classList.remove(this.focusedCssClass),this.cursor=-1)}leafNodesAndReturnIndex(i){if(this.items.length===0)return this.cursor;let e=this.cursor;return e===-1?e=i===cs.directions.RIGHT?-1:0:this.items[e].classList.remove(this.focusedCssClass),i===cs.directions.RIGHT?e=(e+1)%this.items.length:e=(this.items.length+e-1)%this.items.length,G.canSetCaret(this.items[e])&&dr(()=>ge.setCursor(this.items[e]),50)(),this.items[e].classList.add(this.focusedCssClass),e}},lr=cs;lr.directions={RIGHT:"right",LEFT:"left"};var Dt=class{constructor(e){this.iterator=null,this.activated=!1,this.flipCallbacks=[],this.onKeyDown=t=>{if(this.isEventReadyForHandling(t))switch(Dt.usedKeys.includes(t.keyCode)&&t.preventDefault(),t.keyCode){case xe.TAB:this.handleTabPress(t);break;case xe.LEFT:case xe.UP:this.flipLeft();break;case xe.RIGHT:case xe.DOWN:this.flipRight();break;case xe.ENTER:this.handleEnterPress(t);break}},this.iterator=new lr(e.items,e.focusedItemClass),this.activateCallback=e.activateCallback,this.allowedKeys=e.allowedKeys||Dt.usedKeys}get isActivated(){return this.activated}static get usedKeys(){return[xe.TAB,xe.LEFT,xe.RIGHT,xe.ENTER,xe.UP,xe.DOWN]}activate(e,t){this.activated=!0,e&&this.iterator.setItems(e),t!==void 0&&this.iterator.setCursor(t),document.addEventListener("keydown",this.onKeyDown,!0)}deactivate(){this.activated=!1,this.dropCursor(),document.removeEventListener("keydown",this.onKeyDown)}focusFirst(){this.dropCursor(),this.flipRight()}flipLeft(){this.iterator.previous(),this.flipCallback()}flipRight(){this.iterator.next(),this.flipCallback()}hasFocus(){return!!this.iterator.currentItem}onFlip(e){this.flipCallbacks.push(e)}removeOnFlip(e){this.flipCallbacks=this.flipCallbacks.filter(t=>t!==e)}dropCursor(){this.iterator.dropCursor()}isEventReadyForHandling(e){return this.activated&&this.allowedKeys.includes(e.keyCode)}handleTabPress(e){switch(e.shiftKey?lr.directions.LEFT:lr.directions.RIGHT){case lr.directions.RIGHT:this.flipRight();break;case lr.directions.LEFT:this.flipLeft();break}}handleEnterPress(e){this.activated&&(this.iterator.currentItem&&(e.stopPropagation(),e.preventDefault(),this.iterator.currentItem.click()),qe(this.activateCallback)&&this.activateCallback(this.iterator.currentItem))}flipCallback(){this.iterator.currentItem&&this.iterator.currentItem.scrollIntoViewIfNeeded(),this.flipCallbacks.forEach(e=>e())}},Bi=class{static get CSS(){return{wrapper:"cdx-search-field",icon:"cdx-search-field__icon",input:"cdx-search-field__input"}}constructor({items:e,onSearch:t,placeholder:r}){this.listeners=new ps,this.items=e,this.onSearch=t,this.render(r)}getElement(){return this.wrapper}focus(){this.input.focus()}clear(){this.input.value="",this.searchQuery="",this.onSearch("",this.foundItems)}destroy(){this.listeners.removeAll()}render(e){this.wrapper=G.make("div",Bi.CSS.wrapper);let t=G.make("div",Bi.CSS.icon,{innerHTML:I1});this.input=G.make("input",Bi.CSS.input,{placeholder:e}),this.wrapper.appendChild(t),this.wrapper.appendChild(this.input),this.listeners.on(this.input,"input",()=>{this.searchQuery=this.input.value,this.onSearch(this.searchQuery,this.foundItems)})}get foundItems(){return this.items.filter(e=>this.checkItem(e))}checkItem(e){var t;let r=((t=e.title)==null?void 0:t.toLowerCase())||"",s=this.searchQuery.toLowerCase();return r.includes(s)}},ds=class{lock(){nf?this.lockHard():document.body.classList.add(ds.CSS.scrollLocked)}unlock(){nf?this.unlockHard():document.body.classList.remove(ds.CSS.scrollLocked)}lockHard(){this.scrollPosition=window.pageYOffset,document.documentElement.style.setProperty("--window-scroll-offset",`${this.scrollPosition}px`),document.body.classList.add(ds.CSS.scrollLockedHard)}unlockHard(){document.body.classList.remove(ds.CSS.scrollLockedHard),this.scrollPosition!==null&&window.scrollTo(0,this.scrollPosition),this.scrollPosition=null}},kf=ds;kf.CSS={scrollLocked:"ce-scroll-locked",scrollLockedHard:"ce-scroll-locked--hard"};var R1=Object.defineProperty,D1=Object.getOwnPropertyDescriptor,P1=(i,e,t,r)=>{for(var s=r>1?void 0:r?D1(e,t):e,n=i.length-1,o;n>=0;n--)(o=i[n])&&(s=(r?o(e,t,s):o(s))||s);return r&&s&&R1(e,t,s),s},_s=(i=>(i.Close="close",i))(_s||{}),at=class extends pr{constructor(i){super(),this.scopeElement=document.body,this.listeners=new ps,this.scrollLocker=new kf,this.nodes={wrapper:null,popover:null,nothingFoundMessage:null,customContent:null,items:null,overlay:null},this.messages={nothingFound:"Nothing found",search:"Search"},this.onFlip=()=>{this.items.find(e=>e.isFocused).onFocus()},this.items=i.items.map(e=>new Ge(e)),i.scopeElement!==void 0&&(this.scopeElement=i.scopeElement),i.messages&&(this.messages=Ee(Ee({},this.messages),i.messages)),i.customContentFlippableItems&&(this.customContentFlippableItems=i.customContentFlippableItems),this.make(),i.customContent&&this.addCustomContent(i.customContent),i.searchable&&this.addSearch(),this.initializeFlipper()}static get CSS(){return{popover:"ce-popover",popoverOpenTop:"ce-popover--open-top",popoverOpened:"ce-popover--opened",search:"ce-popover__search",nothingFoundMessage:"ce-popover__nothing-found-message",nothingFoundMessageDisplayed:"ce-popover__nothing-found-message--displayed",customContent:"ce-popover__custom-content",customContentHidden:"ce-popover__custom-content--hidden",items:"ce-popover__items",overlay:"ce-popover__overlay",overlayHidden:"ce-popover__overlay--hidden"}}getElement(){return this.nodes.wrapper}hasFocus(){return this.flipper.hasFocus()}show(){this.shouldOpenBottom||(this.nodes.popover.style.setProperty("--popover-height",this.height+"px"),this.nodes.popover.classList.add(at.CSS.popoverOpenTop)),this.nodes.overlay.classList.remove(at.CSS.overlayHidden),this.nodes.popover.classList.add(at.CSS.popoverOpened),this.flipper.activate(this.flippableElements),this.search!==void 0&&setTimeout(()=>{this.search.focus()},100),Li()&&this.scrollLocker.lock()}hide(){this.nodes.popover.classList.remove(at.CSS.popoverOpened),this.nodes.popover.classList.remove(at.CSS.popoverOpenTop),this.nodes.overlay.classList.add(at.CSS.overlayHidden),this.flipper.deactivate(),this.items.forEach(i=>i.reset()),this.search!==void 0&&this.search.clear(),Li()&&this.scrollLocker.unlock(),this.emit("close")}destroy(){this.flipper.deactivate(),this.listeners.removeAll(),Li()&&this.scrollLocker.unlock()}make(){this.nodes.popover=G.make("div",[at.CSS.popover]),this.nodes.nothingFoundMessage=G.make("div",[at.CSS.nothingFoundMessage],{textContent:this.messages.nothingFound}),this.nodes.popover.appendChild(this.nodes.nothingFoundMessage),this.nodes.items=G.make("div",[at.CSS.items]),this.items.forEach(i=>{this.nodes.items.appendChild(i.getElement())}),this.nodes.popover.appendChild(this.nodes.items),this.listeners.on(this.nodes.popover,"click",i=>{let e=this.getTargetItem(i);e!==void 0&&this.handleItemClick(e)}),this.nodes.wrapper=G.make("div"),this.nodes.overlay=G.make("div",[at.CSS.overlay,at.CSS.overlayHidden]),this.listeners.on(this.nodes.overlay,"click",()=>{this.hide()}),this.nodes.wrapper.appendChild(this.nodes.overlay),this.nodes.wrapper.appendChild(this.nodes.popover)}addSearch(){this.search=new Bi({items:this.items,placeholder:this.messages.search,onSearch:(e,t)=>{this.items.forEach(s=>{let n=!t.includes(s);s.toggleHidden(n)}),this.toggleNothingFoundMessage(t.length===0),this.toggleCustomContent(e!=="");let r=e===""?this.flippableElements:t.map(s=>s.getElement());this.flipper.isActivated&&(this.flipper.deactivate(),this.flipper.activate(r))}});let i=this.search.getElement();i.classList.add(at.CSS.search),this.nodes.popover.insertBefore(i,this.nodes.popover.firstChild)}addCustomContent(i){this.nodes.customContent=i,this.nodes.customContent.classList.add(at.CSS.customContent),this.nodes.popover.insertBefore(i,this.nodes.popover.firstChild)}getTargetItem(i){return this.items.find(e=>i.composedPath().includes(e.getElement()))}handleItemClick(i){i.isDisabled||(this.items.filter(e=>e!==i).forEach(e=>e.reset()),i.handleClick(),this.toggleItemActivenessIfNeeded(i),i.closeOnActivate&&this.hide())}initializeFlipper(){this.flipper=new Dt({items:this.flippableElements,focusedItemClass:Ge.CSS.focused,allowedKeys:[xe.TAB,xe.UP,xe.DOWN,xe.ENTER]}),this.flipper.onFlip(this.onFlip)}get flippableElements(){let i=this.items.map(e=>e.getElement());return(this.customContentFlippableItems||[]).concat(i)}get height(){let i=0;if(this.nodes.popover===null)return i;let e=this.nodes.popover.cloneNode(!0);return e.style.visibility="hidden",e.style.position="absolute",e.style.top="-1000px",e.classList.add(at.CSS.popoverOpened),document.body.appendChild(e),i=e.offsetHeight,e.remove(),i}get shouldOpenBottom(){let i=this.nodes.popover.getBoundingClientRect(),e=this.scopeElement.getBoundingClientRect(),t=this.height,r=i.top+t,s=i.top-t,n=Math.min(window.innerHeight,e.bottom);return s<e.top||r<=n}toggleNothingFoundMessage(i){this.nodes.nothingFoundMessage.classList.toggle(at.CSS.nothingFoundMessageDisplayed,i)}toggleCustomContent(i){var e;(e=this.nodes.customContent)==null||e.classList.toggle(at.CSS.customContentHidden,i)}toggleItemActivenessIfNeeded(i){if(i.toggle===!0&&i.toggleActive(),typeof i.toggle=="string"){let e=this.items.filter(t=>t.toggle===i.toggle);if(e.length===1){i.toggleActive();return}e.forEach(t=>{t.toggleActive(t===i)})}}},rl=at;P1([_r],rl.prototype,"height",1);var Ma=class extends Oe{constructor(){super(...arguments),this.opened=!1,this.selection=new ge,this.onPopoverClose=()=>{this.close()}}get events(){return{opened:"block-settings-opened",closed:"block-settings-closed"}}get CSS(){return{settings:"ce-settings"}}get flipper(){var e;return(e=this.popover)==null?void 0:e.flipper}make(){this.nodes.wrapper=G.make("div",[this.CSS.settings])}destroy(){this.removeAllNodes()}open(e=this.Editor.BlockManager.currentBlock){this.opened=!0,this.selection.save(),e.selected=!0,this.Editor.BlockSelection.clearCache();let[t,r]=e.getTunes();this.eventsDispatcher.emit(this.events.opened),this.popover=new rl({searchable:!0,items:t.map(s=>this.resolveTuneAliases(s)),customContent:r,customContentFlippableItems:this.getControls(r),scopeElement:this.Editor.API.methods.ui.nodes.redactor,messages:{nothingFound:kt.ui(Nt.ui.popover,"Nothing found"),search:kt.ui(Nt.ui.popover,"Filter")}}),this.popover.on(_s.Close,this.onPopoverClose),this.nodes.wrapper.append(this.popover.getElement()),this.popover.show()}getElement(){return this.nodes.wrapper}close(){this.opened=!1,ge.isAtEditor||this.selection.restore(),this.selection.clearSaved(),!this.Editor.CrossBlockSelection.isCrossBlockSelectionStarted&&this.Editor.BlockManager.currentBlock&&(this.Editor.BlockManager.currentBlock.selected=!1),this.eventsDispatcher.emit(this.events.closed),this.popover&&(this.popover.off(_s.Close,this.onPopoverClose),this.popover.destroy(),this.popover.getElement().remove(),this.popover=null)}getControls(e){let{StylesAPI:t}=this.Editor,r=e.querySelectorAll(`.${t.classes.settingsButton}, ${G.allInputsSelector}`);return Array.from(r)}resolveTuneAliases(e){let t=S1(e,{label:"title"});return e.confirmation&&(t.confirmation=this.resolveTuneAliases(e.confirmation)),t}},bt=class extends Oe{constructor(){super(...arguments),this.opened=!1,this.tools=[],this.flipper=null,this.togglingCallback=null}static get CSS(){return{conversionToolbarWrapper:"ce-conversion-toolbar",conversionToolbarShowed:"ce-conversion-toolbar--showed",conversionToolbarTools:"ce-conversion-toolbar__tools",conversionToolbarLabel:"ce-conversion-toolbar__label",conversionTool:"ce-conversion-tool",conversionToolHidden:"ce-conversion-tool--hidden",conversionToolIcon:"ce-conversion-tool__icon",conversionToolSecondaryLabel:"ce-conversion-tool__secondary-label",conversionToolFocused:"ce-conversion-tool--focused",conversionToolActive:"ce-conversion-tool--active"}}make(){this.nodes.wrapper=G.make("div",[bt.CSS.conversionToolbarWrapper,...this.isRtl?[this.Editor.UI.CSS.editorRtlFix]:[]]),this.nodes.tools=G.make("div",bt.CSS.conversionToolbarTools);let e=G.make("div",bt.CSS.conversionToolbarLabel,{textContent:kt.ui(Nt.ui.inlineToolbar.converter,"Convert to")});return this.addTools(),this.enableFlipper(),G.append(this.nodes.wrapper,e),G.append(this.nodes.wrapper,this.nodes.tools),this.nodes.wrapper}destroy(){this.flipper&&(this.flipper.deactivate(),this.flipper=null),this.removeAllNodes()}toggle(e){this.opened?this.close():this.open(),qe(e)&&(this.togglingCallback=e)}open(){this.filterTools(),this.opened=!0,this.nodes.wrapper.classList.add(bt.CSS.conversionToolbarShowed),window.requestAnimationFrame(()=>{this.flipper.activate(this.tools.map(e=>e.button).filter(e=>!e.classList.contains(bt.CSS.conversionToolHidden))),this.flipper.focusFirst(),qe(this.togglingCallback)&&this.togglingCallback(!0)})}close(){this.opened=!1,this.flipper.deactivate(),this.nodes.wrapper.classList.remove(bt.CSS.conversionToolbarShowed),qe(this.togglingCallback)&&this.togglingCallback(!1)}hasTools(){return this.tools.length===1?this.tools[0].name!==this.config.defaultBlock:!0}async replaceWithBlock(e,t){let{BlockManager:r,BlockSelection:s,InlineToolbar:n,Caret:o}=this.Editor;r.convert(this.Editor.BlockManager.currentBlock,e,t),s.clearSelection(),this.close(),n.close(),window.requestAnimationFrame(()=>{o.setToBlock(this.Editor.BlockManager.currentBlock,o.positions.END)})}addTools(){let e=this.Editor.Tools.blockTools;Array.from(e.entries()).forEach(([t,r])=>{var s;let n=r.conversionConfig;!n||!n.import||(s=r.toolbox)==null||s.forEach(o=>this.addToolIfValid(t,o))})}addToolIfValid(e,t){Rt(t)||!t.icon||this.addTool(e,t)}addTool(e,t){var r;let s=G.make("div",[bt.CSS.conversionTool]),n=G.make("div",[bt.CSS.conversionToolIcon]);s.dataset.tool=e,n.innerHTML=t.icon,G.append(s,n),G.append(s,G.text(kt.t(Nt.toolNames,t.title||ur(e))));let o=(r=this.Editor.Tools.blockTools.get(e))==null?void 0:r.shortcut;if(o){let a=G.make("span",bt.CSS.conversionToolSecondaryLabel,{innerText:tl(o)});G.append(s,a)}G.append(this.nodes.tools,s),this.tools.push({name:e,button:s,toolboxItem:t}),this.listeners.on(s,"click",async()=>{await this.replaceWithBlock(e,t.data)})}async filterTools(){let{currentBlock:e}=this.Editor.BlockManager,t=await e.getActiveToolboxEntry();function r(s,n){return s.icon===n.icon&&s.title===n.title}this.tools.forEach(s=>{let n=!1;if(t){let o=r(t,s.toolboxItem);n=s.button.dataset.tool===e.name&&o}s.button.hidden=n,s.button.classList.toggle(bt.CSS.conversionToolHidden,n)})}enableFlipper(){this.flipper=new Dt({focusedItemClass:bt.CSS.conversionToolFocused})}},Na={},j1={get exports(){return Na},set exports(i){Na=i}};(function(i,e){(function(t,r){i.exports=r()})(window,function(){return function(t){var r={};function s(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=t,s.c=r,s.d=function(n,o,a){s.o(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:a})},s.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,o){if(1&o&&(n=s(n)),8&o||4&o&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&o&&typeof n!="string")for(var l in n)s.d(a,l,function(c){return n[c]}.bind(null,l));return a},s.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(o,"a",o),o},s.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},s.p="",s(s.s=0)}([function(t,r,s){function n(l,c){for(var u=0;u<c.length;u++){var p=c[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}function o(l,c,u){return c&&n(l.prototype,c),u&&n(l,u),l}s.r(r);var a=function(){function l(c){var u=this;(function(p,m){if(!(p instanceof m))throw new TypeError("Cannot call a class as a function")})(this,l),this.commands={},this.keys={},this.name=c.name,this.parseShortcutName(c.name),this.element=c.on,this.callback=c.callback,this.executeShortcut=function(p){u.execute(p)},this.element.addEventListener("keydown",this.executeShortcut,!1)}return o(l,null,[{key:"supportedCommands",get:function(){return{SHIFT:["SHIFT"],CMD:["CMD","CONTROL","COMMAND","WINDOWS","CTRL"],ALT:["ALT","OPTION"]}}},{key:"keyCodes",get:function(){return{0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,BACKSPACE:8,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,".":190}}}]),o(l,[{key:"parseShortcutName",value:function(c){c=c.split("+");for(var u=0;u<c.length;u++){c[u]=c[u].toUpperCase();var p=!1;for(var m in l.supportedCommands)if(l.supportedCommands[m].includes(c[u])){p=this.commands[m]=!0;break}p||(this.keys[c[u]]=!0)}for(var w in l.supportedCommands)this.commands[w]||(this.commands[w]=!1)}},{key:"execute",value:function(c){var u,p={CMD:c.ctrlKey||c.metaKey,SHIFT:c.shiftKey,ALT:c.altKey},m=!0;for(u in this.commands)this.commands[u]!==p[u]&&(m=!1);var w,x=!0;for(w in this.keys)x=x&&c.keyCode===l.keyCodes[w];m&&x&&this.callback(c)}},{key:"remove",value:function(){this.element.removeEventListener("keydown",this.executeShortcut)}}]),l}();r.default=a}]).default})})(j1);var z1=Yn(Na),Ra=class{constructor(){this.registeredShortcuts=new Map}add(e){if(this.findShortcut(e.on,e.name))throw Error(`Shortcut ${e.name} is already registered for ${e.on}. Please remove it before add a new handler.`);let t=new z1({name:e.name,on:e.on,callback:e.handler}),r=this.registeredShortcuts.get(e.on)||[];this.registeredShortcuts.set(e.on,[...r,t])}remove(e,t){let r=this.findShortcut(e,t);if(!r)return;r.remove();let s=this.registeredShortcuts.get(e);this.registeredShortcuts.set(e,s.filter(n=>n!==r))}findShortcut(e,t){return(this.registeredShortcuts.get(e)||[]).find(({name:r})=>r===t)}},hr=new Ra,F1=Object.defineProperty,H1=Object.getOwnPropertyDescriptor,xf=(i,e,t,r)=>{for(var s=r>1?void 0:r?H1(e,t):e,n=i.length-1,o;n>=0;n--)(o=i[n])&&(s=(r?o(e,t,s):o(s))||s);return r&&s&&F1(e,t,s),s},Pn=(i=>(i.Opened="toolbox-opened",i.Closed="toolbox-closed",i.BlockAdded="toolbox-block-added",i))(Pn||{}),Cf=class extends pr{constructor({api:i,tools:e,i18nLabels:t}){super(),this.opened=!1,this.nodes={toolbox:null},this.onPopoverClose=()=>{this.opened=!1,this.emit("toolbox-closed")},this.api=i,this.tools=e,this.i18nLabels=t}get isEmpty(){return this.toolsToBeDisplayed.length===0}static get CSS(){return{toolbox:"ce-toolbox"}}make(){return this.popover=new rl({scopeElement:this.api.ui.nodes.redactor,searchable:!0,messages:{nothingFound:this.i18nLabels.nothingFound,search:this.i18nLabels.filter},items:this.toolboxItemsToBeDisplayed}),this.popover.on(_s.Close,this.onPopoverClose),this.enableShortcuts(),this.nodes.toolbox=this.popover.getElement(),this.nodes.toolbox.classList.add(Cf.CSS.toolbox),this.nodes.toolbox}hasFocus(){var i;return(i=this.popover)==null?void 0:i.hasFocus()}destroy(){var i;super.destroy(),this.nodes&&this.nodes.toolbox&&(this.nodes.toolbox.remove(),this.nodes.toolbox=null),this.removeAllShortcuts(),(i=this.popover)==null||i.off(_s.Close,this.onPopoverClose)}toolButtonActivated(i,e){this.insertNewBlock(i,e)}open(){var i;this.isEmpty||((i=this.popover)==null||i.show(),this.opened=!0,this.emit("toolbox-opened"))}close(){var i;(i=this.popover)==null||i.hide(),this.opened=!1,this.emit("toolbox-closed")}toggle(){this.opened?this.close():this.open()}get toolsToBeDisplayed(){let i=[];return this.tools.forEach(e=>{e.toolbox&&i.push(e)}),i}get toolboxItemsToBeDisplayed(){let i=(e,t)=>({icon:e.icon,title:kt.t(Nt.toolNames,e.title||ur(t.name)),name:t.name,onActivate:()=>{this.toolButtonActivated(t.name,e.data)},secondaryLabel:t.shortcut?tl(t.shortcut):""});return this.toolsToBeDisplayed.reduce((e,t)=>(Array.isArray(t.toolbox)?t.toolbox.forEach(r=>{e.push(i(r,t))}):t.toolbox!==void 0&&e.push(i(t.toolbox,t)),e),[])}enableShortcuts(){this.toolsToBeDisplayed.forEach(i=>{let e=i.shortcut;e&&this.enableShortcutForTool(i.name,e)})}enableShortcutForTool(i,e){hr.add({name:e,on:this.api.ui.nodes.redactor,handler:t=>{t.preventDefault();let r=this.api.blocks.getCurrentBlockIndex(),s=this.api.blocks.getBlockByIndex(r);if(s)try{this.api.blocks.convert(s.id,i),window.requestAnimationFrame(()=>{this.api.caret.setToBlock(r,"end")});return}catch(n){}this.insertNewBlock(i)}})}removeAllShortcuts(){this.toolsToBeDisplayed.forEach(i=>{let e=i.shortcut;e&&hr.remove(this.api.ui.nodes.redactor,e)})}async insertNewBlock(i,e){let t=this.api.blocks.getCurrentBlockIndex(),r=this.api.blocks.getBlockByIndex(t);if(!r)return;let s=r.isEmpty?t:t+1,n;if(e){let a=await this.api.blocks.composeBlockData(i);n=Object.assign(a,e)}let o=this.api.blocks.insert(i,n,void 0,s,void 0,r.isEmpty);o.call(si.APPEND_CALLBACK),this.api.caret.setToBlock(s),this.emit("toolbox-block-added",{block:o}),this.api.toolbar.close()}},sl=Cf;xf([_r],sl.prototype,"toolsToBeDisplayed",1);xf([_r],sl.prototype,"toolboxItemsToBeDisplayed",1);var Sf="block hovered",Da=class extends Oe{constructor({config:e,eventsDispatcher:t}){super({config:e,eventsDispatcher:t}),this.toolboxInstance=null,this.tooltip=new fs}get CSS(){return{toolbar:"ce-toolbar",content:"ce-toolbar__content",actions:"ce-toolbar__actions",actionsOpened:"ce-toolbar__actions--opened",toolbarOpened:"ce-toolbar--opened",openedToolboxHolderModifier:"codex-editor--toolbox-opened",plusButton:"ce-toolbar__plus",plusButtonShortcut:"ce-toolbar__plus-shortcut",settingsToggler:"ce-toolbar__settings-btn",settingsTogglerHidden:"ce-toolbar__settings-btn--hidden"}}get opened(){return this.nodes.wrapper.classList.contains(this.CSS.toolbarOpened)}get toolbox(){var e;return{opened:(e=this.toolboxInstance)==null?void 0:e.opened,close:()=>{var t;(t=this.toolboxInstance)==null||t.close()},open:()=>{if(this.toolboxInstance===null){Be("toolbox.open() called before initialization is finished","warn");return}this.Editor.BlockManager.currentBlock=this.hoveredBlock,this.toolboxInstance.open()},toggle:()=>{if(this.toolboxInstance===null){Be("toolbox.toggle() called before initialization is finished","warn");return}this.toolboxInstance.toggle()},hasFocus:()=>{var t;return(t=this.toolboxInstance)==null?void 0:t.hasFocus()}}}get blockActions(){return{hide:()=>{this.nodes.actions.classList.remove(this.CSS.actionsOpened)},show:()=>{this.nodes.actions.classList.add(this.CSS.actionsOpened)}}}get blockTunesToggler(){return{hide:()=>this.nodes.settingsToggler.classList.add(this.CSS.settingsTogglerHidden),show:()=>this.nodes.settingsToggler.classList.remove(this.CSS.settingsTogglerHidden)}}toggleReadOnly(e){e?(this.destroy(),this.Editor.BlockSettings.destroy(),this.disableModuleBindings()):window.requestIdleCallback(()=>{this.drawUI(),this.enableModuleBindings()},{timeout:2e3})}moveAndOpen(e=this.Editor.BlockManager.currentBlock){if(this.toolboxInstance===null){Be("Can't open Toolbar since Editor initialization is not finished yet","warn");return}if(this.toolboxInstance.opened&&this.toolboxInstance.close(),this.Editor.BlockSettings.opened&&this.Editor.BlockSettings.close(),!e)return;this.hoveredBlock=e;let t=e.holder,{isMobile:r}=this.Editor.UI,s=e.pluginsContent,n=window.getComputedStyle(s),o=parseInt(n.paddingTop,10),a=t.offsetHeight,l;r?l=t.offsetTop+a:l=t.offsetTop+o,this.nodes.wrapper.style.top=`${Math.floor(l)}px`,this.Editor.BlockManager.blocks.length===1&&e.isEmpty?this.blockTunesToggler.hide():this.blockTunesToggler.show(),this.open()}close(){var e;this.Editor.ReadOnly.isEnabled||(this.nodes.wrapper.classList.remove(this.CSS.toolbarOpened),this.blockActions.hide(),(e=this.toolboxInstance)==null||e.close(),this.Editor.BlockSettings.close())}open(e=!0){dr(()=>{this.nodes.wrapper.classList.add(this.CSS.toolbarOpened),e?this.blockActions.show():this.blockActions.hide()},50)()}make(){this.nodes.wrapper=G.make("div",this.CSS.toolbar),["content","actions"].forEach(t=>{this.nodes[t]=G.make("div",this.CSS[t])}),G.append(this.nodes.wrapper,this.nodes.content),G.append(this.nodes.content,this.nodes.actions),this.nodes.plusButton=G.make("div",this.CSS.plusButton,{innerHTML:B1}),G.append(this.nodes.actions,this.nodes.plusButton),this.readOnlyMutableListeners.on(this.nodes.plusButton,"click",()=>{this.tooltip.hide(!0),this.plusButtonClicked()},!1);let e=G.make("div");e.appendChild(document.createTextNode(kt.ui(Nt.ui.toolbar.toolbox,"Add"))),e.appendChild(G.make("div",this.CSS.plusButtonShortcut,{textContent:"\u21E5 Tab"})),this.tooltip.onHover(this.nodes.plusButton,e,{hidingDelay:400}),this.nodes.settingsToggler=G.make("span",this.CSS.settingsToggler,{innerHTML:L1}),G.append(this.nodes.actions,this.nodes.settingsToggler),this.tooltip.onHover(this.nodes.settingsToggler,kt.ui(Nt.ui.blockTunes.toggler,"Click to tune"),{hidingDelay:400}),G.append(this.nodes.actions,this.makeToolbox()),G.append(this.nodes.actions,this.Editor.BlockSettings.getElement()),G.append(this.Editor.UI.nodes.wrapper,this.nodes.wrapper)}makeToolbox(){return this.toolboxInstance=new sl({api:this.Editor.API.methods,tools:this.Editor.Tools.blockTools,i18nLabels:{filter:kt.ui(Nt.ui.popover,"Filter"),nothingFound:kt.ui(Nt.ui.popover,"Nothing found")}}),this.toolboxInstance.on(Pn.Opened,()=>{this.Editor.UI.nodes.wrapper.classList.add(this.CSS.openedToolboxHolderModifier)}),this.toolboxInstance.on(Pn.Closed,()=>{this.Editor.UI.nodes.wrapper.classList.remove(this.CSS.openedToolboxHolderModifier)}),this.toolboxInstance.on(Pn.BlockAdded,({block:e})=>{let{BlockManager:t,Caret:r}=this.Editor,s=t.getBlockById(e.id);s.inputs.length===0&&(s===t.lastBlock?(t.insertAtEnd(),r.setToBlock(t.lastBlock)):r.setToBlock(t.nextBlock))}),this.toolboxInstance.make()}plusButtonClicked(){var e;this.Editor.BlockManager.currentBlock=this.hoveredBlock,(e=this.toolboxInstance)==null||e.toggle()}enableModuleBindings(){this.readOnlyMutableListeners.on(this.nodes.settingsToggler,"mousedown",e=>{var t;e.stopPropagation(),this.settingsTogglerClicked(),(t=this.toolboxInstance)!=null&&t.opened&&this.toolboxInstance.close(),this.tooltip.hide(!0)},!0),Li()||this.eventsDispatcher.on(Sf,e=>{var t;this.Editor.BlockSettings.opened||(t=this.toolboxInstance)!=null&&t.opened||this.moveAndOpen(e.block)})}disableModuleBindings(){this.readOnlyMutableListeners.clearAll()}settingsTogglerClicked(){this.Editor.BlockManager.currentBlock=this.hoveredBlock,this.Editor.BlockSettings.opened?this.Editor.BlockSettings.close():this.Editor.BlockSettings.open(this.hoveredBlock)}drawUI(){this.Editor.BlockSettings.make(),this.make()}destroy(){this.removeAllNodes(),this.toolboxInstance&&this.toolboxInstance.destroy(),this.tooltip.destroy()}},Gn=(i=>(i[i.Block=0]="Block",i[i.Inline=1]="Inline",i[i.Tune=2]="Tune",i))(Gn||{}),jn=(i=>(i.Shortcut="shortcut",i.Toolbox="toolbox",i.EnabledInlineTools="inlineToolbar",i.EnabledBlockTunes="tunes",i.Config="config",i))(jn||{}),Tf=(i=>(i.Shortcut="shortcut",i.SanitizeConfig="sanitize",i))(Tf||{}),cr=(i=>(i.IsEnabledLineBreaks="enableLineBreaks",i.Toolbox="toolbox",i.ConversionConfig="conversionConfig",i.IsReadOnlySupported="isReadOnlySupported",i.PasteConfig="pasteConfig",i))(cr||{}),nl=(i=>(i.IsInline="isInline",i.Title="title",i))(nl||{}),Ef=(i=>(i.IsTune="isTune",i))(Ef||{}),ms=class{constructor({name:e,constructable:t,config:r,api:s,isDefault:n,isInternal:o=!1,defaultPlaceholder:a}){this.api=s,this.name=e,this.constructable=t,this.config=r,this.isDefault=n,this.isInternal=o,this.defaultPlaceholder=a}get settings(){let e=this.config.config||{};return this.isDefault&&!("placeholder"in e)&&this.defaultPlaceholder&&(e.placeholder=this.defaultPlaceholder),e}reset(){if(qe(this.constructable.reset))return this.constructable.reset()}prepare(){if(qe(this.constructable.prepare))return this.constructable.prepare({toolName:this.name,config:this.settings})}get shortcut(){let e=this.constructable.shortcut;return this.config.shortcut||e}get sanitizeConfig(){return this.constructable.sanitize||{}}isInline(){return this.type===1}isBlock(){return this.type===0}isTune(){return this.type===2}},Pa=class extends Oe{constructor({config:e,eventsDispatcher:t}){super({config:e,eventsDispatcher:t}),this.CSS={inlineToolbar:"ce-inline-toolbar",inlineToolbarShowed:"ce-inline-toolbar--showed",inlineToolbarLeftOriented:"ce-inline-toolbar--left-oriented",inlineToolbarRightOriented:"ce-inline-toolbar--right-oriented",inlineToolbarShortcut:"ce-inline-toolbar__shortcut",buttonsWrapper:"ce-inline-toolbar__buttons",actionsWrapper:"ce-inline-toolbar__actions",inlineToolButton:"ce-inline-tool",inputField:"cdx-input",focusedButton:"ce-inline-tool--focused",conversionToggler:"ce-inline-toolbar__dropdown",conversionTogglerArrow:"ce-inline-toolbar__dropdown-arrow",conversionTogglerHidden:"ce-inline-toolbar__dropdown--hidden",conversionTogglerContent:"ce-inline-toolbar__dropdown-content",togglerAndButtonsWrapper:"ce-inline-toolbar__toggler-and-button-wrapper"},this.opened=!1,this.toolbarVerticalMargin=Li()?20:6,this.buttonsList=null,this.width=0,this.flipper=null,this.tooltip=new fs}toggleReadOnly(e){e?(this.destroy(),this.Editor.ConversionToolbar.destroy()):window.requestIdleCallback(()=>{this.make()},{timeout:2e3})}tryToShow(e=!1,t=!0){if(!this.allowedToShow()){e&&this.close();return}this.move(),this.open(t),this.Editor.Toolbar.close()}move(){let e=ge.rect,t=this.Editor.UI.nodes.wrapper.getBoundingClientRect(),r={x:e.x-t.left,y:e.y+e.height-t.top+this.toolbarVerticalMargin};e.width&&(r.x+=Math.floor(e.width/2));let s=r.x-this.width/2,n=r.x+this.width/2;this.nodes.wrapper.classList.toggle(this.CSS.inlineToolbarLeftOriented,s<this.Editor.UI.contentRect.left),this.nodes.wrapper.classList.toggle(this.CSS.inlineToolbarRightOriented,n>this.Editor.UI.contentRect.right),this.nodes.wrapper.style.left=Math.floor(r.x)+"px",this.nodes.wrapper.style.top=Math.floor(r.y)+"px"}close(){this.opened&&(this.Editor.ReadOnly.isEnabled||(this.nodes.wrapper.classList.remove(this.CSS.inlineToolbarShowed),Array.from(this.toolsInstances.entries()).forEach(([e,t])=>{let r=this.getToolShortcut(e);r&&hr.remove(this.Editor.UI.nodes.redactor,r),qe(t.clear)&&t.clear()}),this.opened=!1,this.flipper.deactivate(),this.Editor.ConversionToolbar.close()))}open(e=!0){if(this.opened)return;this.addToolsFiltered(),this.nodes.wrapper.classList.add(this.CSS.inlineToolbarShowed),this.buttonsList=this.nodes.buttons.querySelectorAll(`.${this.CSS.inlineToolButton}`),this.opened=!0,e&&this.Editor.ConversionToolbar.hasTools()?this.setConversionTogglerContent():this.nodes.conversionToggler.hidden=!0;let t=Array.from(this.buttonsList);t.unshift(this.nodes.conversionToggler),t=t.filter(r=>!r.hidden),this.flipper.activate(t)}containsNode(e){return this.nodes.wrapper.contains(e)}destroy(){this.flipper&&(this.flipper.deactivate(),this.flipper=null),this.removeAllNodes(),this.tooltip.destroy()}make(){this.nodes.wrapper=G.make("div",[this.CSS.inlineToolbar,...this.isRtl?[this.Editor.UI.CSS.editorRtlFix]:[]]),this.nodes.togglerAndButtonsWrapper=G.make("div",this.CSS.togglerAndButtonsWrapper),this.nodes.buttons=G.make("div",this.CSS.buttonsWrapper),this.nodes.actions=G.make("div",this.CSS.actionsWrapper),this.listeners.on(this.nodes.wrapper,"mousedown",e=>{e.target.closest(`.${this.CSS.actionsWrapper}`)||e.preventDefault()}),G.append(this.nodes.wrapper,[this.nodes.togglerAndButtonsWrapper,this.nodes.actions]),G.append(this.Editor.UI.nodes.wrapper,this.nodes.wrapper),this.addConversionToggler(),G.append(this.nodes.togglerAndButtonsWrapper,this.nodes.buttons),this.prepareConversionToolbar(),window.requestAnimationFrame(()=>{this.recalculateWidth()}),this.enableFlipper()}allowedToShow(){let e=["IMG","INPUT"],t=ge.get(),r=ge.text;if(!t||!t.anchorNode||t.isCollapsed||r.length<1)return!1;let s=G.isElement(t.anchorNode)?t.anchorNode:t.anchorNode.parentElement;if(t&&e.includes(s.tagName)||s.closest('[contenteditable="true"]')===null)return!1;let n=this.Editor.BlockManager.getBlock(t.anchorNode);return n?n.tool.inlineTools.size!==0:!1}recalculateWidth(){this.width=this.nodes.wrapper.offsetWidth}addConversionToggler(){this.nodes.conversionToggler=G.make("div",this.CSS.conversionToggler),this.nodes.conversionTogglerContent=G.make("div",this.CSS.conversionTogglerContent);let e=G.make("div",this.CSS.conversionTogglerArrow,{innerHTML:wf});this.nodes.conversionToggler.appendChild(this.nodes.conversionTogglerContent),this.nodes.conversionToggler.appendChild(e),this.nodes.togglerAndButtonsWrapper.appendChild(this.nodes.conversionToggler),this.listeners.on(this.nodes.conversionToggler,"click",()=>{this.Editor.ConversionToolbar.toggle(t=>{!t&&this.opened?this.flipper.activate():this.opened&&this.flipper.deactivate()})}),Li()===!1&&this.tooltip.onHover(this.nodes.conversionToggler,kt.ui(Nt.ui.inlineToolbar.converter,"Convert to"),{placement:"top",hidingDelay:100})}async setConversionTogglerContent(){let{BlockManager:e}=this.Editor,{currentBlock:t}=e,r=t.name,s=t.tool.conversionConfig,n=s&&s.export;this.nodes.conversionToggler.hidden=!n,this.nodes.conversionToggler.classList.toggle(this.CSS.conversionTogglerHidden,!n);let o=await t.getActiveToolboxEntry()||{};this.nodes.conversionTogglerContent.innerHTML=o.icon||o.title||ur(r)}prepareConversionToolbar(){let e=this.Editor.ConversionToolbar.make();G.append(this.nodes.wrapper,e)}addToolsFiltered(){let e=ge.get(),t=this.Editor.BlockManager.getBlock(e.anchorNode);this.nodes.buttons.innerHTML="",this.nodes.actions.innerHTML="",this.toolsInstances=new Map,Array.from(t.tool.inlineTools.values()).forEach(r=>{this.addTool(r)}),this.recalculateWidth()}addTool(e){let t=e.create(),r=t.render();if(!r){Be("Render method must return an instance of Node","warn",e.name);return}if(r.dataset.tool=e.name,this.nodes.buttons.appendChild(r),this.toolsInstances.set(e.name,t),qe(t.renderActions)){let a=t.renderActions();this.nodes.actions.appendChild(a)}this.listeners.on(r,"click",a=>{this.toolClicked(t),a.preventDefault()});let s=this.getToolShortcut(e.name);if(s)try{this.enableShortcuts(t,s)}catch(a){}let n=G.make("div"),o=kt.t(Nt.toolNames,e.title||ur(e.name));n.appendChild(G.text(o)),s&&n.appendChild(G.make("div",this.CSS.inlineToolbarShortcut,{textContent:tl(s)})),Li()===!1&&this.tooltip.onHover(r,n,{placement:"top",hidingDelay:100}),t.checkState(ge.get())}getToolShortcut(e){let{Tools:t}=this.Editor,r=t.inlineTools.get(e),s=t.internal.inlineTools;return Array.from(s.keys()).includes(e)?this.inlineTools[e][Tf.Shortcut]:r.shortcut}enableShortcuts(e,t){hr.add({name:t,handler:r=>{let{currentBlock:s}=this.Editor.BlockManager;s&&s.tool.enabledInlineTools&&(r.preventDefault(),this.toolClicked(e))},on:this.Editor.UI.nodes.redactor})}toolClicked(e){let t=ge.range;e.surround(t),this.checkToolsState(),e.renderActions!==void 0&&this.flipper.deactivate()}checkToolsState(){this.toolsInstances.forEach(e=>{e.checkState(ge.get())})}get inlineTools(){let e={};return Array.from(this.Editor.Tools.inlineTools.entries()).forEach(([t,r])=>{e[t]=r.create()}),e}enableFlipper(){this.flipper=new Dt({focusedItemClass:this.CSS.focusedButton,allowedKeys:[xe.ENTER,xe.TAB]})}},ja=class extends Oe{keydown(e){switch(this.beforeKeydownProcessing(e),e.keyCode){case xe.BACKSPACE:this.backspace(e);break;case xe.DELETE:this.delete(e);break;case xe.ENTER:this.enter(e);break;case xe.DOWN:case xe.RIGHT:this.arrowRightAndDown(e);break;case xe.UP:case xe.LEFT:this.arrowLeftAndUp(e);break;case xe.TAB:this.tabPressed(e);break}}beforeKeydownProcessing(e){this.needToolbarClosing(e)&&pf(e.keyCode)&&(this.Editor.Toolbar.close(),this.Editor.ConversionToolbar.close(),e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||(this.Editor.BlockManager.clearFocused(),this.Editor.BlockSelection.clearSelection(e)))}keyup(e){e.shiftKey||this.Editor.UI.checkEmptiness()}tabPressed(e){this.Editor.BlockSelection.clearSelection(e);let{BlockManager:t,InlineToolbar:r,ConversionToolbar:s}=this.Editor,n=t.currentBlock;if(!n)return;let o=n.isEmpty,a=n.tool.isDefault&&o,l=!o&&s.opened,c=!o&&!ge.isCollapsed&&r.opened;a?this.activateToolbox():!l&&!c&&this.activateBlockSettings()}dragOver(e){let t=this.Editor.BlockManager.getBlockByChildNode(e.target);t.dropTarget=!0}dragLeave(e){let t=this.Editor.BlockManager.getBlockByChildNode(e.target);t.dropTarget=!1}handleCommandC(e){let{BlockSelection:t}=this.Editor;t.anyBlockSelected&&t.copySelectedBlocks(e)}handleCommandX(e){let{BlockSelection:t,BlockManager:r,Caret:s}=this.Editor;t.anyBlockSelected&&t.copySelectedBlocks(e).then(()=>{let n=r.removeSelectedBlocks(),o=r.insertDefaultBlockAtIndex(n,!0);s.setToBlock(o,s.positions.START),t.clearSelection(e)})}enter(e){let{BlockManager:t,UI:r}=this.Editor;if(t.currentBlock.tool.isLineBreaksEnabled||r.someToolbarOpened&&r.someFlipperButtonFocused||e.shiftKey)return;let s=this.Editor.BlockManager.currentBlock;this.Editor.Caret.isAtStart&&!this.Editor.BlockManager.currentBlock.hasMedia?this.Editor.BlockManager.insertDefaultBlockAtIndex(this.Editor.BlockManager.currentBlockIndex):this.Editor.Caret.isAtEnd?s=this.Editor.BlockManager.insertDefaultBlockAtIndex(this.Editor.BlockManager.currentBlockIndex+1):s=this.Editor.BlockManager.split(),this.Editor.Caret.setToBlock(s),this.Editor.Toolbar.moveAndOpen(s),e.preventDefault()}backspace(e){let{BlockManager:t,Caret:r}=this.Editor,{currentBlock:s,previousBlock:n}=t;if(!(!ge.isCollapsed||!r.isAtStart)){if(e.preventDefault(),this.Editor.Toolbar.close(),s.currentInput!==s.firstInput){r.navigatePrevious();return}if(n!==null){if(n.isEmpty){t.removeBlock(n);return}if(s.isEmpty){t.removeBlock(s);let o=t.currentBlock;r.setToBlock(o,r.positions.END);return}of(s,n)?this.mergeBlocks(n,s):r.setToBlock(n,r.positions.END)}}}delete(e){let{BlockManager:t,Caret:r}=this.Editor,{currentBlock:s,nextBlock:n}=t;if(!(!ge.isCollapsed||!r.isAtEnd)){if(e.preventDefault(),this.Editor.Toolbar.close(),s.currentInput!==s.lastInput){r.navigateNext();return}if(n!==null){if(n.isEmpty){t.removeBlock(n);return}if(s.isEmpty){t.removeBlock(s),r.setToBlock(n,r.positions.START);return}of(s,n)?this.mergeBlocks(s,n):r.setToBlock(n,r.positions.START)}}}mergeBlocks(e,t){let{BlockManager:r,Caret:s,Toolbar:n}=this.Editor;s.createShadow(e.pluginsContent),r.mergeBlocks(e,t).then(()=>{window.requestAnimationFrame(()=>{s.restoreCaret(e.pluginsContent),e.pluginsContent.normalize(),n.close()})})}arrowRightAndDown(e){let t=Dt.usedKeys.includes(e.keyCode)&&(!e.shiftKey||e.keyCode===xe.TAB);if(this.Editor.UI.someToolbarOpened&&t)return;this.Editor.BlockManager.clearFocused(),this.Editor.Toolbar.close();let r=this.Editor.Caret.isAtEnd||this.Editor.BlockSelection.anyBlockSelected;if(e.shiftKey&&e.keyCode===xe.DOWN&&r){this.Editor.CrossBlockSelection.toggleBlockSelectedState();return}(e.keyCode===xe.DOWN||e.keyCode===xe.RIGHT&&!this.isRtl?this.Editor.Caret.navigateNext():this.Editor.Caret.navigatePrevious())?e.preventDefault():dr(()=>{this.Editor.BlockManager.currentBlock&&this.Editor.BlockManager.currentBlock.updateCurrentInput()},20)(),this.Editor.BlockSelection.clearSelection(e)}arrowLeftAndUp(e){if(this.Editor.UI.someToolbarOpened){if(Dt.usedKeys.includes(e.keyCode)&&(!e.shiftKey||e.keyCode===xe.TAB))return;this.Editor.UI.closeAllToolbars()}this.Editor.BlockManager.clearFocused(),this.Editor.Toolbar.close();let t=this.Editor.Caret.isAtStart||this.Editor.BlockSelection.anyBlockSelected;if(e.shiftKey&&e.keyCode===xe.UP&&t){this.Editor.CrossBlockSelection.toggleBlockSelectedState(!1);return}(e.keyCode===xe.UP||e.keyCode===xe.LEFT&&!this.isRtl?this.Editor.Caret.navigatePrevious():this.Editor.Caret.navigateNext())?e.preventDefault():dr(()=>{this.Editor.BlockManager.currentBlock&&this.Editor.BlockManager.currentBlock.updateCurrentInput()},20)(),this.Editor.BlockSelection.clearSelection(e)}needToolbarClosing(e){let t=e.keyCode===xe.ENTER&&this.Editor.Toolbar.toolbox.opened,r=e.keyCode===xe.ENTER&&this.Editor.BlockSettings.opened,s=e.keyCode===xe.ENTER&&this.Editor.InlineToolbar.opened,n=e.keyCode===xe.ENTER&&this.Editor.ConversionToolbar.opened,o=e.keyCode===xe.TAB;return!(e.shiftKey||o||t||r||s||n)}activateToolbox(){this.Editor.Toolbar.opened||this.Editor.Toolbar.moveAndOpen(),this.Editor.Toolbar.toolbox.open()}activateBlockSettings(){this.Editor.Toolbar.opened||(this.Editor.BlockManager.currentBlock.focused=!0,this.Editor.Toolbar.moveAndOpen()),this.Editor.BlockSettings.opened||this.Editor.BlockSettings.open()}},us=class{constructor(e){this.blocks=[],this.workingArea=e}get length(){return this.blocks.length}get array(){return this.blocks}get nodes(){return hf(this.workingArea.children)}static set(e,t,r){return isNaN(Number(t))?(Reflect.set(e,t,r),!0):(e.insert(+t,r),!0)}static get(e,t){return isNaN(Number(t))?Reflect.get(e,t):e.get(+t)}push(e){this.blocks.push(e),this.insertToDOM(e)}swap(e,t){let r=this.blocks[t];G.swap(this.blocks[e].holder,r.holder),this.blocks[t]=this.blocks[e],this.blocks[e]=r}move(e,t){let r=this.blocks.splice(t,1)[0],s=e-1,n=Math.max(0,s),o=this.blocks[n];e>0?this.insertToDOM(r,"afterend",o):this.insertToDOM(r,"beforebegin",o),this.blocks.splice(e,0,r);let a=this.composeBlockEvent("move",{fromIndex:t,toIndex:e});r.call(si.MOVED,a)}insert(e,t,r=!1){if(!this.length){this.push(t);return}e>this.length&&(e=this.length),r&&(this.blocks[e].holder.remove(),this.blocks[e].call(si.REMOVED));let s=r?1:0;if(this.blocks.splice(e,s,t),e>0){let n=this.blocks[e-1];this.insertToDOM(t,"afterend",n)}else{let n=this.blocks[e+1];n?this.insertToDOM(t,"beforebegin",n):this.insertToDOM(t)}}replace(e,t){if(this.blocks[e]===void 0)throw Error("Incorrect index");this.blocks[e].holder.replaceWith(t.holder),this.blocks[e]=t}insertMany(e,t){let r=new DocumentFragment;for(let s of e)r.appendChild(s.holder);if(this.length>0){if(t>0){let s=Math.min(t-1,this.length-1);this.blocks[s].holder.after(r)}else t===0&&this.workingArea.prepend(r);this.blocks.splice(t,0,...e)}else this.blocks.push(...e),this.workingArea.appendChild(r);e.forEach(s=>s.call(si.RENDERED))}remove(e){isNaN(e)&&(e=this.length-1),this.blocks[e].holder.remove(),this.blocks[e].call(si.REMOVED),this.blocks.splice(e,1)}removeAll(){this.workingArea.innerHTML="",this.blocks.forEach(e=>e.call(si.REMOVED)),this.blocks.length=0}insertAfter(e,t){let r=this.blocks.indexOf(e);this.insert(r+1,t)}get(e){return this.blocks[e]}indexOf(e){return this.blocks.indexOf(e)}insertToDOM(e,t,r){t?r.holder.insertAdjacentElement(t,e.holder):this.workingArea.appendChild(e.holder),e.call(si.RENDERED)}composeBlockEvent(e,t){return new CustomEvent(e,{detail:t})}},lf="block-removed",cf="block-added",q1="block-moved",df="block-changed",za=class{constructor(){this.completed=Promise.resolve()}add(e){return new Promise((t,r)=>{this.completed=this.completed.then(e).then(t).catch(r)})}},Fa=class extends Oe{constructor(){super(...arguments),this._currentBlockIndex=-1,this._blocks=null}get currentBlockIndex(){return this._currentBlockIndex}set currentBlockIndex(e){this._currentBlockIndex=e}get firstBlock(){return this._blocks[0]}get lastBlock(){return this._blocks[this._blocks.length-1]}get currentBlock(){return this._blocks[this.currentBlockIndex]}set currentBlock(e){this.currentBlockIndex=this.getBlockIndex(e)}get nextBlock(){return this.currentBlockIndex===this._blocks.length-1?null:this._blocks[this.currentBlockIndex+1]}get nextContentfulBlock(){return this.blocks.slice(this.currentBlockIndex+1).find(e=>!!e.inputs.length)}get previousContentfulBlock(){return this.blocks.slice(0,this.currentBlockIndex).reverse().find(e=>!!e.inputs.length)}get previousBlock(){return this.currentBlockIndex===0?null:this._blocks[this.currentBlockIndex-1]}get blocks(){return this._blocks.array}get isEditorEmpty(){return this.blocks.every(e=>e.isEmpty)}prepare(){let e=new us(this.Editor.UI.nodes.redactor);this._blocks=new Proxy(e,{set:us.set,get:us.get}),this.listeners.on(document,"copy",t=>this.Editor.BlockEvents.handleCommandC(t))}toggleReadOnly(e){e?this.disableModuleBindings():this.enableModuleBindings()}composeBlock({tool:e,data:t={},id:r=void 0,tunes:s={}}){let n=this.Editor.ReadOnly.isEnabled,o=this.Editor.Tools.blockTools.get(e),a=new Qe({id:r,data:t,tool:o,api:this.Editor.API,readOnly:n,tunesData:s},this.eventsDispatcher);return n||window.requestIdleCallback(()=>{this.bindBlockEvents(a)},{timeout:2e3}),a}insert({id:e=void 0,tool:t=this.config.defaultBlock,data:r={},index:s,needToFocus:n=!0,replace:o=!1,tunes:a={}}={}){let l=s;l===void 0&&(l=this.currentBlockIndex+(o?0:1));let c=this.composeBlock({id:e,tool:t,data:r,tunes:a});return o&&this.blockDidMutated(lf,this.getBlockByIndex(l),{index:l}),this._blocks.insert(l,c,o),this.blockDidMutated(cf,c,{index:l}),n?this.currentBlockIndex=l:l<=this.currentBlockIndex&&this.currentBlockIndex++,c}insertMany(e,t=0){this._blocks.insertMany(e,t)}async update(e,t){let r=await e.data,s=this.composeBlock({id:e.id,tool:e.name,data:Object.assign({},r,t),tunes:e.tunes}),n=this.getBlockIndex(e);return this._blocks.replace(n,s),this.blockDidMutated(df,s,{index:n}),s}replace(e,t,r){let s=this.getBlockIndex(e);this.insert({tool:t,data:r,index:s,replace:!0})}paste(e,t,r=!1){let s=this.insert({tool:e,replace:r});try{window.requestIdleCallback(()=>{s.call(si.ON_PASTE,t)})}catch(n){Be(`${e}: onPaste callback call is failed`,"error",n)}return s}insertDefaultBlockAtIndex(e,t=!1){let r=this.composeBlock({tool:this.config.defaultBlock});return this._blocks[e]=r,this.blockDidMutated(cf,r,{index:e}),t?this.currentBlockIndex=e:e<=this.currentBlockIndex&&this.currentBlockIndex++,r}insertAtEnd(){return this.currentBlockIndex=this.blocks.length-1,this.insert()}async mergeBlocks(e,t){let r=await t.data;Rt(r)||await e.mergeWith(r),this.removeBlock(t),this.currentBlockIndex=this._blocks.indexOf(e)}removeBlock(e,t=!0){return new Promise(r=>{let s=this._blocks.indexOf(e);if(!this.validateIndex(s))throw new Error("Can't find a Block to remove");e.destroy(),this._blocks.remove(s),this.blockDidMutated(lf,e,{index:s}),this.currentBlockIndex>=s&&this.currentBlockIndex--,this.blocks.length?s===0&&(this.currentBlockIndex=0):(this.currentBlockIndex=-1,t&&this.insert()),r()})}removeSelectedBlocks(){let e;for(let t=this.blocks.length-1;t>=0;t--)this.blocks[t].selected&&(this.removeBlock(this.blocks[t]),e=t);return e}removeAllBlocks(){for(let e=this.blocks.length-1;e>=0;e--)this._blocks.remove(e);this.currentBlockIndex=-1,this.insert(),this.currentBlock.firstInput.focus()}split(){let e=this.Editor.Caret.extractFragmentFromCaretPosition(),t=G.make("div");t.appendChild(e);let r={text:G.isEmpty(t)?"":t.innerHTML};return this.insert({data:r})}getBlockByIndex(e){return e===-1&&(e=this._blocks.length-1),this._blocks[e]}getBlockIndex(e){return this._blocks.indexOf(e)}getBlockById(e){return this._blocks.array.find(t=>t.id===e)}getBlock(e){G.isElement(e)||(e=e.parentNode);let t=this._blocks.nodes,r=e.closest(`.${Qe.CSS.wrapper}`),s=t.indexOf(r);if(s>=0)return this._blocks[s]}highlightCurrentNode(){this.clearFocused(),this.currentBlock.focused=!0}clearFocused(){this.blocks.forEach(e=>{e.focused=!1})}setCurrentBlockByChildNode(e){G.isElement(e)||(e=e.parentNode);let t=e.closest(`.${Qe.CSS.wrapper}`);if(!t)return;let r=t.closest(`.${this.Editor.UI.CSS.editorWrapper}`);if(r!=null&&r.isEqualNode(this.Editor.UI.nodes.wrapper))return this.currentBlockIndex=this._blocks.nodes.indexOf(t),this.currentBlock.updateCurrentInput(),this.currentBlock}getBlockByChildNode(e){G.isElement(e)||(e=e.parentNode);let t=e.closest(`.${Qe.CSS.wrapper}`);return this.blocks.find(r=>r.holder===t)}swap(e,t){this._blocks.swap(e,t),this.currentBlockIndex=t}move(e,t=this.currentBlockIndex){if(isNaN(e)||isNaN(t)){Be("Warning during 'move' call: incorrect indices provided.","warn");return}if(!this.validateIndex(e)||!this.validateIndex(t)){Be("Warning during 'move' call: indices cannot be lower than 0 or greater than the amount of blocks.","warn");return}this._blocks.move(e,t),this.currentBlockIndex=e,this.blockDidMutated(q1,this.currentBlock,{fromIndex:t,toIndex:e})}async convert(e,t,r){if(!await e.save())throw new Error("Could not convert Block. Failed to extract original Block data.");let s=this.Editor.Tools.blockTools.get(t);if(!s)throw new Error(`Could not convert Block. Tool \xAB${t}\xBB not found.`);let n=await e.exportDataAsString(),o=ni(n,s.sanitizeConfig),a=f1(o,s.conversionConfig);r&&(a=Object.assign(a,r)),this.replace(e,s.name,a)}dropPointer(){this.currentBlockIndex=-1,this.clearFocused()}async clear(e=!1){let t=new za;this.blocks.forEach(r=>{t.add(async()=>{await this.removeBlock(r,!1)})}),await t.completed,this.dropPointer(),e&&this.insert(),this.Editor.UI.checkEmptiness()}async destroy(){await Promise.all(this.blocks.map(e=>e.destroy()))}bindBlockEvents(e){let{BlockEvents:t}=this.Editor;this.readOnlyMutableListeners.on(e.holder,"keydown",r=>{t.keydown(r)}),this.readOnlyMutableListeners.on(e.holder,"keyup",r=>{t.keyup(r)}),this.readOnlyMutableListeners.on(e.holder,"dragover",r=>{t.dragOver(r)}),this.readOnlyMutableListeners.on(e.holder,"dragleave",r=>{t.dragLeave(r)}),e.on("didMutated",r=>this.blockDidMutated(df,r,{index:this.getBlockIndex(r)}))}disableModuleBindings(){this.readOnlyMutableListeners.clearAll()}enableModuleBindings(){this.readOnlyMutableListeners.on(document,"cut",e=>this.Editor.BlockEvents.handleCommandX(e)),this.blocks.forEach(e=>{this.bindBlockEvents(e)})}validateIndex(e){return!(e<0||e>=this._blocks.length)}blockDidMutated(e,t,r){let s=new CustomEvent(e,{detail:Ee({target:new Ai(t)},r)});return this.eventsDispatcher.emit(mf,{event:s}),t}},Ha=class extends Oe{constructor(){super(...arguments),this.anyBlockSelectedCache=null,this.needToSelectAll=!1,this.nativeInputSelected=!1,this.readyToBlockSelection=!1}get sanitizerConfig(){return{p:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},ol:{},ul:{},li:{},br:!0,img:{src:!0,width:!0,height:!0},a:{href:!0},b:{},i:{},u:{}}}get allBlocksSelected(){let{BlockManager:e}=this.Editor;return e.blocks.every(t=>t.selected===!0)}set allBlocksSelected(e){let{BlockManager:t}=this.Editor;t.blocks.forEach(r=>{r.selected=e}),this.clearCache()}get anyBlockSelected(){let{BlockManager:e}=this.Editor;return this.anyBlockSelectedCache===null&&(this.anyBlockSelectedCache=e.blocks.some(t=>t.selected===!0)),this.anyBlockSelectedCache}get selectedBlocks(){return this.Editor.BlockManager.blocks.filter(e=>e.selected)}prepare(){this.selection=new ge,hr.add({name:"CMD+A",handler:e=>{let{BlockManager:t,ReadOnly:r}=this.Editor;if(r.isEnabled){e.preventDefault(),this.selectAllBlocks();return}t.currentBlock&&this.handleCommandA(e)},on:this.Editor.UI.nodes.redactor})}toggleReadOnly(){ge.get().removeAllRanges(),this.allBlocksSelected=!1}unSelectBlockByIndex(e){let{BlockManager:t}=this.Editor,r;isNaN(e)?r=t.currentBlock:r=t.getBlockByIndex(e),r.selected=!1,this.clearCache()}clearSelection(e,t=!1){let{BlockManager:r,Caret:s,RectangleSelection:n}=this.Editor;this.needToSelectAll=!1,this.nativeInputSelected=!1,this.readyToBlockSelection=!1;let o=e&&e instanceof KeyboardEvent,a=o&&pf(e.keyCode);if(this.anyBlockSelected&&o&&a&&!ge.isSelectionExists){let l=r.removeSelectedBlocks();r.insertDefaultBlockAtIndex(l,!0),s.setToBlock(r.currentBlock),dr(()=>{let c=e.key;s.insertContentAtCaretPosition(c.length>1?"":c)},20)()}if(this.Editor.CrossBlockSelection.clear(e),!this.anyBlockSelected||n.isRectActivated()){this.Editor.RectangleSelection.clearSelection();return}t&&this.selection.restore(),this.allBlocksSelected=!1}copySelectedBlocks(e){e.preventDefault();let t=G.make("div");this.selectedBlocks.forEach(n=>{let o=ni(n.holder.innerHTML,this.sanitizerConfig),a=G.make("p");a.innerHTML=o,t.appendChild(a)});let r=Array.from(t.childNodes).map(n=>n.textContent).join(`

`),s=t.innerHTML;return e.clipboardData.setData("text/plain",r),e.clipboardData.setData("text/html",s),Promise.all(this.selectedBlocks.map(n=>n.save())).then(n=>{try{e.clipboardData.setData(this.Editor.Paste.MIME_TYPE,JSON.stringify(n))}catch(o){}})}selectBlockByIndex(e){let{BlockManager:t}=this.Editor;t.clearFocused();let r;isNaN(e)?r=t.currentBlock:r=t.getBlockByIndex(e),this.selection.save(),ge.get().removeAllRanges(),r.selected=!0,this.clearCache(),this.Editor.InlineToolbar.close()}clearCache(){this.anyBlockSelectedCache=null}destroy(){hr.remove(this.Editor.UI.nodes.redactor,"CMD+A")}handleCommandA(e){if(this.Editor.RectangleSelection.clearSelection(),G.isNativeInput(e.target)&&!this.readyToBlockSelection){this.readyToBlockSelection=!0;return}let t=this.Editor.BlockManager.getBlock(e.target).inputs;if(t.length>1&&!this.readyToBlockSelection){this.readyToBlockSelection=!0;return}if(t.length===1&&!this.needToSelectAll){this.needToSelectAll=!0;return}this.needToSelectAll?(e.preventDefault(),this.selectAllBlocks(),this.needToSelectAll=!1,this.readyToBlockSelection=!1,this.Editor.ConversionToolbar.close()):this.readyToBlockSelection&&(e.preventDefault(),this.selectBlockByIndex(),this.needToSelectAll=!0)}selectAllBlocks(){this.selection.save(),ge.get().removeAllRanges(),this.allBlocksSelected=!0,this.Editor.InlineToolbar.close()}},fr=class extends Oe{get positions(){return{START:"start",END:"end",DEFAULT:"default"}}static get CSS(){return{shadowCaret:"cdx-shadow-caret"}}get isAtStart(){let e=ge.get(),t=G.getDeepestNode(this.Editor.BlockManager.currentBlock.currentInput),r=e.focusNode;if(G.isNativeInput(t))return t.selectionEnd===0;if(!e.anchorNode)return!1;let s=r.textContent.search(/\S/);s===-1&&(s=0);let n=e.focusOffset;return r.nodeType!==Node.TEXT_NODE&&r.childNodes.length&&(r.childNodes[n]?(r=r.childNodes[n],n=0):(r=r.childNodes[n-1],n=r.textContent.length)),(G.isLineBreakTag(t)||G.isEmpty(t))&&this.getHigherLevelSiblings(r,"left").every(o=>{let a=G.isLineBreakTag(o),l=o.children.length===1&&G.isLineBreakTag(o.children[0]),c=a||l;return G.isEmpty(o)&&!c})&&n===s?!0:t===null||r===t&&n<=s}get isAtEnd(){let e=ge.get(),t=e.focusNode,r=G.getDeepestNode(this.Editor.BlockManager.currentBlock.currentInput,!0);if(G.isNativeInput(r))return r.selectionEnd===r.value.length;if(!e.focusNode)return!1;let s=e.focusOffset;if(t.nodeType!==Node.TEXT_NODE&&t.childNodes.length&&(t.childNodes[s-1]?(t=t.childNodes[s-1],s=t.textContent.length):(t=t.childNodes[0],s=0)),G.isLineBreakTag(r)||G.isEmpty(r)){let o=this.getHigherLevelSiblings(t,"right");if(o.every((a,l)=>l===o.length-1&&G.isLineBreakTag(a)||G.isEmpty(a)&&!G.isLineBreakTag(a))&&s===t.textContent.length)return!0}let n=r.textContent.replace(/\s+$/,"");return t===r&&s>=n.length}setToBlock(e,t=this.positions.DEFAULT,r=0){let{BlockManager:s}=this.Editor,n;switch(t){case this.positions.START:n=e.firstInput;break;case this.positions.END:n=e.lastInput;break;default:n=e.currentInput}if(!n)return;let o=G.getDeepestNode(n,t===this.positions.END),a=G.getContentLength(o);switch(!0){case t===this.positions.START:r=0;break;case t===this.positions.END:case r>a:r=a;break}dr(()=>{this.set(o,r)},20)(),s.setCurrentBlockByChildNode(e.holder),s.currentBlock.currentInput=n}setToInput(e,t=this.positions.DEFAULT,r=0){let{currentBlock:s}=this.Editor.BlockManager,n=G.getDeepestNode(e);switch(t){case this.positions.START:this.set(n,0);break;case this.positions.END:this.set(n,G.getContentLength(n));break;default:r&&this.set(n,r)}s.currentInput=e}set(e,t=0){let{top:r,bottom:s}=ge.setCursor(e,t),{innerHeight:n}=window;r<0&&window.scrollBy(0,r),s>n&&window.scrollBy(0,s-n)}setToTheLastBlock(){let e=this.Editor.BlockManager.lastBlock;if(e)if(e.tool.isDefault&&e.isEmpty)this.setToBlock(e);else{let t=this.Editor.BlockManager.insertAtEnd();this.setToBlock(t)}}extractFragmentFromCaretPosition(){let e=ge.get();if(e.rangeCount){let t=e.getRangeAt(0),r=this.Editor.BlockManager.currentBlock.currentInput;if(t.deleteContents(),r)if(G.isNativeInput(r)){let s=r,n=document.createDocumentFragment(),o=s.value.substring(0,s.selectionStart),a=s.value.substring(s.selectionStart);return n.textContent=a,s.value=o,n}else{let s=t.cloneRange();return s.selectNodeContents(r),s.setStart(t.endContainer,t.endOffset),s.extractContents()}}}navigateNext(){let{BlockManager:e}=this.Editor,{currentBlock:t,nextContentfulBlock:r}=e,{nextInput:s}=t,n=this.isAtEnd,o=r;if(!o&&!s){if(t.tool.isDefault||!n)return!1;o=e.insertAtEnd()}return n?(s?this.setToInput(s,this.positions.START):this.setToBlock(o,this.positions.START),!0):!1}navigatePrevious(){let{currentBlock:e,previousContentfulBlock:t}=this.Editor.BlockManager;if(!e)return!1;let{previousInput:r}=e;return!t&&!r?!1:this.isAtStart?(r?this.setToInput(r,this.positions.END):this.setToBlock(t,this.positions.END),!0):!1}createShadow(e){let t=document.createElement("span");t.classList.add(fr.CSS.shadowCaret),e.insertAdjacentElement("beforeend",t)}restoreCaret(e){let t=e.querySelector(`.${fr.CSS.shadowCaret}`);if(!t)return;new ge().expandToTag(t);let r=document.createRange();r.selectNode(t),r.extractContents()}insertContentAtCaretPosition(e){let t=document.createDocumentFragment(),r=document.createElement("div"),s=ge.get(),n=ge.range;r.innerHTML=e,Array.from(r.childNodes).forEach(c=>t.appendChild(c)),t.childNodes.length===0&&t.appendChild(new Text);let o=t.lastChild;n.deleteContents(),n.insertNode(t);let a=document.createRange(),l=o.nodeType===Node.TEXT_NODE?o:o.firstChild;l!==null&&l.textContent!==null&&a.setStart(l,l.textContent.length),s.removeAllRanges(),s.addRange(a)}getHigherLevelSiblings(e,t){let r=e,s=[];for(;r.parentNode&&r.parentNode.contentEditable!=="true";)r=r.parentNode;let n=t==="left"?"previousSibling":"nextSibling";for(;r[n];)r=r[n],s.push(r);return s}},qa=class extends Oe{constructor(){super(...arguments),this.onMouseUp=()=>{this.listeners.off(document,"mouseover",this.onMouseOver),this.listeners.off(document,"mouseup",this.onMouseUp)},this.onMouseOver=e=>{let{BlockManager:t,BlockSelection:r}=this.Editor,s=t.getBlockByChildNode(e.relatedTarget)||this.lastSelectedBlock,n=t.getBlockByChildNode(e.target);if(!(!s||!n)&&n!==s){if(s===this.firstSelectedBlock){ge.get().removeAllRanges(),s.selected=!0,n.selected=!0,r.clearCache();return}if(n===this.firstSelectedBlock){s.selected=!1,n.selected=!1,r.clearCache();return}this.Editor.InlineToolbar.close(),this.toggleBlocksSelectedState(s,n),this.lastSelectedBlock=n}}}async prepare(){this.listeners.on(document,"mousedown",e=>{this.enableCrossBlockSelection(e)})}watchSelection(e){if(e.button!==K0.LEFT)return;let{BlockManager:t}=this.Editor;this.firstSelectedBlock=t.getBlock(e.target),this.lastSelectedBlock=this.firstSelectedBlock,this.listeners.on(document,"mouseover",this.onMouseOver),this.listeners.on(document,"mouseup",this.onMouseUp)}get isCrossBlockSelectionStarted(){return!!this.firstSelectedBlock&&!!this.lastSelectedBlock}toggleBlockSelectedState(e=!0){let{BlockManager:t,BlockSelection:r}=this.Editor;this.lastSelectedBlock||(this.lastSelectedBlock=this.firstSelectedBlock=t.currentBlock),this.firstSelectedBlock===this.lastSelectedBlock&&(this.firstSelectedBlock.selected=!0,r.clearCache(),ge.get().removeAllRanges());let s=t.blocks.indexOf(this.lastSelectedBlock)+(e?1:-1),n=t.blocks[s];n&&(this.lastSelectedBlock.selected!==n.selected?(n.selected=!0,r.clearCache()):(this.lastSelectedBlock.selected=!1,r.clearCache()),this.lastSelectedBlock=n,this.Editor.InlineToolbar.close(),n.holder.scrollIntoView({block:"nearest"}))}clear(e){let{BlockManager:t,BlockSelection:r,Caret:s}=this.Editor,n=t.blocks.indexOf(this.firstSelectedBlock),o=t.blocks.indexOf(this.lastSelectedBlock);if(r.anyBlockSelected&&n>-1&&o>-1)if(e&&e instanceof KeyboardEvent)switch(e.keyCode){case xe.DOWN:case xe.RIGHT:s.setToBlock(t.blocks[Math.max(n,o)],s.positions.END);break;case xe.UP:case xe.LEFT:s.setToBlock(t.blocks[Math.min(n,o)],s.positions.START);break;default:s.setToBlock(t.blocks[Math.max(n,o)],s.positions.END)}else s.setToBlock(t.blocks[Math.max(n,o)],s.positions.END);this.firstSelectedBlock=this.lastSelectedBlock=null}enableCrossBlockSelection(e){let{UI:t}=this.Editor;ge.isCollapsed||this.Editor.BlockSelection.clearSelection(e),t.nodes.redactor.contains(e.target)?this.watchSelection(e):this.Editor.BlockSelection.clearSelection(e)}toggleBlocksSelectedState(e,t){let{BlockManager:r,BlockSelection:s}=this.Editor,n=r.blocks.indexOf(e),o=r.blocks.indexOf(t),a=e.selected!==t.selected;for(let l=Math.min(n,o);l<=Math.max(n,o);l++){let c=r.blocks[l];c!==this.firstSelectedBlock&&c!==(a?e:t)&&(r.blocks[l].selected=!r.blocks[l].selected,s.clearCache())}}},Ua=class extends Oe{constructor(){super(...arguments),this.isStartedAtEditor=!1}toggleReadOnly(e){e?this.disableModuleBindings():this.enableModuleBindings()}enableModuleBindings(){let{UI:e}=this.Editor;this.readOnlyMutableListeners.on(e.nodes.holder,"drop",async t=>{await this.processDrop(t)},!0),this.readOnlyMutableListeners.on(e.nodes.holder,"dragstart",()=>{this.processDragStart()}),this.readOnlyMutableListeners.on(e.nodes.holder,"dragover",t=>{this.processDragOver(t)},!0)}disableModuleBindings(){this.readOnlyMutableListeners.clearAll()}async processDrop(e){let{BlockManager:t,Caret:r,Paste:s}=this.Editor;e.preventDefault(),t.blocks.forEach(o=>{o.dropTarget=!1}),ge.isAtEditor&&!ge.isCollapsed&&this.isStartedAtEditor&&document.execCommand("delete"),this.isStartedAtEditor=!1;let n=t.setCurrentBlockByChildNode(e.target);if(n)this.Editor.Caret.setToBlock(n,r.positions.END);else{let o=t.setCurrentBlockByChildNode(t.lastBlock.holder);this.Editor.Caret.setToBlock(o,r.positions.END)}await s.processDataTransfer(e.dataTransfer,!0)}processDragStart(){ge.isAtEditor&&!ge.isCollapsed&&(this.isStartedAtEditor=!0),this.Editor.InlineToolbar.close()}processDragOver(e){e.preventDefault()}},Wa=class extends Oe{constructor({config:e,eventsDispatcher:t}){super({config:e,eventsDispatcher:t}),this.disabled=!1,this.batchingTimeout=null,this.batchingOnChangeQueue=new Map,this.batchTime=400,this.mutationObserver=new MutationObserver(r=>{this.redactorChanged(r)}),this.eventsDispatcher.on(mf,r=>{this.particularBlockChanged(r.event)}),this.eventsDispatcher.on(gf,()=>{this.disable()}),this.eventsDispatcher.on(bf,()=>{this.enable()})}enable(){this.mutationObserver.observe(this.Editor.UI.nodes.redactor,{childList:!0,subtree:!0,characterData:!0,attributes:!0}),this.disabled=!1}disable(){this.mutationObserver.disconnect(),this.disabled=!0}particularBlockChanged(e){this.disabled||!qe(this.config.onChange)||(this.batchingOnChangeQueue.set(`block:${e.detail.target.id}:event:${e.type}`,e),this.batchingTimeout&&clearTimeout(this.batchingTimeout),this.batchingTimeout=setTimeout(()=>{let t;this.batchingOnChangeQueue.size===1?t=this.batchingOnChangeQueue.values().next().value:t=Array.from(this.batchingOnChangeQueue.values()),this.config.onChange&&this.config.onChange(this.Editor.API.methods,t),this.batchingOnChangeQueue.clear()},this.batchTime))}redactorChanged(e){this.eventsDispatcher.emit(fa,{mutations:e})}},$f=class extends Oe{constructor(){super(...arguments),this.MIME_TYPE="application/x-editor-js",this.toolsTags={},this.tagsByTool={},this.toolsPatterns=[],this.toolsFiles={},this.exceptionList=[],this.processTool=i=>{try{let e=i.create({},{},!1);if(i.pasteConfig===!1){this.exceptionList.push(i.name);return}if(!qe(e.onPaste))return;this.getTagsConfig(i),this.getFilesConfig(i),this.getPatternsConfig(i)}catch(e){Be(`Paste handling for \xAB${i.name}\xBB Tool hasn't been set up because of the error`,"warn",e)}},this.handlePasteEvent=async i=>{let{BlockManager:e,Toolbar:t}=this.Editor,r=e.setCurrentBlockByChildNode(i.target);!r||this.isNativeBehaviour(i.target)&&!i.clipboardData.types.includes("Files")||r&&this.exceptionList.includes(r.name)||(i.preventDefault(),this.processDataTransfer(i.clipboardData),e.clearFocused(),t.close())}}async prepare(){this.processTools()}toggleReadOnly(i){i?this.unsetCallback():this.setCallback()}async processDataTransfer(i,e=!1){let{Tools:t}=this.Editor,r=i.types;if((r.includes?r.includes("Files"):r.contains("Files"))&&!Rt(this.toolsFiles)){await this.processFiles(i.files);return}let s=i.getData(this.MIME_TYPE),n=i.getData("text/plain"),o=i.getData("text/html");if(s)try{this.insertEditorJSData(JSON.parse(s));return}catch(u){}e&&n.trim()&&o.trim()&&(o="<p>"+(o.trim()?o:n)+"</p>");let a=Object.keys(this.toolsTags).reduce((u,p)=>{var m;return u[p.toLowerCase()]=(m=this.toolsTags[p].sanitizationConfig)!=null?m:{},u},{}),l=Object.assign({},a,t.getAllInlineToolsSanitizeConfig(),{br:{}}),c=ni(o,l);!c.trim()||c.trim()===n||!G.isHTMLString(c)?await this.processText(n):await this.processText(c,!0)}async processText(i,e=!1){let{Caret:t,BlockManager:r}=this.Editor,s=e?this.processHTML(i):this.processPlain(i);if(!s.length)return;if(s.length===1){s[0].isBlock?this.processSingleBlock(s.pop()):this.processInlinePaste(s.pop());return}let n=r.currentBlock&&r.currentBlock.tool.isDefault&&r.currentBlock.isEmpty;s.map(async(o,a)=>this.insertBlock(o,a===0&&n)),r.currentBlock&&t.setToBlock(r.currentBlock,t.positions.END)}setCallback(){this.listeners.on(this.Editor.UI.nodes.holder,"paste",this.handlePasteEvent)}unsetCallback(){this.listeners.off(this.Editor.UI.nodes.holder,"paste",this.handlePasteEvent)}processTools(){let i=this.Editor.Tools.blockTools;Array.from(i.values()).forEach(this.processTool)}collectTagNames(i){return bi(i)?[i]:lt(i)?Object.keys(i):[]}getTagsConfig(i){if(i.pasteConfig===!1)return;let e=i.pasteConfig.tags||[],t=[];e.forEach(r=>{let s=this.collectTagNames(r);t.push(...s),s.forEach(n=>{if(Object.prototype.hasOwnProperty.call(this.toolsTags,n)){Be(`Paste handler for \xAB${i.name}\xBB Tool on \xAB${n}\xBB tag is skipped because it is already used by \xAB${this.toolsTags[n].tool.name}\xBB Tool.`,"warn");return}let o=lt(r)?r[n]:null;this.toolsTags[n.toUpperCase()]={tool:i,sanitizationConfig:o}})}),this.tagsByTool[i.name]=t.map(r=>r.toUpperCase())}getFilesConfig(i){if(i.pasteConfig===!1)return;let{files:e={}}=i.pasteConfig,{extensions:t,mimeTypes:r}=e;!t&&!r||(t&&!Array.isArray(t)&&(Be(`\xABextensions\xBB property of the onDrop config for \xAB${i.name}\xBB Tool should be an array`),t=[]),r&&!Array.isArray(r)&&(Be(`\xABmimeTypes\xBB property of the onDrop config for \xAB${i.name}\xBB Tool should be an array`),r=[]),r&&(r=r.filter(s=>e1(s)?!0:(Be(`MIME type value \xAB${s}\xBB for the \xAB${i.name}\xBB Tool is not a valid MIME type`,"warn"),!1))),this.toolsFiles[i.name]={extensions:t||[],mimeTypes:r||[]})}getPatternsConfig(i){i.pasteConfig===!1||!i.pasteConfig.patterns||Rt(i.pasteConfig.patterns)||Object.entries(i.pasteConfig.patterns).forEach(([e,t])=>{t instanceof RegExp||Be(`Pattern ${t} for \xAB${i.name}\xBB Tool is skipped because it should be a Regexp instance.`,"warn"),this.toolsPatterns.push({key:e,pattern:t,tool:i})})}isNativeBehaviour(i){return G.isNativeInput(i)}async processFiles(i){let{BlockManager:e}=this.Editor,t;t=await Promise.all(Array.from(i).map(s=>this.processFile(s))),t=t.filter(s=>!!s);let r=e.currentBlock.tool.isDefault&&e.currentBlock.isEmpty;t.forEach((s,n)=>{e.paste(s.type,s.event,n===0&&r)})}async processFile(i){let e=Q0(i),t=Object.entries(this.toolsFiles).find(([s,{mimeTypes:n,extensions:o}])=>{let[a,l]=i.type.split("/"),c=o.find(p=>p.toLowerCase()===e.toLowerCase()),u=n.find(p=>{let[m,w]=p.split("/");return m===a&&(w===l||w==="*")});return!!c||!!u});if(!t)return;let[r]=t;return{event:this.composePasteEvent("file",{file:i}),type:r}}processHTML(i){let{Tools:e}=this.Editor,t=G.make("DIV");return t.innerHTML=i,this.getNodes(t).map(r=>{let s,n=e.defaultTool,o=!1;switch(r.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:s=G.make("div"),s.appendChild(r);break;case Node.ELEMENT_NODE:s=r,o=!0,this.toolsTags[s.tagName]&&(n=this.toolsTags[s.tagName].tool);break}let{tags:a}=n.pasteConfig||{tags:[]},l=a.reduce((p,m)=>(this.collectTagNames(m).forEach(w=>{let x=lt(m)?m[w]:null;p[w.toLowerCase()]=x||{}}),p),{}),c=Object.assign({},l,n.baseSanitizeConfig);if(s.tagName.toLowerCase()==="table"){let p=ni(s.outerHTML,c);s=G.make("div",void 0,{innerHTML:p}).firstChild}else s.innerHTML=ni(s.innerHTML,c);let u=this.composePasteEvent("tag",{data:s});return{content:s,isBlock:o,tool:n.name,event:u}}).filter(r=>{let s=G.isEmpty(r.content),n=G.isSingleTag(r.content);return!s||n})}processPlain(i){let{defaultBlock:e}=this.config;if(!i)return[];let t=e;return i.split(/\r?\n/).filter(r=>r.trim()).map(r=>{let s=G.make("div");s.textContent=r;let n=this.composePasteEvent("tag",{data:s});return{content:s,tool:t,isBlock:!1,event:n}})}async processSingleBlock(i){let{Caret:e,BlockManager:t}=this.Editor,{currentBlock:r}=t;if(!r||i.tool!==r.name||!G.containsOnlyInlineElements(i.content.innerHTML)){this.insertBlock(i,(r==null?void 0:r.tool.isDefault)&&r.isEmpty);return}e.insertContentAtCaretPosition(i.content.innerHTML)}async processInlinePaste(i){let{BlockManager:e,Caret:t}=this.Editor,{content:r}=i;if(e.currentBlock&&e.currentBlock.tool.isDefault&&r.textContent.length<$f.PATTERN_PROCESSING_MAX_LENGTH){let s=await this.processPattern(r.textContent);if(s){let n=e.currentBlock&&e.currentBlock.tool.isDefault&&e.currentBlock.isEmpty,o=e.paste(s.tool,s.event,n);t.setToBlock(o,t.positions.END);return}}if(e.currentBlock&&e.currentBlock.currentInput){let s=e.currentBlock.tool.baseSanitizeConfig;document.execCommand("insertHTML",!1,ni(r.innerHTML,s))}else this.insertBlock(i)}async processPattern(i){let e=this.toolsPatterns.find(t=>{let r=t.pattern.exec(i);return r?i===r.shift():!1});return e?{event:this.composePasteEvent("pattern",{key:e.key,data:i}),tool:e.tool.name}:void 0}insertBlock(i,e=!1){let{BlockManager:t,Caret:r}=this.Editor,{currentBlock:s}=t,n;if(e&&s&&s.isEmpty){n=t.paste(i.tool,i.event,!0),r.setToBlock(n,r.positions.END);return}n=t.paste(i.tool,i.event),r.setToBlock(n,r.positions.END)}insertEditorJSData(i){let{BlockManager:e,Caret:t,Tools:r}=this.Editor;vf(i,s=>r.blockTools.get(s).sanitizeConfig).forEach(({tool:s,data:n},o)=>{let a=!1;o===0&&(a=e.currentBlock&&e.currentBlock.tool.isDefault&&e.currentBlock.isEmpty);let l=e.insert({tool:s,data:n,replace:a});t.setToBlock(l,t.positions.END)})}processElementNode(i,e,t){let r=Object.keys(this.toolsTags),s=i,{tool:n}=this.toolsTags[s.tagName]||{},o=this.tagsByTool[n==null?void 0:n.name]||[],a=r.includes(s.tagName),l=G.blockElements.includes(s.tagName.toLowerCase()),c=Array.from(s.children).some(({tagName:p})=>r.includes(p)&&!o.includes(p)),u=Array.from(s.children).some(({tagName:p})=>G.blockElements.includes(p.toLowerCase()));if(!l&&!a&&!c)return t.appendChild(s),[...e,t];if(a&&!c||l&&!u&&!c)return[...e,t,s]}getNodes(i){let e=Array.from(i.childNodes),t,r=(s,n)=>{if(G.isEmpty(n)&&!G.isSingleTag(n))return s;let o=s[s.length-1],a=new DocumentFragment;switch(o&&G.isFragment(o)&&(a=s.pop()),n.nodeType){case Node.ELEMENT_NODE:if(t=this.processElementNode(n,s,a),t)return t;break;case Node.TEXT_NODE:return a.appendChild(n),[...s,a];default:return[...s,a]}return[...s,...Array.from(n.childNodes).reduce(r,[])]};return e.reduce(r,[])}composePasteEvent(i,e){return new CustomEvent(i,{detail:e})}},Of=$f;Of.PATTERN_PROCESSING_MAX_LENGTH=450;var Va=class extends Oe{constructor(){super(...arguments),this.toolsDontSupportReadOnly=[],this.readOnlyEnabled=!1}get isEnabled(){return this.readOnlyEnabled}async prepare(){let{Tools:e}=this.Editor,{blockTools:t}=e,r=[];Array.from(t.entries()).forEach(([s,n])=>{n.isReadOnlySupported||r.push(s)}),this.toolsDontSupportReadOnly=r,this.config.readOnly&&r.length>0&&this.throwCriticalError(),this.toggle(this.config.readOnly)}async toggle(e=!this.readOnlyEnabled){e&&this.toolsDontSupportReadOnly.length>0&&this.throwCriticalError();let t=this.readOnlyEnabled;this.readOnlyEnabled=e;for(let s in this.Editor)this.Editor[s].toggleReadOnly&&this.Editor[s].toggleReadOnly(e);if(t===e)return this.readOnlyEnabled;let r=await this.Editor.Saver.save();return await this.Editor.BlockManager.clear(),await this.Editor.Renderer.render(r.blocks),this.readOnlyEnabled}throwCriticalError(){throw new zn(`To enable read-only mode all connected tools should support it. Tools ${this.toolsDontSupportReadOnly.join(", ")} don't support read-only mode.`)}},Ii=class extends Oe{constructor(){super(...arguments),this.isRectSelectionActivated=!1,this.SCROLL_SPEED=3,this.HEIGHT_OF_SCROLL_ZONE=40,this.BOTTOM_SCROLL_ZONE=1,this.TOP_SCROLL_ZONE=2,this.MAIN_MOUSE_BUTTON=0,this.mousedown=!1,this.isScrolling=!1,this.inScrollZone=null,this.startX=0,this.startY=0,this.mouseX=0,this.mouseY=0,this.stackOfSelected=[],this.listenerIds=[]}static get CSS(){return{overlay:"codex-editor-overlay",overlayContainer:"codex-editor-overlay__container",rect:"codex-editor-overlay__rectangle",topScrollZone:"codex-editor-overlay__scroll-zone--top",bottomScrollZone:"codex-editor-overlay__scroll-zone--bottom"}}prepare(){this.enableModuleBindings()}startSelection(e,t){let r=document.elementFromPoint(e-window.pageXOffset,t-window.pageYOffset);r.closest(`.${this.Editor.Toolbar.CSS.toolbar}`)||(this.Editor.BlockSelection.allBlocksSelected=!1,this.clearSelection(),this.stackOfSelected=[]);let s=[`.${Qe.CSS.content}`,`.${this.Editor.Toolbar.CSS.toolbar}`,`.${this.Editor.InlineToolbar.CSS.inlineToolbar}`],n=r.closest("."+this.Editor.UI.CSS.editorWrapper),o=s.some(a=>!!r.closest(a));!n||o||(this.mousedown=!0,this.startX=e,this.startY=t)}endSelection(){this.mousedown=!1,this.startX=0,this.startY=0,this.overlayRectangle.style.display="none"}isRectActivated(){return this.isRectSelectionActivated}clearSelection(){this.isRectSelectionActivated=!1}enableModuleBindings(){let{container:e}=this.genHTML();this.listeners.on(e,"mousedown",t=>{this.processMouseDown(t)},!1),this.listeners.on(document.body,"mousemove",ua(t=>{this.processMouseMove(t)},10),{passive:!0}),this.listeners.on(document.body,"mouseleave",()=>{this.processMouseLeave()}),this.listeners.on(window,"scroll",ua(t=>{this.processScroll(t)},10),{passive:!0}),this.listeners.on(document.body,"mouseup",()=>{this.processMouseUp()},!1)}processMouseDown(e){e.button===this.MAIN_MOUSE_BUTTON&&(e.target.closest(G.allInputsSelector)!==null||this.startSelection(e.pageX,e.pageY))}processMouseMove(e){this.changingRectangle(e),this.scrollByZones(e.clientY)}processMouseLeave(){this.clearSelection(),this.endSelection()}processScroll(e){this.changingRectangle(e)}processMouseUp(){this.clearSelection(),this.endSelection()}scrollByZones(e){if(this.inScrollZone=null,e<=this.HEIGHT_OF_SCROLL_ZONE&&(this.inScrollZone=this.TOP_SCROLL_ZONE),document.documentElement.clientHeight-e<=this.HEIGHT_OF_SCROLL_ZONE&&(this.inScrollZone=this.BOTTOM_SCROLL_ZONE),!this.inScrollZone){this.isScrolling=!1;return}this.isScrolling||(this.scrollVertical(this.inScrollZone===this.TOP_SCROLL_ZONE?-this.SCROLL_SPEED:this.SCROLL_SPEED),this.isScrolling=!0)}genHTML(){let{UI:e}=this.Editor,t=e.nodes.holder.querySelector("."+e.CSS.editorWrapper),r=G.make("div",Ii.CSS.overlay,{}),s=G.make("div",Ii.CSS.overlayContainer,{}),n=G.make("div",Ii.CSS.rect,{});return s.appendChild(n),r.appendChild(s),t.appendChild(r),this.overlayRectangle=n,{container:t,overlay:r}}scrollVertical(e){if(!(this.inScrollZone&&this.mousedown))return;let t=window.pageYOffset;window.scrollBy(0,e),this.mouseY+=window.pageYOffset-t,setTimeout(()=>{this.scrollVertical(e)},0)}changingRectangle(e){if(!this.mousedown)return;e.pageY!==void 0&&(this.mouseX=e.pageX,this.mouseY=e.pageY);let{rightPos:t,leftPos:r,index:s}=this.genInfoForMouseSelection(),n=this.startX>t&&this.mouseX>t,o=this.startX<r&&this.mouseX<r;this.rectCrossesBlocks=!(n||o),this.isRectSelectionActivated||(this.rectCrossesBlocks=!1,this.isRectSelectionActivated=!0,this.shrinkRectangleToPoint(),this.overlayRectangle.style.display="block"),this.updateRectangleSize(),this.Editor.Toolbar.close(),s!==void 0&&(this.trySelectNextBlock(s),this.inverseSelection(),ge.get().removeAllRanges())}shrinkRectangleToPoint(){this.overlayRectangle.style.left=`${this.startX-window.pageXOffset}px`,this.overlayRectangle.style.top=`${this.startY-window.pageYOffset}px`,this.overlayRectangle.style.bottom=`calc(100% - ${this.startY-window.pageYOffset}px`,this.overlayRectangle.style.right=`calc(100% - ${this.startX-window.pageXOffset}px`}inverseSelection(){let e=this.Editor.BlockManager.getBlockByIndex(this.stackOfSelected[0]).selected;if(this.rectCrossesBlocks&&!e)for(let t of this.stackOfSelected)this.Editor.BlockSelection.selectBlockByIndex(t);if(!this.rectCrossesBlocks&&e)for(let t of this.stackOfSelected)this.Editor.BlockSelection.unSelectBlockByIndex(t)}updateRectangleSize(){this.mouseY>=this.startY?(this.overlayRectangle.style.top=`${this.startY-window.pageYOffset}px`,this.overlayRectangle.style.bottom=`calc(100% - ${this.mouseY-window.pageYOffset}px`):(this.overlayRectangle.style.bottom=`calc(100% - ${this.startY-window.pageYOffset}px`,this.overlayRectangle.style.top=`${this.mouseY-window.pageYOffset}px`),this.mouseX>=this.startX?(this.overlayRectangle.style.left=`${this.startX-window.pageXOffset}px`,this.overlayRectangle.style.right=`calc(100% - ${this.mouseX-window.pageXOffset}px`):(this.overlayRectangle.style.right=`calc(100% - ${this.startX-window.pageXOffset}px`,this.overlayRectangle.style.left=`${this.mouseX-window.pageXOffset}px`)}genInfoForMouseSelection(){let e=document.body.offsetWidth/2,t=this.mouseY-window.pageYOffset,r=document.elementFromPoint(e,t),s=this.Editor.BlockManager.getBlockByChildNode(r),n;s!==void 0&&(n=this.Editor.BlockManager.blocks.findIndex(u=>u.holder===s.holder));let o=this.Editor.BlockManager.lastBlock.holder.querySelector("."+Qe.CSS.content),a=Number.parseInt(window.getComputedStyle(o).width,10)/2,l=e-a,c=e+a;return{index:n,leftPos:l,rightPos:c}}addBlockInSelection(e){this.rectCrossesBlocks&&this.Editor.BlockSelection.selectBlockByIndex(e),this.stackOfSelected.push(e)}trySelectNextBlock(e){let t=this.stackOfSelected[this.stackOfSelected.length-1]===e,r=this.stackOfSelected.length,s=1,n=-1,o=0;if(t)return;let a=this.stackOfSelected[r-1]-this.stackOfSelected[r-2]>0,l=o;r>1&&(l=a?s:n);let c=e>this.stackOfSelected[r-1]&&l===s,u=e<this.stackOfSelected[r-1]&&l===n,p=!(c||u||l===o);if(!p&&(e>this.stackOfSelected[r-1]||this.stackOfSelected[r-1]===void 0)){let x=this.stackOfSelected[r-1]+1||e;for(x;x<=e;x++)this.addBlockInSelection(x);return}if(!p&&e<this.stackOfSelected[r-1]){for(let x=this.stackOfSelected[r-1]-1;x>=e;x--)this.addBlockInSelection(x);return}if(!p)return;let m=r-1,w;for(e>this.stackOfSelected[r-1]?w=()=>e>this.stackOfSelected[m]:w=()=>e<this.stackOfSelected[m];w();)this.rectCrossesBlocks&&this.Editor.BlockSelection.unSelectBlockByIndex(this.stackOfSelected[m]),this.stackOfSelected.pop(),m--}},Ya=class extends Oe{async render(e){return new Promise(t=>{let{Tools:r,BlockManager:s}=this.Editor,n=e.map(({type:o,data:a,tunes:l,id:c})=>{r.available.has(o)===!1&&(Mt(`Tool \xAB${o}\xBB is not found. Check 'tools' property at the Editor.js config.`,"warn"),a=this.composeStubDataForTool(o,a,c),o=r.stubTool);let u;try{u=s.composeBlock({id:c,tool:o,data:a,tunes:l})}catch(p){Be(`Block \xAB${o}\xBB skipped because of plugins error`,"error",{data:a,error:p}),a=this.composeStubDataForTool(o,a,c),o=r.stubTool,u=s.composeBlock({id:c,tool:o,data:a,tunes:l})}return u});s.insertMany(n),window.requestIdleCallback(()=>{t()},{timeout:2e3})})}composeStubDataForTool(e,t,r){let{Tools:s}=this.Editor,n=e;if(s.unavailable.has(e)){let o=s.unavailable.get(e).toolbox;o!==void 0&&o[0].title!==void 0&&(n=o[0].title)}return{savedData:{id:r,type:e,data:t},title:n}}},Ga=class extends Oe{async save(){let{BlockManager:e,Tools:t}=this.Editor,r=e.blocks,s=[];try{r.forEach(a=>{s.push(this.getSavedData(a))});let n=await Promise.all(s),o=await vf(n,a=>t.blockTools.get(a).sanitizeConfig);return this.makeOutput(o)}catch(n){Mt("Saving failed due to the Error %o","error",n)}}async getSavedData(e){let t=await e.save(),r=t&&await e.validate(t.data);return rt(Ee({},t),{isValid:r})}makeOutput(e){let t=[];return e.forEach(({id:r,tool:s,data:n,tunes:o,isValid:a})=>{if(!a){Be(`Block \xAB${s}\xBB skipped because saved data is invalid`);return}if(s===this.Editor.Tools.stubTool){t.push(n);return}let l=Ee({id:r,type:s,data:n},!Rt(o)&&{tunes:o});t.push(l)}),{time:+new Date,blocks:t,version:"2.28.2"}}},Ka={},U1={get exports(){return Ka},set exports(i){Ka=i}};(function(i,e){(function(t,r){i.exports=r()})(window,function(){return function(t){var r={};function s(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=t,s.c=r,s.d=function(n,o,a){s.o(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:a})},s.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,o){if(1&o&&(n=s(n)),8&o||4&o&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&o&&typeof n!="string")for(var l in n)s.d(a,l,function(c){return n[c]}.bind(null,l));return a},s.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(o,"a",o),o},s.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},s.p="/",s(s.s=4)}([function(t,r,s){var n=s(1),o=s(2);typeof(o=o.__esModule?o.default:o)=="string"&&(o=[[t.i,o,""]]);var a={insert:"head",singleton:!1};n(o,a),t.exports=o.locals||{}},function(t,r,s){var n,o=function(){return n===void 0&&(n=!!(window&&document&&document.all&&!window.atob)),n},a=function(){var d={};return function(g){if(d[g]===void 0){var _=document.querySelector(g);if(window.HTMLIFrameElement&&_ instanceof window.HTMLIFrameElement)try{_=_.contentDocument.head}catch(y){_=null}d[g]=_}return d[g]}}(),l=[];function c(d){for(var g=-1,_=0;_<l.length;_++)if(l[_].identifier===d){g=_;break}return g}function u(d,g){for(var _={},y=[],O=0;O<d.length;O++){var E=d[O],k=g.base?E[0]+g.base:E[0],M=_[k]||0,q="".concat(k," ").concat(M);_[k]=M+1;var Y=c(q),F={css:E[1],media:E[2],sourceMap:E[3]};Y!==-1?(l[Y].references++,l[Y].updater(F)):l.push({identifier:q,updater:ee(F,g),references:1}),y.push(q)}return y}function p(d){var g=document.createElement("style"),_=d.attributes||{};if(_.nonce===void 0){var y=s.nc;y&&(_.nonce=y)}if(Object.keys(_).forEach(function(E){g.setAttribute(E,_[E])}),typeof d.insert=="function")d.insert(g);else{var O=a(d.insert||"head");if(!O)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");O.appendChild(g)}return g}var m,w=(m=[],function(d,g){return m[d]=g,m.filter(Boolean).join(`
`)});function x(d,g,_,y){var O=_?"":y.media?"@media ".concat(y.media," {").concat(y.css,"}"):y.css;if(d.styleSheet)d.styleSheet.cssText=w(g,O);else{var E=document.createTextNode(O),k=d.childNodes;k[g]&&d.removeChild(k[g]),k.length?d.insertBefore(E,k[g]):d.appendChild(E)}}function A(d,g,_){var y=_.css,O=_.media,E=_.sourceMap;if(O?d.setAttribute("media",O):d.removeAttribute("media"),E&&btoa&&(y+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(E))))," */")),d.styleSheet)d.styleSheet.cssText=y;else{for(;d.firstChild;)d.removeChild(d.firstChild);d.appendChild(document.createTextNode(y))}}var D=null,j=0;function ee(d,g){var _,y,O;if(g.singleton){var E=j++;_=D||(D=p(g)),y=x.bind(null,_,E,!1),O=x.bind(null,_,E,!0)}else _=p(g),y=A.bind(null,_,g),O=function(){(function(k){if(k.parentNode===null)return!1;k.parentNode.removeChild(k)})(_)};return y(d),function(k){if(k){if(k.css===d.css&&k.media===d.media&&k.sourceMap===d.sourceMap)return;y(d=k)}else O()}}t.exports=function(d,g){(g=g||{}).singleton||typeof g.singleton=="boolean"||(g.singleton=o());var _=u(d=d||[],g);return function(y){if(y=y||[],Object.prototype.toString.call(y)==="[object Array]"){for(var O=0;O<_.length;O++){var E=c(_[O]);l[E].references--}for(var k=u(y,g),M=0;M<_.length;M++){var q=c(_[M]);l[q].references===0&&(l[q].updater(),l.splice(q,1))}_=k}}}},function(t,r,s){(r=s(3)(!1)).push([t.i,`.ce-paragraph {
    line-height: 1.6em;
    outline: none;
}

.ce-paragraph[data-placeholder]:empty::before{
  content: attr(data-placeholder);
  color: #707684;
  font-weight: normal;
  opacity: 0;
}

/** Show placeholder at the first paragraph if Editor is empty */
.codex-editor--empty .ce-block:first-child .ce-paragraph[data-placeholder]:empty::before {
  opacity: 1;
}

.codex-editor--toolbox-opened .ce-block:first-child .ce-paragraph[data-placeholder]:empty::before,
.codex-editor--empty .ce-block:first-child .ce-paragraph[data-placeholder]:empty:focus::before {
  opacity: 0;
}

.ce-paragraph p:first-of-type{
    margin-top: 0;
}

.ce-paragraph p:last-of-type{
    margin-bottom: 0;
}
`,""]),t.exports=r},function(t,r,s){t.exports=function(n){var o=[];return o.toString=function(){return this.map(function(a){var l=function(c,u){var p=c[1]||"",m=c[3];if(!m)return p;if(u&&typeof btoa=="function"){var w=(A=m,D=btoa(unescape(encodeURIComponent(JSON.stringify(A)))),j="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(D),"/*# ".concat(j," */")),x=m.sources.map(function(ee){return"/*# sourceURL=".concat(m.sourceRoot||"").concat(ee," */")});return[p].concat(x).concat([w]).join(`
`)}var A,D,j;return[p].join(`
`)}(a,n);return a[2]?"@media ".concat(a[2]," {").concat(l,"}"):l}).join("")},o.i=function(a,l,c){typeof a=="string"&&(a=[[null,a,""]]);var u={};if(c)for(var p=0;p<this.length;p++){var m=this[p][0];m!=null&&(u[m]=!0)}for(var w=0;w<a.length;w++){var x=[].concat(a[w]);c&&u[x[0]]||(l&&(x[2]?x[2]="".concat(l," and ").concat(x[2]):x[2]=l),o.push(x))}},o}},function(t,r,s){s.r(r),s.d(r,"default",function(){return a}),s(0);function n(l,c){for(var u=0;u<c.length;u++){var p=c[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}function o(l,c,u){return c&&n(l.prototype,c),u&&n(l,u),l}var a=function(){function l(c){var u=c.data,p=c.config,m=c.api,w=c.readOnly;(function(x,A){if(!(x instanceof A))throw new TypeError("Cannot call a class as a function")})(this,l),this.api=m,this.readOnly=w,this._CSS={block:this.api.styles.block,wrapper:"ce-paragraph"},this.readOnly||(this.onKeyUp=this.onKeyUp.bind(this)),this._placeholder=p.placeholder?p.placeholder:l.DEFAULT_PLACEHOLDER,this._data={},this._element=null,this._preserveBlank=p.preserveBlank!==void 0&&p.preserveBlank,this.data=u}return o(l,null,[{key:"DEFAULT_PLACEHOLDER",get:function(){return""}}]),o(l,[{key:"onKeyUp",value:function(c){c.code!=="Backspace"&&c.code!=="Delete"||this._element.textContent===""&&(this._element.innerHTML="")}},{key:"drawView",value:function(){var c=document.createElement("DIV");return c.classList.add(this._CSS.wrapper,this._CSS.block),c.contentEditable=!1,c.dataset.placeholder=this.api.i18n.t(this._placeholder),this.readOnly||(c.contentEditable=!0,c.addEventListener("keyup",this.onKeyUp)),c}},{key:"render",value:function(){return this._element===null&&(this._element=this.drawView()),this.hydrate(),this._element}},{key:"merge",value:function(c){var u={text:this.data.text+c.text};this.data=u}},{key:"validate",value:function(c){return!(c.text.trim()===""&&!this._preserveBlank)}},{key:"save",value:function(c){return{text:c.innerHTML}}},{key:"onPaste",value:function(c){var u={text:c.detail.data.innerHTML};this.data=u}},{key:"hydrate",value:function(){var c=this;window.requestAnimationFrame(function(){c._element.innerHTML=c._data.text||""})}},{key:"data",get:function(){if(this._element!==null){var c=this._element.innerHTML;this._data.text=c}return this._data},set:function(c){this._data=c||{},this._element!==null&&this.hydrate()}}],[{key:"conversionConfig",get:function(){return{export:"text",import:"text"}}},{key:"sanitize",get:function(){return{text:{br:!0}}}},{key:"isReadOnlySupported",get:function(){return!0}},{key:"pasteConfig",get:function(){return{tags:["P"]}}},{key:"toolbox",get:function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8 9V7.2C8 7.08954 8.08954 7 8.2 7L12 7M16 9V7.2C16 7.08954 15.9105 7 15.8 7L12 7M12 7L12 17M12 17H10M12 17H14"/></svg>',title:"Text"}}}]),l}()}]).default})})(U1);var W1=Yn(Ka),gs=class{constructor(){this.commandName="bold",this.CSS={button:"ce-inline-tool",buttonActive:"ce-inline-tool--active",buttonModifier:"ce-inline-tool--bold"},this.nodes={button:void 0}}static get sanitize(){return{b:{}}}render(){return this.nodes.button=document.createElement("button"),this.nodes.button.type="button",this.nodes.button.classList.add(this.CSS.button,this.CSS.buttonModifier),this.nodes.button.innerHTML=T1,this.nodes.button}surround(){document.execCommand(this.commandName)}checkState(){let e=document.queryCommandState(this.commandName);return this.nodes.button.classList.toggle(this.CSS.buttonActive,e),e}get shortcut(){return"CMD+B"}};gs.isInline=!0;gs.title="Bold";var bs=class{constructor(){this.commandName="italic",this.CSS={button:"ce-inline-tool",buttonActive:"ce-inline-tool--active",buttonModifier:"ce-inline-tool--italic"},this.nodes={button:null}}static get sanitize(){return{i:{}}}render(){return this.nodes.button=document.createElement("button"),this.nodes.button.type="button",this.nodes.button.classList.add(this.CSS.button,this.CSS.buttonModifier),this.nodes.button.innerHTML=A1,this.nodes.button}surround(){document.execCommand(this.commandName)}checkState(){let e=document.queryCommandState(this.commandName);return this.nodes.button.classList.toggle(this.CSS.buttonActive,e),e}get shortcut(){return"CMD+I"}};bs.isInline=!0;bs.title="Italic";var vs=class{constructor({api:e}){this.commandLink="createLink",this.commandUnlink="unlink",this.ENTER_KEY=13,this.CSS={button:"ce-inline-tool",buttonActive:"ce-inline-tool--active",buttonModifier:"ce-inline-tool--link",buttonUnlink:"ce-inline-tool--unlink",input:"ce-inline-tool-input",inputShowed:"ce-inline-tool-input--showed"},this.nodes={button:null,input:null},this.inputOpened=!1,this.toolbar=e.toolbar,this.inlineToolbar=e.inlineToolbar,this.notifier=e.notifier,this.i18n=e.i18n,this.selection=new ge}static get sanitize(){return{a:{href:!0,target:"_blank",rel:"nofollow"}}}render(){return this.nodes.button=document.createElement("button"),this.nodes.button.type="button",this.nodes.button.classList.add(this.CSS.button,this.CSS.buttonModifier),this.nodes.button.innerHTML=af,this.nodes.button}renderActions(){return this.nodes.input=document.createElement("input"),this.nodes.input.placeholder=this.i18n.t("Add a link"),this.nodes.input.classList.add(this.CSS.input),this.nodes.input.addEventListener("keydown",e=>{e.keyCode===this.ENTER_KEY&&this.enterPressed(e)}),this.nodes.input}surround(e){if(e){this.inputOpened?(this.selection.restore(),this.selection.removeFakeBackground()):(this.selection.setFakeBackground(),this.selection.save());let t=this.selection.findParentTag("A");if(t){this.selection.expandToTag(t),this.unlink(),this.closeActions(),this.checkState(),this.toolbar.close();return}}this.toggleActions()}checkState(){let e=this.selection.findParentTag("A");if(e){this.nodes.button.innerHTML=M1,this.nodes.button.classList.add(this.CSS.buttonUnlink),this.nodes.button.classList.add(this.CSS.buttonActive),this.openActions();let t=e.getAttribute("href");this.nodes.input.value=t!=="null"?t:"",this.selection.save()}else this.nodes.button.innerHTML=af,this.nodes.button.classList.remove(this.CSS.buttonUnlink),this.nodes.button.classList.remove(this.CSS.buttonActive);return!!e}clear(){this.closeActions()}get shortcut(){return"CMD+K"}toggleActions(){this.inputOpened?this.closeActions(!1):this.openActions(!0)}openActions(e=!1){this.nodes.input.classList.add(this.CSS.inputShowed),e&&this.nodes.input.focus(),this.inputOpened=!0}closeActions(e=!0){if(this.selection.isFakeBackgroundEnabled){let t=new ge;t.save(),this.selection.restore(),this.selection.removeFakeBackground(),t.restore()}this.nodes.input.classList.remove(this.CSS.inputShowed),this.nodes.input.value="",e&&this.selection.clearSaved(),this.inputOpened=!1}enterPressed(e){let t=this.nodes.input.value||"";if(!t.trim()){this.selection.restore(),this.unlink(),e.preventDefault(),this.closeActions();return}if(!this.validateURL(t)){this.notifier.show({message:"Pasted link is not valid.",style:"error"}),Be("Incorrect Link pasted","warn",t);return}t=this.prepareLink(t),this.selection.restore(),this.selection.removeFakeBackground(),this.insertLink(t),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.selection.collapseToEnd(),this.inlineToolbar.close()}validateURL(e){return!/\s/.test(e)}prepareLink(e){return e=e.trim(),e=this.addProtocol(e),e}addProtocol(e){if(/^(\w+):(\/\/)?/.test(e))return e;let t=/^\/[^/\s]/.test(e),r=e.substring(0,1)==="#",s=/^\/\/[^/\s]/.test(e);return!t&&!r&&!s&&(e="http://"+e),e}insertLink(e){let t=this.selection.findParentTag("A");t&&this.selection.expandToTag(t),document.execCommand(this.commandLink,!1,e)}unlink(){document.execCommand(this.commandUnlink)}};vs.isInline=!0;vs.title="Link";var Fn=class{constructor({data:e,api:t}){this.CSS={wrapper:"ce-stub",info:"ce-stub__info",title:"ce-stub__title",subtitle:"ce-stub__subtitle"},this.api=t,this.title=e.title||this.api.i18n.t("Error"),this.subtitle=this.api.i18n.t("The block can not be displayed correctly."),this.savedData=e.savedData,this.wrapper=this.make()}render(){return this.wrapper}save(){return this.savedData}make(){let e=G.make("div",this.CSS.wrapper),t=N1,r=G.make("div",this.CSS.info),s=G.make("div",this.CSS.title,{textContent:this.title}),n=G.make("div",this.CSS.subtitle,{textContent:this.subtitle});return e.innerHTML=t,r.appendChild(s),r.appendChild(n),e.appendChild(r),e}};Fn.isReadOnlySupported=!0;var Xa=class extends ms{constructor(){super(...arguments),this.type=Gn.Inline}get title(){return this.constructable[nl.Title]}create(){return new this.constructable({api:this.api.getMethodsForTool(this),config:this.settings})}},Ja=class extends ms{constructor(){super(...arguments),this.type=Gn.Tune}create(e,t){return new this.constructable({api:this.api.getMethodsForTool(this),config:this.settings,block:t,data:e})}},ot=class extends Map{get blockTools(){let e=Array.from(this.entries()).filter(([,t])=>t.isBlock());return new ot(e)}get inlineTools(){let e=Array.from(this.entries()).filter(([,t])=>t.isInline());return new ot(e)}get blockTunes(){let e=Array.from(this.entries()).filter(([,t])=>t.isTune());return new ot(e)}get internalTools(){let e=Array.from(this.entries()).filter(([,t])=>t.isInternal);return new ot(e)}get externalTools(){let e=Array.from(this.entries()).filter(([,t])=>!t.isInternal);return new ot(e)}},V1=Object.defineProperty,Y1=Object.getOwnPropertyDescriptor,Af=(i,e,t,r)=>{for(var s=r>1?void 0:r?Y1(e,t):e,n=i.length-1,o;n>=0;n--)(o=i[n])&&(s=(r?o(e,t,s):o(s))||s);return r&&s&&V1(e,t,s),s},ys=class extends ms{constructor(){super(...arguments),this.type=Gn.Block,this.inlineTools=new ot,this.tunes=new ot}create(e,t,r){return new this.constructable({data:e,block:t,readOnly:r,api:this.api.getMethodsForTool(this),config:this.settings})}get isReadOnlySupported(){return this.constructable[cr.IsReadOnlySupported]===!0}get isLineBreaksEnabled(){return this.constructable[cr.IsEnabledLineBreaks]}get toolbox(){let e=this.constructable[cr.Toolbox],t=this.config[jn.Toolbox];if(!Rt(e)&&t!==!1)return t?Array.isArray(e)?Array.isArray(t)?t.map((r,s)=>{let n=e[s];return n?Ee(Ee({},n),r):r}):[t]:Array.isArray(t)?t:[Ee(Ee({},e),t)]:Array.isArray(e)?e:[e]}get conversionConfig(){return this.constructable[cr.ConversionConfig]}get enabledInlineTools(){return this.config[jn.EnabledInlineTools]||!1}get enabledBlockTunes(){return this.config[jn.EnabledBlockTunes]}get pasteConfig(){var e;return(e=this.constructable[cr.PasteConfig])!=null?e:{}}get sanitizeConfig(){let e=super.sanitizeConfig,t=this.baseSanitizeConfig;if(Rt(e))return t;let r={};for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s)){let n=e[s];lt(n)?r[s]=Object.assign({},t,n):r[s]=n}return r}get baseSanitizeConfig(){let e={};return Array.from(this.inlineTools.values()).forEach(t=>Object.assign(e,t.sanitizeConfig)),Array.from(this.tunes.values()).forEach(t=>Object.assign(e,t.sanitizeConfig)),e}};Af([_r],ys.prototype,"sanitizeConfig",1);Af([_r],ys.prototype,"baseSanitizeConfig",1);var Za=class{constructor(e,t,r){this.api=r,this.config=e,this.editorConfig=t}get(e){let o=this.config[e],{class:t,isInternal:r=!1}=o,s=Yl(o,["class","isInternal"]),n=this.getConstructor(t);return new n({name:e,constructable:t,config:s,api:this.api,isDefault:e===this.editorConfig.defaultBlock,defaultPlaceholder:this.editorConfig.placeholder,isInternal:r})}getConstructor(e){switch(!0){case e[nl.IsInline]:return Xa;case e[Ef.IsTune]:return Ja;default:return ys}}},Hn=class{constructor({api:e}){this.CSS={animation:"wobble"},this.api=e}render(){return{icon:wf,title:this.api.i18n.t("Move down"),onActivate:()=>this.handleClick(),name:"move-down"}}handleClick(){let e=this.api.blocks.getCurrentBlockIndex(),t=this.api.blocks.getBlockByIndex(e+1);if(!t)throw new Error("Unable to move Block down since it is already the last");let r=t.holder,s=r.getBoundingClientRect(),n=Math.abs(window.innerHeight-r.offsetHeight);s.top<window.innerHeight&&(n=window.scrollY+r.offsetHeight),window.scrollTo(0,n),this.api.blocks.move(e+1),this.api.toolbar.toggleBlockSettings(!0)}};Hn.isTune=!0;var qn=class{constructor({api:e}){this.api=e}render(){return{icon:$1,title:this.api.i18n.t("Delete"),name:"delete",confirmation:{title:this.api.i18n.t("Click to delete"),onActivate:()=>this.handleClick()}}}handleClick(){this.api.blocks.delete()}};qn.isTune=!0;var Un=class{constructor({api:e}){this.CSS={animation:"wobble"},this.api=e}render(){return{icon:E1,title:this.api.i18n.t("Move up"),onActivate:()=>this.handleClick(),name:"move-up"}}handleClick(){let e=this.api.blocks.getCurrentBlockIndex(),t=this.api.blocks.getBlockByIndex(e),r=this.api.blocks.getBlockByIndex(e-1);if(e===0||!t||!r)throw new Error("Unable to move Block up since it is already the first");let s=t.holder,n=r.holder,o=s.getBoundingClientRect(),a=n.getBoundingClientRect(),l;a.top>0?l=Math.abs(o.top)-Math.abs(a.top):l=Math.abs(o.top)+a.height,window.scrollBy(0,-1*l),this.api.blocks.move(e-1),this.api.toolbar.toggleBlockSettings(!0)}};Un.isTune=!0;var G1=Object.defineProperty,K1=Object.getOwnPropertyDescriptor,X1=(i,e,t,r)=>{for(var s=r>1?void 0:r?K1(e,t):e,n=i.length-1,o;n>=0;n--)(o=i[n])&&(s=(r?o(e,t,s):o(s))||s);return r&&s&&G1(e,t,s),s},Wn=class extends Oe{constructor(){super(...arguments),this.stubTool="stub",this.toolsAvailable=new ot,this.toolsUnavailable=new ot}get available(){return this.toolsAvailable}get unavailable(){return this.toolsUnavailable}get inlineTools(){return this.available.inlineTools}get blockTools(){return this.available.blockTools}get blockTunes(){return this.available.blockTunes}get defaultTool(){return this.blockTools.get(this.config.defaultBlock)}get internal(){return this.available.internalTools}async prepare(){if(this.validateTools(),this.config.tools=pa({},this.internalTools,this.config.tools),!Object.prototype.hasOwnProperty.call(this.config,"tools")||Object.keys(this.config.tools).length===0)throw Error("Can't start without tools");let e=this.prepareConfig();this.factory=new Za(e,this.config,this.Editor.API);let t=this.getListOfPrepareFunctions(e);if(t.length===0)return Promise.resolve();await Z0(t,r=>{this.toolPrepareMethodSuccess(r)},r=>{this.toolPrepareMethodFallback(r)}),this.prepareBlockTools()}getAllInlineToolsSanitizeConfig(){let e={};return Array.from(this.inlineTools.values()).forEach(t=>{Object.assign(e,t.sanitizeConfig)}),e}destroy(){Object.values(this.available).forEach(async e=>{qe(e.reset)&&await e.reset()})}get internalTools(){return{bold:{class:gs,isInternal:!0},italic:{class:bs,isInternal:!0},link:{class:vs,isInternal:!0},paragraph:{class:W1,inlineToolbar:!0,isInternal:!0},stub:{class:Fn,isInternal:!0},moveUp:{class:Un,isInternal:!0},delete:{class:qn,isInternal:!0},moveDown:{class:Hn,isInternal:!0}}}toolPrepareMethodSuccess(e){let t=this.factory.get(e.toolName);if(t.isInline()){let r=["render","surround","checkState"].filter(s=>!t.create()[s]);if(r.length){Be(`Incorrect Inline Tool: ${t.name}. Some of required methods is not implemented %o`,"warn",r),this.toolsUnavailable.set(t.name,t);return}}this.toolsAvailable.set(t.name,t)}toolPrepareMethodFallback(e){this.toolsUnavailable.set(e.toolName,this.factory.get(e.toolName))}getListOfPrepareFunctions(e){let t=[];return Object.entries(e).forEach(([r,s])=>{t.push({function:qe(s.class.prepare)?s.class.prepare:()=>{},data:{toolName:r,config:s.config}})}),t}prepareBlockTools(){Array.from(this.blockTools.values()).forEach(e=>{this.assignInlineToolsToBlockTool(e),this.assignBlockTunesToBlockTool(e)})}assignInlineToolsToBlockTool(e){if(this.config.inlineToolbar!==!1){if(e.enabledInlineTools===!0){e.inlineTools=new ot(Array.isArray(this.config.inlineToolbar)?this.config.inlineToolbar.map(t=>[t,this.inlineTools.get(t)]):Array.from(this.inlineTools.entries()));return}Array.isArray(e.enabledInlineTools)&&(e.inlineTools=new ot(e.enabledInlineTools.map(t=>[t,this.inlineTools.get(t)])))}}assignBlockTunesToBlockTool(e){if(e.enabledBlockTunes!==!1){if(Array.isArray(e.enabledBlockTunes)){let t=new ot(e.enabledBlockTunes.map(r=>[r,this.blockTunes.get(r)]));e.tunes=new ot([...t,...this.blockTunes.internalTools]);return}if(Array.isArray(this.config.tunes)){let t=new ot(this.config.tunes.map(r=>[r,this.blockTunes.get(r)]));e.tunes=new ot([...t,...this.blockTunes.internalTools]);return}e.tunes=this.blockTunes.internalTools}}validateTools(){for(let e in this.config.tools)if(Object.prototype.hasOwnProperty.call(this.config.tools,e)){if(e in this.internalTools)return;let t=this.config.tools[e];if(!qe(t)&&!qe(t.class))throw Error(`Tool \xAB${e}\xBB must be a constructor function or an object with function in the \xABclass\xBB property`)}}prepareConfig(){let e={};for(let t in this.config.tools)lt(this.config.tools[t])?e[t]=this.config.tools[t]:e[t]={class:this.config.tools[t]};return e}};X1([_r],Wn.prototype,"getAllInlineToolsSanitizeConfig",1);var J1=`:root{--selectionColor: #e1f2ff;--inlineSelectionColor: #d4ecff;--bg-light: #eff2f5;--grayText: #707684;--color-dark: #1D202B;--color-active-icon: #388AE5;--color-gray-border: rgba(201, 201, 204, .48);--content-width: 650px;--narrow-mode-right-padding: 50px;--toolbox-buttons-size: 26px;--toolbox-buttons-size--mobile: 36px;--icon-size: 20px;--icon-size--mobile: 28px;--block-padding-vertical: .4em;--color-line-gray: #EFF0F1 }.codex-editor{position:relative;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:1}.codex-editor .hide{display:none}.codex-editor__redactor [contenteditable]:empty:after{content:"\\feff"}@media (min-width: 651px){.codex-editor--narrow .codex-editor__redactor{margin-right:50px}}@media (min-width: 651px){.codex-editor--narrow.codex-editor--rtl .codex-editor__redactor{margin-left:50px;margin-right:0}}@media (min-width: 651px){.codex-editor--narrow .ce-toolbar__actions{right:-5px}}.codex-editor-copyable{position:absolute;height:1px;width:1px;top:-400%;opacity:.001}.codex-editor-overlay{position:fixed;top:0px;left:0px;right:0px;bottom:0px;z-index:999;pointer-events:none;overflow:hidden}.codex-editor-overlay__container{position:relative;pointer-events:auto;z-index:0}.codex-editor-overlay__rectangle{position:absolute;pointer-events:none;background-color:#2eaadc33;border:1px solid transparent}.codex-editor svg{max-height:100%}.codex-editor path{stroke:currentColor}.codex-editor ::-moz-selection{background-color:#d4ecff}.codex-editor ::selection{background-color:#d4ecff}.codex-editor--toolbox-opened [contentEditable=true][data-placeholder]:focus:before{opacity:0!important}.ce-scroll-locked{overflow:hidden}.ce-scroll-locked--hard{overflow:hidden;top:calc(-1 * var(--window-scroll-offset));position:fixed;width:100%}.ce-toolbar{position:absolute;left:0;right:0;top:0;-webkit-transition:opacity .1s ease;transition:opacity .1s ease;will-change:opacity,top;display:none}.ce-toolbar--opened{display:block}.ce-toolbar__content{max-width:650px;margin:0 auto;position:relative}.ce-toolbar__plus{color:#1d202b;cursor:pointer;width:26px;height:26px;border-radius:7px;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-flex-negative:0;flex-shrink:0}@media (max-width: 650px){.ce-toolbar__plus{width:36px;height:36px}}@media (hover: hover){.ce-toolbar__plus:hover{background-color:#eff2f5}}.ce-toolbar__plus--active{background-color:#eff2f5;-webkit-animation:bounceIn .75s 1;animation:bounceIn .75s 1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.ce-toolbar__plus-shortcut{opacity:.6;word-spacing:-2px;margin-top:5px}@media (max-width: 650px){.ce-toolbar__plus{position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;position:static}.ce-toolbar__plus--left-oriented:before{left:15px;margin-left:0}.ce-toolbar__plus--right-oriented:before{left:auto;right:15px;margin-left:0}}.ce-toolbar__actions{position:absolute;right:100%;opacity:0;display:-webkit-box;display:-ms-flexbox;display:flex;padding-right:5px}.ce-toolbar__actions--opened{opacity:1}@media (max-width: 650px){.ce-toolbar__actions{right:auto}}.ce-toolbar__settings-btn{color:#1d202b;width:26px;height:26px;border-radius:7px;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;margin-left:3px;cursor:pointer;user-select:none}@media (max-width: 650px){.ce-toolbar__settings-btn{width:36px;height:36px}}@media (hover: hover){.ce-toolbar__settings-btn:hover{background-color:#eff2f5}}.ce-toolbar__settings-btn--active{background-color:#eff2f5;-webkit-animation:bounceIn .75s 1;animation:bounceIn .75s 1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}@media (min-width: 651px){.ce-toolbar__settings-btn{width:24px}}.ce-toolbar__settings-btn--hidden{display:none}@media (max-width: 650px){.ce-toolbar__settings-btn{position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;position:static}.ce-toolbar__settings-btn--left-oriented:before{left:15px;margin-left:0}.ce-toolbar__settings-btn--right-oriented:before{left:auto;right:15px;margin-left:0}}.ce-toolbar__plus svg,.ce-toolbar__settings-btn svg{width:24px;height:24px}@media (min-width: 651px){.codex-editor--narrow .ce-toolbar__plus{left:5px}}@media (min-width: 651px){.codex-editor--narrow .ce-toolbox .ce-popover{right:0;left:auto;left:initial}}.ce-inline-toolbar{--y-offset: 8px;position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;-webkit-transform:translateX(-50%) translateY(8px) scale(.94);transform:translate(-50%) translateY(8px) scale(.94);opacity:0;visibility:hidden;-webkit-transition:opacity .25s ease,-webkit-transform .15s ease;transition:opacity .25s ease,-webkit-transform .15s ease;transition:transform .15s ease,opacity .25s ease;transition:transform .15s ease,opacity .25s ease,-webkit-transform .15s ease;will-change:transform,opacity;top:0;left:0;z-index:3}.ce-inline-toolbar--left-oriented:before{left:15px;margin-left:0}.ce-inline-toolbar--right-oriented:before{left:auto;right:15px;margin-left:0}.ce-inline-toolbar--showed{opacity:1;visibility:visible;-webkit-transform:translateX(-50%);transform:translate(-50%)}.ce-inline-toolbar--left-oriented{-webkit-transform:translateX(-23px) translateY(8px) scale(.94);transform:translate(-23px) translateY(8px) scale(.94)}.ce-inline-toolbar--left-oriented.ce-inline-toolbar--showed{-webkit-transform:translateX(-23px);transform:translate(-23px)}.ce-inline-toolbar--right-oriented{-webkit-transform:translateX(-100%) translateY(8px) scale(.94);transform:translate(-100%) translateY(8px) scale(.94);margin-left:23px}.ce-inline-toolbar--right-oriented.ce-inline-toolbar--showed{-webkit-transform:translateX(-100%);transform:translate(-100%)}.ce-inline-toolbar [hidden]{display:none!important}.ce-inline-toolbar__toggler-and-button-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;width:100%;padding:0 6px}.ce-inline-toolbar__buttons{display:-webkit-box;display:-ms-flexbox;display:flex}.ce-inline-toolbar__dropdown{display:-webkit-box;display:-ms-flexbox;display:flex;padding:6px;margin:0 6px 0 -6px;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;border-right:1px solid rgba(201,201,204,.48);-webkit-box-sizing:border-box;box-sizing:border-box}@media (hover: hover){.ce-inline-toolbar__dropdown:hover{background:#eff2f5}}.ce-inline-toolbar__dropdown--hidden{display:none}.ce-inline-toolbar__dropdown-content,.ce-inline-toolbar__dropdown-arrow{display:-webkit-box;display:-ms-flexbox;display:flex}.ce-inline-toolbar__dropdown-content svg,.ce-inline-toolbar__dropdown-arrow svg{width:20px;height:20px}.ce-inline-toolbar__shortcut{opacity:.6;word-spacing:-3px;margin-top:3px}.ce-inline-tool{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:6px 1px;cursor:pointer;border:0;outline:none;background-color:transparent;vertical-align:bottom;color:inherit;margin:0;border-radius:0;line-height:normal}.ce-inline-tool svg{width:20px;height:20px}@media (max-width: 650px){.ce-inline-tool svg{width:28px;height:28px}}@media (hover: hover){.ce-inline-tool:hover{background-color:#eff2f5}}.ce-inline-tool--active{color:#388ae5}.ce-inline-tool--focused{background:rgba(34,186,255,.08)!important}.ce-inline-tool--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.ce-inline-tool--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.ce-inline-tool--link .icon--unlink,.ce-inline-tool--unlink .icon--link{display:none}.ce-inline-tool--unlink .icon--unlink{display:inline-block;margin-bottom:-1px}.ce-inline-tool-input{outline:none;border:0;border-radius:0 0 4px 4px;margin:0;font-size:13px;padding:10px;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;display:none;font-weight:500;border-top:1px solid rgba(201,201,204,.48);-webkit-appearance:none;font-family:inherit}@media (max-width: 650px){.ce-inline-tool-input{font-size:15px;font-weight:500}}.ce-inline-tool-input::-webkit-input-placeholder{color:#707684}.ce-inline-tool-input::-moz-placeholder{color:#707684}.ce-inline-tool-input:-ms-input-placeholder{color:#707684}.ce-inline-tool-input::-ms-input-placeholder{color:#707684}.ce-inline-tool-input::placeholder{color:#707684}.ce-inline-tool-input--showed{display:block}.ce-conversion-toolbar{position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;opacity:0;visibility:hidden;will-change:transform,opacity;-webkit-transition:opacity .1s ease,-webkit-transform .1s ease;transition:opacity .1s ease,-webkit-transform .1s ease;transition:transform .1s ease,opacity .1s ease;transition:transform .1s ease,opacity .1s ease,-webkit-transform .1s ease;-webkit-transform:translateY(-8px);transform:translateY(-8px);left:-1px;width:190px;margin-top:5px;-webkit-box-sizing:content-box;box-sizing:content-box}.ce-conversion-toolbar--left-oriented:before{left:15px;margin-left:0}.ce-conversion-toolbar--right-oriented:before{left:auto;right:15px;margin-left:0}.ce-conversion-toolbar--showed{opacity:1;visibility:visible;-webkit-transform:none;transform:none}.ce-conversion-toolbar [hidden]{display:none!important}.ce-conversion-toolbar__buttons{display:-webkit-box;display:-ms-flexbox;display:flex}.ce-conversion-toolbar__label{color:#707684;font-size:11px;font-weight:500;letter-spacing:.33px;padding:10px 10px 5px;text-transform:uppercase}.ce-conversion-tool{display:-webkit-box;display:-ms-flexbox;display:flex;padding:5px 10px;font-size:14px;line-height:20px;font-weight:500;cursor:pointer;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.ce-conversion-tool--hidden{display:none}.ce-conversion-tool--focused{background:rgba(34,186,255,.08)!important}.ce-conversion-tool--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.ce-conversion-tool--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.ce-conversion-tool:hover{background:#eff2f5}.ce-conversion-tool__icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;width:26px;height:26px;-webkit-box-shadow:0 0 0 1px rgba(201,201,204,.48);box-shadow:0 0 0 1px #c9c9cc7a;border-radius:5px;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;background:#fff;-webkit-box-sizing:content-box;box-sizing:content-box;-ms-flex-negative:0;flex-shrink:0;margin-right:10px}.ce-conversion-tool__icon svg{width:20px;height:20px}@media (max-width: 650px){.ce-conversion-tool__icon{width:36px;height:36px;border-radius:8px}.ce-conversion-tool__icon svg{width:28px;height:28px}}.ce-conversion-tool--last{margin-right:0!important}.ce-conversion-tool--active{color:#388ae5!important}.ce-conversion-tool--active{-webkit-animation:bounceIn .75s 1;animation:bounceIn .75s 1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.ce-conversion-tool__secondary-label{color:#707684;font-size:12px;margin-left:auto;white-space:nowrap;letter-spacing:-.1em;padding-right:5px;margin-bottom:-2px;opacity:.6}@media (max-width: 650px){.ce-conversion-tool__secondary-label{display:none}}.ce-settings__button{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:6px 1px;border-radius:3px;cursor:pointer;border:0;outline:none;background-color:transparent;vertical-align:bottom;color:inherit;margin:0;line-height:32px}.ce-settings__button svg{width:20px;height:20px}@media (max-width: 650px){.ce-settings__button svg{width:28px;height:28px}}@media (hover: hover){.ce-settings__button:hover{background-color:#eff2f5}}.ce-settings__button--active{color:#388ae5}.ce-settings__button--focused{background:rgba(34,186,255,.08)!important}.ce-settings__button--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.ce-settings__button--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.ce-settings__button:not(:nth-child(3n+3)){margin-right:3px}.ce-settings__button:nth-child(n+4){margin-top:3px}.ce-settings__button--disabled{cursor:not-allowed!important}.ce-settings__button--disabled{opacity:.3}.ce-settings__button--selected{color:#388ae5}@media (min-width: 651px){.codex-editor--narrow .ce-settings .ce-popover{right:0;left:auto;left:initial}}@-webkit-keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-in{0%{opacity:0}to{opacity:1}}.ce-block{-webkit-animation:fade-in .3s ease;animation:fade-in .3s ease;-webkit-animation-fill-mode:none;animation-fill-mode:none;-webkit-animation-fill-mode:initial;animation-fill-mode:initial}.ce-block:first-of-type{margin-top:0}.ce-block--selected .ce-block__content{background:#e1f2ff}.ce-block--selected .ce-block__content [contenteditable]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ce-block--selected .ce-block__content img,.ce-block--selected .ce-block__content .ce-stub{opacity:.55}.ce-block--stretched .ce-block__content{max-width:none}.ce-block__content{position:relative;max-width:650px;margin:0 auto;-webkit-transition:background-color .15s ease;transition:background-color .15s ease}.ce-block--drop-target .ce-block__content:before{content:"";position:absolute;top:100%;left:-20px;margin-top:-1px;height:8px;width:8px;border:solid #388AE5;border-width:1px 1px 0 0;-webkit-transform-origin:right;transform-origin:right;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.ce-block--drop-target .ce-block__content:after{content:"";position:absolute;top:100%;height:1px;width:100%;color:#388ae5;background:repeating-linear-gradient(90deg,#388AE5,#388AE5 1px,#fff 1px,#fff 6px)}.ce-block a{cursor:pointer;-webkit-text-decoration:underline;text-decoration:underline}.ce-block b{font-weight:700}.ce-block i{font-style:italic}@media (min-width: 651px){.codex-editor--narrow .ce-block--focused{margin-right:-50px;padding-right:50px}}@-webkit-keyframes bounceIn{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}20%{-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03)}60%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@keyframes bounceIn{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}20%{-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03)}60%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@-webkit-keyframes selectionBounce{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}50%{-webkit-transform:scale3d(1.01,1.01,1.01);transform:scale3d(1.01,1.01,1.01)}70%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@keyframes selectionBounce{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}50%{-webkit-transform:scale3d(1.01,1.01,1.01);transform:scale3d(1.01,1.01,1.01)}70%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@-webkit-keyframes buttonClicked{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.95,.95,.95);transform:scale3d(.95,.95,.95)}60%{-webkit-transform:scale3d(1.02,1.02,1.02);transform:scale3d(1.02,1.02,1.02)}80%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@keyframes buttonClicked{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.95,.95,.95);transform:scale3d(.95,.95,.95)}60%{-webkit-transform:scale3d(1.02,1.02,1.02);transform:scale3d(1.02,1.02,1.02)}80%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}.cdx-block{padding:.4em 0}.cdx-block::-webkit-input-placeholder{line-height:normal!important}.cdx-input{border:1px solid rgba(201,201,204,.48);-webkit-box-shadow:inset 0 1px 2px 0 rgba(35,44,72,.06);box-shadow:inset 0 1px 2px #232c480f;border-radius:3px;padding:10px 12px;outline:none;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.cdx-input[data-placeholder]:before{position:static!important}.cdx-input[data-placeholder]:before{display:inline-block;width:0;white-space:nowrap;pointer-events:none}.cdx-settings-button{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:6px 1px;border-radius:3px;cursor:pointer;border:0;outline:none;background-color:transparent;vertical-align:bottom;color:inherit;margin:0;min-width:26px;min-height:26px}.cdx-settings-button svg{width:20px;height:20px}@media (max-width: 650px){.cdx-settings-button svg{width:28px;height:28px}}@media (hover: hover){.cdx-settings-button:hover{background-color:#eff2f5}}.cdx-settings-button--focused{background:rgba(34,186,255,.08)!important}.cdx-settings-button--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.cdx-settings-button--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.cdx-settings-button--active{color:#388ae5}.cdx-settings-button svg{width:auto;height:auto}@media (max-width: 650px){.cdx-settings-button{width:36px;height:36px;border-radius:8px}}.cdx-loader{position:relative;border:1px solid rgba(201,201,204,.48)}.cdx-loader:before{content:"";position:absolute;left:50%;top:50%;width:18px;height:18px;margin:-11px 0 0 -11px;border:2px solid rgba(201,201,204,.48);border-left-color:#388ae5;border-radius:50%;-webkit-animation:cdxRotation 1.2s infinite linear;animation:cdxRotation 1.2s infinite linear}@-webkit-keyframes cdxRotation{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes cdxRotation{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.cdx-button{padding:13px;border-radius:3px;border:1px solid rgba(201,201,204,.48);font-size:14.9px;background:#fff;-webkit-box-shadow:0 2px 2px 0 rgba(18,30,57,.04);box-shadow:0 2px 2px #121e390a;color:#707684;text-align:center;cursor:pointer}@media (hover: hover){.cdx-button:hover{background:#FBFCFE;-webkit-box-shadow:0 1px 3px 0 rgba(18,30,57,.08);box-shadow:0 1px 3px #121e3914}}.cdx-button svg{height:20px;margin-right:.2em;margin-top:-2px}.ce-stub{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:12px 18px;margin:10px 0;border-radius:10px;background:#eff2f5;border:1px solid #EFF0F1;color:#707684;font-size:14px}.ce-stub svg{width:20px;height:20px}.ce-stub__info{margin-left:14px}.ce-stub__title{font-weight:500;text-transform:capitalize}.codex-editor.codex-editor--rtl{direction:rtl}.codex-editor.codex-editor--rtl .cdx-list{padding-left:0;padding-right:40px}.codex-editor.codex-editor--rtl .ce-toolbar__plus{right:-26px;left:auto}.codex-editor.codex-editor--rtl .ce-toolbar__actions{right:auto;left:-26px}@media (max-width: 650px){.codex-editor.codex-editor--rtl .ce-toolbar__actions{margin-left:0;margin-right:auto;padding-right:0;padding-left:10px}}.codex-editor.codex-editor--rtl .ce-settings{left:5px;right:auto}.codex-editor.codex-editor--rtl .ce-settings:before{right:auto;left:25px}.codex-editor.codex-editor--rtl .ce-settings__button:not(:nth-child(3n+3)){margin-left:3px;margin-right:0}.codex-editor.codex-editor--rtl .ce-conversion-tool__icon{margin-right:0;margin-left:10px}.codex-editor.codex-editor--rtl .ce-inline-toolbar__dropdown{border-right:0px solid transparent;border-left:1px solid rgba(201,201,204,.48);margin:0 -6px 0 6px}.codex-editor.codex-editor--rtl .ce-inline-toolbar__dropdown .icon--toggler-down{margin-left:0;margin-right:4px}@media (min-width: 651px){.codex-editor--narrow.codex-editor--rtl .ce-toolbar__plus{left:0px;right:5px}}@media (min-width: 651px){.codex-editor--narrow.codex-editor--rtl .ce-toolbar__actions{left:-5px}}.cdx-search-field{--icon-margin-right: 10px;background:rgba(232,232,235,.49);border:1px solid rgba(226,226,229,.2);border-radius:6px;padding:2px;display:grid;grid-template-columns:auto auto 1fr;grid-template-rows:auto}.cdx-search-field__icon{width:26px;height:26px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-right:var(--icon-margin-right)}.cdx-search-field__icon svg{width:20px;height:20px;color:#707684}.cdx-search-field__input{font-size:14px;outline:none;font-weight:500;font-family:inherit;border:0;background:transparent;margin:0;padding:0;line-height:22px;min-width:calc(100% - 26px - var(--icon-margin-right))}.cdx-search-field__input::-webkit-input-placeholder{color:#707684;font-weight:500}.cdx-search-field__input::-moz-placeholder{color:#707684;font-weight:500}.cdx-search-field__input:-ms-input-placeholder{color:#707684;font-weight:500}.cdx-search-field__input::-ms-input-placeholder{color:#707684;font-weight:500}.cdx-search-field__input::placeholder{color:#707684;font-weight:500}.ce-popover{--border-radius: 6px;--width: 200px;--max-height: 270px;--padding: 6px;--offset-from-target: 8px;--color-border: #e8e8eb;--color-shadow: rgba(13,20,33,.13);--color-background: white;--color-text-primary: black;--color-text-secondary: #707684;--color-border-icon: rgba(201, 201, 204, .48);--color-border-icon-disabled: #EFF0F1;--color-text-icon-active: #388AE5;--color-background-icon-active: rgba(56, 138, 229, .1);--color-background-item-focus: rgba(34, 186, 255, .08);--color-shadow-item-focus: rgba(7, 161, 227, .08);--color-background-item-hover: #eff2f5;--color-background-item-confirm: #E24A4A;--color-background-item-confirm-hover: #CE4343;min-width:var(--width);width:var(--width);max-height:var(--max-height);border-radius:var(--border-radius);overflow:hidden;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 3px 15px -3px var(--color-shadow);box-shadow:0 3px 15px -3px var(--color-shadow);position:absolute;left:0;top:calc(100% + var(--offset-from-target));background:var(--color-background);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;z-index:4;opacity:0;max-height:0;pointer-events:none;padding:0;border:none}.ce-popover--opened{opacity:1;padding:var(--padding);max-height:var(--max-height);pointer-events:auto;-webkit-animation:panelShowing .1s ease;animation:panelShowing .1s ease;border:1px solid var(--color-border)}@media (max-width: 650px){.ce-popover--opened{-webkit-animation:panelShowingMobile .25s ease;animation:panelShowingMobile .25s ease}}.ce-popover__items{overflow-y:auto;-ms-scroll-chaining:none;overscroll-behavior:contain}@media (max-width: 650px){.ce-popover__overlay{position:fixed;top:0;bottom:0;left:0;right:0;background:#1D202B;z-index:3;opacity:.5;-webkit-transition:opacity .12s ease-in;transition:opacity .12s ease-in;will-change:opacity;visibility:visible}}.ce-popover__overlay--hidden{display:none}.ce-popover--open-top{top:calc(-1 * (var(--offset-from-target) + var(--popover-height)))}@media (max-width: 650px){.ce-popover{--offset: 5px;position:fixed;max-width:none;min-width:calc(100% - var(--offset) * 2);left:var(--offset);right:var(--offset);bottom:calc(var(--offset) + env(safe-area-inset-bottom));top:auto;border-radius:10px}.ce-popover .ce-popover__search{display:none}}.ce-popover__search,.ce-popover__custom-content:not(:empty){margin-bottom:5px}.ce-popover__nothing-found-message{color:#707684;display:none;cursor:default;padding:3px;font-size:14px;line-height:20px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ce-popover__nothing-found-message--displayed{display:block}.ce-popover__custom-content:not(:empty){padding:4px}@media (min-width: 651px){.ce-popover__custom-content:not(:empty){padding:0}}.ce-popover__custom-content--hidden{display:none}.ce-popover-item{--border-radius: 6px;--icon-size: 20px;--icon-size-mobile: 28px;border-radius:var(--border-radius);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:3px;color:var(--color-text-primary);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media (max-width: 650px){.ce-popover-item{padding:4px}}.ce-popover-item:not(:last-of-type){margin-bottom:1px}.ce-popover-item__icon{border-radius:5px;width:26px;height:26px;-webkit-box-shadow:0 0 0 1px var(--color-border-icon);box-shadow:0 0 0 1px var(--color-border-icon);background:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-right:10px}.ce-popover-item__icon svg{width:20px;height:20px}@media (max-width: 650px){.ce-popover-item__icon{width:36px;height:36px;border-radius:8px}.ce-popover-item__icon svg{width:var(--icon-size-mobile);height:var(--icon-size-mobile)}}.ce-popover-item__title{font-size:14px;line-height:20px;font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@media (max-width: 650px){.ce-popover-item__title{font-size:16px}}.ce-popover-item__secondary-title{color:var(--color-text-secondary);font-size:12px;margin-left:auto;white-space:nowrap;letter-spacing:-.1em;padding-right:5px;margin-bottom:-2px;opacity:.6}@media (max-width: 650px){.ce-popover-item__secondary-title{display:none}}.ce-popover-item--active{background:var(--color-background-icon-active);color:var(--color-text-icon-active)}.ce-popover-item--active .ce-popover-item__icon{-webkit-box-shadow:none;box-shadow:none}.ce-popover-item--disabled{color:var(--color-text-secondary);cursor:default;pointer-events:none}.ce-popover-item--disabled .ce-popover-item__icon{-webkit-box-shadow:0 0 0 1px var(--color-border-icon-disabled);box-shadow:0 0 0 1px var(--color-border-icon-disabled)}.ce-popover-item--focused:not(.ce-popover-item--no-focus){background:var(--color-background-item-focus)!important}.ce-popover-item--focused:not(.ce-popover-item--no-focus){-webkit-box-shadow:inset 0 0 0px 1px var(--color-shadow-item-focus);box-shadow:inset 0 0 0 1px var(--color-shadow-item-focus)}.ce-popover-item--hidden{display:none}@media (hover: hover){.ce-popover-item:hover{cursor:pointer}.ce-popover-item:hover:not(.ce-popover-item--no-hover){background-color:var(--color-background-item-hover)}.ce-popover-item:hover .ce-popover-item__icon{-webkit-box-shadow:none;box-shadow:none}}.ce-popover-item--confirmation{background:var(--color-background-item-confirm)}.ce-popover-item--confirmation .ce-popover-item__icon{color:var(--color-background-item-confirm)}.ce-popover-item--confirmation .ce-popover-item__title{color:#fff}@media (hover: hover){.ce-popover-item--confirmation:not(.ce-popover-item--no-hover):hover{background:var(--color-background-item-confirm-hover)}}.ce-popover-item--confirmation:not(.ce-popover-item--no-focus).ce-popover-item--focused{background:var(--color-background-item-confirm-hover)!important}.ce-popover-item--confirmation .ce-popover-item__icon,.ce-popover-item--active .ce-popover-item__icon,.ce-popover-item--focused .ce-popover-item__icon{-webkit-box-shadow:none;box-shadow:none}@-webkit-keyframes panelShowing{0%{opacity:0;-webkit-transform:translateY(-8px) scale(.9);transform:translateY(-8px) scale(.9)}70%{opacity:1;-webkit-transform:translateY(2px);transform:translateY(2px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes panelShowing{0%{opacity:0;-webkit-transform:translateY(-8px) scale(.9);transform:translateY(-8px) scale(.9)}70%{opacity:1;-webkit-transform:translateY(2px);transform:translateY(2px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes panelShowingMobile{0%{opacity:0;-webkit-transform:translateY(14px) scale(.98);transform:translateY(14px) scale(.98)}70%{opacity:1;-webkit-transform:translateY(-4px);transform:translateY(-4px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes panelShowingMobile{0%{opacity:0;-webkit-transform:translateY(14px) scale(.98);transform:translateY(14px) scale(.98)}70%{opacity:1;-webkit-transform:translateY(-4px);transform:translateY(-4px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}.wobble{-webkit-animation-name:wobble;animation-name:wobble;-webkit-animation-duration:.4s;animation-duration:.4s}@-webkit-keyframes wobble{0%{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}15%{-webkit-transform:translate3d(-9%,0,0);transform:translate3d(-9%,0,0)}30%{-webkit-transform:translate3d(9%,0,0);transform:translate3d(9%,0,0)}45%{-webkit-transform:translate3d(-4%,0,0);transform:translate3d(-4%,0,0)}60%{-webkit-transform:translate3d(4%,0,0);transform:translate3d(4%,0,0)}75%{-webkit-transform:translate3d(-1%,0,0);transform:translate3d(-1%,0,0)}to{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}}@keyframes wobble{0%{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}15%{-webkit-transform:translate3d(-9%,0,0);transform:translate3d(-9%,0,0)}30%{-webkit-transform:translate3d(9%,0,0);transform:translate3d(9%,0,0)}45%{-webkit-transform:translate3d(-4%,0,0);transform:translate3d(-4%,0,0)}60%{-webkit-transform:translate3d(4%,0,0);transform:translate3d(4%,0,0)}75%{-webkit-transform:translate3d(-1%,0,0);transform:translate3d(-1%,0,0)}to{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}}
`,Qa=class extends Oe{constructor(){super(...arguments),this.isMobile=!1,this.contentRectCache=void 0,this.resizeDebouncer=t1(()=>{this.windowResize()},200)}get CSS(){return{editorWrapper:"codex-editor",editorWrapperNarrow:"codex-editor--narrow",editorZone:"codex-editor__redactor",editorZoneHidden:"codex-editor__redactor--hidden",editorEmpty:"codex-editor--empty",editorRtlFix:"codex-editor--rtl"}}get contentRect(){if(this.contentRectCache)return this.contentRectCache;let e=this.nodes.wrapper.querySelector(`.${Qe.CSS.content}`);return e?(this.contentRectCache=e.getBoundingClientRect(),this.contentRectCache):{width:650,left:0,right:0}}async prepare(){this.checkIsMobile(),this.make(),this.loadStyles()}toggleReadOnly(e){e?this.disableModuleBindings():this.enableModuleBindings()}checkEmptiness(){let{BlockManager:e}=this.Editor;this.nodes.wrapper.classList.toggle(this.CSS.editorEmpty,e.isEditorEmpty)}get someToolbarOpened(){let{Toolbar:e,BlockSettings:t,InlineToolbar:r,ConversionToolbar:s}=this.Editor;return t.opened||r.opened||s.opened||e.toolbox.opened}get someFlipperButtonFocused(){return this.Editor.Toolbar.toolbox.hasFocus()?!0:Object.entries(this.Editor).filter(([e,t])=>t.flipper instanceof Dt).some(([e,t])=>t.flipper.hasFocus())}destroy(){this.nodes.holder.innerHTML=""}closeAllToolbars(){let{Toolbar:e,BlockSettings:t,InlineToolbar:r,ConversionToolbar:s}=this.Editor;t.close(),r.close(),s.close(),e.toolbox.close()}checkIsMobile(){this.isMobile=window.innerWidth<ff}make(){this.nodes.holder=G.getHolder(this.config.holder),this.nodes.wrapper=G.make("div",[this.CSS.editorWrapper,...this.isRtl?[this.CSS.editorRtlFix]:[]]),this.nodes.redactor=G.make("div",this.CSS.editorZone),this.nodes.holder.offsetWidth<this.contentRect.width&&this.nodes.wrapper.classList.add(this.CSS.editorWrapperNarrow),this.nodes.redactor.style.paddingBottom=this.config.minHeight+"px",this.nodes.wrapper.appendChild(this.nodes.redactor),this.nodes.holder.appendChild(this.nodes.wrapper)}loadStyles(){let e="editor-js-styles";if(G.get(e))return;let t=G.make("style",null,{id:e,textContent:J1.toString()});G.prepend(document.head,t)}enableModuleBindings(){this.readOnlyMutableListeners.on(this.nodes.redactor,"click",e=>{this.redactorClicked(e)},!1),this.readOnlyMutableListeners.on(this.nodes.redactor,"mousedown",e=>{this.documentTouched(e)},!0),this.readOnlyMutableListeners.on(this.nodes.redactor,"touchstart",e=>{this.documentTouched(e)},!0),this.readOnlyMutableListeners.on(document,"keydown",e=>{this.documentKeydown(e)},!0),this.readOnlyMutableListeners.on(document,"mousedown",e=>{this.documentClicked(e)},!0),this.readOnlyMutableListeners.on(document,"selectionchange",()=>{this.selectionChanged()},!0),this.readOnlyMutableListeners.on(window,"resize",()=>{this.resizeDebouncer()},{passive:!0}),this.watchBlockHoveredEvents()}watchBlockHoveredEvents(){let e;this.readOnlyMutableListeners.on(this.nodes.redactor,"mousemove",ua(t=>{let r=t.target.closest(".ce-block");this.Editor.BlockSelection.anyBlockSelected||r&&e!==r&&(e=r,this.eventsDispatcher.emit(Sf,{block:this.Editor.BlockManager.getBlockByChildNode(r)}))},20),{passive:!0})}disableModuleBindings(){this.readOnlyMutableListeners.clearAll()}windowResize(){this.contentRectCache=null,this.checkIsMobile()}documentKeydown(e){switch(e.keyCode){case xe.ENTER:this.enterPressed(e);break;case xe.BACKSPACE:case xe.DELETE:this.backspacePressed(e);break;case xe.ESC:this.escapePressed(e);break;default:this.defaultBehaviour(e);break}}defaultBehaviour(e){let{currentBlock:t}=this.Editor.BlockManager,r=e.target.closest(`.${this.CSS.editorWrapper}`),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;if(t!==void 0&&r===null){this.Editor.BlockEvents.keydown(e);return}r||t&&s||(this.Editor.BlockManager.dropPointer(),this.Editor.Toolbar.close())}backspacePressed(e){let{BlockManager:t,BlockSelection:r,Caret:s}=this.Editor;if(r.anyBlockSelected&&!ge.isSelectionExists){let n=t.removeSelectedBlocks();s.setToBlock(t.insertDefaultBlockAtIndex(n,!0),s.positions.START),r.clearSelection(e),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}}escapePressed(e){this.Editor.BlockSelection.clearSelection(e),this.Editor.Toolbar.toolbox.opened?(this.Editor.Toolbar.toolbox.close(),this.Editor.Caret.setToBlock(this.Editor.BlockManager.currentBlock)):this.Editor.BlockSettings.opened?this.Editor.BlockSettings.close():this.Editor.ConversionToolbar.opened?this.Editor.ConversionToolbar.close():this.Editor.InlineToolbar.opened?this.Editor.InlineToolbar.close():this.Editor.Toolbar.close()}enterPressed(e){let{BlockManager:t,BlockSelection:r}=this.Editor,s=t.currentBlockIndex>=0;if(r.anyBlockSelected&&!ge.isSelectionExists){r.clearSelection(e),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation();return}if(!this.someToolbarOpened&&s&&e.target.tagName==="BODY"){let n=this.Editor.BlockManager.insert();this.Editor.Caret.setToBlock(n),this.Editor.BlockManager.highlightCurrentNode(),this.Editor.Toolbar.moveAndOpen(n)}this.Editor.BlockSelection.clearSelection(e)}documentClicked(e){if(!e.isTrusted)return;let t=e.target;this.nodes.holder.contains(t)||ge.isAtEditor||(this.Editor.BlockManager.dropPointer(),this.Editor.Toolbar.close());let r=this.Editor.BlockSettings.nodes.wrapper.contains(t),s=this.Editor.Toolbar.nodes.settingsToggler.contains(t),n=r||s;if(this.Editor.BlockSettings.opened&&!n){this.Editor.BlockSettings.close();let o=this.Editor.BlockManager.getBlockByChildNode(t);this.Editor.Toolbar.moveAndOpen(o)}this.Editor.BlockSelection.clearSelection(e)}documentTouched(e){let t=e.target;if(t===this.nodes.redactor){let r=e instanceof MouseEvent?e.clientX:e.touches[0].clientX,s=e instanceof MouseEvent?e.clientY:e.touches[0].clientY;t=document.elementFromPoint(r,s)}try{this.Editor.BlockManager.setCurrentBlockByChildNode(t),this.Editor.BlockManager.highlightCurrentNode()}catch(r){this.Editor.RectangleSelection.isRectActivated()||this.Editor.Caret.setToTheLastBlock()}this.Editor.Toolbar.moveAndOpen()}redactorClicked(e){let{BlockSelection:t}=this.Editor;if(!ge.isCollapsed)return;let r=()=>{e.stopImmediatePropagation(),e.stopPropagation()},s=e.target,n=e.metaKey||e.ctrlKey;if(G.isAnchor(s)&&n){r();let c=s.getAttribute("href"),u=r1(c);n1(u);return}let o=this.Editor.BlockManager.getBlockByIndex(-1),a=G.offset(o.holder).bottom,l=e.pageY;if(e.target instanceof Element&&e.target.isEqualNode(this.nodes.redactor)&&!t.anyBlockSelected&&a<l){r();let{BlockManager:c,Caret:u,Toolbar:p}=this.Editor;(!c.lastBlock.tool.isDefault||!c.lastBlock.isEmpty)&&c.insertAtEnd(),u.setToTheLastBlock(),p.moveAndOpen(c.lastBlock)}}selectionChanged(){let{CrossBlockSelection:e,BlockSelection:t}=this.Editor,r=ge.anchorElement;if(e.isCrossBlockSelectionStarted&&t.anyBlockSelected&&ge.get().removeAllRanges(),!r){ge.range||this.Editor.InlineToolbar.close();return}let s=r.closest(`.${Qe.CSS.content}`)===null;if(s&&(this.Editor.InlineToolbar.containsNode(r)||this.Editor.InlineToolbar.close(),r.dataset.inlineToolbar!=="true"))return;this.Editor.BlockManager.currentBlock||this.Editor.BlockManager.setCurrentBlockByChildNode(r);let n=s!==!0;this.Editor.InlineToolbar.tryToShow(!0,n)}},Z1={BlocksAPI:_a,CaretAPI:ma,EventsAPI:ga,I18nAPI:hs,API:ba,InlineToolbarAPI:va,ListenersAPI:ya,NotifierAPI:xa,ReadOnlyAPI:Ca,SanitizerAPI:Ta,SaverAPI:Ea,SelectionAPI:$a,StylesAPI:Oa,ToolbarAPI:Aa,TooltipAPI:Ba,UiAPI:Ia,BlockSettings:Ma,ConversionToolbar:bt,Toolbar:Da,InlineToolbar:Pa,BlockEvents:ja,BlockManager:Fa,BlockSelection:Ha,Caret:fr,CrossBlockSelection:qa,DragNDrop:Ua,ModificationsObserver:Wa,Paste:Of,ReadOnly:Va,RectangleSelection:Ii,Renderer:Ya,Saver:Ga,Tools:Wn,UI:Qa},el=class{constructor(e){this.moduleInstances={},this.eventsDispatcher=new pr;let t,r;this.isReady=new Promise((s,n)=>{t=s,r=n}),Promise.resolve().then(async()=>{this.configuration=e,this.validate(),this.init(),await this.start(),await this.render();let{BlockManager:s,Caret:n,UI:o,ModificationsObserver:a}=this.moduleInstances;o.checkEmptiness(),a.enable(),this.configuration.autofocus&&(n.setToBlock(s.blocks[0],n.positions.START),s.highlightCurrentNode()),t()}).catch(s=>{Be(`Editor.js is not ready because of ${s}`,"error"),r(s)})}set configuration(e){var t,r;lt(e)?this.config=Ee({},e):this.config={holder:e},ha(!!this.config.holderId,"config.holderId","config.holder"),this.config.holderId&&!this.config.holder&&(this.config.holder=this.config.holderId,this.config.holderId=null),this.config.holder==null&&(this.config.holder="editorjs"),this.config.logLevel||(this.config.logLevel=uf.VERBOSE),X0(this.config.logLevel),ha(!!this.config.initialBlock,"config.initialBlock","config.defaultBlock"),this.config.defaultBlock=this.config.defaultBlock||this.config.initialBlock||"paragraph",this.config.minHeight=this.config.minHeight!==void 0?this.config.minHeight:300;let s={type:this.config.defaultBlock,data:{}};this.config.placeholder=this.config.placeholder||!1,this.config.sanitizer=this.config.sanitizer||{p:!0,b:!0,a:!0},this.config.hideToolbar=this.config.hideToolbar?this.config.hideToolbar:!1,this.config.tools=this.config.tools||{},this.config.i18n=this.config.i18n||{},this.config.data=this.config.data||{blocks:[]},this.config.onReady=this.config.onReady||(()=>{}),this.config.onChange=this.config.onChange||(()=>{}),this.config.inlineToolbar=this.config.inlineToolbar!==void 0?this.config.inlineToolbar:!0,(Rt(this.config.data)||!this.config.data.blocks||this.config.data.blocks.length===0)&&(this.config.data={blocks:[s]}),this.config.readOnly=this.config.readOnly||!1,(t=this.config.i18n)!=null&&t.messages&&kt.setDictionary(this.config.i18n.messages),this.config.i18n.direction=((r=this.config.i18n)==null?void 0:r.direction)||"ltr"}get configuration(){return this.config}validate(){let{holderId:e,holder:t}=this.config;if(e&&t)throw Error("\xABholderId\xBB and \xABholder\xBB param can't assign at the same time.");if(bi(t)&&!G.get(t))throw Error(`element with ID \xAB${t}\xBB is missing. Pass correct holder's ID.`);if(t&&lt(t)&&!G.isElement(t))throw Error("\xABholder\xBB value must be an Element node")}init(){this.constructModules(),this.configureModules()}async start(){await["Tools","UI","BlockManager","Paste","BlockSelection","RectangleSelection","CrossBlockSelection","ReadOnly"].reduce((e,t)=>e.then(async()=>{try{await this.moduleInstances[t].prepare()}catch(r){if(r instanceof zn)throw new Error(r.message);Be(`Module ${t} was skipped because of %o`,"warn",r)}}),Promise.resolve())}render(){return this.moduleInstances.Renderer.render(this.config.data.blocks)}constructModules(){Object.entries(Z1).forEach(([e,t])=>{try{this.moduleInstances[e]=new t({config:this.configuration,eventsDispatcher:this.eventsDispatcher})}catch(r){Be("[constructModules]",`Module ${e} skipped because`,"error",r)}})}configureModules(){for(let e in this.moduleInstances)Object.prototype.hasOwnProperty.call(this.moduleInstances,e)&&(this.moduleInstances[e].state=this.getModulesDiff(e))}getModulesDiff(e){let t={};for(let r in this.moduleInstances)r!==e&&(t[r]=this.moduleInstances[r]);return t}};var Vn=class{static get version(){return"2.28.2"}constructor(e){let t=()=>{};lt(e)&&qe(e.onReady)&&(t=e.onReady);let r=new el(e);this.isReady=r.isReady.then(()=>{this.exportAPI(r),t()})}exportAPI(e){let t=["configuration"],r=()=>{Object.values(e.moduleInstances).forEach(s=>{qe(s.destroy)&&s.destroy(),s.listeners.removeAll()}),e=null;for(let s in this)Object.prototype.hasOwnProperty.call(this,s)&&delete this[s];Object.setPrototypeOf(this,null)};t.forEach(s=>{this[s]=e[s]}),this.destroy=r,Object.setPrototypeOf(this,e.moduleInstances.API.methods),delete this.exportAPI,Object.entries({blocks:{clear:"clear",render:"render"},caret:{focus:"focus"},events:{on:"on",off:"off",emit:"emit"},saver:{save:"save"}}).forEach(([s,n])=>{Object.entries(n).forEach(([o,a])=>{this[a]=e.moduleInstances.API.methods[s][o]})})}};var Bf=Ut(Lf());frappe.standard_pages.Workspaces=function(){var i=frappe.container.add_page("Workspaces");frappe.ui.make_app_page({parent:i,name:"Workspaces",title:__("Workspace"),single_column:!0}),frappe.workspace=new frappe.views.Workspace(i),$(i).bind("show",function(){frappe.workspace.show()})};frappe.views.Workspace=class{constructor(e){this.wrapper=$(e),this.page=e.page,this.blocks=frappe.workspace_block.blocks,this.is_read_only=!0,this.pages={},this.current_page={},this.sidebar_items={public:{},private:{}},this.indicator_colors=["green","cyan","blue","orange","yellow","gray","grey","red","pink","darkgrey","purple","light-blue"],this.prepare_container(),this.sidebar=frappe.app.sidebar,this.app_switcher_menu=frappe.app.app_switcher_menu,this.sidebar.setup_pages(),this.cached_pages=$.extend(!0,{},frappe.boot.sidebar_pages),this.has_access=frappe.boot.sidebar_pages.has_access,this.has_create_access=frappe.boot.sidebar_pages.has_create_access,this.show(),this.register_awesomebar_shortcut()}prepare_container(){this.body=this.wrapper.find(".layout-main-section"),this.prepare_new_and_edit()}prepare_new_and_edit(){this.$page=$(`
		<div class="workspace-header" style="display: flex; gap: 7px; margin-top: var(--margin-sm);">
			<div class="workspace-icon"></div>
			<h4 class="workspace-title"></h4>
		</div>
		<div class="editor-js-container"></div>
		<div class="workspace-footer">
			<button data-label="New" class="btn btn-default ellipsis btn-new-workspace">
				<svg class="es-icon es-line icon-xs" style="" aria-hidden="true">
					<use class="" href="#es-line-add"></use>
				</svg>
				<span class="hidden-xs" data-label="New">${__("New")}</span>
			</button>
			<button class="btn btn-default btn-sm mr-2 btn-edit-workspace" data-label="Edit">
				<svg class="es-icon es-line  icon-xs" style="" aria-hidden="true">
					<use class="" href="#es-line-edit"></use>
				</svg>
				<span class="hidden-xs" data-label="Edit">${__("Edit")}</span>
			</button>
		</div>
	`).appendTo(this.body),this.body.find(".btn-new-workspace").on("click",()=>{this.initialize_new_page(!0)}),this.body.find(".btn-edit-workspace").on("click",async()=>{!this.editor||!this.editor.readOnly||(this.is_read_only=!1,await this.editor.readOnly.toggle(),this.editor.isReady.then(()=>{this.setup_customization_buttons(this._page),this.make_blocks_sortable(),frappe.app.sidebar.toggle_sorting()}))})}get_pages(){return frappe.xcall("frappe.desk.desktop.get_workspace_sidebar_items",null,"GET")}show(){var t;if(!this.sidebar.all_pages){setTimeout(()=>this.show(),100);return}let e=this.get_page_to_show();if(((t=this._page)==null?void 0:t.name)!==e.name){if(!frappe.router.current_route[0]){frappe.route_flags.replace_route=!0,frappe.set_route(frappe.router.slug(e.public?e.name:"private/"+e.name));return}this.page.set_title(__(e.name)),this.show_page(e)}}get_data(e){return frappe.call({method:"frappe.desk.desktop.get_desktop_page",args:{page:{name:e.name,title:e.title,public:e.public}},type:"GET"}).then(t=>{if(this.page_data=t.message,this.pages[e.name]&&delete this.pages[e.name],this.pages[e.name]=t.message,!(!this.page_data||Object.keys(this.page_data).length===0)&&!(this.page_data.charts&&this.page_data.charts.items.length===0))return frappe.dashboard_utils.get_dashboard_settings().then(r=>{if(r){let s=r.chart_config?JSON.parse(r.chart_config):{};this.page_data.charts.items.map(n=>{n.chart_settings=s[n.chart_name]||{}}),this.pages[e.name]=this.page_data}})})}get_page_to_show(){let e;frappe.boot.user.default_workspace?e={name:frappe.boot.user.default_workspace.name,public:frappe.boot.user.default_workspace.public}:localStorage.current_page&&this.sidebar.all_pages.filter(n=>n.name==localStorage.current_page).length!=0?e={name:localStorage.current_page,public:localStorage.is_current_page_public!="false"}:Object.keys(this.sidebar.all_pages).length!==0?e={name:this.sidebar.all_pages[0].name,public:this.sidebar.all_pages[0].public}:e={name:"Build",public:!0};let t=frappe.get_route(),r=(t[1]=="private"?t[2]:t[1])||e.name,s=t[1]?t[1]!="private":e.public;return{name:r,public:s}}async show_page(e){if(this.body.find("#editorjs")[0]||$(`
				<div id="editorjs" class="desk-page page-main-content"></div>
			`).appendTo(this.body.find(".editor-js-container")),this.sidebar.all_pages.length){this.create_page_skeleton();let t=this.sidebar.all_pages.find(s=>s.name==e.name);this._page=t;let r;this._page.public?(r=this._page.app,!r&&this._page.module&&(r=frappe.boot.module_app[frappe.router.slug(this._page.module)]),r||(r="frappe")):r="private",typeof t.content=="string"&&(t.content=JSON.parse(t.content)),this.content=t.content,this.content&&this.add_custom_cards_in_content(),$(".item-anchor").addClass("disable-click"),this.pages&&this.pages[t.name]?this.page_data=this.pages[t.name]:await frappe.after_ajax(()=>this.get_data(t)),this.setup_actions(e),this.prepare_editorjs(),$(".item-anchor").removeClass("disable-click"),this.remove_page_skeleton(),frappe.app.sidebar.apps_switcher.set_current_app(r),this.wrapper.find(".workspace-title").html(__(this._page.title)),this.wrapper.find(".workspace-icon").html(frappe.utils.icon(this._page.icon||"folder-normal","md")),localStorage.current_page=t.name,localStorage.is_current_page_public=t.public?"true":"false"}}add_custom_cards_in_content(){let e=-1;this.content.find((t,r)=>{t.type=="card"&&(e=r)}),e!==-1&&(this.content.splice(e+1,0,{type:"card",data:{card_name:"Custom Documents",col:4}}),this.content.splice(e+2,0,{type:"card",data:{card_name:"Custom Reports",col:4}}))}prepare_editorjs(){this.editor?this.editor.isReady.then(()=>{this.editor.configuration.tools.chart.config.page_data=this.page_data,this.editor.configuration.tools.shortcut.config.page_data=this.page_data,this.editor.configuration.tools.card.config.page_data=this.page_data,this.editor.configuration.tools.quick_list.config.page_data=this.page_data,this.editor.configuration.tools.number_card.config.page_data=this.page_data,this.editor.configuration.tools.custom_block.config.page_data=this.page_data,this.editor.render({blocks:this.content||[]})}):this.initialize_editorjs(this.content)}setup_actions(e){let t=this.sidebar.all_pages.filter(r=>r.name==e.name)[0];if(!this.is_read_only){this.setup_customization_buttons(t);return}this.clear_page_actions(),t.is_editable?this.body.find(".btn-edit-workspace").removeClass("hide"):this.body.find(".btn-edit-workspace").addClass("hide"),this.has_create_access?this.body.find(".btn-new-workspace").removeClass("hide"):this.body.find(".btn-new-workspace").addClass("hide")}initialize_editorjs_undo(){this.undo=new Bf.default({editor:this.editor}),this.undo.initialize({blocks:this.content||[]}),this.undo.readOnly=!1}clear_page_actions(){this.page.clear_primary_action(),this.page.clear_secondary_action(),this.page.clear_inner_toolbar(),this.body.hasClass("edit-mode")||(this.wrapper.find(".page-head").addClass("hidden"),this.wrapper.find(".workspace-header").removeClass("hidden"))}setup_customization_buttons(e){this.body.addClass("edit-mode"),this.initialize_editorjs_undo(),this.clear_page_actions(),this.wrapper.find(".page-head").removeClass("hidden"),this.wrapper.find(".workspace-header").addClass("hidden"),e.is_editable&&this.page.set_primary_action(__("Save"),()=>{this.clear_page_actions(),this.body.removeClass("edit-mode"),this.save_page(e).then(t=>{!t||(this.undo.readOnly=!0,this.editor.readOnly.toggle(),this.is_read_only=!0)}),frappe.app.sidebar.toggle_sorting()},null,__("Saving")),this.page.set_secondary_action(__("Discard"),async()=>{this.body.removeClass("edit-mode"),this.clear_page_actions(),await this.editor.readOnly.toggle(),this.is_read_only=!0,frappe.boot.sidebar_pages=this.cached_pages,this.reload(),frappe.show_alert({message:__("Customizations Discarded"),indicator:"info"})}),e.name&&this.has_access&&this.page.add_inner_button(__("Settings"),()=>{frappe.set_route(`workspace/${e.name}`)})}make_blocks_sortable(){let e=this;this.page_sortable=Sortable.create(this.page.main.find(".codex-editor__redactor").get(0),{handle:".drag-handle",draggable:".ce-block",animation:150,onEnd:function(t){e.editor.blocks.move(t.newIndex,t.oldIndex)},setData:function(){}})}initialize_new_page(){var e=this;this.get_parent_pages();let t=new frappe.ui.Dialog({title:__("New Workspace"),fields:[{label:__("Title"),fieldtype:"Data",fieldname:"title",reqd:1},{label:__("Type"),fieldtype:"Select",fieldname:"type",options:["Workspace","Link","URL"],reqd:1,onchange:function(){t.set_df_property("link_type","hidden",this.get_value()!="Link"),t.set_df_property("link_to","hidden",this.get_value()!="Link")}},{label:__("Link Type"),depends_on:"eval:doc.type=='Link'",mandatory_depends_on:"eval:doc.type=='Link'",fieldtype:"Select",fieldname:"link_type",options:["DocType","Page","Report"]},{label:__("Link To"),depends_on:"eval:doc.type=='Link'",mandatory_depends_on:"eval:doc.type=='Link'",fieldtype:"Dynamic Link",fieldname:"link_to",options:"link_type"},{label:__("External Link"),depends_on:"eval:doc.type=='URL'",mandatory_depends_on:"eval:doc.type=='URL'",fieldtype:"Data",fieldname:"external_link",options:"URL"},{label:__("Parent"),fieldtype:"Select",fieldname:"parent",options:this.private_parent_pages},{label:__("Public"),fieldtype:"Check",fieldname:"is_public",depends_on:`eval:${this.has_access}`,onchange:function(){t.set_df_property("parent","options",this.get_value()?e.public_parent_pages:e.private_parent_pages),t.set_df_property("icon","hidden",this.get_value()?0:1),t.set_df_property("indicator_color","hidden",this.get_value()?1:0)}},{fieldtype:"Column Break"},{label:__("Icon"),fieldtype:"Icon",fieldname:"icon"},{label:__("Indicator color"),fieldtype:"Select",fieldname:"indicator_color",options:this.indicator_colors}],primary_action_label:__("Create"),primary_action:r=>{r.title=strip_html(r.title),t.hide(),r.type==="Workspace"&&this.setup_customization_buttons({is_editable:!0});let s=r.title+(r.is_public?"":"-"+frappe.session.user),n=[{type:"header",data:{text:r.title}}],o={content:JSON.stringify(n),name:s,label:s,title:r.title,public:r.is_public||0,for_user:r.is_public?"":frappe.session.user,icon:r.icon,indicator_color:r.indicator_color,parent_page:r.parent||"",is_editable:!0,selected:!0,app:frappe.current_app,type:r.type,link_type:r.link_type,link_to:r.link_to,external_link:r.external_link};o.type!=="Workspace"?this.create_page(o):this.editor.render({blocks:n}).then(async()=>{this.editor.configuration.readOnly&&(this.is_read_only=!1,await this.editor.readOnly.toggle()),this.create_page(o).then(()=>{let l=(o.public?"":"private/")+frappe.router.slug(o.title);frappe.set_route(l)})})}});t.show()}create_page(e){return new Promise(t=>{frappe.call({method:"frappe.desk.doctype.workspace.workspace.new_page",args:{new_page:e},callback:r=>{if(r.message){let s=__("Workspace {0} created",[e.title.bold()]);window.Cypress||frappe.show_alert({message:s,indicator:"green"}),frappe.boot.sidebar_pages=r.message,this.sidebar.setup_pages(),!frappe.boot.app_data_map.private&&e.public===0&&this.sidebar.apps_switcher.add_private_app(),t()}}})})}initialize_editorjs(e){this.tools={header:{class:this.blocks.header,inlineToolbar:["HeaderSize","bold","italic","link"],config:{default_size:4}},paragraph:{class:this.blocks.paragraph,inlineToolbar:["HeaderSize","bold","italic","link"],config:{placeholder:__("Choose a block or continue typing")}},chart:{class:this.blocks.chart,config:{page_data:this.page_data||[]}},card:{class:this.blocks.card,config:{page_data:this.page_data||[]}},shortcut:{class:this.blocks.shortcut,config:{page_data:this.page_data||[]}},onboarding:{class:this.blocks.onboarding,config:{page_data:this.page_data||[]}},quick_list:{class:this.blocks.quick_list,config:{page_data:this.page_data||[]}},number_card:{class:this.blocks.number_card,config:{page_data:this.page_data||[]}},custom_block:{class:this.blocks.custom_block,config:{page_data:this.page_data||[]}},spacer:this.blocks.spacer,HeaderSize:frappe.workspace_block.tunes.header_size},this.editor=new Vn({data:{blocks:e||[]},tools:this.tools,autofocus:!1,readOnly:!0,logLevel:"ERROR"})}save_page(e){let t=this;return this.current_page={name:e.name,public:e.public},this.editor.save().then(r=>{let s={};r.blocks.forEach(o=>{o.data.new&&(s[o.type]||(s[o.type]=[]),s[o.type].push(o.data.new),delete o.data.new)});let n=r.blocks.filter(o=>o.type!="card"||o.data.card_name!=="Custom Documents"&&o.data.card_name!=="Custom Reports");return e.content==JSON.stringify(n)&&Object.keys(s).length===0?(frappe.show_alert({message:__("No changes made"),indicator:"warning"}),!1):(this.create_page_skeleton(),e.content=JSON.stringify(n),frappe.call({method:"frappe.desk.doctype.workspace.workspace.save_page",args:{name:e.name,public:e.public||0,new_widgets:s,blocks:JSON.stringify(n)},callback:function(o){if(o.message){if(t.discard=!0,t.reload(),window.Cypress)return;frappe.show_alert({message:__("Saved"),indicator:"green"})}}}),!0)}).catch(r=>{})}reload(){return delete this.pages[this._page.name],this._page=null,this.get_pages().then(e=>{frappe.boot.sidebar_pages=e,this.sidebar.setup_pages(),this.show(),this.undo&&(this.undo.readOnly=!0)})}get_parent_pages(e){if(this.public_parent_pages=["",...this.sidebar.all_pages.filter(t=>t.public&&!t.parent_page).map(t=>({label:t.title,value:t.name}))],this.private_parent_pages=["",...this.sidebar.all_pages.filter(t=>!t.public&&!t.parent_page).map(t=>({label:t.title,value:t.name}))],e)return e.public?this.public_parent_pages:this.private_parent_pages}create_page_skeleton(){this.body.find(".workspace-skeleton").length||(this.body.prepend(frappe.render_template("workspace_loading_skeleton")),this.body.find(".codex-editor").addClass("hidden"))}remove_page_skeleton(){this.body.find(".codex-editor").removeClass("hidden"),this.body.find(".workspace-skeleton").remove()}register_awesomebar_shortcut(){"abcdefghijklmnopqrstuvwxyz".split("").forEach(e=>{let t={action:r=>($("#navbar-search").focus(),!1),page:this.page};frappe.ui.keys.add_shortcut(Ee({shortcut:e},t)),frappe.ui.keys.add_shortcut(Ee({shortcut:`shift+${e}`},t))})}};var Wt=class{constructor(e){Object.assign(this,e),this.editing=Boolean(this.values&&Object.keys(this.values).length)}make(){this.make_dialog(),this.setup_dialog_events(),this.dialog.show(),window.cur_dialog=this.dialog,this.editing&&this.set_default_values()}make_dialog(){this.dialog=new frappe.ui.Dialog({title:this.get_title(),fields:this.get_fields(),primary_action:e=>{e=this.process_data(e),!this.editing&&!e.name&&(e.name=`${this.type}-${this.label}-${frappe.utils.get_random(20)}`),this.dialog.hide(),this.primary_action(e)},primary_action_label:this.primary_action_label||__("Add")})}get_title(){if(this.editing)switch(this.type){case"chart":return __("Edit Chart");case"shortcut":return __("Edit Shortcut");case"links":return __("Edit Links");case"number_card":return __("Edit Number Card");case"onboarding":return __("Edit Onboarding");case"quick_list":return __("Edit Quick List");case"custom_block":return __("Edit Custom Block");default:return __("Edit {0}",[__(frappe.model.unscrub(this.type))])}switch(this.type){case"chart":return __("New Chart");case"shortcut":return __("New Shortcut");case"links":return __("New Links");case"number_card":return __("New Number Card");case"onboarding":return __("New Onboarding");case"quick_list":return __("New Quick List");case"custom_block":return __("New Custom Block");default:return __("New {0}",[__(frappe.model.unscrub(this.type))])}}get_fields(){}set_default_values(){return this.dialog.set_values(this.values)}process_data(e){return e}setup_dialog_events(){}hide_field(e){this.dialog.set_df_property(e,"hidden",!0)}show_field(e){this.dialog.set_df_property(e,"hidden",!1)}setup_filter(e){this.filter_group&&(this.filter_group.wrapper.empty(),delete this.filter_group);let t=this.dialog.get_field("filter_area_loading").$wrapper;$(`<span class="text-muted">${__("Loading Filters...")}</span>`).appendTo(t),this.filters=[],this.generate_filter_from_json&&this.generate_filter_from_json(),this.filter_group=new frappe.ui.FilterGroup({parent:this.dialog.get_field("filter_area").$wrapper,doctype:e,on_change:()=>{}}),frappe.model.with_doctype(e,()=>{this.filter_group.add_filters_to_filter_group(this.filters),this.hide_field("filter_area_loading"),this.show_field("filter_area")})}},al=class extends Wt{constructor(e){super(e)}get_fields(){return[{fieldtype:"Link",fieldname:"chart_name",label:__("Chart Name"),options:"Dashboard Chart",reqd:1},{fieldtype:"Data",fieldname:"label",label:"Label"}]}process_data(e){return e.label=e.label?e.label:e.chart_name,e}},ll=class extends Wt{constructor(e){super(e)}get_fields(){return[{fieldtype:"Link",fieldname:"document_type",label:__("DocType"),options:"DocType",reqd:1,onchange:()=>{this.document_type=this.dialog.get_value("document_type"),this.document_type&&this.setup_filter(this.document_type)},get_query:()=>({filters:{issingle:0,istable:0}})},{fieldtype:"Data",fieldname:"label",label:__("Label")},{fieldtype:"Section Break",fieldname:"filter_section",label:__("Add Filters"),depends_on:"eval: doc.document_type"},{fieldtype:"HTML",fieldname:"filter_area_loading"},{fieldtype:"HTML",fieldname:"filter_area"}]}generate_filter_from_json(){this.values&&this.values.quick_list_filter&&(this.filters=frappe.utils.get_filter_from_json(this.values.quick_list_filter,this.values.document_type))}process_data(e){if(this.filter_group){let t=this.filter_group.get_filters();e.quick_list_filter=JSON.stringify(t)}return e.label=e.label?e.label:e.document_type,e}},cl=class extends Wt{constructor(e){super(e)}get_fields(){return[{fieldtype:"Link",fieldname:"onboarding_name",label:__("Onboarding Name"),options:"Module Onboarding",reqd:1}]}},dl=class extends Wt{constructor(e){super(e)}get_fields(){let e=this;return[{fieldtype:"Data",fieldname:"label",label:__("Label")},{fieldtype:"HTML Editor",fieldname:"description",label:__("Description"),max_height:"7rem"},{fieldname:"links",fieldtype:"Table",label:__("Card Links"),editable_grid:1,data:e.values?JSON.parse(e.values.links):[],get_data:()=>e.values?JSON.parse(e.values.links):[],fields:[{fieldname:"link_type",fieldtype:"Select",in_list_view:1,label:__("Link Type"),reqd:1,options:["DocType","Page","Report"]},{fieldname:"link_to",fieldtype:"Dynamic Link",in_list_view:1,label:__("Link To"),reqd:1,get_options:t=>t.doc.link_type,get_query:function(t){if(t.link_type=="DocType")return{filters:{istable:0}}}},{fieldname:"label",fieldtype:"Data",in_list_view:1,label:__("Label")},{fieldname:"icon",fieldtype:"Icon",label:"Icon"},{fieldname:"dependencies",fieldtype:"Data",label:__("Dependencies")},{fieldname:"only_for",fieldtype:"Link",label:__("Only for"),options:"Country"},{default:"0",fieldname:"onboard",fieldtype:"Check",label:__("Onboard")},{default:"0",fieldname:"is_query_report",fieldtype:"Check",label:__("Is Query Report")}]}]}process_data(e){let t="";return e.links?e.links.map((r,s)=>{let n=s+1;r.link_type||(t=__("Following fields have missing values")+": <br><br><ul>",t+=`<li>${__("Link Type in Row")} ${n}</li>`),r.link_to||(t+=`<li>${__("Link To in Row")} ${n}</li>`),r.label=r.label?r.label:r.link_to}):t=__("You must add atleast one link."),t&&(t+="</ul>",frappe.throw({message:__(t),title:__("Missing Values Required"),indicator:"orange"})),e.label=e.label?e.label:e.chart_name,e}},ul=class extends Wt{constructor(e){super(e)}hide_filters(){this.hide_field("count_section_break"),this.hide_field("filters_section_break")}show_filters(){this.show_field("count_section_break"),this.show_field("filters_section_break")}get_fields(){return[{fieldtype:"Select",fieldname:"type",label:__("Type"),reqd:1,options:`DocType
Report
Page
Dashboard
URL`,initial_value:"DocType",onchange:()=>{this.dialog.get_value("type")=="DocType"?this.dialog.fields_dict.link_to.get_query=()=>({query:"frappe.core.report.permitted_documents_for_user.permitted_documents_for_user.query_doctypes",filters:{user:frappe.session.user,include_single_doctypes:!0}}):this.dialog.fields_dict.link_to.get_query=null}},{fieldtype:"Dynamic Link",fieldname:"link_to",label:__("Link To"),options:"type",onchange:()=>{let e=this.dialog.get_value("link_to");e&&this.dialog.get_value("type")=="DocType"?frappe.model.with_doctype(e,async()=>{var n;let t=frappe.get_meta(e);e&&frappe.boot.single_types.includes(e)?this.hide_filters():e&&(this.setup_filter(e),this.show_filters());let r=["List","Report Builder","Dashboard","New"];t.is_tree===1&&r.push("Tree"),t.image_field&&r.push("Image"),frappe.boot.calendars.includes(e)&&r.push("Calendar");let s=await frappe.db.get_value("Kanban Board",{reference_doctype:e},"name");(n=s==null?void 0:s.message)!=null&&n.name&&r.push("Kanban"),this.dialog.set_df_property("doc_view","options",r.join(`
`))}):this.hide_filters()},depends_on:e=>e.type!="URL",mandatory_depends_on:e=>e.type!="URL"},{fieldtype:"Data",fieldname:"label",label:__("Label")},{fieldtype:"Data",fieldname:"url",label:__("URL"),default:"",depends_on:e=>e.type=="URL",mandatory_depends_on:e=>e.type=="URL"},{fieldtype:"Select",fieldname:"doc_view",label:__("DocType View"),options:`List
Report Builder
Dashboard
Tree
New
Calendar
Kanban
Image`,description:__("Which view of the associated DocType should this shortcut take you to?"),default:"List",depends_on:e=>{if(this.dialog){let t=this.dialog.get_value("link_to"),r=frappe.boot.single_types.includes(t);return t&&e.type=="DocType"&&!r}return!1},onchange:()=>{this.dialog.get_value("doc_view")=="Kanban"?this.dialog.fields_dict.kanban_board.get_query=()=>({filters:{reference_doctype:this.dialog.get_value("link_to")}}):this.dialog.fields_dict.link_to.get_query=null}},{fieldtype:"Link",fieldname:"kanban_board",label:__("Kanban Board"),options:"Kanban Board",depends_on:()=>{var t;return((t=this.dialog)==null?void 0:t.get_value("doc_view"))=="Kanban"},mandatory_depends_on:()=>{var t;return((t=this.dialog)==null?void 0:t.get_value("doc_view"))=="Kanban"}},{fieldtype:"Section Break",fieldname:"filters_section_break",label:__("Count Filter"),hidden:1},{fieldtype:"HTML",fieldname:"filter_area_loading"},{fieldtype:"HTML",fieldname:"filter_area",hidden:1},{fieldtype:"Section Break",fieldname:"count_section_break",label:__("Count Customizations"),hidden:1},{fieldtype:"Select",fieldname:"color",label:__("Color"),options:["Grey","Green","Red","Orange","Pink","Yellow","Blue","Cyan"],default:"Grey",input_class:"color-select",onchange:()=>{let e=this.dialog.fields_dict.color.value.toLowerCase(),t=this.dialog.fields_dict.color.$input;t.parent().find(".color-box").get(0)||$('<div class="color-box"></div>').insertBefore(t.get(0)),t.parent().find(".color-box").get(0).style.backgroundColor=`var(--text-on-${e})`}},{fieldtype:"Data",fieldname:"format",label:__("Format"),description:__("For Example: {} Open")}]}set_default_values(){super.set_default_values().then(()=>{this.dialog.fields_dict.link_to.df.onchange()})}generate_filter_from_json(){this.values&&this.values.stats_filter&&(this.filters=frappe.utils.get_filter_from_json(this.values.stats_filter,this.values.link_to))}process_data(e){if(this.dialog.get_value("type")=="DocType"&&this.filter_group){let t=this.filter_group.get_filters();e.stats_filter=JSON.stringify(t)}if(e.label=e.label?e.label:frappe.model.unscrub(e.link_to),e.url){let t=e.url;e.url.startsWith("/")&&(t=frappe.urllib.get_base_url()+e.url),!validate_url(t)&&frappe.throw({message:__("<b>{0}</b> is not a valid URL",[e.url]),title:__("Invalid URL"),indicator:"red"}),e.label||(e.label="No Label (URL)")}return e}},pl=class extends Wt{constructor(e){super(e)}get_fields(){let e;return this.for_workspace?[{fieldtype:"Link",fieldname:"number_card_name",label:__("Number Card"),options:"Number Card",reqd:1,get_query:()=>({query:"frappe.desk.doctype.number_card.number_card.get_cards_for_user",filters:{document_type:this.document_type}})},{fieldtype:"Data",fieldname:"label",label:__("Label")}]:(e=[{fieldtype:"Select",label:__("Choose Existing Card or create New Card"),fieldname:"new_or_existing",options:["New Card","Existing Card"]},{fieldtype:"Link",fieldname:"card",label:__("Number Cards"),options:"Number Card",get_query:()=>({query:"frappe.desk.doctype.number_card.number_card.get_cards_for_user",filters:{document_type:this.document_type}}),depends_on:'eval: doc.new_or_existing == "Existing Card"'},{fieldtype:"Section Break",fieldname:"sb_1",depends_on:'eval: doc.new_or_existing == "New Card"'},{label:__("Label"),fieldname:"label",fieldtype:"Data",mandatory_depends_on:'eval: doc.new_or_existing == "New Card"'},{label:__("Doctype"),fieldname:"document_type",fieldtype:"Link",options:"DocType",onchange:()=>{this.document_type=this.dialog.get_value("document_type"),this.set_aggregate_function_fields(this.dialog.get_values()),this.setup_filter(this.document_type)},hidden:1},{label:__("Color"),fieldname:"color",fieldtype:"Color"},{label:__("Function"),fieldname:"function",fieldtype:"Select",options:["Count","Sum","Average","Minimum","Maximum"],mandatory_depends_on:'eval: doc.new_or_existing == "New Card"'},{label:__("Function Based On"),fieldname:"aggregate_function_based_on",fieldtype:"Select",depends_on:"eval: doc.function !== 'Count'",mandatory_depends_on:'eval: doc.function !== "Count" && doc.new_or_existing == "New Card"'},{fieldtype:"Section Break",fieldname:"sb_1",label:__("Add Filters"),depends_on:'eval: doc.new_or_existing == "New Card"'},{fieldtype:"HTML",fieldname:"filter_area_loading"},{fieldtype:"HTML",fieldname:"filter_area",hidden:1},{fieldtype:"Section Break",fieldname:"sb_1"}],e)}setup_dialog_events(){!this.document_type&&!this.for_workspace&&(this.default_values&&this.default_values.doctype?(this.document_type=this.default_values.doctype,this.setup_filter(this.default_values.doctype),this.set_aggregate_function_fields()):this.show_field("document_type"))}set_aggregate_function_fields(){let e=[];this.document_type&&frappe.get_meta(this.document_type)&&frappe.get_meta(this.document_type).fields.map(t=>{if(frappe.model.numeric_fieldtypes.includes(t.fieldtype)){if(t.fieldtype=="Currency"&&(!t.options||t.options!=="Company:company:default_currency"))return;e.push({label:t.label,value:t.fieldname})}}),this.dialog.set_df_property("aggregate_function_based_on","options",e)}process_data(e){return this.for_workspace?(e.label=e.label?e.label:e.number_card_name,e):(e.new_or_existing=="Existing Card"&&(e.name=e.card),e.stats_filter=this.filter_group&&JSON.stringify(this.filter_group.get_filters()),e.document_type=this.document_type,e)}},hl=class extends Wt{constructor(e){super(e)}get_fields(){return[{fieldtype:"Link",fieldname:"custom_block_name",label:"Custom Block Name",options:"Custom HTML Block",reqd:1,get_query:()=>({query:"frappe.desk.doctype.custom_html_block.custom_html_block.get_custom_blocks_for_user"})}]}};function oi(i){return{chart:al,shortcut:ul,links:dl,onboarding:cl,quick_list:ll,number_card:pl,custom_block:hl}[i]||Wt}var Ke=class{constructor(e){Object.assign(this,e)}make(e,t,r=e){let s=this.config.page_data[e+"s"].items.find(n=>frappe.utils.unescape_html(n.label)==frappe.utils.unescape_html(__(t)));return s?(this.wrapper.innerHTML="",s.in_customize_mode=!this.readOnly,this.block_widget=new frappe.widget.SingleWidgetGroup({container:this.wrapper,type:r,class_name:e=="chart"?"widget-charts":"",options:this.options,widgets:s,api:this.api,block:this.block}),this.wrapper.setAttribute(e+"_name",t),this.readOnly||this.block_widget.customize(),!0):!1}rendered(e){e&&(this.wrapper=e),!this.readOnly&&this.resizer();let t=this.wrapper.closest(".ce-block");this.set_col_class(t,this.get_col())}resizer(){this.wrapper.className=this.wrapper.className+" resizable";var e=document.createElement("div");e.className="resizer",this.wrapper.parentElement.appendChild(e),e.addEventListener("mousedown",n,!1);let t=this;var r,s;function n(c){r=c.clientX,s=this.parentElement.offsetWidth,document.documentElement.addEventListener("mousemove",o,!1),document.documentElement.addEventListener("mouseup",l,!1)}function o(c){$(this).css("cursor","col-resize"),$(".widget").css("pointer-events","none"),$(t.wrapper.parentElement).find(".resizer").css("border-right","3px solid var(--gray-400)"),a(),s+c.clientX-r-s>60?(r=c.clientX,t.increase_width()):s+c.clientX-r-s<-60&&(r=c.clientX,t.decrease_width())}function a(){document.selection?document.selection.empty():window.getSelection().removeAllRanges()}function l(){$(this).css("cursor","default"),$(".widget").css("pointer-events","auto"),$(t.wrapper.parentElement).find(".resizer").css("border-right","0px solid transparent"),document.documentElement.removeEventListener("mousemove",o,!1),document.documentElement.removeEventListener("mouseup",l,!1)}}new(e,t=e){let r=this,s=oi(t),n=e+"_name";this.dialog=new s({for_workspace:!0,label:this.label,type:t,primary_action:o=>{o.in_customize_mode=1,this.block_widget=frappe.widget.make_widget(rt(Ee({},o),{widget_type:t,container:this.wrapper,options:rt(Ee({},this.options),{on_delete:()=>this.api.blocks.delete(),on_edit:()=>this.on_edit(this.block_widget)})})),this.block_widget.customize(this.options),this.wrapper.setAttribute(n,this.block_widget.label),$(this.wrapper).find(".widget").addClass(`${t}`),this.new_block_widget=this.block_widget.get_config(),this.add_settings_button()}}),!this.readOnly&&this.data&&!this.data[n]&&(this.dialog.make(),this.dialog.dialog.get_close_btn().click(()=>{r.wrapper.closest(".ce-block").remove()}))}on_edit(e){let t=e.edit_dialog.type+"_name";e.edit_dialog.type=="links"&&(t="card_name");let r=e.get_config();this.block_widget.widgets=r,this.wrapper.setAttribute(t,r.label),this.new_block_widget=e.get_config()}add_new_block_button(){let e=$(`
			<div class="new-block-button">${frappe.utils.icon("add-round","lg")}</div>
		`);e.appendTo(this.wrapper),e.click(t=>{t.stopPropagation();let r=this.api.blocks.getCurrentBlockIndex()+1;this.api.blocks.insert("paragraph",{},{},r),this.api.caret.setToBlock(r)})}add_settings_button(){let e=this;this.dropdown_list=[{label:"Delete",title:"Delete Block",icon:frappe.utils.icon("delete-active","sm"),action:()=>this.api.blocks.delete()},{label:"Expand",title:"Expand Block",icon:frappe.utils.icon("expand-alt","sm"),action:()=>this.increase_width()},{label:"Shrink",title:"Shrink Block",icon:frappe.utils.icon("shrink","sm"),action:()=>this.decrease_width()},{label:"Move Up",title:"Move Up",icon:frappe.utils.icon("up-arrow","sm"),action:()=>this.move_block("up")},{label:"Move Down",title:"Move Down",icon:frappe.utils.icon("down-arrow","sm"),action:()=>this.move_block("down")}];let t=$(this.wrapper).find(".widget-control"),r=$(`
			<div class="dropdown-btn">
				<button class="btn btn-secondary btn-xs setting-btn" title="${__("Setting")}">
					${frappe.utils.icon("dot-horizontal","xs")}
				</button>
				<div class="dropdown-list hidden"></div>
			</div>
		`),s=function(n,o,a,l){let c=$(`
				<div class="dropdown-item" title="${__(o)}">
					<span class="dropdown-item-icon">${a}</span>
					<span class="dropdown-item-label">${__(n)}</span>
				</div>
			`);return c.click(u=>{u.stopPropagation(),l&&l()}),c};r.click(n=>{n.stopPropagation(),r.find(".dropdown-list").toggleClass("hidden")}),t.prepend(r),this.dropdown_list.forEach(n=>{(n.label=="Expand"||n.label=="Shrink")&&e.options&&!e.options.allow_resize||r.find(".dropdown-list").append(s(n.label,n.title,n.icon,n.action))})}get_col(){let e=this.col||12,t="col-xs-12",r=this.wrapper.closest(".ce-block"),s=new RegExp(/\bcol-.+?\b/,"g");if(r&&r.className.match(s)){r.classList.forEach(function(o){o.match(s)&&(t=o)});let n=t.split("-");e=parseInt(n[2])}return e}decrease_width(){this.update_width("decrease")}increase_width(){this.update_width("increase")}update_width(e){let t=this.options&&this.options.min_width||3,r=this.api.blocks.getCurrentBlockIndex();if(r<0)return;let s=this.api.blocks.getBlockByIndex(r);if(!s)return;let n=s.holder,o="col-xs-12",a=new RegExp(/\bcol-.+?\b/,"g");if(n.className.match(a)){n.classList.forEach(p=>{p.match(a)&&(o=p)});let l=o.split("-"),c=parseInt(l[2]),u=!0;e=="increase"?(u=c<=11,c=c+1):e=="decrease"&&(u=c>t,c=c-1),u&&this.set_col_class(n,c)}}set_col_class(e,t){let r=$.grep(e.classList,function(n){return n.indexOf("col-")!==0});e.classList="",r.forEach(n=>{e.classList.add(n)});let s="col-xs-12";t<=12&&t>=7?s="col-xs-"+t:t==6||t==5?(e.classList.add("col-xs-12"),s="col-sm-"+t):t==4?(e.classList.add("col-xs-12"),e.classList.add("col-sm-6"),s="col-md-"+t):(t==3||t==2)&&(e.classList.add("col-xs-12"),e.classList.add("col-sm-6"),e.classList.add("col-md-4"),s="col-lg-"+t),e.classList.add(s)}move_block(e){let t=this.api.blocks.getCurrentBlockIndex(),r=t+(e=="down"?1:-1);this.api.blocks.move(r,t)}};var ks=class extends Ke{constructor({data:e,config:t,api:r,readOnly:s}){super({config:t,api:r,readOnly:s}),this._settings=this.config,this._data=this.normalizeData(e),this._element=this.getTag(),this.data=e,this.col=this.data.col?this.data.col:"12"}normalizeData(e){let t={};return typeof e!="object"&&(e={}),t.text=e.text||"",t.col=parseInt(e.col)||12,t}render(){if(this.wrapper=document.createElement("div"),!this.readOnly){let e=$('<div class="widget-head"></div>'),t=$('<div class="widget-control"></div>');return e[0].appendChild(this._element),t.appendTo(e),e.appendTo(this.wrapper),this.wrapper.classList.add("widget","header","edit-mode"),this.add_settings_button(),this.add_new_block_button(),frappe.utils.add_custom_button(frappe.utils.icon("drag","xs"),null,"drag-handle",__("Drag"),null,t),this.wrapper}return this._element}merge(e){let t={text:this.data.text+e.text};this.data=t}validate(e){return e.text.trim()!==""}save(){return this.wrapper=this._element,{text:this.wrapper.innerHTML.replace(/&nbsp;/gi,""),col:this.get_col()}}rendered(){super.rendered(this._element)}static get sanitize(){return{level:!1,text:{br:!0,b:!0,i:!0,a:!0,span:!0}}}static get isReadOnlySupported(){return!0}get data(){return this._data.text=this._element.innerHTML,this._data}set data(e){if(this._data=this.normalizeData(e),e.text!==void 0){let t=__(this._data.text)||"",r=/<[a-z][\s\S]*>/i.test(t),s=document.createElement("div");s.innerHTML=t;let n=s.innerText;n=frappe.utils.escape_html(n),t=t.replace(n,__(n)),this._element.innerHTML=r?t:`<span class="h${this._settings.default_size}">${t}</span>`}!this.readOnly&&this.wrapper&&this.wrapper.classList.add("widget","header")}getTag(){let e=document.createElement("DIV"),t=this._data.text||"&nbsp";return e.innerHTML=`<span class="h${this._settings.default_size}"><b>${t}</b></span>`,e.classList.add("ce-header"),this.readOnly||(e.contentEditable=!0),e.dataset.placeholder=this.api.i18n.t(this._settings.placeholder||""),e}static get toolbox(){return{title:"Heading",icon:frappe.utils.icon("header","sm")}}};var Ni=class extends Ke{static get DEFAULT_PLACEHOLDER(){return""}constructor({data:e,config:t,api:r,readOnly:s}){super({config:t,api:r,readOnly:s}),this._CSS={block:this.api.styles.block,wrapper:"ce-paragraph"},this.readOnly||(this.onKeyUp=this.onKeyUp.bind(this)),this._placeholder=this.config.placeholder?this.config.placeholder:Ni.DEFAULT_PLACEHOLDER,this._data={},this._element=this.drawView(),this._preserveBlank=this.config.preserveBlank!==void 0?this.config.preserveBlank:!1,this.data=e,this.col=this.data.col?this.data.col:"12"}onKeyUp(e){if(!this.wrapper||(this.show_hide_block_list(!0),e.code!=="Backspace"&&e.code!=="Delete"))return;let{textContent:t}=this._element;t===""&&(this.show_hide_block_list(),this._element.innerHTML="")}show_hide_block_list(e){let r=($(this.wrapper).hasClass("ce-paragraph")?$(this.wrapper.parentElement):$(this.wrapper)).find(".block-list-container.dropdown-list");r.removeClass("hidden"),e&&r.addClass("hidden")}drawView(){let e=document.createElement("DIV");return e.classList.add(this._CSS.wrapper,this._CSS.block,"widget"),e.contentEditable=!1,this.readOnly||(e.contentEditable=!0,e.addEventListener("focus",()=>{let{textContent:t}=this._element;t===""&&this.show_hide_block_list()}),e.addEventListener("blur",()=>{!this.over_block_list_item&&this.show_hide_block_list(!0)}),e.dataset.placeholder=this.api.i18n.t(this._placeholder),e.addEventListener("keyup",this.onKeyUp)),e}open_block_list(){let e=__("Templates"),t=$(`
			<div class="block-list-container dropdown-list">
				<div class="dropdown-title">${e.toUpperCase()}</div>
			</div>
		`),r=frappe.workspace_block.blocks;Object.keys(r).forEach(s=>{let n=$(`
				<div class="block-list-item dropdown-item">
					<span class="dropdown-item-icon">${r[s].toolbox.icon}</span>
					<span class="dropdown-item-label">${__(r[s].toolbox.title)}</span>
				</div>
			`);n.click(o=>{o.stopPropagation();let a=this.api.blocks.getCurrentBlockIndex();this.api.blocks.delete(),this.api.blocks.insert(s,{},{},a),this.api.caret.setToBlock(a)}),n.mouseenter(()=>{this.over_block_list_item=!0}).mouseleave(()=>{this.over_block_list_item=!1}),t.append(n)}),t.addClass("hidden"),t.appendTo(this.wrapper)}render(){if(this.wrapper=document.createElement("div"),!this.readOnly){let e=$('<div class="widget-control paragraph-control"></div>');return this.wrapper.appendChild(this._element),this._element.classList.remove("widget"),e.appendTo(this.wrapper),this.wrapper.classList.add("widget","paragraph","edit-mode"),this.open_block_list(),this.add_new_block_button(),this.add_settings_button(),frappe.utils.add_custom_button(frappe.utils.icon("drag","xs"),null,"drag-handle",__("Drag"),null,e),this.wrapper}return this._element}merge(e){let t={text:this.data.text+e.text};this.data=t}validate(e){return!(e.text.trim()===""&&!this._preserveBlank)}save(){return this.wrapper=this._element,{text:this.wrapper.innerHTML,col:this.get_col()}}rendered(){super.rendered(this._element)}onPaste(e){let t={text:e.detail.data.innerHTML};this.data=t}static get sanitize(){return{text:{br:!0,b:!0,i:!0,a:!0,span:!0}}}static get isReadOnlySupported(){return!0}get data(){let e=this._element.innerHTML;return this._data.text=e,this._data}set data(e){this._data=e||{},this._element.innerHTML=__(this._data.text)||""}static get pasteConfig(){return{tags:["P"]}}static get toolbox(){return{title:"Text",icon:frappe.utils.icon("text","sm")}}};var xs=class extends Ke{static get toolbox(){return{title:"Card",icon:frappe.utils.icon("card","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s,block:n}){super({data:e,api:t,config:r,readOnly:s,block:n}),this.sections={},this.col=this.data.col?this.data.col:"4",this.allow_customization=!this.readOnly,this.options={allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0,allow_resize:!0}}render(){return this.wrapper=document.createElement("div"),this.new("card","links"),this.data&&this.data.card_name&&!this.make("card",this.data.card_name,"links")?this.wrapper:(this.readOnly||($(this.wrapper).find(".widget").addClass("links edit-mode"),this.add_settings_button(),this.add_new_block_button()),this.wrapper)}validate(e){return!!e.card_name}save(){return{card_name:this.wrapper.getAttribute("card_name"),col:this.get_col(),new:this.new_block_widget}}};var Cs=class extends Ke{static get toolbox(){return{title:"Chart",icon:frappe.utils.icon("chart","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s,block:n}){super({data:e,api:t,config:r,readOnly:s,block:n}),this.col=this.data.col?this.data.col:"12",this.allow_customization=!this.readOnly,this.options={allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0,allow_resize:!0,min_width:6,max_widget_count:2}}render(){return this.wrapper=document.createElement("div"),this.new("chart"),this.data&&this.data.chart_name&&!this.make("chart",this.data.chart_name)?this.wrapper:(this.readOnly||($(this.wrapper).find(".widget").addClass("chart edit-mode"),this.add_settings_button(),this.add_new_block_button()),this.wrapper)}validate(e){return!!e.chart_name}save(){return{chart_name:this.wrapper.getAttribute("chart_name"),col:this.get_col(),new:this.new_block_widget}}};var Ss=class extends Ke{static get toolbox(){return{title:"Shortcut",icon:frappe.utils.icon("shortcut","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s,block:n}){super({data:e,api:t,config:r,readOnly:s,block:n}),this.col=this.data.col?this.data.col:"3",this.allow_customization=!this.readOnly,this.options={allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0,allow_resize:!0}}rendered(){super.rendered(),this.remove_last_divider(),$(window).resize(()=>{this.remove_last_divider()})}remove_last_divider(){let e=this.wrapper.closest(".ce-block"),t=$(".layout-main-section")[0].offsetWidth,r=e.offsetLeft+e.offsetWidth;t-r<=110?$(e).find(".divider").addClass("hidden"):$(e).find(".divider").removeClass("hidden")}render(){return this.wrapper=document.createElement("div"),this.new("shortcut"),this.data&&this.data.shortcut_name&&!this.make("shortcut",this.data.shortcut_name)?this.wrapper:(this.readOnly||($(this.wrapper).find(".widget").addClass("shortcut edit-mode"),this.add_settings_button(),this.add_new_block_button()),this.wrapper)}validate(e){return!!e.shortcut_name}save(){return{shortcut_name:this.wrapper.getAttribute("shortcut_name"),col:this.get_col(),new:this.new_block_widget}}};var Ts=class extends Ke{static get toolbox(){return{title:"Spacer",icon:frappe.utils.icon("spacer","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s}){super({data:e,api:t,config:r,readOnly:s}),this.col=this.data.col?this.data.col:"12"}render(){if(this.wrapper=document.createElement("div"),this.wrapper.classList.add("widget","spacer"),!this.readOnly){let e=$(`
				<div class="widget-head">
					<div class="spacer-left"></div>
					<div>${__("Spacer")}</div>
					<div class="widget-control"></div>
				</div>
			`);e.appendTo(this.wrapper),this.wrapper.classList.add("edit-mode"),this.wrapper.style.minHeight=40+"px";let t=e.find(".widget-control");this.add_settings_button(),this.add_new_block_button(),frappe.utils.add_custom_button(frappe.utils.icon("drag","xs"),null,"drag-handle",__("Drag"),null,t)}return this.wrapper}save(){return{col:this.get_col()}}};var Es=class extends Ke{static get toolbox(){return{title:"Onboarding",icon:frappe.utils.icon("onboarding","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s,block:n}){super({data:e,api:t,config:r,readOnly:s,block:n}),this.col=this.data.col?this.data.col:"12",this.allow_customization=!this.readOnly,this.options={allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0,allow_resize:!1}}rendered(){let e=this.wrapper.closest(".ce-block");this.readOnly&&!$(this.wrapper).find(".onboarding-widget-box").is(":visible")&&$(e).hide(),this.set_col_class(e,this.get_col())}new(e,t=e){let r=this,s=oi(t),n=e+"_name";this.dialog=new s({label:this.label,type:t,primary_action:o=>{o.in_customize_mode=1,this.block_widget=frappe.widget.make_widget(rt(Ee({},o),{widget_type:t,container:this.wrapper,options:rt(Ee({},this.options),{on_delete:()=>this.api.blocks.delete(),on_edit:()=>this.on_edit(this.block_widget)}),new:!0})),this.block_widget.customize(this.options),this.wrapper.setAttribute(n,this.block_widget.label||this.block_widget.onboarding_name),$(this.wrapper).find(".widget").addClass(`${t} edit-mode`),this.new_block_widget=this.block_widget.get_config(),this.add_settings_button()}}),!this.readOnly&&this.data&&!this.data[n]&&(this.dialog.make(),this.dialog.dialog.get_close_btn().click(()=>{r.wrapper.closest(".ce-block").remove()}))}make(e,t){let r=this.config.page_data.onboardings.items.find(s=>s.label==__(t));return r?(this.wrapper.innerHTML="",r.in_customize_mode=!this.readOnly,this.block_widget=frappe.widget.make_widget({container:this.wrapper,widget_type:"onboarding",in_customize_mode:r.in_customize_mode,options:rt(Ee({},this.options),{on_delete:()=>this.api.blocks.delete(),on_edit:()=>this.on_edit(this.block_widget)}),label:r.label,title:r.title||__("Let's Get Started"),subtitle:r.subtitle,steps:r.items,success:r.success,docs_url:r.docs_url,user_can_dismiss:r.user_can_dismiss}),this.wrapper.setAttribute(e+"_name",t),this.readOnly||this.block_widget.customize(this.options),!0):!1}render(){if(!frappe.is_mobile())return this.wrapper=document.createElement("div"),this.new("onboarding"),this.data&&this.data.onboarding_name&&!this.make("onboarding",this.data.onboarding_name)?this.wrapper:(this.readOnly||($(this.wrapper).find(".widget").addClass("onboarding edit-mode"),this.add_settings_button(),this.add_new_block_button()),this.wrapper)}validate(e){return!!e.onboarding_name}save(){return{onboarding_name:this.wrapper.getAttribute("onboarding_name"),col:this.get_col(),new:this.new_block_widget}}};var $s=class extends Ke{static get toolbox(){return{title:"Quick List",icon:frappe.utils.icon("list","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s,block:n}){super({data:e,api:t,config:r,readOnly:s,block:n}),this.col=this.data.col?this.data.col:"4",this.allow_customization=!this.readOnly,this.options={allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0,allow_resize:!0,min_width:4,max_widget_count:2}}render(){return this.wrapper=document.createElement("div"),this.new("quick_list"),this.data&&this.data.quick_list_name&&!this.make("quick_list",this.data.quick_list_name)?this.wrapper:(this.readOnly||($(this.wrapper).find(".widget").addClass("quick_list edit-mode"),this.add_settings_button(),this.add_new_block_button()),this.wrapper)}validate(e){return!!e.quick_list_name}save(){return{quick_list_name:this.wrapper.getAttribute("quick_list_name"),col:this.get_col(),new:this.new_block_widget}}};var Os=class extends Ke{static get toolbox(){return{title:"Number Card",icon:frappe.utils.icon("number-card","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s,block:n}){super({data:e,api:t,config:r,readOnly:s,block:n}),this.sections={},this.col=this.data.col?this.data.col:"4",this.allow_customization=!this.readOnly,this.options={allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0,allow_resize:!0,for_workspace:!0}}render(){return this.wrapper=document.createElement("div"),this.new("number_card"),this.data&&this.data.number_card_name&&!this.make("number_card",this.data.number_card_name)?this.wrapper:(this.readOnly||($(this.wrapper).find(".widget").addClass("number_card edit-mode"),this.add_settings_button(),this.add_new_block_button()),this.wrapper)}validate(e){return!!e.number_card_name}save(){return{number_card_name:this.wrapper.getAttribute("number_card_name"),col:this.get_col(),new:this.new_block_widget}}};var As=class extends Ke{static get toolbox(){return{title:"Custom Block",icon:frappe.utils.icon("edit","sm")}}static get isReadOnlySupported(){return!0}constructor({data:e,api:t,config:r,readOnly:s,block:n}){super({data:e,api:t,config:r,readOnly:s,block:n}),this.col=this.data.col?this.data.col:"12",this.allow_customization=!this.readOnly,this.options={allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0,allow_resize:!0,min_width:2}}render(){return this.wrapper=document.createElement("div"),this.new("custom_block"),this.data&&this.data.custom_block_name&&!this.make("custom_block",this.data.custom_block_name)?this.wrapper:(this.readOnly||($(this.wrapper).find(".widget").addClass("custom_block edit-mode"),this.add_settings_button(),this.add_new_block_button()),this.wrapper)}validate(e){return!!e.custom_block_name}save(){return{custom_block_name:this.wrapper.getAttribute("custom_block_name"),col:this.get_col(),new:this.new_block_widget}}};var Ls=class{static get isInline(){return!0}get state(){return this._state}set state(e){this._state=e}get title(){return"Header Size"}constructor({api:e}){this.api=e,this.button=null,this._state=!0,this.selectedText=null,this.range=null,this.headerLevels=[]}render(){return this.button=document.createElement("button"),this.button.type="button",this.button.innerHTML=`${frappe.utils.icon("header","sm")}${frappe.utils.icon("small-down","xs")}`,this.button.classList="header-inline-tool",this.button}checkState(e){let t=this.api.selection.findParentTag("SPAN");for(let s of["h1","h2","h3","h4","h5","h6"])if(t&&t.classList.contains(s)){let n=s.match(/\d+/)[0];$(".header-inline-tool svg:first-child").replaceWith(frappe.utils.icon(`header-${n}`,"md"))}e.anchorNode}change_size(e,t){if(!e)return;let r=document.createElement("SPAN");r.classList.add(`h${t}`),r.innerText=e.toString(),this.remove_parent_tag(e,e.commonAncestorContainer,r),e.extractContents(),e.insertNode(r),this.api.inlineToolbar.close()}remove_parent_tag(e,t,r){let s=e.startContainer.data,n=r.innerText,o=t.parentElement;s!==n&&(o=t),o.innerText==n&&!o.classList.contains("ce-header")&&!o.classList.contains("ce-paragraph")&&(this.remove_parent_tag(e,t.parentElement,r),o.remove())}surround(e){this.selectedText=e.cloneContents(),this.actions.hidden=!this.actions.hidden,this.range=this.actions.hidden?null:e,this.state=!this.actions.hidden}renderActions(){this.actions=document.createElement("div"),this.actions.classList="header-level-select",this.headerLevels=new Array(6).fill().map((e,t)=>{let r=document.createElement("div");return r.classList.add(`h${t+1}`,"header-level"),r.innerText=`Header ${t+1}`,r});for(let[e,t]of this.headerLevels.entries())this.actions.appendChild(t),this.api.listeners.on(t,"click",()=>{this.change_size(this.range,e+1)});return this.actions.hidden=!0,this.actions}destroy(){for(let e of this.headerLevels)this.api.listeners.off(e,"click")}};frappe.provide("frappe.workspace_block");frappe.workspace_block.blocks={header:ks,paragraph:Ni,card:xs,chart:Cs,shortcut:Ss,spacer:Ts,onboarding:Es,quick_list:$s,number_card:Os,custom_block:As};frappe.workspace_block.tunes={header_size:Ls};var st=class{constructor(e){Object.assign(this,e),this.make()}refresh(){this.set_title(),this.set_actions(),this.set_body(),this.setup_events(),this.set_footer()}get_config(){return{name:this.name,label:this.label}}customize(e){if(this.in_customize_mode=!0,this.action_area.empty(),e.allow_sorting&&frappe.utils.add_custom_button(frappe.utils.icon("es-line-drag","xs"),null,"drag-handle",__("Drag"),null,this.action_area),e.allow_hiding){this.hidden&&(this.widget.removeClass("hidden"),this.body.css("opacity",.5),this.title_field.css("opacity",.5),this.footer.css("opacity",.5));let t=this.hidden?"fa fa-eye":"fa fa-eye-slash",r=this.hidden?__("Show"):__("Hide");frappe.utils.add_custom_button(`<i class="${t}" aria-hidden="true"></i>`,()=>this.hide_or_show(),"show-or-hide-button",r,null,this.action_area),this.show_or_hide_button=this.action_area.find(".show-or-hide-button")}e.allow_edit&&frappe.utils.add_custom_button(frappe.utils.icon("es-line-edit-alt","xs"),()=>this.edit(),"edit-button",__("Edit"),null,this.action_area)}make(){this.make_widget(),this.widget.appendTo(this.container)}make_widget(){this.widget=$(`<div class="widget" data-widget-name="${this.name?this.name:""}">
			<div class="widget-head">
				<div class="widget-label">
					<div class="widget-title"></div>
					<div class="widget-subtitle"></div>
				</div>
				<div class="widget-control"></div>
			</div>
			<div class="widget-body"></div>
			<div class="widget-footer"></div>
		</div>`),this.title_field=this.widget.find(".widget-title"),this.subtitle_field=this.widget.find(".widget-subtitle"),this.body=this.widget.find(".widget-body"),this.action_area=this.widget.find(".widget-control"),this.head=this.widget.find(".widget-head"),this.footer=this.widget.find(".widget-footer"),this.refresh()}set_title(e){let t=this.title||this.label||this.name,r=e?frappe.ellipsis(t,e):t;this.title_field[0].innerHTML=`<span class="ellipsis" title="${__(r)}">${__(r)}</span>`,e&&this.title_field[0].setAttribute("title",this.title||this.label),this.subtitle&&this.subtitle_field.html(this.subtitle)}delete(e=!0,t=!1){let r=s=>{this.widget.remove(),!t&&this.options.on_delete&&this.options.on_delete(this.name,s)};e?(this.widget.addClass("zoom-out"),setTimeout(()=>{r(!0)},300)):r(!1)}edit(){var t;let e=oi(this.widget_type);this.edit_dialog=new e({for_workspace:(t=this.options)==null?void 0:t.for_workspace,label:this.label,type:this.widget_type,values:this.get_config(),primary_action:r=>{Object.assign(this,r),r.name=this.name,this.new=!0,this.refresh(),this.options.on_edit&&this.options.on_edit(r)},primary_action_label:__("Save")}),this.edit_dialog.make()}toggle_width(){this.width=="Full"?(this.widget.removeClass("full-width"),this.width=null,this.refresh()):(this.widget.addClass("full-width"),this.width="Full",this.refresh());let e=this.width=="Full"?__("Collapse"):__("Expand");this.resize_button.attr("title",e)}hide_or_show(){this.hidden?(this.body.css("opacity",1),this.title_field.css("opacity",1),this.footer.css("opacity",1),this.hidden=!1):(this.body.css("opacity",.5),this.title_field.css("opacity",.5),this.footer.css("opacity",.5),this.hidden=!0),this.show_or_hide_button.empty();let e=this.hidden?"fa fa-eye":"fa fa-eye-slash",t=this.hidden?__("Show"):__("Hide");$(`<i class="${e}" aria-hidden="true" title="${t}"></i>`).appendTo(this.show_or_hide_button)}setup_events(){}set_actions(){}set_body(){}set_footer(){}};frappe.provide("frappe.widget.utils");frappe.provide("frappe.dashboards");frappe.provide("frappe.dashboards.chart_sources");var Bs=class extends st{constructor(e){e.shadow=!0,super(e),this.height=this.height||240}get_config(){return{name:this.name,chart_name:this.chart_name,label:this.label,hidden:this.hidden,width:this.width}}refresh(){delete this.dashboard_chart,this.set_body(),this.make_chart()}set_chart_title(){let e=this.widget.width()<600?40:60;this.set_title(e)}set_body(){this.widget.addClass("dashboard-widget-box"),this.width=="Full"&&this.widget.addClass("full-width")}setup_container(){this.body.empty(),this.chart_doc.type=="Heatmap"&&this.setup_heatmap_container(),this.loading=$(`<div class="chart-loading-state text-extra-muted" style="height: ${this.height}px;">${__("Loading...")}</div>`),this.loading.appendTo(this.body),this.empty=$(`<div class="chart-loading-state text-extra-muted" style="height: ${this.height}px;">${__("No Data")}</div>`),this.empty.hide().appendTo(this.body),this.chart_wrapper=$("<div></div>"),this.chart_wrapper.appendTo(this.body),this.$heatmap_legend=null,this.set_chart_title()}setup_heatmap_container(){this.widget.addClass("heatmap-chart"),this.widget.removeClass("full-width").addClass("full-width"),this.width="Full"}set_summary(){this.$summary?this.$summary.empty():(this.$summary=$('<div class="report-summary"></div>').hide(),this.head.after(this.$summary)),this.summary.forEach(e=>{frappe.utils.build_summary_item(e).appendTo(this.$summary)}),this.summary.length&&this.$summary.show()}make_chart(){this.get_settings().then(()=>{if(!this.settings){this.deleted=!0,this.widget.remove();return}this.chart_settings||(this.chart_settings={}),this.setup_container(),this.in_customize_mode||(this.action_area.empty(),this.prepare_chart_actions(),this.chart_doc.timeseries&&this.render_time_series_filters()),frappe.run_serially([()=>this.prepare_chart_object(),()=>this.setup_filter_button(),()=>this.fetch_and_update_chart()])})}render_time_series_filters(){let e=this.get_time_series_filters();frappe.dashboard_utils.render_chart_filters(e,"chart-actions",this.action_area,0)}get_time_series_filters(){let e;return this.chart_doc.type=="Heatmap"?e=[{label:__(this.chart_settings.heatmap_year)||__(this.chart_doc.heatmap_year),options:frappe.dashboard_utils.get_years_since_creation(frappe.boot.user.creation),action:t=>{this.selected_heatmap_year=t,this.save_chart_config_for_user({heatmap_year:this.selected_heatmap_year}),this.fetch_and_update_chart()}}]:e=[{label:__(this.chart_settings.time_interval)||__(this.chart_doc.time_interval),options:["Yearly","Quarterly","Monthly","Weekly","Daily"],icon:"calendar",class:"time-interval-filter",action:t=>{this.selected_time_interval=t,this.save_chart_config_for_user({time_interval:this.selected_time_interval}),this.fetch_and_update_chart()}},{label:__(this.chart_settings.timespan)||__(this.chart_doc.timespan),options:["Select Date Range","Last Year","Last Quarter","Last Month","Last Week"],class:"timespan-filter",action:t=>{this.selected_timespan=t,this.selected_timespan==="Select Date Range"?this.render_date_range_field():(this.selected_from_date=null,this.selected_to_date=null,this.date_field_wrapper&&(this.date_field_wrapper.hide(),this.title_field.show(),this.subtitle_field.show(),this.head.css("flex-direction","row")),this.save_chart_config_for_user({timespan:this.selected_timespan,from_date:null,to_date:null}),this.fetch_and_update_chart())}}],e}fetch_and_update_chart(){this.args={timespan:this.selected_timespan||this.chart_settings.timespan,time_interval:this.selected_time_interval||this.chart_settings.time_interval,from_date:this.selected_from_date||this.chart_settings.from_date,to_date:this.selected_to_date||this.chart_settings.to_date,heatmap_year:this.selected_heatmap_year||this.chart_settings.heatmap_year},this.fetch(this.filters,!0,this.args).then(e=>{this.chart_doc.chart_type=="Report"&&(this.report_result=e,this.summary=e.report_summary,e=this.get_report_chart_data(e)),this.update_chart_object(),this.data=e,this.render()})}render_date_range_field(){(!this.date_field_wrapper||!this.date_field_wrapper.is(":visible"))&&(this.date_field_wrapper=$('<div class="dashboard-date-field pull-right"></div>').insertAfter(this.action_area.find(".timespan-filter")),this.width!=="Full"&&this.widget.width()<700&&(this.title_field.hide(),this.subtitle_field.hide(),this.head.css("flex-direction","row-reverse")),this.date_range_field=frappe.ui.form.make_control({df:{fieldtype:"DateRange",fieldname:"from_date",placeholder:__("Date Range"),input_class:"input-xs",default:[this.chart_settings.from_date,this.chart_settings.to_date],value:[this.chart_settings.from_date,this.chart_settings.to_date],reqd:1,change:()=>{let e=this.date_range_field.get_value();this.selected_from_date=e[0],this.selected_to_date=e[1],e&&e.length==2&&(this.save_chart_config_for_user({timespan:this.selected_timespan,from_date:this.selected_from_date,to_date:this.selected_to_date}),this.fetch_and_update_chart())}},parent:this.date_field_wrapper,render_input:1}),this.date_range_field.$input.focus())}get_report_chart_data(e){if(e.chart&&this.chart_doc.use_report_chart)return e.chart.data;{let t=[];this.chart_doc.y_axis.map(n=>{t.push(n.y_field)});let r={y_fields:t,x_field:this.chart_doc.x_field,chart_type:this.chart_doc.type,color:this.chart_doc.color},s=e.columns.map(n=>frappe.report_utils.prepare_field_from_column(n));return frappe.report_utils.make_chart_options(s,e,r).data}}prepare_chart_actions(){let e=[{label:__("Refresh"),action:"action-refresh",handler:()=>{delete this.dashboard_chart,this.make_chart()}},{label:__("Edit"),action:"action-edit",handler:()=>{frappe.set_route("Form","Dashboard Chart",this.chart_doc.name)}},{label:__("Reset Chart"),action:"action-reset",handler:()=>{this.reset_chart(),delete this.dashboard_chart,this.make_chart()}}];this.chart_doc.document_type?e.push({label:__("{0} List",[__(this.chart_doc.document_type)]),action:"action-list",handler:()=>{frappe.set_route("List",this.chart_doc.document_type)}}):this.chart_doc.chart_type==="Report"&&e.push({label:__("{0} Report",[__(this.chart_doc.report_name)]),action:"action-list",handler:()=>{frappe.set_route("query-report",this.chart_doc.report_name,this.filters)}}),this.set_chart_actions(e)}setup_filter_button(){this.in_customize_mode||(this.is_document_type=this.chart_doc.chart_type!=="Report"&&this.chart_doc.chart_type!=="Custom",this.filter_button=$(`<div class="filter-chart btn btn-xs pull-right">
				${frappe.utils.icon("filter","sm")}
			</div>`),this.filter_button.appendTo(this.action_area),this.is_document_type?(this.filter_group&&(this.filters=this.filter_group.get_filters()),this.create_filter_group_and_add_filters()):this.filter_button.on("click",()=>{let e;frappe.dashboard_utils.get_filters_for_chart_type(this.chart_doc).then(t=>{this.is_document_type?e=[{fieldtype:"HTML",fieldname:"filter_area"}]:t?e=t.filter(r=>r.fieldname).map(r=>(Object.assign(r,r.dashboard_config||{}),r)):e=[{fieldtype:"HTML",options:__("No Filters Set")}],this.setup_filter_dialog(e)})}))}setup_filter_dialog(e){let t=this,r=new frappe.ui.Dialog({title:__("Set Filters for {0}",[__(this.chart_doc.chart_name)]),fields:e,primary_action:function(){let s=this.get_values();s&&(this.hide(),t.filters=s,t.save_chart_config_for_user({filters:t.filters}),t.fetch_and_update_chart())},primary_action_label:__("Set")});r.show(),this.chart_doc.chart_type=="Report"&&(frappe.query_report=new frappe.views.QueryReport({filters:r.fields_list}),frappe.query_reports[this.chart_doc.report_name].onload&&frappe.query_reports[this.chart_doc.report_name].onload(frappe.query_report)),r.set_values(this.filters)}reset_chart(){this.save_chart_config_for_user(null,1),this.chart_settings={},this.filters=null,this.selected_time_interval=null,this.selected_timespan=null,this.selected_heatmap_year=null}save_chart_config_for_user(e,t=0){Object.assign(this.chart_settings,e),frappe.xcall("frappe.desk.doctype.dashboard_settings.dashboard_settings.save_chart_config",{reset:t,config:this.chart_settings,chart_name:this.chart_doc.chart_name})}create_filter_group_and_add_filters(){this.filter_group=new frappe.ui.FilterGroup({doctype:this.chart_doc.document_type,parent_doctype:this.chart_doc.parent_document_type,filter_button:this.filter_button,on_change:()=>{this.filters=this.filter_group.get_filters(),this.save_chart_config_for_user({filters:this.filters}),this.fetch_and_update_chart()}}),this.filters&&frappe.model.with_doctype(this.chart_doc.document_type,()=>{this.filter_group.add_filters_to_filter_group(this.filters)})}set_chart_actions(e){this.chart_actions=$(`<div class="chart-actions dropdown pull-right">
			<button data-toggle="dropdown"
				aria-haspopup="true"aria-expanded="false"
				class="btn btn-xs btn-secondary chart-menu"
			>
				<svg class="icon icon-sm">
					<use href="#icon-dot-horizontal">
					</use>
				</svg>
			</button>
			<ul class="dropdown-menu dropdown-menu-right">
				${e.map(t=>`<li><a class="dropdown-item" data-action="${t.action}">${__(t.label)}</a></li>`).join("")}
			</ul>
		</div>
		`),this.chart_actions.find("a[data-action]").each((t,r)=>{let s=r.dataset.action;$(r).click(e.find(n=>n.action===s))}),this.chart_actions.appendTo(this.action_area)}fetch(e,t=!1,r){let s=this.settings.method;return this.chart_doc.chart_type=="Report"?r={report_name:this.chart_doc.report_name,filters:e,ignore_prepared_report:1}:r={chart_name:this.chart_doc.name,filters:e,refresh:t?1:0,time_interval:r&&r.time_interval?r.time_interval:null,timespan:r&&r.timespan?r.timespan:null,from_date:r&&r.from_date?r.from_date:null,to_date:r&&r.to_date?r.to_date:null,heatmap_year:r&&r.heatmap_year?r.heatmap_year:null},frappe.xcall(s,r)}async get_source_doctype(){if(this.chart_doc.document_type)return this.chart_doc.document_type;if(this.chart_doc.chart_type=="Report"&&this.chart_doc.report_name)return await frappe.db.get_value("Report",this.chart_doc.report_name,"ref_doctype").then(e=>e.message.ref_doctype)}async render(){let e=()=>{let t=this.get_chart_args();this.dashboard_chart?this.dashboard_chart.update(this.data):this.dashboard_chart=frappe.utils.make_chart(this.chart_wrapper[0],t)};!this.data||!this.data.labels||!Object.keys(this.data).length?(this.chart_wrapper.hide(),this.loading.hide(),this.$summary&&this.$summary.hide(),this.empty.show()):(this.loading.hide(),this.empty.hide(),this.chart_wrapper.show(),this.chart_doc.document_type=await this.get_source_doctype(),this.chart_doc.document_type?frappe.model.with_doctype(this.chart_doc.document_type,e):e(),this.width=="Full"&&this.summary&&this.set_summary(),this.chart_doc.type=="Heatmap"&&this.render_heatmap_legend())}get_chart_args(){var l,c;let e=this.get_chart_colors(),t,r,s={Line:"line",Bar:"bar",Percentage:"percentage",Pie:"pie",Donut:"donut",Heatmap:"heatmap"},n=["Pie","Donut"].includes(this.chart_doc.type)?6:9,o={data:this.data,type:s[this.chart_doc.type],colors:e,height:this.height,maxSlices:this.chart_doc.number_of_groups||n,axisOptions:{xIsSeries:this.chart_doc.timeseries,shortenYAxisNumbers:1}};if(this.chart_doc.document_type){let p=frappe.get_meta(this.chart_doc.document_type).fields.find(m=>m.fieldname==this.chart_doc.value_based_on);t=p==null?void 0:p.fieldtype,r=p==null?void 0:p.options}if(this.chart_doc.chart_type=="Report"&&((c=(l=this.report_result)==null?void 0:l.chart)==null?void 0:c.fieldtype)&&(t=this.report_result.chart.fieldtype,r=this.report_result.chart.options),this.chart_doc.chart_type=="Custom"&&this.chart_doc.custom_options){let u=JSON.parse(this.chart_doc.custom_options);t=u.fieldtype,r=u.options}if(this.chart_doc.currency?o.tooltipOptions={formatTooltipY:u=>format_currency(u,this.chart_doc.currency)}:o.tooltipOptions={formatTooltipY:u=>frappe.format(u,{fieldtype:t,options:r},{always_show_decimals:!0,inline:!0})},this.chart_doc.type=="Heatmap"){let u=parseInt(this.selected_heatmap_year||this.chart_settings.heatmap_year||this.chart_doc.heatmap_year);o.data.start=new Date(`${u}-01-01`),o.data.end=new Date(`${u+1}-01-01`)}let a=u=>{let p=JSON.parse(u);for(let m in p)typeof o[m]=="object"&&typeof p[m]=="object"?o[m]=Object.assign(o[m],p[m]):o[m]=p[m]};return this.custom_options&&a(this.custom_options),this.chart_doc.custom_options&&a(this.chart_doc.custom_options),o}get_chart_colors(){let e=[];return this.chart_doc.y_axis.length?this.chart_doc.y_axis.map(t=>{e.push(t.color)}):["Line","Bar"].includes(this.chart_doc.type)?e=[this.chart_doc.color||[]]:this.chart_doc.type=="Heatmap"&&(e=[]),e}render_heatmap_legend(){let e,t=r=>{e=JSON.parse(r).colors};this.custom_options&&t(this.custom_options),this.chart_doc.custom_options&&t(this.chart_doc.custom_options),!this.$heatmap_legend&&this.widget.width()>991&&(this.$heatmap_legend=$(`
				<div class="heatmap-legend">
					<ul class="legend-colors">
						<li style="background-color: ${e[0]||"#ebedf0"}"></li>
						<li style="background-color: ${e[1]||"#c6e48b"}"></li>
						<li style="background-color: ${e[2]||"#7bc96f"}"></li>
						<li style="background-color: ${e[3]||"#239a3b"}"></li>
						<li style="background-color: ${e[4]||"#196127"}"></li>
					</ul>
					<div class="legend-label">
						<div style="margin-bottom: 45px">${__("Less")}</div>
						<div>${__("More")}</div>
					</div>
				</div>
				`),this.body.append(this.$heatmap_legend))}update_last_synced(){if(!this.chart_doc.last_synced_on)return;let e=__("Last synced {0}",[comment_when(this.chart_doc.last_synced_on)]);this.subtitle_field.html(e)}update_chart_object(){frappe.db.get_doc("Dashboard Chart",this.chart_doc.name).then(e=>{this.chart_doc=e,this.update_last_synced()})}prepare_chart_object(){return this.chart_doc.type=="Heatmap"&&!this.chart_doc.heatmap_year&&(this.chart_doc.heatmap_year=frappe.dashboard_utils.get_year(frappe.datetime.now_date())),this.set_chart_filters()}set_chart_filters(){let e=this.chart_settings.filters||null,t=frappe.dashboard_utils.get_all_filters(this.chart_doc);return this.chart_doc.chart_type=="Report"?frappe.dashboard_utils.get_filters_for_chart_type(this.chart_doc).then(r=>{t=this.update_default_date_filters(r,t),this.filters=frappe.utils.parse_array(e)||frappe.utils.parse_array(this.filters)||frappe.utils.parse_array(t)}):(this.filters=frappe.utils.parse_array(e)||frappe.utils.parse_array(this.filters)||frappe.utils.parse_array(t),Promise.resolve())}update_default_date_filters(e,t){return e&&e.map(r=>{["Date","DateRange"].includes(r.fieldtype)&&r.default&&(r.reqd||t[r.fieldname])&&(t[r.fieldname]=r.default)}),t}get_settings(){return frappe.model.with_doc("Dashboard Chart",this.chart_name).then(e=>{if(e)if(this.chart_doc=e,this.chart_doc.chart_type=="Custom"){if(frappe.dashboards.chart_sources[this.chart_doc.source])return this.settings=frappe.dashboards.chart_sources[this.chart_doc.source],Promise.resolve();{let t="frappe.desk.doctype.dashboard_chart_source.dashboard_chart_source.get_config";return frappe.xcall(t,{name:this.chart_doc.source}).then(r=>{frappe.dom.eval(r),this.settings=frappe.dashboards.chart_sources[this.chart_doc.source]})}}else return this.chart_doc.chart_type=="Report"?(this.settings={method:"frappe.desk.query_report.run"},Promise.resolve()):(this.settings={method:"frappe.desk.doctype.dashboard_chart.dashboard_chart.get"},Promise.resolve())})}};frappe.provide("frappe.utils");var Is=class extends st{constructor(e){e.shadow=!0,super(e)}get_config(){return{name:this.name,icon:this.icon,label:this.label,format:this.format,link_to:this.link_to,doc_view:this.doc_view,color:this.color,restrict_to_domain:this.restrict_to_domain,stats_filter:this.stats_filter,type:this.type,url:this.url,kanban_board:this.kanban_board}}setup_events(){this.widget.click(e=>{if(this.in_customize_mode)return;let t=frappe.utils.generate_route({route:this.route,name:this.link_to,type:this.type,is_query_report:this.is_query_report,doctype:this.ref_doctype,doc_view:this.doc_view,kanban_board:this.kanban_board,report_ref_doctype:this.report_ref_doctype}),r=frappe.utils.get_filter_from_json(this.stats_filter);if(this.type=="DocType"&&r&&(frappe.route_options=r),(e.ctrlKey||e.metaKey)&&(frappe.open_in_new_tab=!0),this.type=="URL"){window.open(this.url,"_blank");return}frappe.set_route(t)})}set_actions(){if(this.in_customize_mode)return;let e=frappe.utils.icon("es-line-arrow-up-right","xs","","","ml-2");frappe.utils.is_rtl(frappe.boot.lang)&&(e=frappe.utils.icon("es-line-arrow-up-left","xs","","","ml-2")),$(e).appendTo(this.action_area),this.widget.addClass("shortcut-widget-box"),this.widget.attr({role:"link",tabindex:0,"aria-label":this.label});let t=frappe.utils.process_filter_expression(this.stats_filter);this.type=="DocType"&&this.doc_view!="New"&&!frappe.boot.single_types.includes(this.link_to)&&frappe.db.count(this.link_to,{filters:t||[]}).then(r=>this.set_count(r))}set_count(e){let t=()=>this.format?__(this.format).replace(/{}/g,e):e;this.action_area.empty();let r=t(),s=this.color&&e?this.color.toLowerCase():"gray";$(`<div class="indicator-pill no-indicator-dot ellipsis ${s}">${__(r)}</div>`).appendTo(this.action_area),$(frappe.utils.icon("es-line-arrow-up-right","xs","","","ml-2")).appendTo(this.action_area)}};frappe.provide("frappe.utils");var Ms=class extends st{constructor(e){e.icon=e.icon||"es-line-filetype",super(e)}get_config(){return{name:this.name,links:JSON.stringify(this.links),link_count:this.links.length,label:this.label,hidden:this.hidden,description:this.description}}set_body(){this.options||(this.options={},this.options.links=this.links),this.widget.addClass("links-widget-box"),this.description&&$(`
				<button class="btn-reset card-description-btn ml-2">
					${frappe.utils.icon("help","sm")}
				</button>
			`).appendTo(this.widget.find(".widget-title")).popover({trigger:"hover",placement:"top",content:()=>`<div class="card-description small">${__(this.description)}</div>`,html:!0});let e=n=>n.dependencies&&n.incomplete_dependencies,t=n=>e(n)?"disabled-link":"",r=n=>n.open_count?"red":n.onboard?n.count?"blue":"yellow":"gray",s=n=>e(n)?`<span class="link-content ellipsis disabled-link">${n.link_title}</span>
					<div class="module-link-popover popover fade top in" role="tooltip" style="display: none;">
						<div class="arrow"></div>
						<h3 class="popover-title" style="display: none;"></h3>
						<div class="popover-content" style="padding: 12px;">
							<div class="small text-muted">${__("You need to create these first: ")}</div>
							<div class="small">${n.incomplete_dependencies.join(", ")}</div>
						</div>
					</div>`:n.youtube_id?`
					<span class="link-content help-video-link ellipsis" data-youtubeid="${n.youtube_id}">
						${n.link_title}
					</span>
				`:`
				<span class="link-content ellipsis">
					<span class="link-text">${n.link_title}</span>
					${frappe.utils.icon("es-line-arrow-up-right","xs","","","ml-2")}
				</span>
			`;this.link_list=this.links.map(n=>{let o={name:n.link_to,type:n.link_type,doctype:n.doctype,is_query_report:n.is_query_report,report_ref_doctype:n.report_ref_doctype};n.link_type.toLowerCase()=="report"&&!n.is_query_report&&(o.doctype=n.dependencies);let a=frappe.utils.generate_route(o);n.link_title=n.label?n.label:n.name;let l=$(`
				<a href="${a}" class="link-item ellipsis
					${n.onboard?"onboard-spotlight":""} ${t(n)}"
					type="${n.type}" title="${n.link_title}"
				>
					${s(n)}
				</a>
			`);return n.description&&l.find(".link-text").popover({trigger:"hover",placement:"top",title:n.link_title,content:()=>`<div class="link-description small">${__(n.description)}</div>`,html:!0,delay:{show:600,hide:100}}),l}),this.in_customize_mode&&this.body.empty(),this.link_list.forEach(n=>n.appendTo(this.body))}setup_events(){this.link_list.forEach(e=>{let t=e.find(".link-content");if(e.hasClass("disabled-link")){let r=e.find(".module-link-popover");t.mouseover(()=>{this.in_customize_mode||r.show()}),t.mouseout(()=>r.hide())}else t.click(r=>{if(!this.in_customize_mode&&t.hasClass("help-video-link")){let s=r.currentTarget.dataset.youtubeid;frappe.help.show_video(s)}})})}};frappe.provide("frappe.utils");var Ns=class extends st{async refresh(){frappe.utils.load_video_player(),this.new&&await this.get_onboarding_data(),this.set_title(),this.set_actions(),this.set_body(),this.setup_events()}get_config(){return{label:this.onboarding_name}}make_body(){this.body.empty(),this.steps_wrapper=$('<div class="onboarding-steps-wrapper"></div>').appendTo(this.body),this.step_preview=$(`<div class="onboarding-step-preview">
			<div class="onboarding-step-body"></div>
			<div class="onboarding-step-footer"></div>
		</div>`).appendTo(this.body),this.step_body=this.step_preview.find(".onboarding-step-body"),this.step_footer=this.step_preview.find(".onboarding-step-footer"),this.steps.forEach((t,r)=>{this.add_step(t,r)});let e=this.steps.findIndex(t=>!t.is_skipped&&!t.is_complete);e==-1&&(e=0),this.show_step(this.steps[e])}add_step(e,t){let r="pending";e.is_skipped&&(r="skipped"),e.is_complete&&(r="complete");let s=$(`<a class="onboarding-step ${r}">
				<div class="step-title">
					<div class="step-index step-pending">${frappe.utils.icon("es-line-success","md","","","step-icon")}</div>
					<div class="step-index step-skipped">${frappe.utils.icon("es-line-close-circle","md","","--icon-stroke: var(--gray-600);","step-icon")}</div>
					<div class="step-index step-complete">${frappe.utils.icon("es-solid-success","md","","","step-icon")}</div>
					<div class="step-text">${__(e.title)}</div>
				</div>
			</a>`);if(e.$step=s,!e.is_complete&&!e.is_skipped){let n=$(`<div class="step-skip">${__("Skip")}</div>`);n.appendTo(s),n.on("click",()=>{this.skip_step(e),event.stopPropagation()})}return s.on("click",()=>this.show_step(e)),s.appendTo(this.steps_wrapper),s}show_step(e){this.active_step&&this.active_step.$step.removeClass("active"),e.$step.addClass("active"),this.active_step=e;let t={"Watch Video":o=>this.show_video(o),"Create Entry":o=>{o.is_complete?frappe.set_route(`/app/List/${o.reference_document}`):o.show_full_form?this.create_entry(o):this.show_quick_entry(o)},"Show Form Tour":o=>this.show_form_tour(o),"Update Settings":o=>this.update_settings(o),"View Report":o=>this.open_report(o),"Go to Page":o=>this.go_to_page(o)},r=()=>{this.step_body.empty(),this.step_footer.empty(),s(),e.intro_video_url?$(`<button class="btn btn-default btn-sm">${__("Watch Tutorial")}</button>`).appendTo(this.step_footer).on("click",n):$(`<button class="btn btn-default btn-sm">${__(e.action_label)||__(e.action)}</button>`).appendTo(this.step_footer).on("click",()=>t[e.action](e))},s=()=>{let o=__(e.description)?frappe.markdown(__(e.description)):`<h1>${__(e.title)}</h1>`;e.action==="Create Entry"&&(o+=`<p>
					<a href='/app/${frappe.router.slug(e.reference_document)}'>
						${__("Show {0} List",[__(e.reference_document)])}</a>
				</p>`),this.step_body.html(o)},n=()=>{this.step_body.empty(),this.step_footer.empty();let o=$(`<div class="video-player" data-plyr-provider="youtube" data-plyr-embed-id="${e.intro_video_url}"></div>`);o.appendTo(this.step_body);let a=new frappe.Plyr(o[0],{hideControls:!0,resetOnEnd:!0});$(`<button class="btn btn-primary btn-sm">${__(e.action_label)||__(e.action)}</button>`).appendTo(this.step_footer).on("click",()=>{a.pause(),t[e.action](e)}),$(`<button class="btn btn-secondary ml-2 btn-sm">${__("Back")}</button>`).appendTo(this.step_footer).on("click",r)};r()}go_to_page(e){this.mark_complete(e),frappe.set_route(e.path).then(()=>{let t=e.callback_message||__("You can continue with the onboarding after exploring this page"),r=e.callback_title||__("Awesome Work"),s=frappe.msgprint({message:t,title:r,primary_action:{action:()=>{s.hide()},label:()=>__("Continue")},wide:!0})})}open_report(e){let t=frappe.utils.generate_route({name:e.reference_report,type:"report",is_query_report:e.report_type!=="Report Builder",doctype:e.report_reference_doctype}),r=frappe.get_route();frappe.set_route(t).then(()=>{let s=frappe.msgprint({message:__(e.report_description),title:__(e.reference_report),primary_action:{action:()=>{frappe.set_route(r).then(()=>{this.mark_complete(e)}),s.hide()},label:()=>__("Continue")},secondary_action:{action:()=>{s.hide(),frappe.set_route(r).then(()=>{this.mark_complete(e)})},label:__("Go Back")}});frappe.msg_dialog.custom_onhide=()=>this.mark_complete(e)})}show_form_tour(e){let t;e.is_single?t=frappe.router.slug(e.reference_document):t=`${frappe.router.slug(e.reference_document)}/new`;let r=frappe.get_route();frappe.route_hooks={},frappe.route_hooks.after_load=s=>{let n=()=>{let a=frappe.msgprint({message:__("Let's take you back to onboarding"),title:__("Onboarding complete"),primary_action:{action:()=>{frappe.set_route(r).then(()=>{this.mark_complete(e)}),a.hide()},label:()=>__("Continue")}})},o=e.form_tour;s.tour.init({tour_name:o,on_finish:n}).then(()=>s.tour.start())},frappe.set_route(t)}update_settings(e){let t=frappe.get_route();frappe.route_hooks={},frappe.route_hooks.after_load=r=>{r.scroll_to_field(e.field),r.doc.__unsaved=!0},frappe.route_hooks.after_save=r=>{let s=!1,n={},o=r.doc[e.field],a=null;o&&e.value_to_validate=="%"&&(s=!0),o==e.value_to_validate&&(s=!0),cstr(o)==cstr(e.value_to_validate)&&(s=!0),s?(n.message=__("Let's take you back to onboarding"),n.title=__("Action Complete"),n.primary_action={action:()=>{frappe.set_route(t).then(()=>{this.mark_complete(e)})},label:__("Continue")},a=()=>n.primary_action.action()):(n.message=__("Looks like you didn't change the value"),n.title=__("Try Again"),n.secondary_action={action:()=>frappe.set_route(t),label:__("Go Back")},n.primary_action={action:()=>{frappe.set_route(t).then(()=>{setTimeout(()=>{this.skip_step(e)},300)})},label:__("Skip Step")},a=()=>n.secondary_action.action()),frappe.msgprint(n),frappe.msg_dialog.custom_onhide=()=>a()},frappe.set_route("Form",e.reference_document)}async create_entry(e){let t=frappe.get_route(),r=await this.get_first_document(e.reference_document);frappe.route_hooks={},frappe.route_hooks.after_load=n=>{let o=()=>{frappe.msgprint({message:__("Awesome, now try making an entry yourself"),title:__("Document Saved"),primary_action:{action:()=>{frappe.set_route(t).then(()=>{this.mark_complete(e)})},label:__("Continue")}}),frappe.msg_dialog.custom_onhide=()=>{this.mark_complete(e)}},a=e.form_tour;n.tour.init({tour_name:a,on_finish:o}).then(()=>n.tour.start())};let s=()=>{frappe.msgprint({message:__("Let's take you back to onboarding"),title:__("Action Complete"),primary_action:{action:()=>{frappe.set_route(t).then(()=>{this.mark_complete(e)})},label:__("Continue")}}),frappe.msg_dialog.custom_onhide=()=>{this.mark_complete(e)}};e.is_submittable?(frappe.route_hooks.after_save=()=>{frappe.msgprint({message:__("Submit this document to complete this step."),title:__("Document Saved")})},frappe.route_hooks.after_submit=s):frappe.route_hooks.after_save=s,frappe.set_route("Form",e.reference_document,r)}show_quick_entry(e){let t=frappe.get_route_str();frappe.ui.form.make_quick_entry(e.reference_document,()=>{if(frappe.get_route_str()!=t){let r=frappe.msgprint({message:__("Let's take you back to onboarding"),title:__("Document Saved"),primary_action:{action:()=>{r.hide(),frappe.set_route(t).then(()=>{this.mark_complete(e)})},label:__("Continue")}});frappe.msg_dialog.custom_onhide=()=>{frappe.set_route(t).then(()=>{this.mark_complete(e)})}}else frappe.show_alert(__("Document Saved")+"<br>"+__("Let us continue with the onboarding")),this.mark_complete(e)},null,null,!0)}show_video(e){frappe.help.show_video(e.video_url,e.title),this.mark_complete(e)}mark_complete(e){let t=e.$step,r=()=>{e.is_complete=!0,t.removeClass("skipped"),t.addClass("complete")};this.update_step_status(e,"is_complete",1,r),this.activate_next_step(e)}skip_step(e){let t=e.$step,r=()=>{e.is_skipped=!0,t.removeClass("complete"),t.removeClass("pending"),t.addClass("skipped")};this.update_step_status(e,"is_skipped",1,r),this.activate_next_step(e)}activate_next_step(e){let t=this.steps.findIndex(s=>s==e),r=this.steps[t+1];!r||this.show_step(r)}update_step_status(e,t,r,s){let n={is_complete:"complete",is_skipped:"skipped"};frappe.route_hooks={},frappe.call("frappe.desk.desktop.update_onboarding_step",{name:e.name,field:t,value:r}).then(()=>{s(),e.$step.removeClass("pending").removeClass("complete").removeClass("skipped").addClass(n[t]),this.steps.filter(a=>!(a.is_complete||a.is_skipped)).length==0&&this.show_success()})}show_success(){let e=this.success||__("You seem good to go!"),t=this.success_state_image||"/assets/frappe/images/ui-states/success-color.png",r="";this.docs_url&&(r=__('Congratulations on completing the module setup. If you want to learn more you can refer to the documentation <a target="_blank" href="{0}">here</a>.',[this.docs_url]));let s=$(`<div class="text-center onboarding-success">
					<img src="${t}" alt="Success State" class="zoom-in success-state">
					<h3>${e}</h3>
					<div class="text-muted">${r}</div>
					<button class="btn btn-primary btn-sm">${__("Continue")}</button>
			</div>
		`);s.find(".btn").on("click",()=>this.delete()),this.step_preview.empty(),s.appendTo(this.step_preview)}set_body(){this.widget.addClass("onboarding-widget-box"),this.is_dismissed()?this.widget.hide():this.make_body()}is_dismissed(){if(this.in_customize_mode)return!1;let e=JSON.parse(localStorage.getItem("dismissed-onboarding")||"{}");if(Object.keys(e).includes(this.title)){let t=new Date(e[this.title]),r=new Date;return frappe.datetime.get_hour_diff(r,t)<24}return!1}set_actions(){if(this.in_customize_mode)return;this.action_area.empty();let e=$(`<div class="btn btn-sm btn-secondary small" style="cursor:pointer;">${__("Dismiss",null,"Stop showing the onboarding widget.")}</div>`);e.on("click",()=>{let t=JSON.parse(localStorage.getItem("dismissed-onboarding")||"{}");t[this.title]=frappe.datetime.now_datetime(),localStorage.setItem("dismissed-onboarding",JSON.stringify(t)),this.delete(!0,!0),this.widget.closest(".ce-block").hide(),frappe.telemetry.capture("dismissed_"+frappe.scrub(this.title),"frappe_onboarding")}),e.appendTo(this.action_area)}get_onboarding_data(){return frappe.model.with_doc("Module Onboarding",this.onboarding_name).then(e=>{if(e){this.onboarding_doc=e,this.label=e.label,this.title=e.title||__("Let's Get Started"),this.subtitle=e.subtitle,this.success=e.success,this.docs_url=e.docs_url,this.user_can_dismiss=e.user_can_dismiss;let t="frappe.desk.doctype.onboarding_step.onboarding_step.get_onboarding_steps";return frappe.xcall(t,{ob_steps:e.steps}).then(r=>{this.steps=r})}})}async get_first_document(e){let{message:t}=await frappe.db.get_value("Form Tour",{reference_doctype:e},["first_document"]),r;return t.first_document&&await frappe.db.get_list(e,{order_by:"creation"}).then(s=>{Array.isArray(s)&&s.length&&(r=s[0].name)}),r||"new"}};var Rs=class{constructor(e){Object.assign(this,e),this.make()}customize(){}make(){this.make_widget(),this.widget.appendTo(this.container),this.setup_events()}get_title(){let e=`New ${frappe.model.unscrub(this.type)}`;return __(e)}make_widget(){let e=`new-${frappe.scrub(frappe.model.unscrub(this.type),"-")}-widget`;this.widget=$(`<div class="widget new-widget ${e}">
				+ ${this.get_title()}
			</div>`),this.body=this.widget}setup_events(){this.widget.on("click",()=>{this.custom_dialog?this.custom_dialog():this.open_dialog()})}open_dialog(){let e=oi(this.type);this.dialog=new e({label:this.label,type:this.type,values:!1,default_values:this.default_values,primary_action:this.on_create}),this.dialog.make()}delete(){this.widget.remove()}};frappe.provide("frappe.utils");var Ds=class extends st{constructor(e){e.shadow=!0,super(e)}get_config(){return{name:this.name,number_card_name:this.number_card_name,label:this.label,color:this.color,hidden:this.hidden}}refresh(){this.set_body()}set_body(){this.widget.addClass("number-widget-box"),this.make_card()}make_card(){frappe.model.with_doc("Number Card",this.number_card_name||this.name).then(e=>{if(e)this.card_doc=e,this.render_card();else if(this.document_type)frappe.run_serially([()=>this.create_number_card(),()=>this.render_card()]);else{this.delete(!1);return}this.set_events()})}create_number_card(){return this.set_doc_args(),frappe.xcall("frappe.desk.doctype.number_card.number_card.create_number_card",{args:this.card_doc}).then(e=>{this.name=e.name,this.card_doc=e,this.widget.attr("data-widget-name",this.name)})}set_events(){$(this.body).click(()=>{this.in_customize_mode||this.set_route()})}set_route(){if(this.card_doc.type==="Custom"){this.set_route_for_custom_card();return}let e=this.card_doc.type!=="Report",t=e?this.card_doc.document_type:this.card_doc.report_name,r=frappe.utils.generate_route({name:t,type:e?"doctype":"report",is_query_report:!e});if(e){let s=JSON.parse(this.card_doc.filters_json);frappe.route_options=s.reduce((n,o)=>Object.assign(n,{[`${o[0]}.${o[1]}`]:[o[2],o[3]]}),{})}frappe.set_route(r)}set_route_for_custom_card(){var e;!((e=this.data)!=null&&e.route)||(this.data.route_options&&(frappe.route_options=this.data.route_options),frappe.set_route(this.data.route))}set_doc_args(){this.card_doc=Object.assign({},{document_type:this.document_type,label:this.label,function:this.function,aggregate_function_based_on:this.aggregate_function_based_on,color:this.color,filters_json:this.stats_filter})}get_settings(e){return this.filters=this.get_filters(),{Custom:{method:this.card_doc.method,args:{filters:this.filters},get_number:r=>this.get_number_for_custom_card(r)},Report:{method:"frappe.desk.query_report.run",args:{report_name:this.card_doc.report_name,filters:this.filters,ignore_prepared_report:1},get_number:r=>this.get_number_for_report_card(r)},"Document Type":{method:"frappe.desk.doctype.number_card.number_card.get_result",args:{doc:this.card_doc,filters:this.filters},get_number:r=>this.get_number_for_doctype_card(r)}}[e]}get_filters(){return frappe.dashboard_utils.get_all_filters(this.card_doc)}async render_card(){this.prepare_actions(),this.set_title(),this.set_loading_state(),this.card_doc.type||(this.card_doc.type="Document Type"),this.settings=this.get_settings(this.card_doc.type),await this.get_data(),this.render_number(),this.render_stats()}set_loading_state(){$(this.body).html(`<div class="number-card-loading text-muted">
			${__("Loading...")}
		</div>`)}async get_data(){return this.data=await frappe.xcall(this.settings.method,this.settings.args),this.settings.get_number(this.data)}get_number_for_custom_card(e){typeof e=="object"?(this.number=e.value,this.set_formatted_number(e)):this.formatted_number=e}get_number_for_doctype_card(e){if(this.number=e,this.card_doc.function!=="Count")return frappe.model.with_doctype(this.card_doc.document_type,()=>{let t=frappe.meta.get_docfield(this.card_doc.document_type,this.card_doc.aggregate_function_based_on);this.set_formatted_number(t)});this.formatted_number=e}get_number_for_report_card(e){let t=this.card_doc.report_field,r=e.result.reduce((n,o)=>(o[t]&&n.push(o[t]),n),[]),s=e.columns.find(n=>n.fieldname==t);this.number=frappe.report_utils.get_result_of_fn(this.card_doc.report_function,r),this.set_formatted_number(s,this._generate_common_doc(e.result))}set_formatted_number(e,t){let r=frappe.sys_defaults.country,n=frappe.utils.shorten_number(this.number,r,5).split(" ");if(this.card_doc.currency){this.formatted_number=format_currency(n[0],this.card_doc.currency);return}let o=n[1]||"";n[0]=window.convert_old_to_new_number_format(n[0]);let a=frappe.format(n[0],e,null,t);this.formatted_number=($(a).text()||a)+" "+__(o)}_generate_common_doc(e){if(!e||!e.length)return{};let t=Object.assign({},e[0]);return e.forEach(r=>{if(!Array.isArray(r))for(let[s,n]of Object.entries(t))n!==r[s]&&delete t[s]}),t}render_number(){let e=this.card_doc.color?`style="color: ${this.card_doc.color};"`:"";$(this.body).html(`<div class="widget-content">
			<div class="number" ${e}>${this.formatted_number}</div>
			</div>`)}render_stats(){if(this.card_doc.type!=="Document Type"||!this.card_doc.show_percentage_stats)return;let e="",t="";return this.get_percentage_stats().then(()=>{this.percentage_stat==0||this.percentage_stat==null?t="grey-stat":this.percentage_stat>0?(e=`<span class="indicator-pill-round green">
						${frappe.utils.icon("es-line-arrow-up-right","xs")}
					</span>`,t="green-stat"):(e=`<span class="indicator-pill-round red">
						${frappe.utils.icon("arrow-down-right","xs")}
					</span>`,t="red-stat");let s={Daily:__("since yesterday"),Weekly:__("since last week"),Monthly:__("since last month"),Yearly:__("since last year")}[this.card_doc.stats_time_interval],n=(()=>{if(this.percentage_stat==null)return NaN;let o=this.percentage_stat.split(" "),a=o[1]||"";return Math.abs(o[0])+" "+a})();isNaN(n)||$(this.body).find(".widget-content").append(`<div class="card-stats ${t}">
				<span class="percentage-stat-area">
					${e} ${n} % ${s}
				</span>
			</div>`)})}get_percentage_stats(){return frappe.xcall("frappe.desk.doctype.number_card.number_card.get_percentage_difference",{doc:this.card_doc,filters:this.filters,result:this.number}).then(e=>{e!==void 0&&(this.percentage_stat=frappe.utils.shorten_number(e))})}prepare_actions(){if(this.in_customize_mode)return;let e=[{label:__("Refresh"),action:"action-refresh",handler:()=>{this.render_card()}},{label:__("Edit"),action:"action-edit",handler:()=>{let t=this.number_card_name||this.name;frappe.set_route("Form","Number Card",t)}}];this.set_card_actions(e)}set_card_actions(e){this.card_actions=$(`<div class="card-actions dropdown pull-right">
				<a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				...
				</a>
				<ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
					${e.map(t=>`<li class="dropdown-item">
									<a data-action="${t.action}">${t.label}</a>
								</li>`).join("")}
				</ul>
			</div>`),this.card_actions.find("a[data-action]").each((t,r)=>{let s=r.dataset.action;$(r).click(e.find(n=>n.action===s))}),this.action_area.html(this.card_actions)}};frappe.provide("frappe.utils");var Ps=class extends st{constructor(e){e.shadow=!0,super(e)}get_config(){return{document_type:this.document_type,label:this.label,quick_list_filter:this.quick_list_filter}}set_actions(){this.in_customize_mode||(frappe.model.can_create(this.document_type)&&this.setup_add_new_button(),this.setup_refresh_list_button(),this.setup_filter_list_button())}setup_add_new_button(){this.add_new_button=$(`<div class="add-new btn btn-xs pull-right"
			title="${__("Add New")} ${__(this.document_type)}
			">
				${frappe.utils.icon("add","sm")}
			</div>`),this.add_new_button.appendTo(this.action_area),this.add_new_button.on("click",()=>{frappe.set_route(frappe.utils.generate_route({type:"doctype",name:this.document_type,doc_view:"New"}))})}setup_refresh_list_button(){this.refresh_list=$(`<div class="refresh-list btn btn-xs pull-right" title="${__("Refresh List")}">
				${frappe.utils.icon("es-line-reload","sm")}
			</div>`),this.refresh_list.appendTo(this.action_area),this.refresh_list.on("click",()=>{this.body.empty(),this.set_body()})}setup_filter_list_button(){this.filter_list=$(`<div class="filter-list btn btn-xs pull-right" title="${__("Add/Update Filter")}">
				${frappe.utils.icon("filter","sm")}
			</div>`),this.filter_list.appendTo(this.action_area),this.filter_list.on("click",()=>this.setup_filter_dialog())}setup_filter(e){this.filter_group&&(this.filter_group.wrapper.empty(),delete this.filter_group),this.filters=frappe.utils.process_filter_expression(this.quick_list_filter),this.filter_group=new frappe.ui.FilterGroup({parent:this.dialog.get_field("filter_area").$wrapper,doctype:e,on_change:()=>{}}),frappe.model.with_doctype(e,()=>{this.filter_group.add_filters_to_filter_group(this.filters),this.dialog.set_df_property("filter_area","hidden",!1)})}setup_filter_dialog(){let e=[{fieldtype:"HTML",fieldname:"filter_area"}],t=this;this.dialog=new frappe.ui.Dialog({title:__("Set Filters for {0}",[__(this.document_type)]),fields:e,primary_action:function(){let r=t.quick_list_filter,s=t.filter_group.get_filters();t.quick_list_filter=JSON.stringify(s),this.hide(),r!=t.quick_list_filter&&(t.body.empty(),t.set_footer(),t.set_body())},primary_action_label:__("Save")}),this.dialog.show(),this.setup_filter(this.document_type)}render_loading_state(){this.body.empty(),this.loading=$(`<div class="list-loading-state text-muted">${__("Loading...")}</div>`),this.loading.appendTo(this.body)}render_no_data_state(){this.loading=$(`<div class="list-no-data-state text-muted">${__("No Data...")}</div>`),this.loading.appendTo(this.body)}setup_quick_list_item(e){let t=frappe.get_indicator(e,this.document_type),r=$(`
			<div class="quick-list-item">
				<div class="ellipsis left">
					<div class="ellipsis title"
						title="${strip_html(e[this.title_field_name])}">
						${strip_html(e[this.title_field_name])}
					</div>
					<div class="timestamp text-muted">
						${frappe.datetime.prettyDate(e.modified)}
					</div>
				</div>
			</div>
		`);t&&$(`
				<div class="status indicator-pill ${t[1]} ellipsis">
					${__(t[0])}
				</div>
			`).appendTo(r);let s=`<div class="right-arrow">${frappe.utils.icon("right","xs")}</div>`;return frappe.utils.is_rtl(frappe.boot.lang)&&(s=`<div class="left-arrow">${frappe.utils.icon("left","xs")}</div>`),$(s).appendTo(r),r.click(n=>{(n.ctrlKey||n.metaKey)&&(frappe.open_in_new_tab=!0),frappe.set_route(`${frappe.utils.get_form_link(this.document_type,e.name)}`)}),r}set_body(){this.widget.addClass("quick-list-widget-box"),this.render_loading_state(),frappe.model.with_doctype(this.document_type,()=>{var o,a;let e=["name"];if(!this.title_field_name){let l=frappe.get_meta(this.document_type);this.title_field_name=l&&l.title_field||"name"}this.title_field_name&&this.title_field_name!="name"&&e.push(this.title_field_name),this.has_status_field=frappe.meta.has_field(this.document_type,"status"),this.has_status_field&&(e.push("status"),e.push("docstatus"));let t=frappe.workflow.get_state_fieldname(this.document_type);t&&e.push(t),e.push("modified");let r=(a=(o=frappe.listview_settings)==null?void 0:o[this.document_type])==null?void 0:a.add_fields;if(Array.isArray(r)){for(let l of r)frappe.meta.has_field(this.document_type,l)&&e.push(l);e=[...new Set(e)]}let s=frappe.utils.process_filter_expression(this.quick_list_filter),n={method:"frappe.desk.reportview.get",args:{doctype:this.document_type,fields:e,filters:s,order_by:"creation desc",start:0,page_length:4}};frappe.call(n).then(l=>{if(!l.message)return;let c=l.message;if(this.body.empty(),c=Array.isArray(c)?c:frappe.utils.dict(c.keys,c.values),!c.length){this.render_no_data_state();return}this.quick_list=c.map(u=>this.setup_quick_list_item(u)),this.quick_list.forEach(u=>u.appendTo(this.body))})})}set_footer(){this.footer.empty();let e=frappe.utils.get_filter_from_json(this.quick_list_filter),t=frappe.utils.generate_route({type:"doctype",name:this.document_type});this.see_all_button=$(`
			<div class="see-all btn btn-xs">${__("View List")}</div>
		`).appendTo(this.footer),this.see_all_button.click(r=>{(r.ctrlKey||r.metaKey)&&(frappe.open_in_new_tab=!0),e&&(frappe.route_options=e),frappe.set_route(t)})}};var js=class extends st{constructor(e){e.shadow=!0,super(e)}get_config(){return{custom_block_name:this.custom_block_name,label:this.custom_block_name}}refresh(){this.set_body(),this.make_custom_block()}set_body(){this.widget.addClass("custom-block-widget-box"),this.widget.addClass("full-width")}async make_custom_block(){await this.get_custom_block_data(),this.body.empty(),frappe.create_shadow_element(this.body[0],this.custom_block_doc.html,this.custom_block_doc.style,this.custom_block_doc.script)}async get_custom_block_data(){this.label=this.custom_block_name;let e=await frappe.model.with_doc("Custom HTML Block",this.custom_block_name);this.custom_block_doc=e||""}};frappe.provide("frappe.widget");frappe.widget.widget_factory={chart:Bs,base:st,shortcut:Is,links:Ms,onboarding:Ns,number_card:Ds,quick_list:Ps,custom_block:js};frappe.widget.make_widget=i=>{let e=frappe.widget.widget_factory[i.widget_type];if(e)return new e(i);console.warn("Invalid Widget Name: "+i.widget_type)};var Xn=class{constructor(e){Object.assign(this,e),this.widgets_list=[],this.widgets_dict={},this.widget_order=[],this.make()}make(){this.make_container(),this.title?this.set_title():this.title_area.remove(),this.widgets&&this.make_widgets()}make_container(){let e=$(`<div class="widget-group ${this.class_name||""}">
				<div class="widget-group-head">
					<div class="widget-group-title"></div>
					<div class="widget-group-control"></div>
				</div>
				<div class="widget-group-body grid-col-${this.columns}">
				</div>
			</div>`);this.widget_area=e,this.hidden&&this.widget_area.hide(),this.title_area=e.find(".widget-group-title"),this.control_area=e.find(".widget-group-control"),this.body=e.find(".widget-group-body"),!this.widgets.length&&this.widget_area.hide(),e.appendTo(this.container)}set_title(){this.title_area[0].innerText=this.title}make_widgets(){this.body.empty(),this.widgets.forEach(e=>{this.add_widget(e)})}add_widget(e){let t=frappe.widget.make_widget(rt(Ee({},e),{widget_type:this.type,container:this.body,height:this.height||null,options:rt(Ee({},this.options),{on_delete:r=>this.on_delete(r)})}));return this.widgets_list.push(t),this.widgets_dict[e.name]=t,t}remove_widget(e){e.widget.remove(),this.widgets_list.filter(t=>{if(t.name==e.name)return!1}),delete this.widgets_dict[e.name]}customize(){this.hidden||this.widget_area.show(),this.widgets_list.forEach(e=>{e.customize(this.options)}),this.options.allow_create&&this.setup_new_widget(),this.options.allow_sorting&&this.setup_sortable()}setup_new_widget(){let e=this.options&&this.options.max_widget_count||Number.POSITIVE_INFINITY;this.widgets_list.length<e&&(this.new_widget=new Rs({container:this.body,type:this.type,custom_dialog:this.custom_dialog,default_values:this.default_values,on_create:t=>{this.new_widget.delete(),delete this.new_widget,t.in_customize_mode=1,this.add_widget(t).customize(this.options),this.widgets_list.length<e&&this.setup_new_widget()}}))}on_delete(e,t){this.widgets_list=this.widgets_list.filter(r=>e!=r.name),delete this.widgets_dict[e],this.update_widget_order(),!this.new_widget&&t&&this.setup_new_widget()}update_widget_order(){this.widget_order=[],this.body.children().each((e,t)=>{let r=t.dataset.widgetName;r&&this.widget_order.push(r)})}setup_sortable(){let e=this.body[0];this.sortable=new Sortable(e,{animation:150,handle:".drag-handle",onEnd:()=>this.update_widget_order()})}get_widget_config(){this.update_widget_order();let e={};return this.widgets_list.forEach(t=>{let r=t.get_config(),s=r.docname?r.docname:r.name;e[s]=r}),{order:this.widget_order,widgets:e}}},fl=class{constructor(e){Object.assign(this,e),this.widgets_list=[],this.widgets_dict={},this.make()}make(){this.add_widget(this.widgets)}add_widget(e){let t=frappe.widget.make_widget(rt(Ee({},e),{widget_type:this.type,container:this.container,height:this.height||null,options:rt(Ee({},this.options),{on_delete:()=>this.on_delete(),on_edit:()=>this.on_edit(t)})}));return this.widgets_list.push(t),this.widgets_dict[e.name]=t,t}on_delete(){this.api.blocks.delete()}on_edit(e){this.block.call("on_edit",e)}customize(){this.widgets_list.forEach(e=>{e.customize(this.options)})}};frappe.widget.WidgetGroup=Xn;frappe.widget.SingleWidgetGroup=fl;frappe.templates.sort_selector=`<div class="sort-selector">
	<div class="btn-group">
		<button class="btn btn-default btn-sm btn-order"
			data-value="{{ sort_order }}"
			title="{{ sort_order==="desc" ? __("descending") : __("ascending") }}">
			<span class="sort-order">
				<svg class="icon icon-sm">
					<use href="#icon-{{ sort_order==="desc" ? "sort-descending" : "sort-ascending" }}"></use>
				</svg>
			</span>
		</button>
		<button type="button" class="btn btn-default btn-sm sort-selector-button" data-toggle="dropdown">
			<span class="dropdown-text">{{ __(sort_by_label) }}</span>
			<ul class="dropdown-menu dropdown-menu-right">
				{% for value in options %}
				<li>
					<a class="dropdown-item option" data-value="{{ value.fieldname }}">
						{{ __(value.label) }}
					</a>
				</li>
				{% endfor %}
			</ul>
		</button>
	</div>
</div>
`;frappe.ui.SortSelector=class{constructor(e){$.extend(this,e),this.labels={},this.make()}make(){this.prepare_args(),this.parent.find(".sort-selector").remove(),this.wrapper=$(frappe.render_template("sort_selector",this.args)).appendTo(this.parent),this.bind_events()}bind_events(){var e=this;this.wrapper.find(".btn-order").on("click",function(){let t=$(this).attr("data-value")==="desc"?"asc":"desc";e.set_value(e.sort_by,t),(e.onchange||e.change)(e.sort_by,e.sort_order)}),this.wrapper.find(".dropdown-menu a.option").on("click",function(){e.set_value($(this).attr("data-value"),e.sort_order),(e.onchange||e.change)(e.sort_by,e.sort_order)})}set_value(e,t){let r=this.wrapper.find(".btn-order"),s=r.find(".sort-order"),n=this.wrapper.find(".dropdown-text");if(this.sort_by!==e&&(this.sort_by=e,n.html(__(this.get_label(e)))),this.sort_order!==t){this.sort_order=t;let o=t==="desc"?__("ascending"):__("descending"),a=t==="asc"?"sort-ascending":"sort-descending";r.attr("data-value",t),r.attr("title",o),s.html(frappe.utils.icon(a,"sm"))}}prepare_args(){var e=this;if(this.args||(this.args={}),this.args&&typeof this.args=="string"){var t=this.args;this.args={},t.includes("`.`")&&(t=t.split(".")[1]);var r=t.split(" ");if(r.length===2){var s=strip(r[0],"`");this.args.sort_by=s,this.args.sort_order=r[1]}}this.args.options&&this.args.options.forEach(function(n){e.labels[n.fieldname]=n.label}),this.setup_from_doctype(),this.args.sort_by&&!this.args.sort_by_label&&this.args.options.every(function(n){return n.fieldname===e.args.sort_by?(e.args.sort_by_label=n.label,!1):!0})}setup_from_doctype(){var e=this,t=frappe.get_meta(this.doctype);if(!!t){var{meta_sort_field:r,meta_sort_order:s}=this.get_meta_sort_field();if(this.args.sort_by||(r?(this.args.sort_by=r,this.args.sort_order=s):(this.args.sort_by="creation",this.args.sort_order="desc")),this.args.sort_by_label||(this.args.sort_by_label=this.get_label(this.args.sort_by)),!this.args.options){var n=[{fieldname:"modified"},{fieldname:"name"},{fieldname:"creation"},{fieldname:"idx"}];t.title_field&&n.splice(1,0,{fieldname:t.title_field}),r&&n.splice(1,0,{fieldname:r}),t.fields.forEach(function(o){(o.mandatory||o.bold||o.in_list_view||o.reqd)&&frappe.model.is_value_type(o.fieldtype)&&frappe.perm.has_perm(e.doctype,o.permlevel,"read")&&n.push({fieldname:o.fieldname,label:o.label})}),n.forEach(o=>{o.label||(o.label=e.get_label(o.fieldname))}),this.args.options=n.uniqBy(o=>o.fieldname)}this.sort_by=this.args.sort_by,this.sort_order=this.args.sort_order=this.args.sort_order.toLowerCase()}}get_meta_sort_field(){var e=frappe.get_meta(this.doctype);if(!e)return{meta_sort_field:null,meta_sort_order:null};if(e.sort_field){var t=e.sort_field.split(",")[0].split(" ");return{meta_sort_field:t[0],meta_sort_order:e.sort_order?e.sort_order.toLowerCase():""}}else return{meta_sort_field:e.sort_field||"creation",meta_sort_order:e.sort_order?e.sort_order.toLowerCase():""}}get_label(e){return e==="idx"?__("Most Used"):this.labels[e]||frappe.meta.get_label(this.doctype,e)}get_sql_string(){let e="`tab"+this.doctype+"`",t=`${e}.${this.sort_by}`;return["name","creation","modified"].includes(this.sort_by)?`${t} ${this.sort_order}`:`${t} ${this.sort_order}, ${e}.name ${this.sort_order}`}};frappe.templates.change_log=`{% for (var i=0, l=change_log.length; i < l; i++) {
    var app_info = change_log[i]; %}
	{% if (i > 0) { %} <hr> {% } %}
	<div class="text-left app-change-log">
		<h2 style="margin-top: 10px;">
            {{ app_info.title }}
			<small>{{ __("updated to {0}", [app_info.version]) }}</small>
		</h2>
		<div class="app-change-log-body">
		{% for (var x=0, y=app_info.change_log.length; x < y; x++) {
            var version_info = app_info.change_log[x];
            if(version_info) { %}
    			<p>{{ frappe.markdown(version_info[1]) }}</p>
		    {% }
        } %}
    	</div>
	</div>
{% } %}
`;frappe.templates.workspace_loading_skeleton=`<div class="workspace-skeleton mt-3">
	<div class="widget-group">
		<div class="widget-group-head skeleton-header">
			<div class="widget-group-title skeleton-card"></div>
		</div>
		<div class="widget-group-body grid-col-3">
			<div class="widget shortcut-widget-box skeleton-card"></div>
			<div class="widget shortcut-widget-box skeleton-card"></div>
			<div class="widget shortcut-widget-box skeleton-card"></div>
		</div>
	</div>
	<div class="widget-group skeleton-body">
		<div class="widget-group-head skeleton-header">
			<div class="widget-group-title skeleton-card"></div>
		</div>
		<div class="widget-group-body grid-col-3">
			<div class="widget links-widget-box skeleton-card"></div>
			<div class="widget links-widget-box skeleton-card"></div>
			<div class="widget links-widget-box skeleton-card"></div>
			<div class="widget links-widget-box skeleton-card"></div>
			<div class="widget links-widget-box skeleton-card"></div>
		</div>
	</div>
</div>
`;frappe.templates.workspace_sidebar_loading_skeleton=`<div class="workspace-sidebar-skeleton">
	<div class="widget-group-body">
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box child skeleton-card"></div>
		<div class="widget sidebar-box child skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
	</div>
	<div class="widget-group-body">
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box child skeleton-card"></div>
		<div class="widget sidebar-box child skeleton-card"></div>
		<div class="widget sidebar-box child skeleton-card"></div>
		<div class="widget sidebar-box child skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
		<div class="widget sidebar-box skeleton-card"></div>
	</div>
</div>`;frappe.start_app=function(){!frappe.Application||(frappe.assets.check(),frappe.provide("frappe.app"),frappe.provide("frappe.desk"),frappe.app=new frappe.Application)};$(document).ready(function(){frappe.utils.supportsES6||frappe.msgprint({indicator:"red",title:__("Browser not supported"),message:__("Some of the features might not work in your browser. Please update your browser to the latest version.")}),frappe.start_app()});frappe.Application=class{constructor(){this.startup()}startup(){if(frappe.realtime.init(),frappe.model.init(),this.load_bootinfo(),this.load_user_permissions(),this.make_nav_bar(),this.make_sidebar(),this.set_favicon(),this.set_fullwidth_if_enabled(),this.add_browser_class(),this.setup_copy_doc_listener(),this.setup_broadcast_listeners(),frappe.ui.keys.setup(),this.setup_theme(),this.make_page_container(),this.setup_tours(),this.set_route(),$(document).trigger("startup"),$(document).trigger("app_ready"),this.show_notices(),this.show_notes(),frappe.ui.startup_setup_dialog&&!frappe.boot.setup_complete&&(frappe.ui.startup_setup_dialog.pre_show(),frappe.ui.startup_setup_dialog.show()),this.setup_build_events(),frappe.sys_defaults.email_user_password){var e=frappe.sys_defaults.email_user_password.split(",");for(var t in e)e[t]===frappe.user.name&&this.set_password(e[t])}this.link_preview=new frappe.ui.LinkPreview,frappe.broadcast.emit("boot",{csrf_token:frappe.csrf_token,user:frappe.session.user})}make_sidebar(){this.sidebar=new frappe.ui.Sidebar({})}setup_theme(){frappe.ui.keys.add_shortcut({shortcut:"shift+ctrl+g",description:__("Switch Theme"),action:()=>{frappe.theme_switcher&&frappe.theme_switcher.dialog.is_visible?frappe.theme_switcher.hide():(frappe.theme_switcher=new frappe.ui.ThemeSwitcher,frappe.theme_switcher.show())}}),frappe.ui.add_system_theme_switch_listener();let e=document.documentElement;new MutationObserver(()=>{frappe.ui.set_theme()}).observe(e,{attributes:!0,attributeFilter:["data-theme-mode"]}),frappe.ui.set_theme()}setup_tours(){!window.Cypress&&frappe.boot.onboarding_tours&&frappe.boot.user.onboarding_status!=null&&!frappe.boot.onboarding_tours.every(t=>{var r;return(r=frappe.boot.user.onboarding_status[t[0]])==null?void 0:r.is_complete})&&frappe.boot.onboarding_tours.length>0&&frappe.require("onboarding_tours.bundle.js",()=>{frappe.utils.sleep(1e3).then(()=>{frappe.ui.init_onboarding_tour()})})}show_notices(){if(frappe.boot.messages&&frappe.msgprint(frappe.boot.messages),frappe.user_roles.includes("System Manager")&&setTimeout(()=>{this.show_change_log(),this.show_update_available()},1e3),!frappe.boot.developer_mode){let e=__("Using this console may allow attackers to impersonate you and steal your information. Do not enter or paste code that you do not understand.");console.log(`%c${e}`,"font-size: large")}frappe.realtime.on("version-update",function(){var e=frappe.msgprint({message:__("The application has been updated to a new version, please refresh this page"),indicator:"green",title:__("Version Updated")});e.set_primary_action(__("Refresh"),function(){location.reload(!0)}),e.get_close_btn().toggle(!1)})}set_route(){frappe.boot&&localStorage.getItem("session_last_route")?(frappe.set_route(localStorage.getItem("session_last_route")),localStorage.removeItem("session_last_route")):frappe.router.route(),frappe.router.on("change",()=>{$(".tooltip").hide()})}set_password(e){var t=this;frappe.call({method:"frappe.core.doctype.user.user.get_email_awaiting",args:{user:e},callback:function(r){if(r=r.message,r){var s=0;s<r.length&&t.email_password_prompt(r,e,s)}}})}email_password_prompt(e,t,r){var s=this;let n=e[r].email_id,o=new frappe.ui.Dialog({title:__("Password missing in Email Account"),fields:[{fieldname:"password",fieldtype:"Password",label:__("Please enter the password for: <b>{0}</b>",[n],"Email Account"),reqd:1},{fieldname:"submit",fieldtype:"Button",label:__("Submit",null,"Submit password for Email Account")}]});o.get_input("submit").on("click",function(){o.hide();var a=new frappe.ui.Dialog({title:__("Checking one moment"),fields:[{fieldtype:"HTML",fieldname:"checking"}]});a.fields_dict.checking.$wrapper.html('<i class="fa fa-spinner fa-spin fa-4x"></i>'),a.show(),frappe.call({method:"frappe.email.doctype.email_account.email_account.set_email_password",args:{email_account:e[r].email_account,password:o.get_value("password")},callback:function(l){a.hide(),o.hide(),l.message?r+1<e.length&&(r=r+1,s.email_password_prompt(e,t,r)):(frappe.show_alert({message:__("Login Failed please try again"),indicator:"error"},5),s.email_password_prompt(e,t,r))}})}),o.show()}load_bootinfo(){frappe.boot?(this.setup_workspaces(),frappe.model.sync(frappe.boot.docs),this.check_metadata_cache_status(),this.set_globals(),this.sync_pages(),frappe.router.setup(),this.setup_moment(),frappe.boot.print_css&&frappe.dom.set_style(frappe.boot.print_css,"print-style"),frappe.user.name=frappe.boot.user.name,frappe.router.setup()):this.set_as_guest()}setup_workspaces(){frappe.modules={},frappe.workspaces={},frappe.boot.allowed_workspaces=frappe.boot.sidebar_pages.pages;for(let e of frappe.boot.allowed_workspaces||[])frappe.modules[e.module]=e,frappe.workspaces[frappe.router.slug(e.name)]=e}load_user_permissions(){frappe.defaults.load_user_permission_from_boot(),frappe.realtime.on("update_user_permissions",frappe.utils.debounce(()=>{frappe.defaults.update_user_permissions()},500))}check_metadata_cache_status(){frappe.boot.metadata_version!=localStorage.metadata_version&&(frappe.assets.clear_local_storage(),frappe.assets.init_local_storage())}set_globals(){frappe.session.user=frappe.boot.user.name,frappe.session.logged_in_user=frappe.boot.user.name,frappe.session.user_email=frappe.boot.user.email,frappe.session.user_fullname=frappe.user_info().fullname,frappe.user_defaults=frappe.boot.user.defaults,frappe.user_roles=frappe.boot.user.roles,frappe.sys_defaults=frappe.boot.sysdefaults,frappe.ui.py_date_format=frappe.boot.sysdefaults.date_format.replace("dd","%d").replace("mm","%m").replace("yyyy","%Y"),frappe.boot.user.last_selected_values={}}sync_pages(){if(localStorage.page_info){frappe.boot.allowed_pages=[];var e=JSON.parse(localStorage.page_info);$.each(frappe.boot.page_info,function(t,r){(!e[t]||e[t].modified!=r.modified)&&delete localStorage["_page:"+t],frappe.boot.allowed_pages.push(t)})}else frappe.boot.allowed_pages=Object.keys(frappe.boot.page_info);localStorage.page_info=JSON.stringify(frappe.boot.page_info)}set_as_guest(){frappe.session.user="Guest",frappe.session.user_email="",frappe.session.user_fullname="Guest",frappe.user_defaults={},frappe.user_roles=["Guest"],frappe.sys_defaults={}}make_page_container(){$("#body").length&&($(".splash").remove(),frappe.temp_container=$("<div id='temp-container' style='display: none;'>").appendTo("body"),frappe.container=new frappe.views.Container)}make_nav_bar(){frappe.boot&&frappe.boot.home_page!=="setup-wizard"&&(frappe.frappe_toolbar=new frappe.ui.toolbar.Toolbar)}logout(){var e=this;return e.logged_out=!0,frappe.call({method:"logout",callback:function(t){t.exc||e.redirect_to_login()}})}handle_session_expired(){frappe.app.redirect_to_login()}redirect_to_login(){window.location.href=`/login?redirect-to=${encodeURIComponent(window.location.pathname+window.location.search)}`}set_favicon(){var e=$('link[type="image/x-icon"]').remove().attr("href");$('<link rel="shortcut icon" href="'+e+'" type="image/x-icon">').appendTo("head"),$('<link rel="icon" href="'+e+'" type="image/x-icon">').appendTo("head")}trigger_primary_action(){$(document.activeElement).blur(),setTimeout(()=>{window.cur_dialog&&cur_dialog.display&&!cur_dialog.is_minimized?cur_dialog.get_primary_btn().trigger("click"):cur_frm&&cur_frm.page.btn_primary.is(":visible")?cur_frm.page.btn_primary.trigger("click"):frappe.container.page.save_action&&frappe.container.page.save_action()},100)}show_change_log(){var e=this;let t=frappe.boot.change_log;if(!(!Array.isArray(t)||!t.length||window.Cypress||cint(frappe.boot.sysdefaults.disable_change_log_notification))){var r=frappe.msgprint({message:frappe.render_template("change_log",{change_log:t}),title:__("Updated To A New Version \u{1F389}"),wide:!0});r.keep_open=!0,r.custom_onhide=function(){frappe.call({method:"frappe.utils.change_log.update_last_known_versions"}),e.show_notes()}}}show_update_available(){!frappe.boot.has_app_updates||frappe.xcall("frappe.utils.change_log.show_update_popup")}add_browser_class(){$("html").addClass(frappe.utils.get_browser().name.toLowerCase())}set_fullwidth_if_enabled(){frappe.ui.toolbar.set_fullwidth_if_enabled()}show_notes(){var e=this;frappe.boot.notes.length&&frappe.boot.notes.forEach(function(t){if(!t.seen||t.notify_on_every_login){var r=frappe.msgprint({message:t.content,title:t.title});r.keep_open=!0,r.custom_onhide=function(){t.seen=!0,t.notify_on_every_login||frappe.call({method:"frappe.desk.doctype.note.note.mark_as_seen",args:{note:t.name}}),e.show_notes()}}})}setup_build_events(){frappe.boot.developer_mode&&frappe.require("build_events.bundle.js")}setup_copy_doc_listener(){$("body").on("paste",e=>{try{let t=frappe.utils.get_clipboard_data(e),r=JSON.parse(t);if(r.doctype){e.preventDefault();let s=frappe.utils.sleep;frappe.dom.freeze(__("Creating {0}",[r.doctype])+"..."),s(500).then(()=>{var o;let n=frappe.model.with_doctype(r.doctype,()=>{let a=frappe.model.copy_doc(r);a.__newname=r.name,delete r.name,a.idx=null,a.__run_link_triggers=!1,frappe.set_route("Form",a.doctype,a.name),frappe.dom.unfreeze()});n&&((o=n.fail)==null||o.call(n,frappe.dom.unfreeze))})}}catch(t){}})}setup_broadcast_listeners(){frappe.broadcast.on("boot",({csrf_token:e,user:t})=>{if(t&&t!=frappe.session.user){frappe.msgprint({message:__("You've logged in as another user from another tab. Refresh this page to continue using system."),title:__("User Changed"),primary_action:{label:__("Refresh"),action:()=>{window.location.reload()}}});return}e&&(frappe.csrf_token=e)})}setup_moment(){moment.updateLocale("en",{week:{dow:frappe.datetime.get_first_day_of_the_week_index()}}),moment.locale("en"),moment.user_utc_offset=moment().utcOffset(),frappe.boot.timezone_info&&moment.tz.add(frappe.boot.timezone_info)}};frappe.get_module=function(i,e){var t=frappe.modules[i]||e;if(!!t)return t._setup||(t.label||(t.label=i),t._label||(t._label=__(t.label)),t._setup=!0),t};frappe.provide("frappe.utils");function Q1(i){return If()[i]||""}function ex(i){return i.includes("?")?i.slice(i.indexOf("?")+1):""}function If(i){var e={};i||(i=location.search.substring(1));for(var t=i.split("&"),r=0,s=t.length;r<s;r++){var n=t[r].split(/=(.+)/),o=n[0];if(!!o){var a=n[1];if(typeof a=="string"){a=a.replace(/\+/g,"%20");try{a=decodeURIComponent(a)}catch(l){}}o in e?(typeof e[o]=="undefined"?e[o]=[]:typeof e[o]=="string"&&(e[o]=[e[o]]),e[o].push(a)):e[o]=a}}return e}function tx(i,e=!0){let t=[];for(let r in i){let s=i[r];s===void 0||s===""||s===null||(typeof s=="object"&&(s=JSON.stringify(s)),e&&(r=encodeURIComponent(r),s=encodeURIComponent(s)),t.push(`${r}=${s}`))}return"?"+t.join("&")}Object.assign(frappe.utils,{get_url_arg:Q1,get_query_string:ex,get_query_params:If,make_query_string:tx});var ZL=Ut(Mf());function to(i){return(to=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Vt(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Nf(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}function ai(i,e,t){return e&&Nf(i.prototype,e),t&&Nf(i,t),i}function br(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Jf(i,e)}function xt(i){return(xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function Jf(i,e){return(Jf=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(i,e)}function ix(i,e){return!e||typeof e!="object"&&typeof e!="function"?function(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i):e}function vr(i){var e=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,r=xt(i);if(e){var s=xt(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return ix(this,t)}}function Pt(i,e,t){return(Pt=typeof Reflect!="undefined"&&Reflect.get?Reflect.get:function(r,s,n){var o=function(l,c){for(;!Object.prototype.hasOwnProperty.call(l,c)&&(l=xt(l))!==null;);return l}(r,s);if(o){var a=Object.getOwnPropertyDescriptor(o,s);return a.get?a.get.call(n):a.value}})(i,e,t||i)}function ct(i,e){return function(t){if(Array.isArray(t))return t}(i)||function(t,r){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var s=[],n=!0,o=!1,a=void 0;try{for(var l,c=t[Symbol.iterator]();!(n=(l=c.next()).done)&&(s.push(l.value),!r||s.length!==r);n=!0);}catch(u){o=!0,a=u}finally{try{n||c.return==null||c.return()}finally{if(o)throw a}}return s}}(i,e)||Zf(i,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function jt(i){return function(e){if(Array.isArray(e))return vl(e)}(i)||function(e){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}(i)||Zf(i)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Zf(i,e){if(i){if(typeof i=="string")return vl(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?vl(i,e):void 0}}function vl(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function vi(i,e){return typeof i=="string"?(e||document).querySelector(i):i||null}function Qn(i){var e=i.getBoundingClientRect();return{top:e.top+(document.documentElement.scrollTop||document.body.scrollTop),left:e.left+(document.documentElement.scrollLeft||document.body.scrollLeft)}}function rx(i){return i.offsetParent===null}function sx(i){var e=i.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}(function(i,e){e===void 0&&(e={});var t=e.insertAt;if(i&&typeof document!="undefined"){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=i:s.appendChild(document.createTextNode(i))}})(`:root {
  --charts-label-color: #313b44;
  --charts-axis-line-color: #f4f5f6;
  --charts-tooltip-title: var(--charts-label-color);
  --charts-tooltip-label: var(--charts-label-color);
  --charts-tooltip-value: #192734;
  --charts-tooltip-bg: #ffffff;
  --charts-stroke-width: 2px;
  --charts-dataset-circle-stroke: #ffffff;
  --charts-dataset-circle-stroke-width: var(--charts-stroke-width);
  --charts-legend-label: var(--charts-label-color);
  --charts-legend-value: var(--charts-label-color);
}

.chart-container {
  position: relative; /* for absolutely positioned tooltip */
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
}
.chart-container .axis,
.chart-container .chart-label {
  fill: var(--charts-label-color);
}
.chart-container .axis line,
.chart-container .chart-label line {
  stroke: var(--charts-axis-line-color);
}
.chart-container .dataset-units circle {
  stroke: var(--charts-dataset-circle-stroke);
  stroke-width: var(--charts-dataset-circle-stroke-width);
}
.chart-container .dataset-units path {
  fill: none;
  stroke-opacity: 1;
  stroke-width: var(--charts-stroke-width);
}
.chart-container .dataset-path {
  stroke-width: var(--charts-stroke-width);
}
.chart-container .path-group path {
  fill: none;
  stroke-opacity: 1;
  stroke-width: var(--charts-stroke-width);
}
.chart-container line.dashed {
  stroke-dasharray: 5, 3;
}
.chart-container .axis-line .specific-value {
  text-anchor: start;
}
.chart-container .axis-line .y-line {
  text-anchor: end;
}
.chart-container .axis-line .x-line {
  text-anchor: middle;
}
.chart-container .legend-dataset-label {
  fill: var(--charts-legend-label);
  font-weight: 600;
}
.chart-container .legend-dataset-value {
  fill: var(--charts-legend-value);
}

.graph-svg-tip {
  position: absolute;
  z-index: 99999;
  padding: 10px;
  font-size: 12px;
  text-align: center;
  background: var(--charts-tooltip-bg);
  box-shadow: 0px 1px 4px rgba(17, 43, 66, 0.1), 0px 2px 6px rgba(17, 43, 66, 0.08), 0px 40px 30px -30px rgba(17, 43, 66, 0.1);
  border-radius: 6px;
}
.graph-svg-tip ul {
  padding-left: 0;
  display: flex;
}
.graph-svg-tip ol {
  padding-left: 0;
  display: flex;
}
.graph-svg-tip ul.data-point-list li {
  min-width: 90px;
  font-weight: 600;
}
.graph-svg-tip .svg-pointer {
  position: absolute;
  height: 12px;
  width: 12px;
  border-radius: 2px;
  background: var(--charts-tooltip-bg);
  transform: rotate(45deg);
  margin-top: -7px;
  margin-left: -6px;
}
.graph-svg-tip.comparison {
  text-align: left;
  padding: 0px;
  pointer-events: none;
}
.graph-svg-tip.comparison .title {
  display: block;
  padding: 16px;
  margin: 0;
  color: var(--charts-tooltip-title);
  font-weight: 600;
  line-height: 1;
  pointer-events: none;
  text-transform: uppercase;
}
.graph-svg-tip.comparison .title strong {
  color: var(--charts-tooltip-value);
}
.graph-svg-tip.comparison ul {
  margin: 0;
  white-space: nowrap;
  list-style: none;
}
.graph-svg-tip.comparison ul.tooltip-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 5px;
}
.graph-svg-tip.comparison li {
  display: inline-block;
  display: flex;
  flex-direction: row;
  font-weight: 600;
  line-height: 1;
  padding: 5px 15px 15px 15px;
}
.graph-svg-tip.comparison li .tooltip-legend {
  height: 12px;
  width: 12px;
  margin-right: 8px;
  border-radius: 2px;
}
.graph-svg-tip.comparison li .tooltip-label {
  margin-top: 4px;
  font-size: 11px;
  line-height: 1.25;
  max-width: 150px;
  white-space: normal;
  color: var(--charts-tooltip-label);
}
.graph-svg-tip.comparison li .tooltip-value {
  color: var(--charts-tooltip-value);
}`),vi.create=function(i,e){var t=document.createElement(i);for(var r in e){var s=e[r];if(r==="inside")vi(s).appendChild(t);else if(r==="around"){var n=vi(s);n.parentNode.insertBefore(t,n),t.appendChild(n)}else r==="styles"?to(s)==="object"&&Object.keys(s).map(function(o){t.style[o]=s[o]}):r in t?t[r]=s:t.setAttribute(r,s)}return t};var nx={margins:{top:10,bottom:10,left:20,right:20},paddings:{top:20,bottom:40,left:30,right:10},baseHeight:240,titleHeight:20,legendHeight:30,titleFontSize:12};function eo(i){return i.titleHeight+i.margins.top+i.paddings.top}function Zn(i){return i.margins.left+i.paddings.left}function Tl(i){return i.margins.top+i.margins.bottom+i.paddings.top+i.paddings.bottom+i.titleHeight+i.legendHeight}function yl(i){return i.margins.left+i.margins.right+i.paddings.left+i.paddings.right}var zs=["pink","blue","green","grey","red","yellow","purple","teal","cyan","orange"],ox={bar:zs,line:zs,pie:zs,percentage:zs,heatmap:["#ebedf0","#c6e48b","#7bc96f","#239a3b","#196127"],donut:zs},Rf=Math.PI/180,ax=function(){function i(e){var t=e.parent,r=t===void 0?null:t,s=e.colors,n=s===void 0?[]:s;Vt(this,i),this.parent=r,this.colors=n,this.titleName="",this.titleValue="",this.listValues=[],this.titleValueFirst=0,this.x=0,this.y=0,this.top=0,this.left=0,this.setup()}return ai(i,[{key:"setup",value:function(){this.makeTooltip()}},{key:"refresh",value:function(){this.fill(),this.calcPosition()}},{key:"makeTooltip",value:function(){var e=this;this.container=vi.create("div",{inside:this.parent,className:"graph-svg-tip comparison",innerHTML:`<span class="title"></span>
				<ul class="data-point-list"></ul>
				<div class="svg-pointer"></div>`}),this.hideTip(),this.title=this.container.querySelector(".title"),this.list=this.container.querySelector(".data-point-list"),this.dataPointList=this.container.querySelector(".data-point-list"),this.parent.addEventListener("mouseleave",function(){e.hideTip()})}},{key:"fill",value:function(){var e,t=this;this.index&&this.container.setAttribute("data-point-index",this.index),e=this.titleValueFirst?"<strong>".concat(this.titleValue,"</strong>").concat(this.titleName):"".concat(this.titleName,"<strong>").concat(this.titleValue,"</strong>"),this.listValues.length>4?this.list.classList.add("tooltip-grid"):this.list.classList.remove("tooltip-grid"),this.title.innerHTML=e,this.dataPointList.innerHTML="",this.listValues.map(function(r,s){var n=t.colors[s]||"black",o=r.formatted===0||r.formatted?r.formatted:r.value,a=vi.create("li",{innerHTML:'<div class="tooltip-legend" style="background: '.concat(n,`;"></div>
					<div>
						<div class="tooltip-value">`).concat(o===0||o?o:"",`</div>
						<div class="tooltip-label">`).concat(r.title?r.title:"",`</div>
					</div>`)});t.dataPointList.appendChild(a)})}},{key:"calcPosition",value:function(){var e=this.container.offsetWidth;this.top=this.y-this.container.offsetHeight-7.48,this.left=this.x-e/2;var t=this.parent.offsetWidth-e,r=this.container.querySelector(".svg-pointer");if(this.left<0)r.style.left="calc(50% - ".concat(-1*this.left,"px)"),this.left=0;else if(this.left>t){var s=this.left-t,n="calc(50% + ".concat(s,"px)");r.style.left=n,this.left=t}else r.style.left="50%"}},{key:"setValues",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:-1;this.titleName=r.name,this.titleValue=r.value,this.listValues=s,this.x=e,this.y=t,this.titleValueFirst=r.valueFirst||0,this.index=n,this.refresh()}},{key:"hideTip",value:function(){this.container.style.top="0px",this.container.style.left="0px",this.container.style.opacity="0"}},{key:"showTip",value:function(){this.container.style.top=this.top+"px",this.container.style.left=this.left+"px",this.container.style.opacity="1"}}]),i}();function Qf(i){return parseFloat(i.toFixed(2))}function wl(i,e,t){var r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];t||(t=r?i[0]:i[i.length-1]);var s=new Array(Math.abs(e)).fill(t);return i=r?s.concat(i):i.concat(s)}function Df(i,e){return(i+"").length*e}function _l(i,e){return{x:Math.sin(i*Rf)*e,y:Math.cos(i*Rf)*e}}function Ri(i){var e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return!Number.isNaN(i)&&i!==void 0&&!!Number.isFinite(i)&&!(e&&i<0)}function e_(i){return Number(Math.round(i+"e4")+"e-4")}function kl(i){var e,t,r;if(i instanceof Date)return new Date(i.getTime());if(to(i)!=="object"||i===null)return i;for(r in e=Array.isArray(i)?[]:{},i)t=i[r],e[r]=kl(t);return e}function Pf(i,e){var t,r;return i<=e?(t=e-i,r=i):(t=i-e,r=e),[t,r]}function Et(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length-i.length;return t>0?i=wl(i,t):e=wl(e,t),[i,e]}function lx(i,e){if(i)return i.length>e?i.slice(0,e-3)+"...":i}function cx(i){var e;if(typeof i=="number")e=i;else if(typeof i=="string"&&(e=Number(i),Number.isNaN(e)))return i;var t=Math.floor(Math.log10(Math.abs(e)));if(t<=2)return e;var r=Math.floor(t/3),s=Math.pow(10,t-3*r)*+(e/Math.pow(10,t)).toFixed(1);return Math.round(100*s)/100+["","K","M","B","T"][r]}function jf(i,e){for(var t=[],r=(Math.min(i.length,e.length),0);r<i.length;r++)t.push([i[r],e[r]]);var s=function(n,o,a,l){var c,u,p,m,w=(c=o||n,p=(u=a||n)[0]-c[0],m=u[1]-c[1],{length:Math.sqrt(Math.pow(p,2)+Math.pow(m,2)),angle:Math.atan2(m,p)}),x=w.angle+(l?Math.PI:0),A=.2*w.length;return[n[0]+Math.cos(x)*A,n[1]+Math.sin(x)*A]};return function(n,o){return n.reduce(function(a,l,c,u){return c===0?"".concat(l[0],",").concat(l[1]):"".concat(a," ").concat(o(l,c,u))},"")}(t,function(n,o,a){var l=s(a[o-1],a[o-2],n),c=s(n,a[o-1],a[o+1],!0);return"C ".concat(l[0],",").concat(l[1]," ").concat(c[0],",").concat(c[1]," ").concat(n[0],",").concat(n[1])})}function zf(i,e){return typeof i=="string"?(e||document).querySelector(i):i||null}function Ne(i,e){var t=document.createElementNS("http://www.w3.org/2000/svg",i);for(var r in e){var s=e[r];if(r==="inside")zf(s).appendChild(t);else if(r==="around"){var n=zf(s);n.parentNode.insertBefore(t,n),t.appendChild(n)}else r==="styles"?to(s)==="object"&&Object.keys(s).map(function(o){t.style[o]=s[o]}):(r==="className"&&(r="class"),r==="innerHTML"?t.textContent=s:t.setAttribute(r,s))}return t}function dx(i,e){return Ne("linearGradient",{inside:i,id:e,x1:0,x2:0,y1:0,y2:1})}function ml(i,e,t,r){return Ne("stop",{inside:i,style:"stop-color: ".concat(t),offset:e,"stop-opacity":r})}function xl(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,r={className:i,transform:e};return t&&(r.inside=t),Ne("g",r)}function mr(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"none",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"none",s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:2;return Ne("path",{className:e,d:i,styles:{stroke:t,fill:r,"stroke-width":s}})}function ux(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,o=t.x+i.x,a=t.y+i.y,l=t.x+e.x,c=t.y+e.y;return"M".concat(t.x," ").concat(t.y,`
		L`).concat(o," ").concat(a,`
		A `).concat(r," ").concat(r," 0 ").concat(n," ").concat(s?1:0,`
		`).concat(l," ").concat(c," z")}function px(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,o=t.x+i.x,a=t.y+i.y,l=t.x+e.x,c=2*t.y,u=t.y+e.y;return"M".concat(t.x," ").concat(t.y,`
		L`).concat(o," ").concat(a,`
		A `).concat(r," ").concat(r," 0 ").concat(n," ").concat(s?1:0,`
		`).concat(l," ").concat(c,` z
		L`).concat(o," ").concat(c,`
		A `).concat(r," ").concat(r," 0 ").concat(n," ").concat(s?1:0,`
		`).concat(l," ").concat(u," z")}function hx(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,o=t.x+i.x,a=t.y+i.y,l=t.x+e.x,c=t.y+e.y;return"M".concat(o," ").concat(a,`
		A `).concat(r," ").concat(r," 0 ").concat(n," ").concat(s?1:0,`
		`).concat(l," ").concat(c)}function fx(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,o=t.x+i.x,a=t.y+i.y,l=t.x+e.x,c=2*r+a,u=t.y+i.y;return"M".concat(o," ").concat(a,`
		A `).concat(r," ").concat(r," 0 ").concat(n," ").concat(s?1:0,`
		`).concat(l," ").concat(c,`
		M`).concat(o," ").concat(c,`
		A `).concat(r," ").concat(r," 0 ").concat(n," ").concat(s?1:0,`
		`).concat(l," ").concat(u)}function Ff(i,e){var t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r="path-fill-gradient-"+e+"-"+(t?"lighter":"default"),s=dx(i,r),n=[1,.6,.2];return t&&(n=[.15,.05,0]),ml(s,"0%",e,n[0]),ml(s,"50%",e,n[1]),ml(s,"100%",e,n[2]),r}function _x(i,e,t){var r=t/2,s=e-r;return"M".concat(i,",0 h").concat(s," q").concat(r,",0 ").concat(r,",").concat(r," q0,").concat(r," -").concat(r,",").concat(r," h-").concat(s," v").concat(t,"z")}function mx(i,e,t){var r=t/2,s=e-r;return"M".concat(i+r,",0 h").concat(s," v").concat(t," h-").concat(s," q-").concat(r,", 0 -").concat(r,",-").concat(r," q0,-").concat(r," ").concat(r,",-").concat(r,"z")}function t_(i,e,t,r,s){var n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"none",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:{},a={className:i,x:e,y:t,width:r,height:r,rx:s,fill:n};return Object.keys(o).map(function(l){a[l]=o[l]}),Ne("rect",a)}function i_(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"none",n=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,l=arguments.length>8&&arguments[8]!==void 0&&arguments[8];a||(a=10);var c={className:"legend-dot",x:0,y:4-t,height:t,width:t,rx:r,fill:s},u=Ne("text",{className:"legend-dataset-label",x:t,y:0,dx:a+"px",dy:a/3+"px","font-size":1.6*a+"px","text-anchor":"start",innerHTML:n=l?lx(n,18):n}),p=null;o&&(p=Ne("text",{className:"legend-dataset-value",x:t,y:20,dx:"10px",dy:10/3+"px","font-size":"12px","text-anchor":"start",innerHTML:o}));var m=Ne("g",{transform:"translate(".concat(i,", ").concat(e,")")});return m.appendChild(Ne("rect",c)),m.appendChild(u),o&&p&&m.appendChild(p),m}function Us(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},n=s.fontSize||10,o=s.dy!==void 0?s.dy:n/2,a=s.fill||"var(--charts-label-color)",l=s.textAnchor||"start";return Ne("text",{className:i,x:e,y:t,dy:o+"px","font-size":n+"px",fill:a,"text-anchor":l,innerHTML:r})}function gx(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},n=Ne("line",{className:"line-vertical "+s.className,x1:0,x2:0,y1:t,y2:r,styles:{stroke:s.stroke}}),o=Ne("text",{x:0,y:t>r?t+4:t-4-10,dy:"10px","font-size":"10px","text-anchor":"middle",innerHTML:e+""}),a=Ne("g",{transform:"translate(".concat(i,", 0)")});return a.appendChild(n),a.appendChild(o),a}function Hf(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};s.lineType||(s.lineType=""),s.shortenNumbers&&(e=s.numberFormatter?s.numberFormatter(e):cx(e));var n="line-horizontal "+s.className+(s.lineType==="dashed"?"dashed":""),o=Ne("line",{className:n,x1:t,x2:r,y1:0,y2:0,styles:{stroke:s.stroke}}),a=Ne("text",{x:t<r?t-4:t+4,y:0,dy:"3px","font-size":"10px","text-anchor":t<r?"end":"start",innerHTML:e+""}),l=Ne("g",{transform:"translate(0, ".concat(i,")"),"stroke-opacity":1});return a!==0&&a!=="0"||(l.style.stroke="rgba(27, 31, 35, 0.6)"),l.appendChild(o),l.appendChild(a),l}function qf(i,e,t,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,o=arguments.length>6&&arguments[6]!==void 0&&arguments[6],a=Ne("circle",{style:"fill: ".concat(r,"; ").concat(o?"stroke: ".concat(r):""),"data-point-index":n,cx:i,cy:e,r:t});if((s+="")||s.length){a.setAttribute("cy",0),a.setAttribute("cx",0);var l=Ne("text",{className:"data-point-value",x:0,y:0,dy:-5-t+"px","font-size":"10px","text-anchor":"middle",innerHTML:s}),c=Ne("g",{"data-point-index":n,transform:"translate(".concat(i,", ").concat(e,")")});return c.appendChild(a),c.appendChild(l),c}return a}var bx={bar:function(i){var e;i.nodeName!=="rect"&&(e=i.getAttribute("transform"),i=i.childNodes[0]);var t=i.cloneNode();return t.style.fill="#000000",t.style.opacity="0.4",e&&t.setAttribute("transform",e),t},dot:function(i){var e;i.nodeName!=="circle"&&(e=i.getAttribute("transform"),i=i.childNodes[0]);var t=i.cloneNode(),r=i.getAttribute("r"),s=i.getAttribute("fill");return t.setAttribute("r",parseInt(r)+4),t.setAttribute("fill",s),t.style.opacity="0.6",e&&t.setAttribute("transform",e),t},heat_square:function(i){var e;i.nodeName!=="circle"&&(e=i.getAttribute("transform"),i=i.childNodes[0]);var t=i.cloneNode(),r=i.getAttribute("r"),s=i.getAttribute("fill");return t.setAttribute("r",parseInt(r)+4),t.setAttribute("fill",s),t.style.opacity="0.6",e&&t.setAttribute("transform",e),t}},vx={bar:function(i,e){var t;i.nodeName!=="rect"&&(t=i.getAttribute("transform"),i=i.childNodes[0]);var r=["x","y","width","height"];Object.values(i.attributes).filter(function(s){return r.includes(s.name)&&s.specified}).map(function(s){e.setAttribute(s.name,s.nodeValue)}),t&&e.setAttribute("transform",t)},dot:function(i,e){var t;i.nodeName!=="circle"&&(t=i.getAttribute("transform"),i=i.childNodes[0]);var r=["cx","cy"];Object.values(i.attributes).filter(function(s){return r.includes(s.name)&&s.specified}).map(function(s){e.setAttribute(s.name,s.nodeValue)}),t&&e.setAttribute("transform",t)},heat_square:function(i,e){var t;i.nodeName!=="circle"&&(t=i.getAttribute("transform"),i=i.childNodes[0]);var r=["cx","cy"];Object.values(i.attributes).filter(function(s){return r.includes(s.name)&&s.specified}).map(function(s){e.setAttribute(s.name,s.nodeValue)}),t&&e.setAttribute("transform",t)}},yx={pink:"#F683AE",blue:"#318AD8",green:"#48BB74",grey:"#A6B1B9",red:"#F56B6B",yellow:"#FACF7A",purple:"#44427B",teal:"#5FD8C4",cyan:"#15CCEF",orange:"#F8814F","light-pink":"#FED7E5","light-blue":"#BFDDF7","light-green":"#48BB74","light-grey":"#F4F5F6","light-red":"#F6DFDF","light-yellow":"#FEE9BF","light-purple":"#E8E8F7","light-teal":"#D3FDF6","light-cyan":"#DDF8FD","light-orange":"#FECDB8"};function Hs(i,e,t,r){var s=typeof e=="string"?e:e.join(", ");return[i,{transform:t.join(", ")},r,"easein","translate",{transform:s}]}function Uf(i,e,t){return Hs(i,[0,t],[0,e],350)}function Wf(i,e){return[i,{d:e},350,"easein"]}var wx={ease:"0.25 0.1 0.25 1",linear:"0 0 1 1",easein:"0.1 0.8 0.2 1",easeout:"0 0 0.58 1",easeinout:"0.42 0 0.58 1"};function kx(i,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"linear",s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0,n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=i.cloneNode(!0),a=i.cloneNode(!0);for(var l in e){var c=void 0;c=l==="transform"?document.createElementNS("http://www.w3.org/2000/svg","animateTransform"):document.createElementNS("http://www.w3.org/2000/svg","animate");var u=n[l]||i.getAttribute(l),p=e[l],m={attributeName:l,from:u,to:p,begin:"0s",dur:t/1e3+"s",values:u+";"+p,keySplines:wx[r],keyTimes:"0;1",calcMode:"spline",fill:"freeze"};for(var w in s&&(m.type=s),m)c.setAttribute(w,m[w]);o.appendChild(c),s?a.setAttribute(l,"translate(".concat(p,")")):a.setAttribute(l,p)}return[o,a]}function Cl(i,e){i.style.transform=e,i.style.webkitTransform=e,i.style.msTransform=e,i.style.mozTransform=e,i.style.oTransform=e}function xx(i,e){var t=[],r=[];e.map(function(n){var o,a,l=n[0],c=l.parentNode;n[0]=l;var u=ct(kx.apply(void 0,jt(n)),2);o=u[0],a=u[1],t.push(a),r.push([o,c]),c.replaceChild(o,l)});var s=i.cloneNode(!0);return r.map(function(n,o){n[1].replaceChild(t[o],n[0]),e[o][0]=t[o]}),s}function Cx(i,e,t){if(t.length!==0){var r=xx(e,t);e.parentNode==i&&(i.removeChild(e),i.appendChild(r)),setTimeout(function(){r.parentNode==i&&(i.removeChild(r),i.appendChild(e))},250)}}var El=function(){function i(e,t){if(Vt(this,i),t=kl(t),this.parent=typeof e=="string"?document.querySelector(e):e,!(this.parent instanceof HTMLElement))throw new Error("No `parent` element to render on was provided.");this.rawChartArgs=t,this.title=t.title||"",this.type=t.type||"",this.realData=this.prepareData(t.data),this.data=this.prepareFirstData(this.realData),this.colors=this.validateColors(t.colors,this.type),this.config={showTooltip:1,showLegend:t.showLegend!==void 0?t.showLegend:1,isNavigable:t.isNavigable||0,animate:t.animate!==void 0?t.animate:1,disableEntryAnimation:t.disableEntryAnimation||0,truncateLegends:t.truncateLegends!==void 0?t.truncateLegends:1},this.measures=JSON.parse(JSON.stringify(nx));var r=this.measures;this.setMeasures(t),this.title.length||(r.titleHeight=0),this.config.showLegend||(r.legendHeight=0),this.argHeight=t.height||r.baseHeight,this.state={},this.options={},this.initTimeout=700,this.config.isNavigable&&(this.overlays=[]),this.configure(t)}return ai(i,[{key:"prepareData",value:function(e){return e}},{key:"prepareFirstData",value:function(e){return e}},{key:"validateColors",value:function(e,t){var r=[];return(e=(e||[]).concat(ox[t])).forEach(function(s){var n=function(o){return/rgb[a]{0,1}\([\d, ]+\)/gim.test(o)?/\D+(\d*)\D+(\d*)\D+(\d*)/gim.exec(o).map(function(a,l){return l!==0?Number(a).toString(16):"#"}).reduce(function(a,l){return"".concat(a).concat(l)}):yx[o]||o}(s);(function(o){return/(^\s*)(#)((?:[A-Fa-f0-9]{3}){1,2})$/i.test(o)||/(^\s*)(rgb|hsl)(a?)[(]\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*(?:,\s*([\d.]+)\s*)?[)]$/i.test(o)})(n)?r.push(n):console.warn('"'+s+'" is not a valid color.')}),r}},{key:"setMeasures",value:function(){}},{key:"configure",value:function(){var e=this,t=this.argHeight;this.baseHeight=t,this.height=t-Tl(this.measures),this.boundDrawFn=function(){return e.draw(!0)},ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.boundDrawFn),this.resizeObserver.observe(this.parent)),window.addEventListener("resize",this.boundDrawFn),window.addEventListener("orientationchange",this.boundDrawFn)}},{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),window.removeEventListener("resize",this.boundDrawFn),window.removeEventListener("orientationchange",this.boundDrawFn)}},{key:"setup",value:function(){this.makeContainer(),this.updateWidth(),this.makeTooltip(),this.draw(!1,!0)}},{key:"makeContainer",value:function(){this.parent.innerHTML="";var e={inside:this.parent,className:"chart-container"};this.independentWidth&&(e.styles={width:this.independentWidth+"px"}),this.container=vi.create("div",e)}},{key:"makeTooltip",value:function(){this.tip=new ax({parent:this.container,colors:this.colors}),this.bindTooltip()}},{key:"bindTooltip",value:function(){}},{key:"draw",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];t&&rx(this.parent)||(this.updateWidth(),this.calc(t),this.makeChartArea(),this.setupComponents(),this.components.forEach(function(s){return s.setup(e.drawArea)}),this.render(this.components,!1),r&&(this.data=this.realData,setTimeout(function(){e.update(e.data,!0)},this.initTimeout)),this.config.showLegend&&this.renderLegend(),this.setupNavigation(r))}},{key:"calc",value:function(){}},{key:"updateWidth",value:function(){var e,t,r;this.baseWidth=(e=this.parent,t=window.getComputedStyle(e),r=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),e.clientWidth-r),this.width=this.baseWidth-yl(this.measures)}},{key:"makeChartArea",value:function(){this.svg&&this.container.removeChild(this.svg);var e,t,r,s,n=this.measures;this.svg=(e=this.container,t="frappe-chart chart",r=this.baseWidth,s=this.baseHeight,Ne("svg",{className:t,inside:e,width:r,height:s})),this.svgDefs=Ne("defs",{inside:this.svg}),this.title.length&&(this.titleEL=Us("title",n.margins.left,n.margins.top,this.title,{fontSize:n.titleFontSize,fill:"#666666",dy:n.titleFontSize}));var o=eo(n);this.drawArea=xl(this.type+"-chart chart-draw-area","translate(".concat(Zn(n),", ").concat(o,")")),this.config.showLegend&&(o+=this.height+n.paddings.bottom,this.legendArea=xl("chart-legend","translate(".concat(Zn(n),", ").concat(o,")"))),this.title.length&&this.svg.appendChild(this.titleEL),this.svg.appendChild(this.drawArea),this.config.showLegend&&this.svg.appendChild(this.legendArea),this.updateTipOffset(Zn(n),eo(n))}},{key:"updateTipOffset",value:function(e,t){this.tip.offset={x:e,y:t}}},{key:"setupComponents",value:function(){this.components=new Map}},{key:"update",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];e||console.error("No data to update."),t||(e=kl(e));var r=t?!this.config.disableEntryAnimation:this.config.animate;this.data=this.prepareData(e),this.calc(),this.render(this.components,r)}},{key:"render",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.components,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.config.isNavigable&&this.overlays.map(function(n){return n.parentNode.removeChild(n)});var s=[];t.forEach(function(n){s=s.concat(n.update(r))}),s.length>0?(Cx(this.container,this.svg,s),setTimeout(function(){t.forEach(function(n){return n.make()}),e.updateNav()},400)):(t.forEach(function(n){return n.make()}),this.updateNav())}},{key:"updateNav",value:function(){this.config.isNavigable&&(this.makeOverlay(),this.bindUnits())}},{key:"renderLegend",value:function(e){var t=this;this.legendArea.textContent="";var r=0,s=0;e.map(function(n,o){var a=Math.floor(t.width/150);r>a&&(r=0,s+=t.config.legendRowHeight);var l=150*r,c=t.makeLegend(n,o,l,s);t.legendArea.appendChild(c),r++})}},{key:"makeLegend",value:function(){}},{key:"setupNavigation",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.config.isNavigable&&t&&(this.bindOverlay(),this.keyActions={13:this.onEnterKey.bind(this),37:this.onLeftArrow.bind(this),38:this.onUpArrow.bind(this),39:this.onRightArrow.bind(this),40:this.onDownArrow.bind(this)},document.addEventListener("keydown",function(r){sx(e.container)&&(r=r||window.event,e.keyActions[r.keyCode]&&e.keyActions[r.keyCode]())}))}},{key:"makeOverlay",value:function(){}},{key:"updateOverlay",value:function(){}},{key:"bindOverlay",value:function(){}},{key:"bindUnits",value:function(){}},{key:"onLeftArrow",value:function(){}},{key:"onRightArrow",value:function(){}},{key:"onUpArrow",value:function(){}},{key:"onDownArrow",value:function(){}},{key:"onEnterKey",value:function(){}},{key:"addDataPoint",value:function(){}},{key:"removeDataPoint",value:function(){}},{key:"getDataPoint",value:function(){}},{key:"setCurrentDataPoint",value:function(){}},{key:"updateDataset",value:function(){}},{key:"export",value:function(){var e=function(t){var r=t.cloneNode(!0);r.classList.add("chart-container"),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var s=vi.create("style",{innerHTML:".chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ul{padding-left:0;display:flex}.graph-svg-tip ol{padding-left:0;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:' ';border:5px solid transparent;}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}"});r.insertBefore(s,r.firstChild);var n=vi.create("div");return n.appendChild(r),n.innerHTML}(this.svg);(function(t,r){var s=document.createElement("a");s.style="display: none";var n=new Blob(r,{type:"image/svg+xml; charset=utf-8"}),o=window.URL.createObjectURL(n);s.href=o,s.download=t,document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s),window.URL.revokeObjectURL(o)},300)})(this.title||"Chart",[e])}}]),i}(),r_=function(i){br(t,El);var e=vr(t);function t(r,s){return Vt(this,t),e.call(this,r,s)}return ai(t,[{key:"configure",value:function(r){Pt(xt(t.prototype),"configure",this).call(this,r),this.config.formatTooltipY=(r.tooltipOptions||{}).formatTooltipY,this.config.maxSlices=r.maxSlices||20,this.config.maxLegendPoints=r.maxLegendPoints||20,this.config.legendRowHeight=60}},{key:"calc",value:function(){var r=this,s=this.state,n=this.config.maxSlices;s.sliceTotals=[];var o=this.data.labels.map(function(u,p){var m=0;return r.data.datasets.map(function(w){m+=w.values[p]}),[m,u]}).filter(function(u){return u[0]>=0}),a=o;if(o.length>n){o.sort(function(u,p){return p[0]-u[0]}),a=o.slice(0,n-1);var l=o.slice(n-1),c=0;l.map(function(u){c+=u[0]}),a.push([c,"Rest"]),this.colors[n-1]="grey"}s.labels=[],a.map(function(u){s.sliceTotals.push(e_(u[0])),s.labels.push(u[1])}),s.grandTotal=s.sliceTotals.reduce(function(u,p){return u+p},0),this.center={x:this.width/2,y:this.height/2}}},{key:"renderLegend",value:function(){var r=this.state;this.legendArea.textContent="",this.legendTotals=r.sliceTotals.slice(0,this.config.maxLegendPoints),Pt(xt(t.prototype),"renderLegend",this).call(this,this.legendTotals)}},{key:"makeLegend",value:function(r,s,n,o){var a=this.config.formatTooltipY?this.config.formatTooltipY(r):r;return i_(n,o,12,3,this.colors[s],this.state.labels[s],a,null,this.config.truncateLegends)}}]),t}(),Sx=["January","February","March","April","May","June","July","August","September","October","November","December"],Tx=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function Vf(i){var e=new Date(i);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e}function gl(i){var e=i.getDate(),t=i.getMonth()+1;return[i.getFullYear(),(t>9?"":"0")+t,(e>9?"":"0")+e].join("-")}function Di(i){return new Date(i.getTime())}function bl(i,e){var t=n_(i);return Math.ceil(function(r,s){return(Vf(s)-Vf(r))/864e5}(t,e)/7)}function Ex(i,e){return i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()}function s_(i){var e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=Sx[i];return e?t.slice(0,3):t}function Yf(i,e){return new Date(e,i+1,0)}function n_(i){var e=Di(i),t=e.getDay();return t!==0&&gr(e,-1*t),e}function gr(i,e){i.setDate(i.getDate()+e)}var $x=function(){function i(e){var t=e.layerClass,r=t===void 0?"":t,s=e.layerTransform,n=s===void 0?"":s,o=e.constants,a=e.getData,l=e.makeElements,c=e.animateElements;Vt(this,i),this.layerTransform=n,this.constants=o,this.makeElements=l,this.getData=a,this.animateElements=c,this.store=[],this.labels=[],this.layerClass=r,this.layerClass=typeof this.layerClass=="function"?this.layerClass():this.layerClass,this.refresh()}return ai(i,[{key:"refresh",value:function(e){this.data=e||this.getData()}},{key:"setup",value:function(e){this.layer=xl(this.layerClass,this.layerTransform,e)}},{key:"make",value:function(){this.render(this.data),this.oldData=this.data}},{key:"render",value:function(e){var t=this;this.store=this.makeElements(e),this.layer.textContent="",this.store.forEach(function(r){t.layer.appendChild(r)}),this.labels.forEach(function(r){t.layer.appendChild(r)})}},{key:"update",value:function(){var e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];this.refresh();var t=[];return e&&(t=this.animateElements(this.data)||[]),t}}]),i}(),Gf={donutSlices:{layerClass:"donut-slices",makeElements:function(i){return i.sliceStrings.map(function(e,t){var r=mr(e,"donut-path",i.colors[t],"none",i.strokeWidth);return r.style.transition="transform .3s;",r})},animateElements:function(i){return this.store.map(function(e,t){return Wf(e,i.sliceStrings[t])})}},pieSlices:{layerClass:"pie-slices",makeElements:function(i){return i.sliceStrings.map(function(e,t){var r=mr(e,"pie-path","none",i.colors[t]);return r.style.transition="transform .3s;",r})},animateElements:function(i){return this.store.map(function(e,t){return Wf(e,i.sliceStrings[t])})}},percentageBars:{layerClass:"percentage-bars",makeElements:function(i){var e=this,t=i.xPositions.length;return i.xPositions.map(function(r,s){var n=s==t-1,o=s==0;return function(a,l,c,u,p,m){var w=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"none";if(m){var x=_x(a,c,u);return mr(x,"percentage-bar",null,w)}if(p){var A=mx(a,c,u);return mr(A,"percentage-bar",null,w)}var D={className:"percentage-bar",x:a,y:l,width:c,height:u,fill:w};return Ne("rect",D)}(r,0,i.widths[s],e.constants.barHeight,o,n,i.colors[s])})},animateElements:function(i){if(i)return[]}},yAxis:{layerClass:"y axis",makeElements:function(i){var e=this;return i.positions.map(function(t,r){return function(s,n,o){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Ri(s)||(s=0),a.pos||(a.pos="left"),a.offset||(a.offset=0),a.mode||(a.mode="span"),a.stroke||(a.stroke="#E2E6E9"),a.className||(a.className="");var l=-6,c=a.mode==="span"?o+6:0;return a.mode==="tick"&&a.pos==="right"&&(l=o+6,c=o),l+=a.offset,c+=a.offset,typeof n=="number"&&(n=e_(n)),Hf(s,n,l,c,{className:a.className,lineType:a.lineType,shortenNumbers:a.shortenNumbers,numberFormatter:a.numberFormatter})}(t,i.labels[r],e.constants.width,{mode:e.constants.mode,pos:e.constants.pos,shortenNumbers:e.constants.shortenNumbers,numberFormatter:e.constants.numberFormatter})})},animateElements:function(i){var e=i.positions,t=i.labels,r=this.oldData.positions,s=this.oldData.labels,n=ct(Et(r,e),2);r=n[0],e=n[1];var o=ct(Et(s,t),2);return s=o[0],t=o[1],this.render({positions:r,labels:t}),this.store.map(function(a,l){return Uf(a,e[l],r[l])})}},xAxis:{layerClass:"x axis",makeElements:function(i){var e=this;return i.positions.map(function(t,r){return function(s,n,o){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Ri(s)||(s=0),a.pos||(a.pos="bottom"),a.offset||(a.offset=0),a.mode||(a.mode="span"),a.className||(a.className="");var l=o+6,c=a.mode==="span"?-6:o;return a.mode==="tick"&&a.pos==="top"&&(l=-6,c=0),gx(s,n,l,c,{className:a.className,lineType:a.lineType})}(t,i.calcLabels[r],e.constants.height,{mode:e.constants.mode,pos:e.constants.pos})})},animateElements:function(i){var e=i.positions,t=i.calcLabels,r=this.oldData.positions,s=this.oldData.calcLabels,n=ct(Et(r,e),2);r=n[0],e=n[1];var o=ct(Et(s,t),2);return s=o[0],t=o[1],this.render({positions:r,calcLabels:t}),this.store.map(function(a,l){return function(c,u,p){return Hs(c,[p,0],[u,0],350)}(a,e[l],r[l])})}},yMarkers:{layerClass:"y-markers",makeElements:function(i){var e=this;return i.map(function(t){return function(r,s,n){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Ri(r)||(r=0),o.labelPos||(o.labelPos="right"),o.lineType||(o.lineType="dashed");var a=o.labelPos==="left"?4:n-Df(s,5)-4,l=Ne("text",{className:"chart-label",x:a,y:0,dy:"-5px","font-size":"10px","text-anchor":"start",innerHTML:s+""}),c=Hf(r,"",0,n,{stroke:o.stroke||"#E2E6E9",className:o.className||"",lineType:o.lineType});return c.appendChild(l),c}(t.position,t.label,e.constants.width,{labelPos:t.options.labelPos,stroke:t.options.stroke,mode:"span",lineType:t.options.lineType})})},animateElements:function(i){var e=ct(Et(this.oldData,i),2);this.oldData=e[0];var t=(i=e[1]).map(function(o){return o.position}),r=i.map(function(o){return o.label}),s=i.map(function(o){return o.options}),n=this.oldData.map(function(o){return o.position});return this.render(n.map(function(o,a){return{position:n[a],label:r[a],options:s[a]}})),this.store.map(function(o,a){return Uf(o,t[a],n[a])})}},yRegions:{layerClass:"y-regions",makeElements:function(i){var e=this;return i.map(function(t){return function(r,s,n,o){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},l=r-s,c=Ne("rect",{className:"bar mini",styles:{fill:a.fill||"rgba(228, 234, 239, 0.49)",stroke:a.stroke||"#E2E6E9","stroke-dasharray":"".concat(n,", ").concat(l)},x:0,y:0,width:n,height:l});a.labelPos||(a.labelPos="right");var u=a.labelPos==="left"?4:n-Df(o+"",4.5)-4,p=Ne("text",{className:"chart-label",x:u,y:0,dy:"-5px","font-size":"10px","text-anchor":"start",innerHTML:o+""}),m=Ne("g",{transform:"translate(0, ".concat(s,")")});return m.appendChild(c),m.appendChild(p),m}(t.startPos,t.endPos,e.constants.width,t.label,{labelPos:t.options.labelPos,stroke:t.options.stroke,fill:t.options.fill})})},animateElements:function(i){var e=ct(Et(this.oldData,i),2);this.oldData=e[0];var t=(i=e[1]).map(function(c){return c.endPos}),r=i.map(function(c){return c.label}),s=i.map(function(c){return c.startPos}),n=i.map(function(c){return c.options}),o=this.oldData.map(function(c){return c.endPos}),a=this.oldData.map(function(c){return c.startPos});this.render(o.map(function(c,u){return{startPos:a[u],endPos:o[u],label:r[u],options:n[u]}}));var l=[];return this.store.map(function(c,u){l=l.concat(function(p,m,w,x){var A=m-w,D=p.childNodes[0],j=D.getAttribute("width");return[[D,{height:A,"stroke-dasharray":"".concat(j,", ").concat(A)},350,"easein"],Hs(p,[0,x],[0,w],350)]}(c,s[u],t[u],o[u]))}),l}},heatDomain:{layerClass:function(){return"heat-domain domain-"+this.constants.index},makeElements:function(i){var e=this,t=this.constants,r=t.index,s=t.colWidth,n=t.rowHeight,o=t.squareSize,a=t.radius,l=t.xTranslate,c=l,u=0;return this.serializedSubDomains=[],i.cols.map(function(p,m){m===1&&e.labels.push(Us("domain-name",c,-12,s_(r,!0).toUpperCase(),{fontSize:9})),p.map(function(w,x){if(w.fill){var A={"data-date":w.yyyyMmDd,"data-value":w.dataValue,"data-day":x},D=t_("day",c,u,o,a,w.fill,A);e.serializedSubDomains.push(D)}u+=n}),u=0,c+=s}),this.serializedSubDomains},animateElements:function(i){if(i)return[]}},barGraph:{layerClass:function(){return"dataset-units dataset-bars dataset-"+this.constants.index},makeElements:function(i){var e=this.constants;return this.unitType="bar",this.units=i.yPositions.map(function(t,r){return function(s,n,o,a){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0,p=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{},m=Pf(n,p.zeroLine),w=ct(m,2),x=w[0],A=w[1];A-=u,x===0&&(x=p.minHeight,A-=p.minHeight),Ri(s)||(s=0),Ri(A)||(A=0),Ri(x,!0)||(x=0),Ri(o,!0)||(o=0);var D=Ne("rect",{className:"bar mini",style:"fill: ".concat(a),"data-point-index":c,x:s,y:A,width:o,height:x});if((l+="")||l.length){D.setAttribute("y",0),D.setAttribute("x",0);var j=Ne("text",{className:"data-point-value",x:o/2,y:0,dy:"-5px","font-size":"10px","text-anchor":"middle",innerHTML:l}),ee=Ne("g",{"data-point-index":c,transform:"translate(".concat(s,", ").concat(A,")")});return ee.appendChild(D),ee.appendChild(j),ee}return D}(i.xPositions[r],t,i.barWidth,e.color,i.labels[r],r,i.offsets[r],{zeroLine:i.zeroLine,barsWidth:i.barsWidth,minHeight:e.minHeight})}),this.units},animateElements:function(i){var e=i.xPositions,t=i.yPositions,r=i.offsets,s=i.labels,n=this.oldData.xPositions,o=this.oldData.yPositions,a=this.oldData.offsets,l=this.oldData.labels,c=ct(Et(n,e),2);n=c[0],e=c[1];var u=ct(Et(o,t),2);o=u[0],t=u[1];var p=ct(Et(a,r),2);a=p[0],r=p[1];var m=ct(Et(l,s),2);l=m[0],s=m[1],this.render({xPositions:n,yPositions:o,offsets:a,labels:s,zeroLine:this.oldData.zeroLine,barsWidth:this.oldData.barsWidth,barWidth:this.oldData.barWidth});var w=[];return this.store.map(function(x,A){w=w.concat(function(D,j,ee,d){var g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,_=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},y=Pf(ee,_.zeroLine),O=ct(y,2),E=O[0],k=O[1];if(k-=g,D.nodeName!=="rect"){var M=D.childNodes[0],q=[M,{width:d,height:E},350,"easein"],Y=D.getAttribute("transform").split("(")[1].slice(0,-1),F=Hs(D,Y,[j,k],350);return[q,F]}return[[D,{width:d,height:E,x:j,y:k},350,"easein"]]}(x,e[A],t[A],i.barWidth,r[A],{zeroLine:i.zeroLine}))}),w}},lineGraph:{layerClass:function(){return"dataset-units dataset-line dataset-"+this.constants.index},makeElements:function(i){var e=this.constants;if(this.unitType="dot",this.paths={},e.hideLine||(this.paths=function(s,n,o){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},c=n.map(function(D,j){return s[j]+","+D}),u=c.join("L");a.spline&&(u=jf(s,n));var p=mr("M"+u,"line-graph-path",o);if(a.heatline){var m=Ff(l.svgDefs,o);p.style.stroke="url(#".concat(m,")")}var w={path:p};if(a.regionFill){var x=Ff(l.svgDefs,o,!0),A="M"+"".concat(s[0],",").concat(l.zeroLine,"L")+u+"L".concat(s.slice(-1)[0],",").concat(l.zeroLine);w.region=mr(A,"region-fill","none","url(#".concat(x,")"))}return w}(i.xPositions,i.yPositions,e.color,{heatline:e.heatline,regionFill:e.regionFill,spline:e.spline},{svgDefs:e.svgDefs,zeroLine:i.zeroLine})),this.units=[],e.showDots&&(this.units=i.yPositions.map(function(s,n){return qf(i.xPositions[n],s,i.radius,e.color,e.valuesOverPoints?i.values[n]:"",n,e.hideDotBorder)})),e.trailingDot&&!e.showDots){var t=i.yPositions.length-1,r=qf(i.xPositions[t],i.yPositions[t],i.radius,e.color,e.valuesOverPoints?i.values[t]:"",t,e.hideDotBorder);this.units.push(r)}return Object.values(this.paths).concat(this.units)},animateElements:function(i){var e=i.xPositions,t=i.yPositions,r=i.values,s=this.oldData.xPositions,n=this.oldData.yPositions,o=this.oldData.values,a=ct(Et(s,e),2);s=a[0],e=a[1];var l=ct(Et(n,t),2);n=l[0],t=l[1];var c=ct(Et(o,r),2);o=c[0],r=c[1],this.render({xPositions:s,yPositions:n,values:r,zeroLine:this.oldData.zeroLine,radius:this.oldData.radius});var u=[];return Object.keys(this.paths).length&&(u=u.concat(function(p,m,w,x,A){var D=[],j=w.map(function(y,O){return m[O]+","+y}).join("L");A&&(j=jf(m,w));var ee=[p.path,{d:"M"+j},350,"easein"];if(D.push(ee),p.region){var d="".concat(m[0],",").concat(x,"L"),g="L".concat(m.slice(-1)[0],", ").concat(x),_=[p.region,{d:"M"+d+j+g},350,"easein"];D.push(_)}return D}(this.paths,e,t,i.zeroLine,this.constants.spline))),this.units.length&&this.units.map(function(p,m){u=u.concat(function(w,x,A){if(w.nodeName!=="circle"){var D=w.getAttribute("transform").split("(")[1].slice(0,-1);return[Hs(w,D,[x,A],350)]}return[[w,{cx:x,cy:A},350,"easein"]]}(p,e[m],t[m]))}),u}}};function Ws(i,e,t){var r=Object.keys(Gf).filter(function(n){return i.includes(n)}),s=Gf[r[0]];return Object.assign(s,{constants:e,getData:t}),new $x(s)}var Ox=function(i){br(t,r_);var e=vr(t);function t(r,s){var n;return Vt(this,t),(n=e.call(this,r,s)).type="percentage",n.setup(),n}return ai(t,[{key:"setMeasures",value:function(r){var s=this.measures;this.barOptions=r.barOptions||{};var n=this.barOptions;n.height=n.height||16,s.paddings.right=30,s.paddings.top=60,s.paddings.bottom=0,s.legendHeight=80,s.baseHeight=8*n.height+Tl(s)}},{key:"setupComponents",value:function(){var r=this.state,s=[["percentageBars",{barHeight:this.barOptions.height},function(){return{xPositions:r.xPositions,widths:r.widths,colors:this.colors}}.bind(this)]];this.components=new Map(s.map(function(n){var o=Ws.apply(void 0,jt(n));return[n[0],o]}))}},{key:"calc",value:function(){var r=this;Pt(xt(t.prototype),"calc",this).call(this);var s=this.state;s.xPositions=[],s.widths=[];var n=0;s.sliceTotals.map(function(o){var a=r.width*o/s.grandTotal;s.widths.push(a),s.xPositions.push(n),n+=a})}},{key:"makeDataByIndex",value:function(){}},{key:"bindTooltip",value:function(){var r=this,s=this.state;this.container.addEventListener("mousemove",function(n){var o=r.components.get("percentageBars").store,a=n.target;if(o.includes(a)){var l=o.indexOf(a),c=Qn(r.container),u=Qn(a),p=a.getAttribute("width")||a.getBoundingClientRect().width,m=u.left-c.left+parseInt(p)/2,w=u.top-c.top,x=(r.formattedLabels&&r.formattedLabels.length>0?r.formattedLabels[l]:r.state.labels[l])+": ",A=s.sliceTotals[l]/s.grandTotal;r.tip.setValues(m,w,{name:x,value:(100*A).toFixed(1)+"%"}),r.tip.showTip()}})}}]),t}(),Kf=function(i){br(t,r_);var e=vr(t);function t(r,s){var n;return Vt(this,t),(n=e.call(this,r,s)).initTimeout=0,n.init=1,n.setup(),n}return ai(t,[{key:"configure",value:function(r){Pt(xt(t.prototype),"configure",this).call(this,r),this.mouseMove=this.mouseMove.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.hoverRadio=r.hoverRadio||.1,this.config.startAngle=r.startAngle||0,this.type="pie",this.sliceName="pieSlices",this.arcFunc=ux,this.shapeFunc=px,this.clockWise=r.clockWise||!1}},{key:"getRadius",value:function(){return this.height>this.width?this.center.x:this.center.y}},{key:"calc",value:function(){var r=this;Pt(xt(t.prototype),"calc",this).call(this);var s=this.state;this.radius=this.getRadius();var n=this.radius,o=this.clockWise,a=s.slicesProperties||[];s.sliceStrings=[],s.slicesProperties=[];var l=180-this.config.startAngle;s.sliceTotals.map(function(c,u){var p,m,w=l,x=c/s.grandTotal*360,A=x>180?1:0,D=o?-x:x,j=l+=D,ee=_l(w,n),d=_l(j,n),g=r.init&&a[u];r.init?(p=g?g.startPosition:ee,m=g?g.endPosition:ee):(p=ee,m=d);var _=x===360?r.shapeFunc(p,m,r.center,r.radius,o,A):r.arcFunc(p,m,r.center,r.radius,o,A);s.sliceStrings.push(_),s.slicesProperties.push({startPosition:ee,endPosition:d,value:c,total:s.grandTotal,startAngle:w,endAngle:j,angle:D})}),this.init=0}},{key:"setupComponents",value:function(){var r=this.state,s=[["pieSlices",{},function(){return{sliceStrings:r.sliceStrings,colors:this.colors}}.bind(this)]];this.components=new Map(s.map(function(n){var o=Ws.apply(void 0,jt(n));return[n[0],o]}))}},{key:"calTranslateByAngle",value:function(r){var s=this.radius,n=this.hoverRadio,o=_l(r.startAngle+r.angle/2,s);return"translate3d(".concat(o.x*n,"px,").concat(o.y*n,"px,0)")}},{key:"hoverSlice",value:function(r,s,n,o){if(r){var a=this.colors[s];if(n){Cl(r,this.calTranslateByAngle(this.state.slicesProperties[s]));var l=Qn(this.svg),c=o.pageX-l.left+10,u=o.pageY-l.top-10,p=(this.formatted_labels&&this.formatted_labels.length>0?this.formatted_labels[s]:this.state.labels[s])+": ",m=(100*this.state.sliceTotals[s]/this.state.grandTotal).toFixed(1);this.tip.setValues(c,u,{name:p,value:m+"%"}),this.tip.showTip()}else this.resetHover(r,a)}}},{key:"resetHover",value:function(r,s){Cl(r,"translate3d(0,0,0)"),this.tip.hideTip(),r.style.fill=s}},{key:"bindTooltip",value:function(){this.container.addEventListener("mousemove",this.mouseMove),this.container.addEventListener("mouseleave",this.mouseLeave)}},{key:"mouseMove",value:function(r){var s=r.target,n=this.components.get(this.sliceName).store,o=this.curActiveSliceIndex,a=this.curActiveSlice;if(n.includes(s)){var l=n.indexOf(s);this.hoverSlice(a,o,!1),this.curActiveSlice=s,this.curActiveSliceIndex=l,this.hoverSlice(s,l,!0,r)}else this.mouseLeave()}},{key:"mouseLeave",value:function(){this.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,!1)}}]),t}();function qs(i){if(i===0)return[0,0];if(isNaN(i))return{mantissa:-6755399441055744,exponent:972};var e=i>0?1:-1;if(!isFinite(i))return{mantissa:4503599627370496*e,exponent:972};i=Math.abs(i);var t=Math.floor(Math.log10(i));return[e*(i/Math.pow(10,t)),t]}function Ax(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.ceil(i),r=Math.floor(e),s=t-r,n=s,o=1;s>5&&(s%2!=0&&(s=++t-r),n=s/2,o=2),s<=2&&(o=s/(n=4)),s===0&&(n=5,o=1);for(var a=[],l=0;l<=n;l++)a.push(r+o*l);return a}function Fs(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=qs(i),r=ct(t,2),s=r[0],n=r[1],o=e?e/Math.pow(10,n):0,a=Ax(s=s.toFixed(6),o);return a=a.map(function(l){return l*Math.pow(10,n)})}function Lx(i){var e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=Math.max.apply(Math,jt(i)),s=Math.min.apply(Math,jt(i));t.max!==void 0&&(r=r>t.max?r:t.max),t.min!==void 0&&(s=s<t.min?s:t.min);var n=[];function o(p,m){for(var w=Fs(p),x=w[1]-w[0],A=0,D=1;A<m;D++)A+=x,w.unshift(-1*A);return w}if(r>=0&&s>=0)qs(r)[1],n=e?Fs(r,s):Fs(r);else if(r>0&&s<0){var a=Math.abs(s);if(r>=a)qs(r)[1],n=o(r,a);else{qs(a)[1];var l=o(a,r);n=l.reverse().map(function(p){return-1*p})}}else if(r<=0&&s<=0){var c=Math.abs(s),u=Math.abs(r);qs(c)[1],n=(n=e?Fs(c,u):Fs(c)).reverse().map(function(p){return-1*p})}return n}function Bx(i){var e,t=o_(i);return i.indexOf(0)>=0?e=i.indexOf(0):i[0]>0?e=-1*i[0]/t:e=-1*i[i.length-1]/t+(i.length-1),e}function o_(i){return i[1]-i[0]}function Ix(i){return i[i.length-1]-i[0]}function Jn(i,e){return Qf(e.zeroLine-i*e.scaleMultiplier)}var Mx=function(i){br(t,El);var e=vr(t);function t(r,s){var n;Vt(this,t),(n=e.call(this,r,s)).type="heatmap",n.countLabel=s.countLabel||"";var o=["Sunday","Monday"],a=o.includes(s.startSubDomain)?s.startSubDomain:"Sunday";return n.startSubDomainIndex=o.indexOf(a),n.setup(),n}return ai(t,[{key:"setMeasures",value:function(r){var s=this.measures;this.discreteDomains=r.discreteDomains===0?0:1,s.paddings.top=36,s.paddings.bottom=0,s.legendHeight=24,s.baseHeight=84+Tl(s);var n=this.data,o=this.discreteDomains?12:0;this.independentWidth=12*(bl(n.start,n.end)+o)+yl(s)}},{key:"updateWidth",value:function(){var r=this.discreteDomains?12:0,s=this.state.noOfWeeks?this.state.noOfWeeks:52;this.baseWidth=12*(s+r)+yl(this.measures)}},{key:"prepareData",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.data;if(r.start&&r.end&&r.start>r.end)throw new Error("Start date cannot be greater than end date.");if(r.start||(r.start=new Date,r.start.setFullYear(r.start.getFullYear()-1)),r.end||(r.end=new Date),r.dataPoints=r.dataPoints||{},parseInt(Object.keys(r.dataPoints)[0])>1e5){var s={};Object.keys(r.dataPoints).forEach(function(n){var o=new Date(1e3*n);s[gl(o)]=r.dataPoints[n]}),r.dataPoints=s}return r}},{key:"calc",value:function(){var r=this.state;r.start=Di(this.data.start),r.end=Di(this.data.end),r.firstWeekStart=Di(r.start),r.noOfWeeks=bl(r.start,r.end),r.distribution=function(s,n){for(var o=Math.max.apply(Math,jt(s)),a=1/(n-1),l=[],c=0;c<n;c++){var u=o*(a*c);l.push(u)}return l}(Object.values(this.data.dataPoints),5),r.domainConfigs=this.getDomains()}},{key:"setupComponents",value:function(){var r=this,s=this.state,n=this.discreteDomains?0:1,o=s.domainConfigs.map(function(l,c){return["heatDomain",{index:l.index,colWidth:12,rowHeight:12,squareSize:10,radius:r.rawChartArgs.radius||0,xTranslate:12*s.domainConfigs.filter(function(u,p){return p<c}).map(function(u){return u.cols.length-n}).reduce(function(u,p){return u+p},0)},function(){return s.domainConfigs[c]}.bind(r)]});this.components=new Map(o.map(function(l,c){var u=Ws.apply(void 0,jt(l));return[l[0]+"-"+c,u]}));var a=0;Tx.forEach(function(l,c){if([1,3,5].includes(c)){var u=Us("subdomain-name",-6,a,l,{fontSize:10,dy:8,textAnchor:"end"});r.drawArea.appendChild(u)}a+=12})}},{key:"update",value:function(r){r||console.error("No data to update."),this.data=this.prepareData(r),this.draw(),this.bindTooltip()}},{key:"bindTooltip",value:function(){var r=this;this.container.addEventListener("mousemove",function(s){r.components.forEach(function(n){var o=n.store,a=s.target;if(o.includes(a)){var l=a.getAttribute("data-value"),c=a.getAttribute("data-date").split("-"),u=s_(parseInt(c[1])-1,!0),p=r.container.getBoundingClientRect(),m=a.getBoundingClientRect(),w=parseInt(s.target.getAttribute("width")),x=m.left-p.left+w/2,A=m.top-p.top,D=l+" "+r.countLabel,j=" on "+u+" "+c[0]+", "+c[2];r.tip.setValues(x,A,{name:j,value:D,valueFirst:1},[]),r.tip.showTip()}})})}},{key:"renderLegend",value:function(){var r=this;this.legendArea.textContent="";var s=0,n=this.rawChartArgs.radius||0,o=Us("subdomain-name",s,12,"Less",{fontSize:11,dy:9});s=30,this.legendArea.appendChild(o),this.colors.slice(0,5).map(function(l,c){var u=t_("heatmap-legend-unit",s+15*c,12,10,n,l);r.legendArea.appendChild(u)});var a=Us("subdomain-name",s+75+3,12,"More",{fontSize:11,dy:9});this.legendArea.appendChild(a)}},{key:"getDomains",value:function(){for(var r=this.state,s=[r.start.getMonth(),r.start.getFullYear()],n=s[0],o=s[1],a=[r.end.getMonth(),r.end.getFullYear()],l=a[0]-n+1+12*(a[1]-o),c=[],u=Di(r.start),p=0;p<l;p++){var m=r.end;if(!Ex(u,r.end)){var w=[u.getMonth(),u.getFullYear()];m=Yf(w[0],w[1])}c.push(this.getDomainConfig(u,m)),gr(m,1),u=m}return c}},{key:"getDomainConfig",value:function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=[r.getMonth(),r.getFullYear()],o=n[0],a=n[1],l=n_(r),c={index:o,cols:[]};gr(s=Di(s)||Yf(o,a),1);for(var u,p=bl(l,s),m=[],w=0;w<p;w++)u=this.getCol(l,o),m.push(u),gr(l=new Date(u[6].yyyyMmDd),1);return u[6].dataValue!==void 0&&(gr(l,1),m.push(this.getCol(l,o,!0))),c.cols=m,c}},{key:"getCol",value:function(r,s){for(var n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=this.state,a=Di(r),l=[],c=0;c<7;c++,gr(a,1)){var u={},p=a>=o.start&&a<=o.end;n||a.getMonth()!==s||!p?u.yyyyMmDd=gl(a):u=this.getSubDomainConfig(a),l.push(u)}return l}},{key:"getSubDomainConfig",value:function(r){var s,n,o=gl(r),a=this.data.dataPoints[o];return{yyyyMmDd:o,dataValue:a||0,fill:this.colors[s=a,n=this.state.distribution,n.filter(function(l){return l<s}).length]}}}]),t}();function Nx(i,e){i.labels=i.labels||[];var t=i.labels.length,r=i.datasets,s=new Array(t).fill(0);return r||(r=[{values:s}]),r.map(function(n){if(n.values){var o=n.values;o=(o=o.map(function(a){return isNaN(a)?0:a})).length>t?o.slice(0,t):wl(o,t-o.length,0),n.values=o}else n.values=s;n.chartType||(n.chartType=e)}),i.yRegions&&i.yRegions.map(function(n){if(n.end<n.start){var o=[n.end,n.start];n.start=o[0],n.end=o[1]}}),i}function Rx(i){var e=i.labels.length,t=new Array(e).fill(0),r={labels:i.labels.slice(0,-1),datasets:i.datasets.map(function(s){return{name:"",values:t.slice(0,-1),chartType:s.chartType}})};return i.yMarkers&&(r.yMarkers=[{value:0,label:""}]),i.yRegions&&(r.yRegions=[{start:0,end:0,label:""}]),r}var Sl=function(i){br(t,El);var e=vr(t);function t(r,s){var n;return Vt(this,t),(n=e.call(this,r,s)).barOptions=s.barOptions||{},n.lineOptions=s.lineOptions||{},n.type=s.type||"line",n.init=1,n.setup(),n}return ai(t,[{key:"setMeasures",value:function(){this.data.datasets.length<=1&&(this.config.showLegend=0,this.measures.paddings.bottom=30)}},{key:"configure",value:function(r){Pt(xt(t.prototype),"configure",this).call(this,r),r.axisOptions=r.axisOptions||{},r.tooltipOptions=r.tooltipOptions||{},this.config.xAxisMode=r.axisOptions.xAxisMode||"span",this.config.yAxisMode=r.axisOptions.yAxisMode||"span",this.config.xIsSeries=r.axisOptions.xIsSeries||0,this.config.shortenYAxisNumbers=r.axisOptions.shortenYAxisNumbers||0,this.config.numberFormatter=r.axisOptions.numberFormatter,this.config.seriesLabelSpaceRatio=r.axisOptions.seriesLabelSpaceRatio,this.config.yAxisRange=r.axisOptions.yAxisRange||{},this.config.formatTooltipX=r.tooltipOptions.formatTooltipX,this.config.formatTooltipY=r.tooltipOptions.formatTooltipY,this.config.valuesOverPoints=r.valuesOverPoints,this.config.legendRowHeight=30}},{key:"prepareData",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.data;return Nx(r,this.type)}},{key:"prepareFirstData",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.data;return Rx(r)}},{key:"calc",value:function(){var r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.calcXPositions(),r||this.calcYAxisParameters(this.getAllYValues(),this.type==="line"),this.makeDataByIndex()}},{key:"calcXPositions",value:function(){var r=this.state,s=this.data.labels;r.datasetLength=s.length,r.unitWidth=this.width/r.datasetLength,r.xOffset=r.unitWidth/2,r.xAxis={labels:s,positions:s.map(function(n,o){return Qf(r.xOffset+o*r.unitWidth)})}}},{key:"calcYAxisParameters",value:function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"false",n=Lx(r,s,this.config.yAxisRange),o=this.height/Ix(n),a=o_(n)*o,l=this.height-Bx(n)*a;this.state.yAxis={labels:n,positions:n.map(function(c){return l-c*o}),scaleMultiplier:o,zeroLine:l},this.calcDatasetPoints(),this.calcYExtremes(),this.calcYRegions()}},{key:"calcDatasetPoints",value:function(){var r=this.state,s=function(n){return n.map(function(o){return Jn(o,r.yAxis)})};r.datasets=this.data.datasets.map(function(n,o){var a=n.values,l=n.cumulativeYs||[];return{name:n.name&&n.name.replace(/<|>|&/g,function(c){return c=="&"?"&amp;":c=="<"?"&lt;":"&gt;"}),index:o,chartType:n.chartType,values:a,yPositions:s(a),cumulativeYs:l,cumulativeYPos:s(l)}})}},{key:"calcYExtremes",value:function(){var r=this.state;this.barOptions.stacked?r.yExtremes=r.datasets[r.datasets.length-1].cumulativeYPos:(r.yExtremes=new Array(r.datasetLength).fill(9999),r.datasets.map(function(s){s.yPositions.map(function(n,o){n<r.yExtremes[o]&&(r.yExtremes[o]=n)})}))}},{key:"calcYRegions",value:function(){var r=this.state;this.data.yMarkers&&(this.state.yMarkers=this.data.yMarkers.map(function(s){return s.position=Jn(s.value,r.yAxis),s.options||(s.options={}),s})),this.data.yRegions&&(this.state.yRegions=this.data.yRegions.map(function(s){return s.startPos=Jn(s.start,r.yAxis),s.endPos=Jn(s.end,r.yAxis),s.options||(s.options={}),s}))}},{key:"getAllYValues",value:function(){var r,s=this,n="values";if(this.barOptions.stacked){n="cumulativeYs";var o=new Array(this.state.datasetLength).fill(0);this.data.datasets.map(function(l,c){var u=s.data.datasets[c].values;l[n]=o=o.map(function(p,m){return p+u[m]})})}var a=this.data.datasets.map(function(l){return l[n]});return this.data.yMarkers&&a.push(this.data.yMarkers.map(function(l){return l.value})),this.data.yRegions&&this.data.yRegions.map(function(l){a.push([l.end,l.start])}),(r=[]).concat.apply(r,jt(a))}},{key:"setupComponents",value:function(){var r=this,s=[["yAxis",{mode:this.config.yAxisMode,width:this.width,shortenNumbers:this.config.shortenYAxisNumbers,numberFormatter:this.config.numberFormatter},function(){return this.state.yAxis}.bind(this)],["xAxis",{mode:this.config.xAxisMode,height:this.height},function(){var p=this.state;return p.xAxis.calcLabels=function(m){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],x=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],A=arguments.length>3?arguments[3]:void 0,D=m/w.length*(A||.6);D<=0&&(D=1);var j,ee=D/7;if(x){var d=Math.max.apply(Math,jt(w.map(function(_){return _.length})));j=Math.ceil(d/ee)}var g=w.map(function(_,y){return(_+="").length>ee&&(x?y%j!=0?y!==w.length-1&&(_=""):y>w.length-j/2&&(_=""):_=ee-3>0?_.slice(0,ee-3)+" ...":_.slice(0,ee)+".."),_});return g}(this.width,p.xAxis.labels,this.config.xIsSeries,this.config.seriesLabelSpaceRatio),p.xAxis}.bind(this)],["yRegions",{width:this.width,pos:"right"},function(){return this.state.yRegions}.bind(this)]],n=this.state.datasets.filter(function(p){return p.chartType==="bar"}),o=this.state.datasets.filter(function(p){return p.chartType==="line"}),a=n.map(function(p){var m=p.index;return["barGraph-"+p.index,{index:m,color:r.colors[m],stacked:r.barOptions.stacked,valuesOverPoints:r.config.valuesOverPoints,minHeight:0*r.height},function(){var w=this.state,x=w.datasets[m],A=this.barOptions.stacked,D=this.barOptions.spaceRatio||.5,j=w.unitWidth*(1-D),ee=j/(A?1:n.length),d=w.xAxis.positions.map(function(y){return y-j/2});A||(d=d.map(function(y){return y+ee*m}));var g=new Array(w.datasetLength).fill("");this.config.valuesOverPoints&&(g=A&&x.index===w.datasets.length-1?x.cumulativeYs:x.values);var _=new Array(w.datasetLength).fill(0);return A&&(_=x.yPositions.map(function(y,O){return y-x.cumulativeYPos[O]})),{xPositions:d,yPositions:x.yPositions,offsets:_,labels:g,zeroLine:w.yAxis.zeroLine,barsWidth:j,barWidth:ee}}.bind(r)]}),l=o.map(function(p){var m=p.index;return["lineGraph-"+p.index,{index:m,color:r.colors[m],svgDefs:r.svgDefs,heatline:r.lineOptions.heatline,regionFill:r.lineOptions.regionFill,spline:r.lineOptions.spline,showDots:r.lineOptions.showDots,trailingDot:r.lineOptions.trailingDot,hideDotBorder:r.lineOptions.hideDotBorder,hideLine:r.lineOptions.hideLine,valuesOverPoints:r.config.valuesOverPoints},function(){var w=this.state,x=w.datasets[m],A=w.yAxis.positions[0]<w.yAxis.zeroLine?w.yAxis.positions[0]:w.yAxis.zeroLine;return{xPositions:w.xAxis.positions,yPositions:x.yPositions,values:x.values,zeroLine:A,radius:this.lineOptions.dotSize||4}}.bind(r)]}),c=[["yMarkers",{width:this.width,pos:"right"},function(){return this.state.yMarkers}.bind(this)]];s=s.concat(a,l,c);var u=["yMarkers","yRegions"];this.dataUnitComponents=[],this.components=new Map(s.filter(function(p){return!u.includes(p[0])||r.state[p[0]]}).map(function(p){var m=Ws.apply(void 0,jt(p));return(p[0].includes("lineGraph")||p[0].includes("barGraph"))&&r.dataUnitComponents.push(m),[p[0],m]}))}},{key:"makeDataByIndex",value:function(){var r=this;this.dataByIndex={};var s=this.state,n=this.config.formatTooltipX,o=this.config.formatTooltipY;s.xAxis.labels.map(function(a,l){var c=r.state.datasets.map(function(u,p){var m=u.values[l];return{title:u.name,value:m,yPos:u.yPositions[l],color:r.colors[p],formatted:o?o(m,{name:u.name,index:u.index,values:u.values}):m}});r.dataByIndex[l]={label:a,formattedLabel:n?n(a):a,xPos:s.xAxis.positions[l],values:c,yExtreme:s.yExtremes[l]}})}},{key:"bindTooltip",value:function(){var r=this;this.container.addEventListener("mousemove",function(s){var n=r.measures,o=Qn(r.container),a=s.pageX-o.left-Zn(n),l=s.pageY-o.top;l<r.height+eo(n)&&l>eo(n)?r.mapTooltipXPosition(a):r.tip.hideTip()})}},{key:"mapTooltipXPosition",value:function(r){var s=this.state;if(s.yExtremes){var n=function(a,l){var c=arguments.length>2&&arguments[2]!==void 0&&arguments[2],u=l.reduce(function(p,m){return Math.abs(m-a)<Math.abs(p-a)?m:p},[]);return c?l.indexOf(u):u}(r,s.xAxis.positions,!0);if(n>=0){var o=this.dataByIndex[n];this.tip.setValues(o.xPos+this.tip.offset.x,o.yExtreme+this.tip.offset.y,{name:o.formattedLabel,value:""},o.values,n),this.tip.showTip()}}}},{key:"renderLegend",value:function(){var r=this.data;r.datasets.length>1&&Pt(xt(t.prototype),"renderLegend",this).call(this,r.datasets)}},{key:"makeLegend",value:function(r,s,n,o){return i_(n,o+5,12,3,this.colors[s],r.name,null,8.75,this.config.truncateLegends)}},{key:"makeOverlay",value:function(){var r=this;this.init?this.init=0:(this.overlayGuides&&this.overlayGuides.forEach(function(s){var n=s.overlay;n.parentNode.removeChild(n)}),this.overlayGuides=this.dataUnitComponents.map(function(s){return{type:s.unitType,overlay:void 0,units:s.units}}),this.state.currentIndex===void 0&&(this.state.currentIndex=this.state.datasetLength-1),this.overlayGuides.map(function(s){var n=s.units[r.state.currentIndex];s.overlay=bx[s.type](n),r.drawArea.appendChild(s.overlay)}))}},{key:"updateOverlayGuides",value:function(){this.overlayGuides&&this.overlayGuides.forEach(function(r){var s=r.overlay;s.parentNode.removeChild(s)})}},{key:"bindOverlay",value:function(){var r=this;this.parent.addEventListener("data-select",function(){r.updateOverlay()})}},{key:"bindUnits",value:function(){var r=this;this.dataUnitComponents.map(function(s){s.units.map(function(n){n.addEventListener("click",function(){var o=n.getAttribute("data-point-index");r.setCurrentDataPoint(o)})})}),this.tip.container.addEventListener("click",function(){var s=r.tip.container.getAttribute("data-point-index");r.setCurrentDataPoint(s)})}},{key:"updateOverlay",value:function(){var r=this;this.overlayGuides.map(function(s){var n=s.units[r.state.currentIndex];vx[s.type](n,s.overlay)})}},{key:"onLeftArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex-1)}},{key:"onRightArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex+1)}},{key:"getDataPoint",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.state.currentIndex,s=this.state,n={index:r,label:s.xAxis.labels[r],values:s.datasets.map(function(o){return o.values[r]})};return n}},{key:"setCurrentDataPoint",value:function(r){var s=this.state;(r=parseInt(r))<0&&(r=0),r>=s.xAxis.labels.length&&(r=s.xAxis.labels.length-1),r!==s.currentIndex&&(s.currentIndex=r,function(n,o,a){var l=document.createEvent("HTMLEvents");for(var c in l.initEvent(o,!0,!0),a)l[c]=a[c];n.dispatchEvent(l)}(this.parent,"data-select",this.getDataPoint()))}},{key:"addDataPoint",value:function(r,s){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.state.datasetLength;Pt(xt(t.prototype),"addDataPoint",this).call(this,r,s,n),this.data.labels.splice(n,0,r),this.data.datasets.map(function(o,a){o.values.splice(n,0,s[a])}),this.update(this.data)}},{key:"removeDataPoint",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.state.datasetLength-1;this.data.labels.length<=1||(Pt(xt(t.prototype),"removeDataPoint",this).call(this,r),this.data.labels.splice(r,1),this.data.datasets.map(function(s){s.values.splice(r,1)}),this.update(this.data))}},{key:"updateDataset",value:function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.data.datasets[s].values=r,this.update(this.data)}},{key:"updateDatasets",value:function(r){this.data.datasets.map(function(s,n){r[n]&&(s.values=r[n])}),this.update(this.data)}}]),t}(),Xf={bar:Sl,line:Sl,percentage:Ox,heatmap:Mx,pie:Kf,donut:function(i){br(t,Kf);var e=vr(t);function t(r,s){return Vt(this,t),e.call(this,r,s)}return ai(t,[{key:"configure",value:function(r){Pt(xt(t.prototype),"configure",this).call(this,r),this.type="donut",this.sliceName="donutSlices",this.arcFunc=hx,this.shapeFunc=fx,this.strokeWidth=r.strokeWidth||30}},{key:"getRadius",value:function(){return this.height>this.width?this.center.x-this.strokeWidth/2:this.center.y-this.strokeWidth/2}},{key:"resetHover",value:function(r,s){Cl(r,"translate3d(0,0,0)"),this.tip.hideTip(),r.style.stroke=s}},{key:"setupComponents",value:function(){var r=this.state,s=[[this.sliceName,{},function(){return{sliceStrings:r.sliceStrings,colors:this.colors,strokeWidth:this.strokeWidth}}.bind(this)]];this.components=new Map(s.map(function(n){var o=Ws.apply(void 0,jt(n));return[n[0],o]}))}}]),t}()},a_=function i(e,t){return Vt(this,i),function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"line",s=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return r==="axis-mixed"?(n.type="line",new Sl(s,n)):Xf[r]?new Xf[r](s,n):void console.error("Undefined chart type: "+r)}(t.type,e,t)};frappe.provide("frappe.ui");frappe.Chart=a_;frappe.ui.RealtimeChart=class extends frappe.Chart{constructor(e,t,r=8,s){super(e,s),s.data.datasets[0].values.length>r&&frappe.throw(__("Length of passed data array is greater than value of maximum allowed label points!")),this.currentSize=s.data.datasets[0].values.length,this.socketEvent=t,this.maxLabelPoints=r,this.start_updating=function(){frappe.realtime.on(this.socketEvent,n=>{this.update_chart(n.label,n.points)})},this.stop_updating=function(){frappe.realtime.off(this.socketEvent)},this.update_chart=function(n,o){this.currentSize>=this.maxLabelPoints?this.removeDataPoint(0):this.currentSize++,this.addDataPoint(__(n),o)}}};var T_=Ut(S_());frappe.DataTable=T_.default;var $_=Ut(E_());frappe.Driver=$_.default;frappe.provide("frappe.ui");frappe.ui.Scanner=class{constructor(e){this.dialog=null,this.handler=null,this.options=e,this.is_alive=!1,"multiple"in this.options||(this.options.multiple=!1),e.container&&(this.$scan_area=$(e.container),this.scan_area_id=frappe.dom.set_unique_id(this.$scan_area)),e.dialog&&(this.dialog=this.make_dialog(),this.dialog.show())}scan(){this.load_lib().then(()=>this.start_scan())}start_scan(){this.handler||(this.handler=new Html5Qrcode(this.scan_area_id)),this.handler.start({facingMode:"environment"},{fps:10,qrbox:250},(e,t)=>{if(this.options.on_scan)try{this.options.on_scan(t)}catch(r){console.error(r)}this.options.multiple||(this.stop_scan(),this.hide_dialog())},e=>{}).catch(e=>{this.is_alive=!1,this.hide_dialog(),console.error(e)}),this.is_alive=!0}stop_scan(){this.handler&&this.is_alive&&this.handler.stop().then(()=>{this.is_alive=!1,this.$scan_area.empty(),this.hide_dialog()})}make_dialog(){let e=new frappe.ui.Dialog({title:__("Scan QRCode"),fields:[{fieldtype:"HTML",fieldname:"scan_area"}],on_page_show:()=>{this.$scan_area=e.get_field("scan_area").$wrapper,this.$scan_area.addClass("barcode-scanner"),this.scan_area_id=frappe.dom.set_unique_id(this.$scan_area),this.scan()},on_hide:()=>{this.stop_scan()}});return e}hide_dialog(){this.dialog&&this.dialog.hide()}load_lib(){return frappe.require("/assets/frappe/node_modules/html5-qrcode/html5-qrcode.min.js")}};frappe.provide("frappe.ui");frappe.ui.AddressAutocompleteDialog=class{constructor(e){this.title=(e==null?void 0:e.title)||__("New Address"),this.link_doctype=e==null?void 0:e.link_doctype,this.link_name=e==null?void 0:e.link_name,this.after_insert=e==null?void 0:e.after_insert,this.dialog=this._get_dialog()}_get_dialog(){let e=new frappe.ui.Dialog({title:this.title,fields:[{fieldname:"search",fieldtype:"Autocomplete",label:__("Search"),reqd:1,get_query:"frappe.integrations.doctype.geolocation_settings.geolocation_settings.autocomplete",onchange:()=>{frappe.model.with_doctype("Address",()=>{let t=this.parse_selected_value();frappe.get_meta("Address").fields.filter(o=>o.reqd&&!o.default&&o.fieldname!=="address_type").filter(o=>!t[o.fieldname]).length===0?e.enable_primary_action():e.disable_primary_action()})}}],primary_action_label:__("Create Address"),primary_action:()=>{e.hide();let t=this.parse_selected_value();t.doctype="Address",t.links=[{link_doctype:this.link_doctype,link_name:this.link_name}],frappe.db.insert(t).then(r=>{this.after_insert&&this.after_insert(r)})},secondary_action_label:__("Edit Address in Form"),secondary_action:()=>{e.hide();let t=this.parse_selected_value();frappe.new_doc("Address",t)}});return e}parse_selected_value(){let e=this.dialog.get_values();return JSON.parse(e.search)}show(){this.dialog.show()}};})();
/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
/*!
 * CodeX.Tooltips
 * 
 * @version 1.0.5
 * 
 * @licence MIT
 * @author CodeX <https://codex.so>
 * 
 * 
 */
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*!
 * Library for handling keyboard shortcuts
 * @copyright CodeX (https://codex.so)
 * @license MIT
 * @author CodeX (https://codex.so)
 * @version 1.2.0
 */
/*! Sortable 1.15.0 - MIT | git://github.com/SortableJS/Sortable.git */
/*! showdown v 2.1.0 - 21-04-2022 */
/**
 * Base Paragraph Block for the Editor.js.
 * Represents a regular text block
 *
 * @author CodeX (team@codex.so)
 * @copyright CodeX 2018
 * @license The MIT License (MIT)
 */
/**
 * Editor.js
 *
 * @license Apache-2.0
 * @see Editor.js <https://editorjs.io>
 * @author CodeX Team <https://codex.so>
 */
//# sourceMappingURL=desk.bundle.KKKODCIC.js.map
